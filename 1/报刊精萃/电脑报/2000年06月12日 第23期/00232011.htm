<HTML>
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='images/epcw.css' TYPE='text/css'>
 
<TITLE>电脑报电子版 --在powerbuilder 中向Excel传递数据</TITLE>
 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
<span class="centertitle"></span> 
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
<TR VALIGN='top'><TD WIDTH='100%'><IMG SRC='images/dot.gif' WIDTH='468' HEIGHT='1'></TD></TR>
</TABLE><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
<TR>
<TD WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'><img src="images/yjds.gif" width="468" height="50"></TD>
</TR>
</TABLE><TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
<TR>
<TD WIDTH='100%'><IMG SRC='images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
</TR>
</TABLE>
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
<TR VALIGN='bottom'>
<TD WIDTH='100%'><IMG SRC='images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
</TR></TABLE>
<table width='468' border='0' cellspacing='0' cellpadding='2' align='Center'>
  <tr> 
    <td width='615' colspan='2'><font color="#FF6666">当前位置：</font><a href='index.html'>YESKY电子版</a> 
      &gt; <a href='http://drivers.cpcw.com/issue.htm'>2000 年</a> &gt; <a href="index.html">23期</a> 
      &gt; <a href="software.html">软件世界</a> &gt; 在powerbuilder 中向Excel传递数据</td>
  </tr>
</table>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'><TR ALIGN='center' VALIGN='bottom'><TD HEIGHT='6'><IMG SRC='images/dot.gif' WIDTH='468' HEIGHT='1'></TD></TR></TABLE>
<BR><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
<TR>
    <TD><SPAN CLASS='title'>《 在powerbuilder 
      中向Excel传递数据 
      》</SPAN></TD>
</TR></TABLE><BR><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
<TR>
    <TD>　　PowerBuilder是面向对象的数据库开发工具之一，它可以操纵很多大型数据库和桌面数据库，但它对中国式报表打印不太方便，而 
      Excel对此却非常容易，若把两者结合起来使用则可取长补短。<br>
      　　建立一个Excel工作表如图1，以mxz.xls为文件名保存。<br>
      　　然后编写脚本如下并执行：<br>
      　　long handle_1<br>
      　　handle_1=openchannel(″excel″,″mxz.xls″)　建立与Excel的通道<br>
      　　setremote(″r2c1″,″序号″,″excel″,″mxz.xls″)<br>
      　　setremote(″r2c2″,″摘要″,″excel″,″mxz.xls″)<br>
      　　setremote(″r2c3″,″收入″,″excel″,″mxz.xls″)<br>
      　　setremote(″r2c4″,″支出″,″excel″,″mxz.xls″)<br>
      　　setremote(″r2c5″,″余额″,″excel″,″mxz.xls″)<br>
      　　setremote(″r2c6″,″日期″,″excel″,″mxz.xls″)<br>
      　　execremote(″[Save()]″,″excel″,″xmk.xls″)<br>
      　　上述脚本执行后，再打开mxz.xls，它变成了如图2的模样：<br>
      　　其实，这段脚本用到了三个DDE客户函数：OpenChannel()、SetRemote()和ExecRemote()，其实，掌握了这三个DDE函数，就可以随心所欲地写出打印功能十分强大的PowerBuilder数据库程序来。<br>
      　　一、OpenChannel()<br>
      　　它的功能是打开连接DDE服务器的通道。<br>
      　　语法<br>
      　　OpenChannel ( applname, topicname {, windowhandle } )<br>
      　　参数<br>
      applname：string类型，指定DDE服务器应用的DDE名称。<br>
      　　topicname：string类型，指定命令中要使用的DDE应用的数据或实例。<br>
      　　windowhandle：long类型，可选项，指明用作DDE客户的PowerBuilder窗口的窗口句柄。省略该参数时，当前应用中的活动窗口用作DDE客户。<br>
      　　返回值<br>
      　　long类型。函数执行成功时返回一个正数作为已打开通道的句柄，发生错误时返回下述值之一：<br>
      　　－1打开失败。<br>
      　　－9句柄为NULL。<br>
      　　示例： 下面的代码建立到Excel的DDE通道，之后请求三个单元格的数据，并把这些数据保存在数组s_regiondata中。DDE会话的客户端窗口为w_ddewin：<br>
      　　long handle<br>
      　　string s_regiondata[3]<br>
      　　handle = OpenChannel(″Excel″, ″REGION.XLS″, Handle(w_ddewin))<br>
      　　GetRemote(″R1C2″, s_regiondata[1], handle, Handle(w_ddewin))<br>
      　　GetRemote(″R1C3″, s_regiondata[2], handle, Handle(w_ddewin))<br>
      　　GetRemote(″R1C4″, s_regiondata[3], handle, Handle(w_ddewin))<br>
      　　CloseChannel(handle, Handle(w_ddewin))<br>
      　　二、SetRemote()<br>
      　　功能是请求服务器应用把指定项设置为指定值。该函数有两种语法格式，下面分别予以介绍：<br>
      　　语法一，请求DDE服务器应用接收保存在指定位置的数据，该格式不要求事先打开通道，适用于仅发出少数几个请求的情况。<br>
      　　SetRemote ( location, value, applname, topicname )<br>
      　　参数<br>
      　　location：string类型，指明要DDE服务器的哪一部分接收数据，位置的表达方式由具体的DDE服务器决定。<br>
      　　value：string类型变量，指定发送给DDE服务器的数据。<br>
      　　applname：string类型，指定DDE服务器应用的DDE名称。<br>
      　　topicname：string类型，指定要接收数据的DDE应用的数据或实例。<br>
      　　返回值<br>
      　　integer类型。函数执行成功时返回1，发生错误时返回下述值之一：<br>
      　　－1未启动连接。<br>
      　　－2请求被拒绝，如果任何参数的值为NULL，SetRemote()函数返回NULL。<br>
      　　示例：下面的代码请求Excel把工作表SALES.XLS的第5行第8列单元的值设置为5500：<br>
      　　SetRemote(″R5C8″, ″5500″, ″Excel″, ″SALES.XLS″)<br>
      　　语法二，请求DDE服务器应用接收保存在指定位置的数据，该格式适用于热连接的情况，即应用程序已经与服务器建立通道。<br>
      　　SetRemote ( location, value, handle {, windowhandle } )<br>
      　　参数<br>
      　　location：string类型，指明要DDE服务器的哪一部分接收数据。位置的表达方式由具体的DDE服务器决定。<br>
      　　value：string类型变量，指定发送给DDE服务器的数据。<br>
      　　handle：long类型，指定使用的DDE通道句柄。<br>
      　　windowhandle：long类型，可选项，指明用做DDE客户的PowerBuilder窗口的窗口句柄。省略该参数时，当前应用中的活动窗口用做DDE客户。<br>
      　　返回值<br>
      　　integer类型。函数执行成功时返回1，发生错误时返回下述值之一：<br>
      　　－1未启动连接。<br>
      　　－2请求被拒绝。<br>
      －9 Handle参数的值为NULL。<br>
      　　示例：下面的代码先打开一个通道，然后请求Excel将第5行第8列单元的值设置为5500：<br>
      　　long hand<br>
      　　lehandle = OpenChannel(″Excel″, ″REGION.XLS″)<br>
      　　SetRemote(″R5C8″, ″5500″, handle)<br>
      　　三、ExecRemote()<br>
      　　它的功能是请求DDE服务器应用程序执行命令。该函数也有两种语法格式，下面分别予以介绍。<br>
      　　语法一，直接向DDE服务器应用发送一条命令（冷连接方式）；<br>
      　　ExecRemote ( command, applname, topicname )<br>
      　　参数<br>
      　　command：string类型，其值为希望DDE服务器应用执行的命令，命令格式和语法需要参看DDE服务器应用的文档。<br>
      　　applname：string类型，指定服务器应用的DDE名称。<br>
      　　topicname：string类型，指定命令中要使用的DDE应用的数据或实例返回值Integer。函数执行成功时返回1，发生错误时返回下述值之一：<br>
      　　－1未启动连接。<br>
      　　－2请求被拒绝。<br>
      －3不能终止服务器。<br>
      　　如果任何参数的值为NULL，ExecRemote()函数返回NULL。<br>
      　　示例：下面的语句请求Excel将活动工作表的内容保存到文件REGION.XLS中：<br>
      　　ExecRemote(″[Save()]″, ″Excel″, ″REGION.XLS″)<br>
      　　语法二，应用程序打开某个通道后向DDE服务器应用发送命令（热连接方式）<br>
      　　ExecRemote ( command, handle {, windowhandle } )<br>
      　　参数<br>
      　　command：string类型，其值为希望DDE服务器应用执行的命令，命令格式和语法需要参看DDE服务器应用的文档<br>
      　　handle：long类型，指定使用的DDE通道句柄<br>
      　　windowhandle：long类型，可选项，指明用做DDE客户的PowerBuilder窗口的窗口句柄。省略该参数时，当前应用中的活动窗口用做DDE客户，返回值integer。函数执行成功时返回1，发生错误时返回下述值之一：<br>
      　　－1未启动连接。<br>
      　　－2请求被拒绝－9handle参数的值为NULL。<br>
      　　（新疆　尚建军）</TD>
  </TR></TABLE><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
<TR>
    <TD>&nbsp;</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
</TR></TABLE><BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
<TR ALIGN='center' VALIGN='bottom'>
<TD HEIGHT='6'><IMG SRC='images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
</TR></TABLE><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
<TR ALIGN='center'>
    <TD>&nbsp;</TD>
    <TD> <a name='top'></a> <img src='http://cq.cpcw.com/cgi-bin/Count.cgi?ft=2|md=8|df=cpcw.dat|dd=E|cache=F|expires=18000' width='1' height='1' alt='312345678'> 
      
       YESKY版权所有，<A HREF='mailto:webmaster@cpcw.com'>YESKY网站编辑部</A>设计制作发布</TD>
</TR>
</TABLE></BODY></HTML>