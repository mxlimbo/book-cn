 
<HTML>
 
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='images/epcw.css' TYPE='text/css'>
 
<TITLE>电脑报电子版 -- 统计图片的点击率</TITLE>
 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
 

 
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='top'> 
    <TD WIDTH='100%'>&nbsp;</TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
  <TR> 
    <TD WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'> 
      <img src="images/yjds.gif" height="50" width="468">
    </TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR> 
    <TD WIDTH='100%'><IMG SRC='../images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='bottom'> 
    <TD WIDTH='100%'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='Center'>
  <TR> 
    <TD WIDTH='615' COLSPAN='2'><font color="#FF6666">当前位置：</font><A HREF='index.html'>CPCW电子版</A> 
      &gt; <A HREF='http://drivers.cpcw.com/issue.htm'>2000 年</A> &gt; <a href="index.html">27期</a> 
      &gt; <a href="internet.html">互联网时代</a> &gt; 统计图片的点击率</TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
  <TR> 
    <TD><SPAN CLASS='title'>《 统计图片的点击率 
      》</SPAN></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD> 
      <p>　　如果你跟我一样，自己的主页是提供各种图片服务的，那么知道哪些图片受欢迎，哪些不受欢迎是相当有必要的。在这里，向大家介绍一下我用ASP如何解决这个问题的。<br>
        　　我们首先来分析一下。一般作为图片站点，首先显示出来的是一些小尺寸的缩略图，点击后才显示出大图。因此，我们可以在小图与大图之间的链接上做文章，让小图的链接指向一个ASP文件，由这个ASP文件将点击记录下来，然后再显示出大图，原理是相当简单的。<br>
        　　首先，我们要建立一个用来记录点击的数据库文件，我用的是ACCESS97，其它的数据库也可以。在这个库中，只需要一个表，取名就叫1吧。数据库字段有三个：picturename（字符型），clicktimes（数字型），starttime（日期型），第一个是图片的名字，第二个是点击的总次数，第三个是第一次点击的时间。注意，字段名不能用汉字。<br>
        　　建好库后，接下来是界面和程序的编制。在FrontPage2000中新建一个HTML文件，插入几张图片，并用缩略图功能把它缩成小图，保存。再新建一个ASP文件，它的源代码如下：<br>
        　　&lt;％ Server.ScriptTimeOut = 60 //设置超时时间<br>
        　　 Response.Expires =0％&gt; //设置网页的过期时间为0<br>
        　　&lt;!－－＃include file =″adovbs.inc″ －－&gt; //调入VB常量说明文件<br>
        　　&lt;％<br>
        　　Dim picturename1,clicktimes1,starttime1 //申明用来保存数据的变量。<br>
        　　Dim connection,record　//申明用来打开数据库的变量。<br>
        　　Picturename1= Request.QueryString(″picturename″)//取得图片的名字。<br>
        　　Set connection = Server.CreateObject(″ADODB.Connection″) <br>
        　　 Set record= Server.CreateObject(″ADODB.Recordset″) <br>
        　　 Record.locktype=3 //设置record对象的锁定方式<br>
        　　 Record.cursortype=adopenforwardonly //设置游标的方向只能向前<br>
        　　 dsn =server.MapPath(″access.dsn″) //取得access.dsn在服务器的路径<br>
        　　mdb=server.mappath(″click.mdb″) 　　//取得click.mdb的路径<br>
        　　mydsn=″filedsn=″＋dsn＋″;dbq=″＋mdb＋″;″ <br>
        　　connection.Open mydsn <br>
        　　//以上这些是打开数据库的操作。其中access.dsn是一个ACCESS数据库的配置文件。<br>
        　　下面，我们要取得在数据库中图片名字对应的点击次数。首先在库中查找有没有这个名字。<br>
        　　sql=″SElect ＊ from 1 where picturename=′″＆picturename1＆″′″ //构建SQL语句。<br>
        　　Record.open sql, connection //执行SQL查询<br>
        　　查询后，我们要判断一下库中有没有对应的记录。如果没有就要新建一个：<br>
        　　if record.EOF=true then<br>
        　　thistime=1<br>
        　　currenttime=date<br>
        　　Record.close() //关闭record这个对象,下面要重新以另一种方式打开<br>
        　　sql=″insert into 1(picname,clicktimes,starttime) values(′″＆picturename1＆″′,′″＆thistime＆″′,′″＆currenttime＆″′)″　′构建SQL插入语句<br>
        　　set record=connection.Execute(sql)<br>
        　　else<br>
        　　totaltimes=cint(record(″clicktimes″)) //从数据库中取得以前存入的点击次数<br>
        　　totaltimes=totaltimes＋1 //加上这一次<br>
        　　record(″clicktimes″)=totoletimes //重新赋值<br>
        　　record.updata() //更新数据库中的记录<br>
        　　endif <br>
        　　％&gt;<br>
        　　以上，点击记录的工作就基本上完成了，千万别忘了，还要把图显示出来。这也很简单，只需在&lt;body&gt;与&lt;/body&gt;间加入一句 
        &lt;img border =″0″ src=″&lt;％=picturename1％&gt; &gt;就可以了。如果需要的话，还可以写上总的点击次数：&lt;％ 
        Response.Write picturename1＆″这幅图片总共被点击″＆totaltimes＆″次″ ％&gt;<br>
        　　到此为止，ASP部分就完成了。在前一个HTML文件中还要作些小改动。把所有的<br>
        　　&lt;a href=″文件名″&gt;&lt;img border=″0″ src=″文件名_small.jpg″ alt=″文件名.jpg 
        (48344 字节)″ width=″120″ height=″98″&gt;&lt;/a&gt;<br>
        　　通通都改成&lt;a href=″jilu.asp?picturename=文件名&gt;&lt;img border=″0″ src=″文件名_small.jpg″ 
        alt=″文件名.jpg (48344 字节)″ width=″120″ height=″98″&gt;&lt;/a&gt;其中jilu.asp是刚才的那个ASP文件名。<br>
        　　如果就记录点击情况而言，上面这些基本上就足够了。但是这样记录下的的结果需要下载下来才知道，这似乎有点太原始了。所以下面还要加入在线统计的功能。<br>
        　　用来统计的程序，应该能够按升序或降序排列记录，显示每天的点击率，如果条目太多，还有必要加入翻页功能。<br>
        　　查看统计只是让站长做的工作，所以设置一个密码是很有必要的。因此，新建一个HTML文件，插入一个表单：<br>
        　　&lt;form method=″POST″ action=″tongji.asp″&gt;<br>
        　　&lt;p&gt;&lt;input type=″radio″ value=″升″ checked name=″R1″&gt;升序排列<br>
        　　&lt;input type=″radio″ name=″R1″ value=″降″&gt;降序排列&lt;/p&gt;<br>
        　　&lt;p&gt;&lt;input type=″text″ name=″T1″ size=″20″&gt;&lt;input type=″submit″ 
        value=″提交″ name=″B1″&gt;&lt;input type=″reset″ value=″全部重写″ name=″B2″&gt;&lt;/p&gt;<br>
        　　&lt;p&gt;　&lt;/p&gt;<br>
        　　&lt;/form&gt;<br>
        　　下面是tongji.asp的内容：<br>
        　　&lt;％<br>
        　　if (request.From(T1)&lt;&gt;″1234″) then <br>
        　　response.write ″你不能进入！！！″<br>
        　　response.end<br>
        　　end if<br>
        　　Set connection = Server.CreateObject(″ADODB.Connection″) <br>
        　　Set record= Server.CreateObject(″ADODB.Recordset″) <br>
        　　Record.locktype=3 　<br>
        　　Record.cursortype=adopenforwardonly <br>
        　　dsn =server.MapPath(″access.dsn″) <br>
        　　mdb=server.mappath(″click.mdb″) 　　<br>
        　　mydsn=″filedsn=″＋dsn＋″;dbq=″＋mdb＋″;″ <br>
        　　connection.Open mydsn<br>
        　　if request.Form(R1)=″升″　then<br>
        　　 sql=″select ＊ from 1 order by clicktimes″ <br>
        　　Else<br>
        　　 Sql= ″select ＊ from 1 order by clicktimes DESC″<br>
        　　End if<br>
        　　 Record.open sql,connection //执行SQL<br>
        　　cuttenttime=date<br>
        　　％&gt;<br>
        　　下面是显示的部分,这里用一个表格来分隔各种数据：<br>
        　　&lt;table border=″1″ width=″100％″&gt;<br>
        　　&lt;％while record.eof =false <br>
        　　if record(″clicktimes″)=0 then record.MoveNext ％&gt; //在数据库中有一些数据并不正常,要排除它们。<br>
        　　&lt;tr&gt;<br>
        　　&lt;td width=″33％″&gt;&lt;％=record(″picname″)％&gt; 　&lt;/td&gt;<br>
        　　&lt;td width=″33％″&gt;&lt;％=record(″clicktimes″)％&gt;　&lt;/td&gt;<br>
        &lt;td width=″34％″&gt;&lt;％=csng( record(″clicktimes″)/(datediff(″d″,record(″starttime 
        ″),currenttime,0,0)＋1))％&gt;　&lt;/td&gt;<br>
        　　&lt;/tr&gt;<br>
        　　&lt;％<br>
        　　record.MoveNext //游标向下移<br>
        　　wend％&gt;　　<br>
        　　&lt;/table&gt;<br>
        　　到这里，一个简单的图片点击记录、统计的ASP程序就完成了，希望大家在这个基础上添枝加叶，也欢迎大家与我探讨其它的编程问题，我的信箱是：timer1@cmmail.com。</p>
      <p align="right">　　(重庆　余　疆)</p>
      　　　　　　　　　　　　　 
    </TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>&nbsp;</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR ALIGN='center'> 
    <TD>&nbsp;</TD>
    <TD> CPCW版权所有，<A HREF='mailto:webmaster@cpcw.com'>CPCW网站编辑部</A>设计制作发布</TD>
  </TR>
</TABLE>
</BODY>

</HTML>
