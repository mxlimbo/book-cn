 
<HTML>
<!-- #BeginTemplate "/模板/software.dwt" --> 
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='epcw.css' TYPE='text/css'>
<!-- #BeginEditable "doctitle" --> 
<TITLE>电脑报电子版 -- 用VC++编程控制计算机和光驱</TITLE>
<!-- #EndEditable --> 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
<span class="centertitle"></span> 
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='top'> 
    <TD WIDTH='100%'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
  <TR> 
    <TD WIDTH='145' BGCOLOR='#CCCC99' 	ALIGN='Center' VALIGN='top'><A HREF='http://www.yesky.com'><IMG SRC='images/logo.gif' WIDTH='143' HEIGHT='50' ALT='电脑报' BORDER='0'></A></TD>
    <TD WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'> 
      <a href="http://chat.yesky.com"><img src="images/0823-3.gif" width="468" height="60" border="0"></a>
    </TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR> 
    <TD WIDTH='100%'><IMG SRC='../../images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='bottom'> 
    <TD WIDTH='100%'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<table width='615' border='0' cellspacing='0' cellpadding='2' align='Center'>
  <tr> 
    <td width='615' colspan='2'><font color="#FF6666">当前位置：</font><a href='http://www.cpcw.com/issue/index.html'>CPCW电子版</a> 
      &gt; <a href='http://www.cpcw.com/issue/all.html'>2000 年</a> &gt; <a href="index.html"><!-- #BeginEditable "%C6%DA" -->34期<!-- #EndEditable --></a> 
      &gt; <!-- #BeginEditable "%C0%B8%C4%BF" --><a href="software.html">软件世界</a><!-- #EndEditable --> 
      &gt; <!-- #BeginEditable "%B1%EA%CC%E2" -->{用VC++编程控制计算机和光驱}<!-- #EndEditable --></td>
  </tr>
</table>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
  <TR> 
    <TD><SPAN CLASS='title'>《 <!-- #BeginEditable "%CE%C4%D5%C2%CD%B7" -->{用VC++编程控制计算机和光驱}<!-- #EndEditable --> 
      》</SPAN></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD><!-- #BeginEditable "%CE%C4%D5%C2%C4%DA%C8%DD" -->{　　通常有些程序在初次使用时，要进行一些像安装特定字体的设置，之后需要重新启动计算机使之生效；而在一些多媒体软件编程中会用到用程序操纵CD_ROM的开与关的情况。为了说明在VC中实现这两项功能的方法，我们创建一个基于对话框、名为Control的工程。对话框的外观如图1所示，其中四个按钮（Button）属性设置见下表， 
      <br>
      　　<br>
      　　<br>
      　　（1） 重新启动计算机<br>
      　　先获取操作系统版本，然后调用ExitWindowsEx函数重新启动计算机。为IDC_RESTARTCOMPUTER按钮添加BN_CLICKED消息处理函数如下：<br>
      　　void CControlDlg::OnRestartcomputer() <br>
      　　{ OSVERSIONINFO OsVersionInfo;//包含操作系统版本信息的数据结构<br>
      　　 OsVersionInfo.dwOSVersionInfoSize= sizeof(OSVERSIONINFO);<br>
      　　GetVersionEx(＆OsVersionInfo);//获取操作系统版本信息<br>
      　　if( OsVersionInfo.dwPlatformId == VER_PLATFORM_WIN32_WINDOWS )<br>
      　　{//Windows98,调用ExitWindowsEx（）函数重新启动计算机<br>
      DWORD dwReserved ;<br>
      ExitWindowsEx(EWX_LOGOFF,dwReserved);}}<br>
      　　实际上，通过改变函数ExitWindowsEx的第一个参数可以实现注销用户、关机、关闭电源等操作。<br>
      　　（2）关闭计算机<br>
      　　此功能是通过shell32.dll中一个索引号为60的API函数调用，显示“关闭Windows”对话窗口实现的。<br>
      具体方法为IDC_SHUTDOWNCOMPUTER按钮添加BN_CLICKED消息处理函数：<br>
      void CControlDlg::OnShutdowncomputer() <br>
      　　{HINSTANCE hInst=LoadLibrary(″shell32.dll″);//装入shell32.dll<br>
      SHUTDOWNDLG ShutDownDialog;//指向shell32库中显示关机对话框函数的指针<br>
      　　 if(hInst!=NULL)<br>
      　　 {//获得函数的地址并调用之<br>
      ShutDownDialog=(SHUTDOWNDLG)GetProcAddress(hInst,(LPSTR)60);//<br>
      　　(＊ShutDownDialog)(0);}}<br>
      　　函数中的SHUTDOWNDLG定义如下：<br>
      　　typedef int (CALLBACK ＊SHUTDOWNDLG)(int);//显示关机对话框函数的指针<br>
      　　（3）打开CD_ROM与关闭CD_ROM<br>
      　　方法是先向工程中加入多媒体组件。选择“Project/Add to Project/Components and Controls”菜单项，在弹出的Components 
      and Controls Gallery对话框中选择Visual C＋＋ Components文件夹，然后选择Windows Multimedia 
      library项，按Insert按钮。在之后的消息框中按“是”。这样，在工程中加入了了多媒体组件，在stdafx.h文件中加入了两行语句：<br>
      　　＃include &lt;MMSystem.h&gt;<br>
      　　// CG: The following line was added by the Windows Multimedia component.<br>
      　　＃pragma comment(lib, &quot;winmm.lib&quot;)<br>
      　　然后分别为IDC_OPENCDROM和IDC_CLOSECDROM按钮添加BN_CLICKED消息处理函数如下：<br>
      　　void CControlDlg::OnOpencdrom() //打开光驱<br>
      　　{mciSendString(″Set cdAudio door open wait″, NULL, 0, NULL); }<br>
      　　void CControlDlg::OnClosecdrom() //关闭光驱<br>
      　　{mciSendString(″Set cdAudio door closed wait″, NULL, 0, NULL);}<br>
      　　本程序在中文Windows 98、Visual C＋＋6.0下通过。
      <p></p>
      }<!-- #EndEditable --></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>&nbsp;</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR ALIGN='center'> 
    <TD> 
      <script language="JavaScript" src="http://nethome.yesky.com/sp/yeskye.js">
</script>
    </TD>
    <TD> <noscript></noscript> <a href='/'>《电脑报》版权所有</a>，<a href='mailto:webmaster@staff.yesky.com'>YESKY网站编辑部</a>设计制作发布</TD>
  </TR>
</TABLE>
</BODY>
<!-- #EndTemplate -->
</HTML>
