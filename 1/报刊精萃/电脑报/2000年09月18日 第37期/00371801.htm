 
<HTML>
<!-- #BeginTemplate "/模板/software.dwt" --> 
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='epcw.css' TYPE='text/css'>
<!-- #BeginEditable "doctitle" --> 
<TITLE>电脑报电子版 -- PowerBuilder编程俱乐部</TITLE>
<!-- #EndEditable --> 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
<span class="centertitle"></span> 
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='top'> 
    <TD WIDTH='100%'><IMG SRC='../../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
  <TR> 
    <TD WIDTH='145' BGCOLOR='#CCCC99' 	ALIGN='Center' VALIGN='top'><A HREF='http://www.yesky.com'><IMG SRC='images/logo.gif' WIDTH='140' HEIGHT='60' ALT='天极网' BORDER='0'></A></TD>
    <TD WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'> 
      <a href="http://chat.yesky.com"><img src="images/0823-3.gif" width="468" height="60" border="0"></a>
    </TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR> 
    <TD WIDTH='100%'><IMG SRC='../../../images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='bottom'> 
    <TD WIDTH='100%'><IMG SRC='../../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<table width='615' border='0' cellspacing='0' cellpadding='2' align='Center'>
  <tr> 
    <td width='615' colspan='2'><font color="#FF6666">当前位置：</font><a href='http://www.cpcw.com/issue/index.html'>CPCW电子版</a> 
      &gt; <a href='http://www.cpcw.com/issue/all.html'>2000年</a> &gt; <a href="index.html"><!-- #BeginEditable "%C6%DA" -->37期<!-- #EndEditable --></a> 
      &gt; <!-- #BeginEditable "%C0%B8%C4%BF" --><a href="software.html">软件世界</a><!-- #EndEditable --> 
      &gt; <!-- #BeginEditable "%B1%EA%CC%E2" -->{PowerBuilder编程俱乐部}<!-- #EndEditable --></td>
  </tr>
</table>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
  <TR> 
    <TD><SPAN CLASS='title'>《 <!-- #BeginEditable "%CE%C4%D5%C2%CD%B7" -->{PowerBuilder编程俱乐部}<!-- #EndEditable --> 
      》</SPAN></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD><!-- #BeginEditable "%CE%C4%D5%C2%C4%DA%C8%DD" -->{　　大家好！PowerBuilder（以下简称PB）编程俱乐部又与大家见面了，各位可到俱乐部主页http://kjx.126.com或http://pb70.yeah.net的BBS讨论区去提交或解答问题。如遇主页访问故障，可以直接访问论坛：http://kukoc.abc.yesite.com，俱乐部欢迎你的到来！<br>
      　　一、请问用PB如何调用Windows的API函数，即具体要在哪几个地方写些代码？最好能给出实例。<br>
      　　答：调用 API 函数步骤为：<br>
      　　1．在适当的位置声明函数，如窗口内、Application内、UserObject内，定义在Local External Function或Global 
      External Function中。如播放声音的API函数：<br>
      　　Function boolean sndPlaySoundA (string SoundName, uint Flags) Library 
      ″WINMM.DLL″<br>
      　　Function uint waveOutGetNumDevs () Library ″WINMM.DLL″<br>
      　　也可以创建一个UserObject,集中声明常用的API及函数本地化，如定义用户对象u_external_function：<br>
      　　Declare Local External Function（定义外部函数）:<br>
      　　Function boolean sndPlaySoundA (string SoundName, uint Flags) Library 
      ″WINMM.DLL″<br>
      　　Function uint waveOutGetNumDevs () Library ″WINMM.DLL″<br>
      　　Declare User Object Function（定义用户对象函数）:<br>
      　　 uf_play_sound(string as_wave_name, integer ai_option) <br>
      　　函数内容如下：<br>
      　　 //参数：as_wave_name ：wav文件名<br>
      　　 //ai_option：同步或异步(I/0)<br>
      　　 uint lui_numdevs<br>
      　　 lui_numdevs = WaveOutGetNumDevs() <br>
      　　 if lui_numdevs &gt; 0 Then <br>
      　　 sndPlaySoundA(as_wave_name,ai_option)<br>
      　　 return 1<br>
      　　 else<br>
      　　 return －1<br>
      　　 end If <br>
      　　2．调用时在程序中定义一个实体并调用其函数：<br>
      　　 u_external_function iu_external_function<br>
      　　 iu_external_function = create u_external_function<br>
      　　 iu_external_function.uf_play_sound(′c:\windows\media\ding.wav′,1)<br>
      　　试试看，如果有声卡，就会听到“叮”的一声。<br>
      　　其它API函数也是如此处理。关于如何声明，在俱乐部的主页上有一个帮助，在我的主页PB手记http://liulee.yeah.net 的“源码天地”下也有一个集成了常用API函数的用户对象，你可以下载回去参考。（此题由流方回答）<br>
      　　二、如何在PB应用程序中创建目录？<br>
      　　答：可以用API函数CreateDirectoryA实现，定义:<br>
      　　function boolean CreateDirectoryA(ref string pathname,int sa) Library 
      ″Kernel32.dll″ <br>
      　　调用代码:<br>
      　　 boolean rtn<br>
      　　 string ls_dir<br>
      　　 ls_dir = ″c:\newdir″ //要创建的目录名称<br>
      　　 rtn = CreateDirectoryA(ls_dir,0)<br>
      　　 if rtn then<br>
      　　 Messagebox(″Succeed″,″Succeed!″)<br>
      　　 else<br>
      　　 Messagebox(″Failed″,″Failed!″)<br>
      　　 End if<br>
      　　三、我编的系统中用了OCX控件，当系统编译后发行时必须带上该OCX控件，但在用户的机子上必须注册该OCX控件才能使用，否则程序运行会出错，请问用什么方法注册该OCX控件？<br>
      　　答：提供以下几种方法供参考：<br>
      　　1．在Windows命令行或DOS下运行：regsvr32 ocxname.OCX<br>
      　　2．用Install Shield 做安装程序时，在里面选“Self－Registered”，安装程序将自动注册。<br>
      　　3．在PB程序中调用regsvr32实现，安装程序只需负责将OCX拷贝到相应路径下，这个路径PB程序必须可以得到，建议拷贝到Windows系统目录或者与执行文件同目录下。<br>
      　　具体代码：<br>
      　　//首先定义API函数，如果OCX控件在与执行文件同目录下，使用GetCurrentDirectory函数；如果OCX控件放在系统目录下，使用GetSystemDirectory函数。<br>
      　　Function ulong GetCurrentDirectory(ulong nBufferLength,ref string lpBuffer) 
      Library ″kernel32.dll″ Alias for ″GetCurrentDirectoryA″<br>
      　　Function uint GetSystemDirectory(ref string lpBuffer,uint uSize) Library 
      ″kernel32.dll″ Alias for ″GetSystemDirectoryA″<br>
      　　//假设OCX文件在Windows系统目录下，在PB应用（Application）的Open事件中编写如下代码<br>
      　　string ls_PathName,ls_Command<br>
      　　 ulong ll_RequiredBufferSize<br>
      　　 ls_PathName = Space(255)<br>
      　　 ll_RequiredBufferSize = GetSystemDirectory(ls_PathName,255)<br>
      　　 IF ll_RequiredBufferSize=0 or ll_RequiredBufferSize&gt;255 THEN<br>
      　　 //报错信息<br>
      　　 else<br>
      　　 ls_Command = ″Regsvr32 /s ″ ＋ ″～″″ ＋ ls_PathName ＋ ″\Myocx.ocx″ ＋ ″～″″<br>
      　　Run (ls_Command)<br>
      　　 …<br>
      　　 end if<br>
      　　 Regsvr32后面的″/s″执行参数是为了隐藏注册成功消息框。 （此方法由张涛提供）<br>
      　　 4．在PB应用程序中注册：<br>
      　　 函数声明：<br>
      　　 Function long DllRegisterServer() Library ″ocxname.OCX″<br>
      　　 调用：<br>
      　　 LONG ll_RC<br>
      　　 ll_RC = DllRegisterServer()<br>
      四、如何带参数执行SQL的系统储存过程？我想在script中执行系统存储过程Sp_DropUser删除MS SQL Server 7某用户。我是这样写的：execute 
      Sp_DropUser(Sp_DropUser语法)，编译提示Sp_DropUser为未定义的系统存储过程。<br>
      　　答：代码如下：<br>
      　　 string ls_name<br>
      　　 ls_name = ′username′ //要删除的用户名<br>
      　　 //定义存储过程<br>
      　　 dECLARE dropUser_proc PROCEDURE FOR Sp_DropUser<br>
      　　 @name_in_db =:ls_name;<br>
      　　 SQLca.AutoCommit = TRUE<br>
      　　 EXECUTE dropUser_proc ; //执行<br>
      　　 SQLca.AutoCommit = false}<!-- #EndEditable --></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>&nbsp;</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR ALIGN='center'> 
    <TD> 
      <script language="JavaScript" src="../../download/yeskye.js">
</script>
    </TD>
    <TD> <noscript></noscript> <a href='/'>《电脑报》版权所有</a>，<a href='mailto:webmaster@staff.yesky.com'>YESKY网站编辑部</a>设计制作发布</TD>
  </TR>
</TABLE>
</BODY>
<!-- #EndTemplate -->
</HTML>
