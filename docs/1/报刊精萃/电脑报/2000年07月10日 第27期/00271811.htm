 
<HTML>
 
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='images/epcw.css' TYPE='text/css'>
 
<TITLE>电脑报电子版 -- 用DELPHI开发串口通信软件</TITLE>
 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
<span class="centertitle"></span> 
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='top'> 
    <TD WIDTH='100%'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
  <TR> 
    <TD WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'> 
      <img src="images/yjds.gif" height="50" width="468">
    </TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR> 
    <TD WIDTH='100%'><IMG SRC='../images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='bottom'> 
    <TD WIDTH='100%'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<table width='468' border='0' cellspacing='0' cellpadding='2' align='Center'>
  <tr> 
    <td width='615' colspan='2'><font color="#FF6666">当前位置：</font><a href='index.html'>CPCW电子版</a> 
      &gt; <a href='http://drivers.cpcw.com/issue.htm'>2000 年</a> &gt; <a href="index.html">27期</a> 
      &gt; <a href="software.html">软件世界</a> &gt; 用DELPHI开发串口通信软件</td>
  </tr>
</table>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
  <TR> 
    <TD><SPAN CLASS='title'>《 用DELPHI开发串口通信软件 
      》</SPAN></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>
      <p>　　用Delphi开发串口通信软件一般有两种方法：一是利用Windows的通信API函数，另一种是采用Microsoft的MSComm控件。利用API编写串口通信程序较为复杂，需要掌握大量通信知识，其优点是实现的功能强大，应用面广泛，适合于编写较为复杂的低层次通信程序。而利用MSComm控件则相对较简单，该控件具有丰富的与串口通信密切相关的属性及事件，提供了对串口的各种操作。<br>
        <b>　　一、MSComm控件的主要属性及事件</b><br>
        　　（1）CommPort：设置或返回串行端口号，缺省值1。<br>
        　　（2）Setting：设置或返回串口通信参数，格式为“波特率，奇偶校验位，数据位，停止位”。例如：MSComm1.Setting:=′9600,n,8,1′<br>
        　　（3）PortOpen：打开或关闭串行端口，格式为：MSComm1.PortOpen:={True|False}<br>
        　　（4）InBufferSize：设置或返回接收缓冲区的大小，缺省值为1024字节。<br>
        　　（5）InBufferCount：返回接收缓冲区内等待读取的字节数，可通过设置该属性为0来清空接收缓冲区。<br>
        　　（6）RThreshold：该属性为一阀值，它确定当接收缓冲区内的字节个数达到或超过该值后就产生代码为ComEvReceive的OnComm事件。<br>
        　　（7）SThreshold：该属性为一阀值，它确定当发送缓冲区内的字节个数少于该值后就产生代码为ComEvSend的OnComm事件。<br>
        　　（8）InputLen：设置或返回接收缓冲区内用Input读入的字节数，设置该属性为0表示Input读取整个缓冲区的内容。<br>
        　　（9）Input：从接收缓冲区读取一串字符。<br>
        　　（10）OutBufferSize：设置或返回发送缓冲区的大小，缺省值为512字节。<br>
        　　（11）OutBufferCount：返回发送缓冲区内等待发送的字节数，可通过设置该属性为0来清空缓冲区。<br>
        　　（12）OutPut：向发送缓冲区传送一串字符。<br>
        　　如果在通信过程中发生错误或事件，就会触发OnComm事件，并由CommEvent属性代码反映错误类型，在通信程序的设计中可根据该属性值来执行不同的操作。CommEvent属性值及其含义如下：<br>
        　　（1）ComEvSend：值为1，发送缓冲区的内容少于SThreshold指定的值。<br>
        　　（2）ComEvReceive：值为2，接收缓冲区内字符数达到RThreshold指定的值。<br>
        　　（3）ComEvFrame：值为1004，硬件检测到帧错误。<br>
        　　（4）ComEvRxOver：值为1008，接收缓冲区溢出。<br>
        　　（5）ComEvTxFull：值为1010，发送缓冲区溢出。<br>
        　　（6）ComEvRxParity：值为1009，奇偶校验错误。<br>
        　　（7）ComEvEOF：值为7，接收数据中出现文件尾（ASCII码为26）字符。<br>
        　<b>　二、程序样例</b><br>
        　　在Delphi3.0中无法使用MSComm控件，笔者使用的是Delphi5.0。MSComm控件是VB中的OCX控件，首先需要将其添加到Delphi中，选择菜单“Component”→“Import 
        ActiveX Control”，在“Import ActiveX”页内选择“Microsoft Comm Control”，点击“Install”安装，安装后在“ActiveX”组件板中出现MSComm图标，即可被使用。有一点要注意，在Object 
        Inspector中MSComm控件的Input和Output属性是不可见的，但它们仍然存在，这两个属性的类型是OleVariant（Ole万能变量）。<br>
        　　下面是一接收程序的样例（主要部分），大家可根据实际需要进行完善。<br>
        　　在Form中放置一Memo控件用于显示接收的数据，Combobox1选择通信参数（Setting属性值），Combobox2选择串口（CommPort属性值），按Button1开始接收数据，按Button2停止接收。<br>
        　　procedure TForm1.FormCreate(Sender: TObject);<br>
        　　begin<br>
        　　Mscomm1.InBufferCount :=0; // 清空接收缓冲区<br>
        　　Mscomm1.InputLen :=0; // Input读取整个缓冲区内容<br>
        　　Mscomm1.RThreshold :=1; // 每次接收到字符即产生OnComm事件<br>
        　　end;<br>
        　　procedure TForm1.Button1Click(Sender: TObject);<br>
        　　begin<br>
        　　Mscomm1.Settings :=ComboBox1.Text;<br>
        　　if ComboBox2.Text =′com1′ then // 假设只考虑COM1和COM2两种情况<br>
        Mscomm1.CommPort :=1<br>
        　　else<br>
        　　　　Mscomm1.CommPort :=2;<br>
        　　Mscomm1.PortOpen :=true; // 打开串口<br>
        　　Mscomm1.DTREnable :=true; // 数据终端准备好<br>
        　　Mscomm1.RTSEnable :=true; // 请求发送<br>
        　　end;<br>
        　　procedure TForm1.Button2Click(Sender: TObject);<br>
        　　begin<br>
        　　Mscomm1.PortOpen :=false; // 关闭串口<br>
        　　 Mscomm1.DTREnable :=false;<br>
        　　Mscomm1.RTSEnable :=false;<br>
        　　end;<br>
        　　procedure TForm1.MSComm1Comm(Sender: TObject);<br>
        　　var<br>
        　　recstr:Olevariant;<br>
        　　begin<br>
        　　　if Mscomm1.CommEvent = 2 then<br>
        　　　　begin<br>
        　　recstr := Mscomm1.Input ;<br>
        　　Memo1.text := Memo1.Text ＋ recstr;<br>
        　　end;<br>
        end;</p>
      <p align="right"><br>
        　　（江西 万雪勇）</p>
      </TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>&nbsp;</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR ALIGN='center'> 
    <TD>&nbsp;</TD>
    <TD> <a name='top'></a>  
      
       CPCW版权所有，<A HREF='mailto:webmaster@cpcw.com'>CPCW网站编辑部</A>设计制作发布</TD>
  </TR>
</TABLE>
</BODY>

</HTML>
