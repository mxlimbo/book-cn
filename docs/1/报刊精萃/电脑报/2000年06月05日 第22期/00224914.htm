<HTML>
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='images/epcw.css' TYPE='text/css'>
 
<TITLE>电脑报电子版 -- Javascript制作站内搜索</TITLE>
 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
 

 
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
<TR VALIGN='top'>
    <TD WIDTH='100%'>&nbsp;</TD>
  </TR>
</TABLE><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
<tr>
    <td width='470' bgcolor='#CCCC99' height='50'><img src="images/yjds.gif" width="468" height="60"> 
    </td>
  </tr>
</TABLE><TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
<TR>
<TD WIDTH='100%'><IMG SRC='../images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
</TR>
</TABLE>
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
<TR VALIGN='bottom'>
<TD WIDTH='100%'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
</TR></TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='Center'>
<TR>
    <TD WIDTH='615' COLSPAN='2'><font color="#FF6666">当前位置：</font><A HREF='index.html'>CPCW电子版</A> 
      &gt; 2000 年 &gt; <a href="index.html">22期</a> 
      &gt; <a href="internet.html">大众网络</a> &gt; Javascript制作站内搜索</TD>
</TR></TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'><TR ALIGN='center' VALIGN='bottom'><TD HEIGHT='6'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD></TR></TABLE>
<BR><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
<TR>
    <TD><SPAN>《 Javascript制作站内搜索 
      》</SPAN></TD>
</TR></TABLE><BR><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
<TR>
    <TD> 
      <p>　　用JavaScript做的站内搜索不仅编程实现、维护起来很简单，而且它能在客户端浏览器直接执行，无须服务器的支持，也可以省去申请有脚本执行权限空间的麻烦。所以，只要你愿意动手，有个人主页就能有自己的站内搜索。下面让我们共同来做一个基于JavaScript的站内搜索的脚本，可不要小看它，做完了你就知道它的好处了。<br>
        　　首先，你要编写一个搜索表单，将用户要搜索的数据提交给JavaScript函数。最简单的代码如下，因为是最简单的HTML代码，所以就不作解释了：<br>
        　　&lt;form name=″search″ onsubmit=″goSearch(this)″&gt;<br>
        　　&lt;input type=″text″ size=″22″ name=″searchStr″ value=″多个关键字请以空格隔开″ 
        onmouseover=″this.focus()″ onfocus=″this.select()″&gt;<br>
        　　&lt;select name=″select″ size=″1″&gt;<br>
        　　&lt;option selected&gt;或者(or)&lt;/option&gt;<br>
        　　&lt;option&gt;并且(and)&lt;/option&gt;<br>
        　　&lt;option selected&gt;不包含(no)&lt;/option&gt;<br>
        　　&lt;/select&gt;<br>
        　　&lt;input type=″submit″ name=″submit″ value=″搜索″&gt;<br>
        　　&lt;/form&gt;<br>
        　　其次，要对你的站点的数据初始化。这是搜索时要用到的数据库，站点更新只要更改这些数据就行了。对于这个数据库，建议单独存为一个文件，在这里我们先存为相同路径下的″db.js″<br>
        　　/＊ 站点数据库db.js开始 ＊/<br>
        　　function initArray(){ /＊ 定义数组初始化函数 ＊/<br>
        　　this.length=initArray.arguments.length;<br>
        　　for(var i=0;i&lt;this.length;i＋＋) this[i]=initArray.arguments[i];<br>
        　　}<br>
        　　/＊ 定义待搜索的页面的标题，没有先后顺序，应将待搜索的页面都列出 ＊/<br>
        　　var titles=new initArray(′页面标题1′,′页面标题2′,……);<br>
        　　/＊ 这些页面的详细说明，位置应该与它们的标题一致 ＊/<br>
        　　var descriptions=new initArray(′详细说明1′,′详细说明2′,……);<br>
        　　/＊ 待搜索页面的地址，建议使用在你站点上的相对地址，位置也应与标题、说明相一致 ＊/<br>
        　　var URLs=new initArray(′url1′,′url2′,……);<br>
        　　/＊ 站点数据库db.js结束 ＊/<br>
        　　第三步，初始化用户输入的搜索字符串，并将它传递给搜索函数，列出结果。<br>
        　　function goSearch(){<br>
        　　var searchStr=document.search.searchStr.value; /＊ 取得表单中的用户输入的搜索字符 ＊/<br>
        　　var string1=searchStr.toLowerCase(); /＊ 转换为小写，避免大小写敏感 ＊/<br>
        　　var length1=string1.length;<br>
        　　var string2=′′;<br>
        　　for(var i=0;i&lt;3;i＋＋){ /＊ 取得搜索的字符串的各个关键字的逻辑关系 ＊/<br>
        　　if(document.search.select.options[i].selected) logic=i;}<br>
        　　if(length1!=0＆＆string1!=′ ′＆＆string1!=′　′){ /＊ 滤掉″空″关键字 ＊/<br>
        　　for(i=0;i&lt;length1;i＋＋){ /＊ 将表单中的用户输入的搜索字符串的空格转换为″＋″号 ＊/if(string1.charAt(i)==′ 
        ′) string2＋=′＋′;<br>
        　　else string2＋=string1.charAt(i);}<br>
        　　var search=string2.split(′＋′); /＊ 将转换过的搜索字符串以″＋″为分割符分割为一个字符串数组 ＊/<br>
        　　uptodataSearch(search);<br>
        　　outWin=window.open(′′,′′,′′); doc=outWin.document;<br>
        　　if(hitCount!=0){ /＊ 如果检索到符合要求的页面 ＊/<br>
        　　doc.write(′&lt;p&gt;检索结果：共有′＋hitCount＋′个页面符合字符串：″&lt;b&gt;&lt;font color=″ff0000″&gt;′＋string2＋′&lt;/font&gt;&lt;/b&gt;″：&lt;/p&gt;&lt;ul&gt;′);<br>
        　　for(i=0;i&lt;hitCount;i＋＋){<br>
        　　doc.write(′&lt;li&gt;′);<br>
        　　hrefmaker(titles[index[i]],URLs[index[i]],descriptions[index[i]]); /＊ 
        把检索到的数据一一列出，这里调用到的链接生成函数hrefmaker()在下面给出 ＊/<br>
        　　doc.write(′&lt;/li&gt;′);}<br>
        　　doc.write(′&lt;/ul&gt;′);<br>
        　　}<br>
        　　else doc.write(′&lt;p&gt;很抱歉，本站没有关于″&lt;b&gt;&lt;font color=″ff0000″&gt;′＋string2＋′&lt;/font&gt;&lt;/b&gt;″的内容！&lt;/p&gt;′);<br>
        　　}<br>
        　　else alert(′请输入要搜索的关键字!′);<br>
        　　}<br>
        　　第四，编写搜索函数。限于篇幅，给出的函数只有“不包含”的功能（就是输入的多个关键字必须全部满足要求才算符合搜索结果），要实现″或者″、″并且″功能请访问以下链接：http://ctsight.topcool.net/documents/pt_nr2000050902.html。<br>
        　　var hitCount=0; /＊ 全局变量hitCount，用于记录符合搜索要求的页数 ＊/<br>
        　　var index=new Array(); /＊ 全局变量数组，用于保存符合搜索要求的的页面在″数据库″db.js中的位置 ＊/<br>
        　　function uptodataSearch(searchStr){ /＊ 以经过处理的用户输入的搜索字符串为参数的搜索函数 ＊/<br>
        　　var tmpCount1=0,tmpCount2=0;<br>
        　　var tmpStr=′′,des=′′;<br>
        　　var length1=searchStr.length,length2=titles.length;<br>
        　　for(var i=0;i&lt;length2;i＋＋){ /＊ 检索整个站点资料 ＊/<br>
        　　tmpStr=titles[i]＋descriptions[i]; /＊ 将本次循环的站点数据的标题与详细内容合并，作为本次检索的范围＊/<br>
        　　des=tmpStr.toLowerCase(); /＊ 同样将它转化为小写 ＊/<br>
        　　tmpCount1=tmpCount2;<br>
        　　if(logic==2){ /＊ 如果逻辑关系是″不包括(not，!)″ ＊/<br>
        　　if(des.indexOf(searchStr[0])!=－1){ //首先必须满足第一个关键字要求<br>
        　　for(j=1;j&lt;length1;j＋＋){ //检索其它关键字<br>
        　　if(des.indexOf(searchStr[j])==－1) tmpCount2＋＋;}<br>
        　　if(tmpCount1==tmpCount2－length1＋1){ /＊ 只有满足第一个关键字要求但不满足其它任何一个关键字的才算符合检索要求 
        ＊/<br>
        　　index[hitCount]=i; hitCount＋＋;} } } } }<br>
        　　第五，编写搜索页面。<br>
        　　OK，基于JavaScript的站内搜索完工了。试一下，感觉如何？如要与我交流，请E－mail：contion@21cn.com。</p>
      <p align="right">　　(西安　周辉腾)</p>
      　　　　　　　　　　　　　 
    </TD>
  </TR></TABLE><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
<TR>
    <TD>&nbsp;</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
</TR></TABLE><BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
<TR ALIGN='center' VALIGN='bottom'>
<TD HEIGHT='6'><IMG SRC='../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
</TR></TABLE><TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
<TR ALIGN='center'>
    <TD>&nbsp;</TD>
<TD> <A HREF='mailto:webmaster@cpcw.com'>CPCW网站编辑部</A>设计制作发布</TD>
</TR>
</TABLE></BODY></HTML>