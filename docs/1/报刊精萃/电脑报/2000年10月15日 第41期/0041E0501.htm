 
<HTML>
<!-- #BeginTemplate "/模板/oa.dwt" --> 
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2812'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='epcw.css' TYPE='text/css'>
<!-- #BeginEditable "doctitle" --> 
<TITLE>电脑报电子版 -- 利用任务栏上的图标与用户交互</TITLE>
<!-- #EndEditable --> 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
<span class="centertitle"></span> 
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='top'> 
    <TD WIDTH='100%'><IMG SRC='../../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
  <TR> 
    <TD WIDTH='145' BGCOLOR='#CCCC99' 	ALIGN='Center' VALIGN='top'><A HREF='http://www.yesky.com'><IMG SRC='images/logo.gif' WIDTH='140' HEIGHT='60' ALT='天极网' BORDER='0'></A></TD>
    <TD WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'> 
       <a href="http://chat.yesky.com" target="_blank"><img src="images/0823-3.gif" width="468" height="60" border="0" alt="天极飞翔聊天室"></a>
    </TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR> 
    <TD WIDTH='100%'><IMG SRC='../../../images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='bottom'> 
    <TD WIDTH='100%'><IMG SRC='../../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='Center'>
  <TR> 
    <TD WIDTH='615' COLSPAN='2'><font color="#FF6666">当前位置：</font><A HREF='http://www.cpcw.com'>《电脑报》电子版</A> 
      &gt; <A href="http://www.cpcw.com/all.html">2000年</A> &gt; <a href="http://www.cpcw.com/all.html"><!-- #BeginEditable "%C6%DA" -->41期<!-- #EndEditable --></a> 
      &gt;<!-- #BeginEditable "%C0%B8%C4%BF" --> <a href="oa.html">OA专刊</a><!-- #EndEditable -->&gt; 
      <!-- #BeginEditable "%B1%EA%CC%E2" -->{利用任务栏上的图标与用户交互}<!-- #EndEditable --></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
  <TR> 
    <TD><SPAN CLASS='title'>《 <!-- #BeginEditable "%CE%C4%D5%C2%CD%B7" -->{利用任务栏上的图标与用户交互}<!-- #EndEditable --> 
      》</SPAN></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD><!-- #BeginEditable "%C4%DA%C8%DD" -->{　　将一个图标显示在任务栏右端静态通告区中并响应用户的鼠标动作是当前非常流行的方法，它体现了Windows 
      95友好的界面风格。下面以一个SDI（单文档界面）程序为例，讲述采用Microsoft Visual C＋＋ 6.0开发这类程序的主要步骤。<br>
      　　首先，要使程序的主窗口不可见，并且不在任务栏上出现任务按钮：<br>
      　　BOOL CMainFrame::PreCreateWindow(CREATESTRUCT＆ cs)<br>
      　　{<br>
      　　cs.style =WS_POPUP;／／使主窗口不可见<br>
      　　cs.dwExStyle =WS_EX_TOOLWINDOW;／／不显示任务按钮<br>
      　　return CFrameWnd::PreCreateWindow(cs);<br>
      　　}<br>
      　　其次，利用系统函数Shell_NotifyIcon将一个图标显示在任务栏的通告区中。该函数的原型为：<br>
      　　WINSHELLAPI BOOL WINAPI Shell_NotifyIcon(<br>
      　　DWORD dwMessage, <br>
      　　PNOTIFYICONDATA pnid <br>
      　　); <br>
      　　在调用该函数之前，需要确定其参数的取值，其中之一为一个具有NOTIFYICONDATA类型的结构。其原型为：<br>
      　　typedef struct _NOTIFYICONDATA { ／／ nid<br>
      　　DWORD cbSize;<br>
      　　HWND hWnd;<br>
      　　UINT uID;<br>
      　　UINT uFlags;<br>
      　　UINT uCallbackMessage;<br>
      　　HICON hIcon; <br>
      　　Char szTip[64]; }<br>
      　　NOTIFYICONDATA, ＊PNOTIFYICONDATA; <br>
      　　最后，我们的任务就是在hWnd窗口中响应该自定义消息：<br>
      　　void CMainFrame::OnLiben(WPARAM wParam,LPARAM lParam)<br>
      　　{<br>
      　　UINT uID;／／发出该消息的图标的ID<br>
      　　UINT uMouseMsg;／／鼠标动作<br>
      　　POINT pt;<br>
      　　uID=(UINT) wParam;<br>
      　　uMouseMsg=(UINT) lParam;<br>
      　　if(uMouseMsg==WM_RBUTTONDOWN)／／如果是单击右键<br>
      　　{<br>
      　　switch(uID)<br>
      　　{<br>
      　　case IDR_MAINFRAME:／／如果是我们的图标<br>
      　　GetCursorPos(＆pt);／／取得鼠标位置<br>
      　　…／／执行相应操作<br>
      　　break;<br>
      　　…<br>
      　　default:<br>
      　　…<br>
      　　}<br>
      　　}<br>
      　　return; <br>
      　　}<br>
      　　当程序结束时，需要删去通告区中的图标，这时同样应该调用Shell_NotifyIcon函数，只不过第一个参数是表示删除图标的NIM_DELETE了：<br>
      　　void CMainFrame::OnAppExit() <br>
      　　{<br>
      　　／／ TODO: Add your command handler code here<br>
      　　NOTIFYICONDATA tnid;<br>
      　　tnid.cbSize=sizeof(NOTIFYICONDATA);<br>
      　　tnid.hWnd=this－&gt;m_hWnd;<br>
      　　tnid.uID=IDR_MAINFRAME;／／保证删除的是我们的图标<br>
      　　Shell_NotifyIcon(NIM_DELETE,＆tnid);<br>
      　　AfxPostQuitMessage(0);<br>
      　　}<br>
      　　通过类似的步骤，用户可以响应其他的消息，完成更加高级的交互功能。}<!-- #EndEditable --></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>&nbsp;</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR ALIGN='center'> 
    <TD> 
      <script language="JavaScript" src="../../download/yeskye.js">
</script>
    </TD>
    <TD> <a href='/'>《电脑报》版权所有</a>，<a href='mailto:webmaster@staff.yesky.com'>YESKY网站编辑部</a>设计制作发布</TD>
  </TR>
</TABLE>
</BODY>
<!-- #EndTemplate -->
</HTML>
