 
<HTML>
 
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='images/cpcw.css' TYPE='text/css'>
 
<TITLE>电脑报电子版 -- 在PowerBuilder中实现电子邮件自动寻呼</TITLE>
 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
<span class="centertitle"></span><A NAME='top'></A> 
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='top'> 
    <TD WIDTH='100%'><IMG SRC='../../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
  <TR> 
    
    <TD WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'><IMG SRC='images/yjds.gif' WIDTH='468' HEIGHT='60' ALT='广告Logo' BORDER='0'></TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR> 
    <TD WIDTH='100%'><IMG SRC='../../images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='bottom'> 
    <TD WIDTH='100%'><IMG SRC='../../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='Center'>
  <TR> 
    <TD WIDTH='615' COLSPAN='2'><font color="#FF6666">当前位置：</font>CPCW电子版 
      &gt; 2000 年 &gt; <a href="index.html">07期</a> 
      &gt; <a href="software.html">软件世界</a> 
      &gt; 在PowerBuilder中实现电子邮件自动寻呼</TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
  <TR> 
    <TD><SPAN CLASS='title'>《 在PowerBuilder中实现电子邮件自动寻呼 
      》</SPAN></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>　　PowerBuilder不仅在开发数据库应用方面具有强大的优势,而且它为用户提供的DDE、OLE、MAPI等接口也给编程人员一个友好的开发界面。PowerBuilder基于COM编程的思想使开发者不必关心电子邮件的底层协议的实现就可以很轻松地编写出一些有关电子邮件的应用软件。本文介绍的电子邮件自动寻呼就是在PowerBuilder中通过调用MS_Mail系统和Windows 
      SDK函数实现的。<br>
      　　本程序是利用TIMER事件，每隔一定时间，检测一次用户的电子信箱，如果发现新邮件，就通过MODEM拨打用户的呼机号码来通知用户，从而实现电子邮件自动寻呼的目的。PowerBuilder没有内置相关函数来支持拨号功能，但可以调用Windows底层通信函数来实现。具体方法如下：<br>
      　　首先在PowerBuilder中打开应用窗口，创建一个新应用及mailcall.pbl，在应用的open事件下输入脚本 open(w_main)<br>
      创建一个窗口w_main，在窗口上放置如下控件（见左图及表）：<br>
      　　在全局变量声明窗口中输入如下语句：<br>
      　　mailMessage msg<br>
      　　mailSession msession<br>
      　　mailReturnCode mrtncode<br>
      　　在外部函数声明窗口中输入如下语句：<br>
      　　FUNCTION int OpenComm(string comm,uint inqueue,uint OutQueue)＆<br>
      　　Library ″user.exe″<br>
      　　FUNCTION int CloseComm(int pFile) Library ″user.exe″<br>
      　　FUNCTION int FlushComm(int pFile, int size) Library ″user.exe″<br>
      　　FUNCTION int WriteComm(int pFile,string buffer,int size) Library ″user.exe″<br>
      　　在窗口w_main的open、timer和close事件中输入以下脚本：<br>
      　　1.open事件<br>
      　　sle_1.text=″″<br>
      　　sle_2.text=″″<br>
      　　2.timer事件<br>
      　　int mCount,pFile<br>
      　　string mbLocation,mContext,timestr,commstr<br>
      　　mrtncode=msession.mailGetMessages(TRUE)//得到接收到的新邮件的ID<br>
      　　if mrtncode&lt;&gt;mailReturnSuccess! then Return //如果无新邮件,等待下次检索<br>
      　　timestr=string(Month(Today()),″00″)＋string(Day(Today()),″00″)＋＆<br>
      　　string(Hour(Now()),″00″)＋string(Minute(Now()),″00″)<br>
      　　mblocation=″c:\mail\m″＋timestr＋″.txt″ //新邮件存放的位置<br>
      　　mcount=Upperbound(msession.MessageID[])//取最后一封新邮件<br>
      　　msession.mailReadMessage(msession.MessageID[mount],msg,mailEntireMessage!,TRUE)<br>
      　　mcontext=msg.NoteText<br>
      　　pFile=FileOpen(mbLocation,Streammode!,Write!,LockReadWrite!,Replace!)<br>
      　　FileWrite(pFile,mContext)//保存新邮件<br>
      　　FileClose(pFile)<br>
      　　commstr=″atdt″＋sle_3.text＋″～r～n″ //要拨打的call机号码<br>
      　　pFile=OpenComm(″com2″,128,128)//打开com2口<br>
      　　FlushComm(pFile,0)<br>
      　　FlushComm(pFile,1)<br>
      　　WriteComm(pFile,commstr,len(commstr))//开始拨打用户的call机<br>
      　　WriteComm(pFile,″～r～n″,2)<br>
      　　CloseComm(pFile)<br>
      　　3.CLOSE事件<br>
      　　msession.mailLogoff()//退出邮件系统<br>
      　　Destroy msession//释放邮件对象占用的内存<br>
      　　4.在cb_2的clicked事件中输入以下代码：<br>
      　　mailLogonOption mlogopt<br>
      　　msession=create mailsession//实例化对象变量msession<br>
      　　mlogopt=mailNewSession!<br>
      　　if sle_1.text=″″ or sle_2.text=″″ or sle_3.text=″″ then<br>
      　　MessageBox(″错误″,″请输入用户名和口令!″)<br>
      　　else<br>
      　　//以用户输入的用户名和口令开始一个邮件会话<br>
      　　mrtncode=msession.mailLogon(sle_1.text,sle_2.text,mlogopt)<br>
      　　if mrtncode&lt;&gt;mailReturnSuccess! then<br>
      　　messagebox(″错误″,″信箱登录失败!″)<br>
      　　Return<br>
      　　end if<br>
      　　timer(300) //若登录成功，每5分钟检索一次邮箱<br>
      　　end if<br>
      　　5.在cb_1的clicked事件中输入以下代码：<br>
      　　halt//终止程序<br>
      　　注意：要达到电子邮件的自动寻呼的目的，还必须配置好MS_Mail系统。正确配置好用户的个人信息和邮箱信息(POP3和SMTP)。<br>
      <b>　　(河南　岳兵)</b></TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>下载本期推荐软件</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../images/dot.gif' WIDTH='468' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR ALIGN='center'> 
    <TD>&nbsp; 
      
       </TD>
    <TD> CPCW版权所有，<A HREF='mailto:webmaster@cpcw.com'>CPCW网站编辑部</A>设计制作发布</TD>
  </TR>
</TABLE>
</BODY>

</HTML>
