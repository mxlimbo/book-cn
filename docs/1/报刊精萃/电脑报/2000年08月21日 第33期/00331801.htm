 
<HTML>
<!-- #BeginTemplate "/模板/software.dwt" --> 
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='epcw.css' TYPE='text/css'>
<!-- #BeginEditable "doctitle" --> 
<TITLE>电脑报电子版 -- 用CLIPPER编写CGI程序</TITLE>
<!-- #EndEditable --> 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
<span class="centertitle"></span> 
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='top'> 
    <TD WIDTH='100%'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
  <TR> 
    <TD WIDTH='145' BGCOLOR='#CCCC99' 	ALIGN='Center' VALIGN='top'><a href="http://www.yesky.com"><img src="images/logo.gif" width="140" height="60" border="0"></a></TD>
    <TD WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'> 
      <a href="http://chat.yesky.com"><img src="images/0823-3.gif" width="468" height="60" border="0"></a>
    </TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR> 
    <TD WIDTH='100%'><IMG SRC='../../images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='bottom'> 
    <TD WIDTH='100%'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<table width='615' border='0' cellspacing='0' cellpadding='2' align='Center'>
  <tr> 
    <td width='615' colspan='2'><font color="#FF6666">当前位置：</font><a href='http://www.cpcw.com/issue/index.html'>CPCW电子版</a> 
      &gt; <a href='http://drivers.cpcw.com/issue.htm'>2000 年</a> &gt; <a href='index.html'><!-- #BeginEditable "%C6%DA" -->33期<!-- #EndEditable --></a> 
      &gt; <!-- #BeginEditable "%C0%B8%C4%BF" --><a href="software.html">软件世界</a><!-- #EndEditable --> 
      &gt; <!-- #BeginEditable "%B1%EA%CC%E2" -->{用CLIPPER编写CGI程序}<!-- #EndEditable --></td>
  </tr>
</table>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
  <TR> 
    <TD><SPAN CLASS='title'>《 <!-- #BeginEditable "%CE%C4%D5%C2%CD%B7" -->{用CLIPPER编写CGI程序}<!-- #EndEditable --> 
      》</SPAN></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD><!-- #BeginEditable "%CE%C4%D5%C2%C4%DA%C8%DD" -->{ 　　DBASE的历史实在是辉煌，但如今它已失去了许多光彩，也不再拥有往日众多的追随者，只有在邮局、税务、客房管理等特定用途上才能看到它的身影，因为人们很难找到有关资料把它与互联网联系在一起。通过CGI的帮助，我终于把它应用于互联网上。<br>
      　　CGI（Common Gateway Interface，公共网关接口）的作用是把客户端浏览器发出的请求通过WWW服务器软件的管理把SERVER上的数据反映到客户端的浏览器上。CGI程序也是程序，而且在这里我们讲的是用CLIPPER写的程序。<br>
      　　首先我们需要把环境建立起来：<br>
      　　1． 在一台WIN9x或NT计算机上安装SAMBAR公司（http://www.sambar.com）的SERVER，它是完全免费的，内建WWW、FTP及各种代理功能。建议你使用 
      SAMBAR的4.2版本，因为其它版本对CGI的支持有些问题。在安装时一定要注意不要使用其默认的安装路径（c:\program files\sambar），可以把它装在c:\sambar里，因为CLIPPER不支持长文件夹名或文件名。它是一个绿色软件，不向注册表添加任何内容。<br>
      　　2．启动SAMBAR，打开浏览器就可以进入WEB方式的管理界面了，建议你把它配置一下，把WWW服务的端口从80改成8080，防止与你计算机上的其它WWW服务器相冲突（如PWS或IIS等）。<br>
      　　3． 把CLIPPER5.01安装在你的计算机上，后面我们将用它编程(假设你把它装在了d:\clipper5里面)。<br>
      　　说明：下面的例子运行的环境是浏览器和SERVER同时在一台计算机上，也可以把SERVER装在一台单独的计算机上，用另一台计算机的浏览器显示，此时必须为计算机分配IP地址，而不是使用localhost。<br>
      　　如果你的计算机上没安装其它WWW服务器，就不用修改端口。下面的例子都是假设你把端口改成了8080。软件安装好后，你会发现有一个c:\sambar\cgi－win的文件夹，它是系统默认的，你也可以更改默认CGI路径。以后我们开发所有的Windows 
      CGI程序都将放在这个文件夹里。<br>
      　　下面我们先编一个非常简单的程序：<br>
      　　在D:\CLIPPER5\BIN里用EDIT编一个叫TEST1的PRG程序，它的功能是在浏览器上显示HELLO WORLD，程序如下：<br>
      　　TEST1.PRG<br>
      　　Parameters IN1, IN2, IN3<br>
      　　SIZE=200<br>
      　　buffer=space(SIZE)<br>
      　　Target=in3<br>
      　　infile=fcreate(Target)<br>
      　　 buffer=″HTTP/1.0 200 OK″＋chr(13)<br>
      　　 p=len(buffer)<br>
      　　 fwrite(infile,buffer,p)<br>
      　　 buffer=″&lt;html&gt;″＋chr(13)<br>
      　　 p=len(buffer)<br>
      　　 fwrite(infile,buffer,p)<br>
      　　 buffer=″&lt;body&gt;&lt;H1&gt;&lt;center&gt;HELLO WORLD&lt;/center&gt;&lt;/H1&gt;&lt;br&gt;″＋chr(13)<br>
      　　 p=len(buffer)<br>
      　　 fwrite(infile,buffer,p)<br>
      　　 buffer=″&lt;/body&gt;&lt;/html&gt;″＋chr(13)<br>
      　　 p=len(buffer)<br>
      　　 fwrite(infile,buffer,p)<br>
      　　fclose(infile)<br>
      　　接下来用CLIPPER5提供的CL.BAT程序，把它编译并存放在C:\SAMBAR\CGI－WIN下面，然后在浏览器的URL处输入 http://localhost:8080/cgi－win/test1.exe并回车。HELLO 
      WORLD几个大字就会跃然于你的浏览器上。<br>
      　　限于篇幅所限，我只能讲些简单的例子，更实用的例子留给你自已完成吧，有问题可发E－mail到 rockoil@263.net。<br>
      　　下面我们进行第二个例子TEST2.PRG。它的功能是打开一个数据库把其中ACNUMBER字段中的内容显示到浏览器上。在进行本例之前，你应准备一个D:\CLIPPER5\BIN\ACC.DBF数据文件，里面有一个ACNUMBER字段（CHAR型的），并且随便在里面添加20条以上记录。<br>
      　　TEST2.PRG<br>
      　　Parameters IN1, IN2, IN3<br>
      　　SIZE=200<br>
      　　buffer=space(SIZE)<br>
      　　Target=in3<br>
      　　infile=fcreate(Target)<br>
      　　 buffer=″HTTP/1.0 200 OK″＋chr(13)<br>
      　　 p=len(buffer)<br>
      　　 fwrite(infile,buffer,p)<br>
      　　 buffer=″&lt;html&gt;″＋chr(13)<br>
      　　 p=len(buffer)<br>
      　　 fwrite(infile,buffer,p)<br>
      　　 buffer=″&lt;body&gt;&lt;H1&gt;&lt;center&gt;AC－NO LIST&lt;/center&gt;&lt;/H1&gt;&lt;br&gt;″＋chr(13)<br>
      　　 p=len(buffer)<br>
      　　 fwrite(infile,buffer,p)<br>
      　　use d:\clipper5\bin\acc.dbf<br>
      　　 for I=1 to 20<br>
      ACCONTENT=ACNUMBER<br>
      　　buffer=ACCONTENT＋″&lt;br&gt;″＋chr(13)<br>
      　　 p=len(buffer)<br>
      　　fwrite(infile,buffer,p)<br>
      　　skip(1)<br>
      　　next<br>
      　　use<br>
      　　 buffer=″&lt;/body&gt;&lt;/html&gt;″＋chr(13)<br>
      　　 p=len(buffer)<br>
      　　 fwrite(infile,buffer,p)<br>
      　　fclose(infile)<br>
      　　把它编译后拷到c:\sambar\cgi－win文件夹下，在浏览器下执行http://localhost:8080/cgi－win/test2.exe并回车。数据库中的的20条记录就会显示在用户的浏览器上。<br>
      　　下面我再讲第三个例子TEST3.PRG，将HTML表单与CIPPER5的程序结合起来，完成查询工作。TEST3.PRG的功能是，在HTML表单上输入一个数字（记录号），CGI程序自动把相应的记录显示给用户的浏览器。你把它改一下就能变成一个电话号码或住址查询程序。<br>
      　　TEST3.PRG<br>
      　　默认情况下，你的ROOT目录是 C:\SAMBAR\DOCS文件夹，先写一个TEST3.HTM并放在那个文件夹下。<br>
      　　&lt;html&gt;<br>
      　　&lt;title&gt;<br>
      　　THIS IS TEST3<br>
      　　&lt;/title&gt;<br>
      　　&lt;body&gt;<br>
      　　请输入记录号:<br>
      　　&lt;p&gt;<br>
      　　&lt;form action=″/cgi－win/test3.exe″ method=post&gt;<br>
      　　&lt;input type=text name=aaaa value=1&gt;<br>
      　　&lt;input type=submit name=bbbb value=″ 确认 ″&gt;<br>
      　　&lt;/form&gt;<br>
      　　&lt;/body&gt;<br>
      　　&lt;/html&gt;<br>
      　　为了接收TEST3.HTM的数据，需要写一个TEST3.PRG，内容如下：<br>
      　　parameters in1, in2, in3<br>
      　　SIZE=200<br>
      　　buffer=space(SIZE)<br>
      　　buffer2=space(SIZE)<br>
      　　infile=fopen(in2)<br>
      　　oufile=fcreate(in3)<br>
      　　 num_read=fread(infile,@buffer,200)<br>
      　　 buffer2=″HTTP/1.0 200 OK″＋chr(13)<br>
      　　 p=len(buffer2)<br>
      　　 fwrite(oufile,buffer2,p)<br>
      　　 buffer2=″&lt;html&gt;″＋chr(13)<br>
      　　 p=len(buffer2)<br>
      　　 fwrite(oufile,buffer2,p)<br>
      　　 ch=″″<br>
      　　 tbf=″″<br>
      　　 mm=1<br>
      　　 epos=0<br>
      　　 do while .t.<br>
      　　 ch=substr(buffer,mm,1)<br>
      　　 if ch!=″＆″<br>
      　　 tbf=tbf＋ch<br>
      　　 mm=mm＋1<br>
      　　 if ch==″=″<br>
      　　 epos=mm<br>
      　　 endif<br>
      　　 else<br>
      　　 exit<br>
      　　 endif<br>
      　　 enddo<br>
      　　 buffer2=substr(tbf,epos,2)<br>
      　　 use d:\clipper5\bin\acc.dbf<br>
      　　 go val(buffer2)<br>
      　　 buffer2=ACNUMBER＋″&lt;/html&gt;″＋chr(13)<br>
      　　 p=len(buffer2)<br>
      　　 fwrite(oufile,buffer2,p)<br>
      　　 use<br>
      　　fclose(infile)<br>
      　　把TEST3.PRG编译后存到 C:\SAMBAR\CGI－WIN文件夹下，在浏览器的URL处输入 http://localhost:8080/test3.htm 
      ，在文本框内输入记录号后按“确认”，相应记录的ACNUMBER就会显示在浏览器上。上面的HTM也可以直接换成EXE文件，由EXE文件生成HTM文档。<br>
      　　上面的这些程序都能正常运行，但有些勉强（除错处理、变量分离都需要细化）。写本文的目的仅在于介绍CLIPPER实现CGI的方法而不是具体的编程。<br>
      　　（北京 宋永强）}<!-- #EndEditable --></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>&nbsp;</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR ALIGN='center'> 
    <TD> 
      <script language="JavaScript" src="http://nethome.yesky.com/sp/yeskye.js">
</script>
    </TD>
    <TD> <A HREF='/'>CPCW版权所有</A>，<A HREF='mailto:webmaster@cpcw.com'>CPCW网站编辑部</A>设计制作发布</TD>
  </TR>
</TABLE>
</BODY>
<!-- #EndTemplate -->
</HTML>
