<html>
<head>
<meta HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<meta NAME='author' CONTENT='William Wan'>
<link REL='STYLESHEET' HREF='images/cpcw.css' TYPE='text/css'>
 
<title>电脑报电子版 -- 魔鬼辞典</title>
 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</head>
<body BGCOLOR='white'>
<span class="centertitle"></span><a NAME='top'></a> 
<table BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
<tr VALIGN='top'><td WIDTH='100%'><img SRC='images/dot.gif' WIDTH='468' HEIGHT='1'></td></tr>
</table><table WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
<tr>

<td WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'><img SRC='images/yjds.gif' WIDTH='468' HEIGHT='60' ALT='广告Logo' BORDER='0'></td>
</tr>
</table><table BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
<tr>
<td WIDTH='100%'><img SRC='images/pixel.gif' WIDTH='1' HEIGHT='1'></td>
</tr>
</table>
<table BORDER='0' WIDTH='468' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
<tr VALIGN='bottom'>
<td WIDTH='100%'><img SRC='images/dot.gif' WIDTH='468' HEIGHT='1'></td>
</tr></table>
<table width='468' border='0' cellspacing='0' cellpadding='2' align='Center'>
  <tr> 
    <td width='615' colspan='2'><font color="#FF6666">当前位置：</font>CPCW电子版 
      &gt; 2000 年 &gt; <a href="index.html">11期</a> 
      &gt; <a href="software.html">软件世界</a> 
      &gt; 实战client/server编程（上）</td>
  </tr>
</table>
<table WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'><tr ALIGN='center' VALIGN='bottom'><td HEIGHT='6'><img SRC='images/dot.gif' WIDTH='468' HEIGHT='1'></td></tr></table>
<br><table WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
<tr>
    <td><span CLASS='title'>《 实战client/server编程（上） 》</span></td>
</tr></table><br><table WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
<tr>
    <td>
      <p>　　在Browse/Server体系结构如日中天、为人所津津乐道的今天，Client/Server模式在企业应用中依然占据着很大的市场，对Client/Server的开发技术仍然有很大的需求。而作为 
        Client/Server模式应用和基于Internet 模式应用的主要开发工具、数据库编程排头兵之一的PowerBuilder，又在这个领域中有着举足轻重的地位，全世界有很多的开发人员仍然使用PowerBuilder从事着企业应用的开发。<br>
        　　PowerBuilder支持各种常见的数据库，它与数据库的连接建立在驱动程序之上。对于Sybase、Oracle、MS SQL Server、Informix这样的大型数据库管理系统，PowerBuilder提供了旨在提高数据库访问效率的专用数据库接口；而对小型数据库如Xbase、Access、Excel，Power 
        Builder提供了ODBC接口。<br>
        　　PowerBuilder6.5自带了一个小型关系数据库Sybase SQL Anywhere 5.0，它体积虽小但功能强大，支持多种平台，几乎拥有其它大型关系型数据库的所有功能，如触发器、存储过程等。我们学习PowerBuilder数据库编程一般是从它入手，一般人认为它是一个本地数据库，其实Sybase 
        SQL Anywhere 5.0同样支持网络编程，可用于Client/Server架构。<br>
        　　下面我们以一个简单的小程序为例，看看PowerBuilder 6.5 ＋ Sybase SQL Anywhere 5.0 是如何实现Client/Server式编程的。<br>
        　　<b>一、数据库安装配置</b></p>
      <p> 　　（一）服务器端<br>
        　　1．安装Sybase SQL Anywhere 5。<br>
        　　Sybase SQL Anywhere 5 安装类型有三种：Network Client、Network Server、Standalone 
        Engine，选第二种Network Server开始安装。<br>
        　　2．创建数据库。<br>
        　　在PowerBuilder中打开“Database”画板，出现Select Table对话框，选择“Cancel”，再点击“File”菜单，选择“Create 
        Database”选项，出现创建数据库对话框，为数据库取一个名字database_server，用户和密码用默认值dba、sql，选择相应的目录(C:\database)保存。在资源管理器中我们可以看到C:\database目录下生成数据库文件database_server.db。<br>
        　　为数据库建立一个表personnel，表中有如下字段：<br>
        　　表结构建好后，以Id字段建立索引和关键字。还可以再输入测试数据。 　　3．将数据库文件所在目录C:\database共享（只读共享即可）。<br>
        　　（二）客户端<br>
        　　1．安装Sybase SQL Anywhere 5。<br>
        　　选Network Client模式安装。<br>
        　　2．配置ODBC。<br>
        　　可在控制面板的ODBC Data Source Administrtaor或PowerBuilder中的Configure ODBC中进行配置。选Sybase 
        SQL Anywhere 5.0作为驱动，在配置的对话框中，Data Source Name 项输入database_server；User 
        ID项输入dba；Password项输入sql；Database File选Network方式，并通过浏览按钮确认数据库文件。<br>
        　　<b>二、启动、连接及关闭数据库</b></p>
      <p> 　　（一）服务器端启动数据库<br>
        　　1．运行MS_DOS模式。<br>
        　　2．进入Sybase SQL Anywhere5.0\win32目录。<br>
        　　3．运行如下命令启动数据库：<br>
        　　dbsrv50 c:\database\database_server.db 　　数据库服务器端将启动数据库，并打开监控画面。<br>
        　　（二）客户端连接数据库<br>
        　　1．启动PowerBuilder。<br>
        　　2．点击DB Profile 图标，选择“ODBC/Database Server”，点击“connect”按钮连接。<br>
        　　当然我们也可以像服务器端启动数据库一样，进入DOS模式，用declient.exe命令来连接数据库。<br>
        　　（三）查看数据库连接情况<br>
        　　在数据库服务器端启动的监控画面，记载了Client端用户的连接情况，如User ID、连入时间等。对于某一个连接，我们可以用鼠标右键单击，系统将弹出菜单，选择“Disconnect”可以强行断开此连接，选择“Detail”可查看此连接的详细情况，如用户ID、连入时间、通讯协议、连入机器IP地址等。<br>
        　　（四）关闭数据库<br>
        　　关闭数据库之前最好确认所有用户均已断开连接。<br>
        　　关闭数据库有两种办法：<br>
        　　1．在数据库监控画面中，进入“File”菜单，点击“Exit”菜单项。<br>
        　　2．定时关闭：进入“File”菜单，点击“Configure”菜单项，在对话框中输入退出数据库的时间（Quitting time），即可实现数据库定时关闭功能。<br>
        　　三、编写程序<br>
        　　（一）在PowerBuilder中新建一个应用（Application），名字为personnel，保存在personnel.pbl中。<br>
        　　（二）创建一数据窗口对象d_grid_personnel，其中所选Table为personnel，Grid风格。<br>
        　　（三）新建一Window，取名为w_main_ personnel，内有如下控件：<br>
        　　（四）编写personnel.ini文件 　　内容如下：<br>
        　　[Database] 　　DBMS=ODBC 　　Database=database_server 　　UserId=dba 　　DatabasePassword= 
        　　LogPassword= 　　ServerName= 　　LogId= 　　Lock=DbParm=Connectstring=′DSN=database_server′Prompt=0 
        　　（五）编写连接数据库脚本<br>
        　　在Application的Open事件中加入脚本：<br>
        　　string ls_startupfile//holds name of start－up file 　　ls_startupfile 
        = ″personnel.ini″ 　　// Populate sqlca from current preference－file settings 
        　　sqlca.DBMS=ProfileString (ls_startupfile, ″database″, ″dbms″, ″″) 　　sqlca.database 
        = ProfileString (ls_startupfile, ″database″, ″database″, ″″) 　　sqlca.userid 
        = ProfileString (ls_startupfile, ″database″, ″userid″, ″″) 　　sqlca.dbpass 
        = ProfileString (ls_startupfile, ″database″, ″dbpass″, ″″) 　　sqlca.logid 
        = ProfileString (ls_startupfile, ″database″, ″logid″, ″″) 　　sqlca.logpass 
        = ProfileString (ls_startupfile, ″database″, ″LogPassWord″, ″″) 　　sqlca.servername 
        = ProfileString (ls_startupfile, ″database″, ″servername″, ″″) 　　sqlca.dbparm 
        = ProfileString (ls_startupfile, ″database″, ″dbparm″, ″″) 　　connect; 
        　　if sqlca.sqlcode &lt;> 0 then 　　 MessageBox (″Cannot Connect to Database″, 
        sqlca.sqlerrtext) 　　 return 　　end if 　　// Open Main window 　　Open (w_main_ 
        personnel)<br>
        　　（六）编写窗口w_main_ personnel的脚本<br>
        　　1．dw_personnel的constructor事件：<br>
        　　this.SetTransObject(sqlca) 　　this.Retrieve()<br>
        　　2．cb_add的clicked事件：<br>
        　　long ll_row 　　ll_row = dw_personnel.insertrow(0) 　　dw_personnel.SetRow(ll_row) 
        　　dw_personnel.SetFocus() <br>
        　　3．cb_del的clicked事件：<br>
        　　long ll_row 　　ll_row = dw_personnel.GetRow() 　　IF ll_row &lt;= 0 THEN return 
        　　dw_personnel.DeleteRow(ll_row) <br>
        　　4．cb_save的clicked事件： 　　long ll_return 　　dw_personnel.AcceptText() 　　ll_return 
        = dw_personnel.Update() 　　if ll_return = 1 then 　　 commit; 　　 messagebox(″提示信息″,″保存成功!″) 
        　　else 　　 rollback; 　　 messagebox(″提示信息″,″保存失败!″) 　　end if 　　5．cb_refresh的clicked事件： 
        　　dw_personnel.Retrieve() 　　6．cb_print的clicked事件： 　　if messagebox(″提示信息″,″确认打印吗？″,question!,Yesno!,1) 
        = 1 then 　　 if PrintSetup()=－1 then 　　 messagebox(″出错信息″,″打印机设置出错！″,Exclamation!) 
        　　 return 　　 else 　　 dw_personnel.Print() 　　 end if 　　end if 　　7．cb_exit的clicked事件： 
        　　close(parent) <br>
        　　（七）运行<br>
        　　编写脚本完毕后，我们就可以在PB环境下运行该程序了，看看客户端应用程序是如何对服务器端数据库操作的。<br>
        　　（八）编译成可执行文件<br>
        　　限于篇幅，省略。<br>
      </p>
      </td>
  </tr></table><table WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
<tr>
<td><a HREF='http://www.mydown.com/dnb/' TARGET='_blank'>下载本期推荐软件</a></td><td ALIGN='right'><a HREF='#top'>页 首</a></td>
</tr></table><br>
<table WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
<tr ALIGN='center' VALIGN='bottom'>
<td HEIGHT='6'><img SRC='images/dot.gif' WIDTH='468' HEIGHT='1'></td>
</tr></table><table WIDTH='468' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
<tr ALIGN='center'>
<td>&nbsp;


</td>
<td> CPCW版权所有，<a HREF='mailto:webmaster@cpcw.com'>CPCW网站编辑部</a>设计制作发布</td>
</tr>
</table></body></html>