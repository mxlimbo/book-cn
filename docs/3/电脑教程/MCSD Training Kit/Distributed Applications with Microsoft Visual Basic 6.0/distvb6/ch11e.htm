<HTML>
<HEAD>
<TITLE>Lab: Interactively Debugging an MTS Component </TITLE>
<link rel="STYLESHEET" type="text/css" href="Library.css">

</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch11d.htm", "ch11f.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>


<A NAME="444"><H1>Lab: Interactively Debugging an MTS Component </H1></A>

<P>In this lab, you will create a COM DLL and move it into MTS. You will then use Visual Basic to test and debug the COM DLL interactively.</P>

<P>
<img src="images/video.gif" width=78 height=54 border="0">
</P>

<P>To see a demonstration of this lab, run the Lab11.exe animation located in the Animations folder on the Supplemental Course Materials CD-ROM that accompanies this book. </P>


<b>Estimated lesson time: 45 minutes</b>


<A NAME="445"><H2>Exercise 1: </H2></A>

<P>In this exercise, you will create a COM DLL. You will then create a new package in MTS and add the COM DLL to that package. Next, you will create a Standard EXE client application to test the MTS component interactively in Visual Basic.</P>

<p><li><b> To create a COM DLL for use in MTS</b></li></p>

<ol>
<p><li>Create a new ActiveX DLL project in Visual Basic.</li></p>

<p><li>Name the project <B>Lab11</B>.</li></p>

<p><li>Change the name of Class1 to <B>CDebug</B>.</li></p>

<p><li>Set the <B>MTSTransactionMode</B> property of the CDebug class to <B>NoTransactions</B>.</li></p>

<p><li>Set a reference to the <B>Microsoft Transaction Server Type Library</B>.</li></p>

<p>In the General Declarations section of CDebug, implement the ObjectControl interface.</p>

<p><li>Implement each method of the ObjectControl interface.</li></p>

<p>Methods include Activate, CanBePooled, and Deactivate.</p>

<p><li>Add the following public method to the CDebug class.</li></p>

<P><table cellpadding=5 width="95%"><TR><TD>
<PRE>Public Function SquareIt(i As Integer) As Integer
     SquareIt = i * i
End Function</PRE>
</TD></TR></TABLE>
</P>

<p><li>Compile your project and save the Lab11.dll file to a folder on the computer running MTS.</li></p>

<p><li>On the <B>Component</B> tab of the Project Properties dialog box, set the Version Compatibility option to <B>Binary</B> <B>Compatibility</B>.</li></p>

<p><li>Save your project and close Visual Basic.</li></p>
</ol>

<p><li><b> To move the COM DLL into MTS</b></li></p>

<ol>
<p><li>Create a new empty package in MTS named <B>Lab11</B>.</li></p>

<p><li>In the <B>Lab11</B> package, right-click the <B>Components</B> folder, point to <B>New</B>, then click <B>Component</B>.</li></p>

<p>The Component Wizard appears.</p>

<p><li>In the <B>Component Wizard</B>, click <B>Install new component(s)</B>.</li></p>

<p><li>Add the Lab11.dll, which will add the CDebug component.</li></p>
</ol>

<p><li><b> To test your MTS Component</b></li></p>

<ol>
<p><li>Open the Lab11.vbp project in Visual Basic.</li></p>

<p><li>Add a Stop statement to the Activate event for the ObjectControl object, as shown in the following example.</li></p>

<P><table cellpadding=5 width="95%"><TR><TD>
<PRE>Private Sub ObjectControl_Activate()
     Stop
End Sub</PRE>
</TD></TR></TABLE>
</P>

<p><li>Open a new instance of Visual Basic, and create a new Standard EXE project.</li></p>

<p><li>In the References dialog box, set a reference to <B>Lab11</B>.</li></p>

<p><li>On <B>Form1</B>, add a command button named <B>cmdTestMTSDLL</B>.</li></p>

<p><li>In the <B>cmdTestMTSDLL_Click</B> event procedure, type the following code.</li></p>

<P><table cellpadding=5 width="95%"><TR><TD>
<PRE>Dim objDebug As CDebug
Dim retVal As Integer

Set objDebug = New CDebug
retVal = objDebug.SquareIt(2)
Set objDebug = Nothing</PRE>
</TD></TR></TABLE>
</P>

<p><li>Run the Lab11 project.</li></p>

<p><li>If the Debugging tab of the Project Properties dialog box appears, choose the <B>Wait for components to be created</B> option.</li></p>

<p>MTS will create an instance of the CDebug class in its run-time environment.</p>

<p><li>Run the Standard EXE project and click the <B>cmdTestMTSDLL</B> button when the form appears.</li></p>

<p>The Stop statement in the ObjectControl_Activate event executes, as illustrated in Figure 11.7.</p>

<P>
<A HREF="javascript:fullSize('F11xx07x.htm')"> <img src="images/F11xx07.JPG" width=404 height=271 border=0 ALT = "Click to view at full size."> </A>
</P><P>
<!--caption--><b>Figure 11.7</b> <i>Viewing the CDebug class in break mode</i><!--/caption-->
</P>


<p><li>Press <B>F5</B> to continue running the program.</li></p>

<p><li>End the Standard EXE project and then the Lab11 project.</li></p>

<p><li>Delete the Stop statement in the <B>ObjectControl_Activate</B> event procedure of CDebug.</li></p>

<p><li>Add a watch to the <B>Watch</B> window in the Lab11 project.</li></p>

<p>Set the expression to break when the SquareIt function returns a value of 4, as illustrated in Figure 11.8.</p>

<P>
<img src="images/F11xx08.GIF" width=384 height=277 border="0">
</P><P>
<!--caption--><b>Figure 11.8</b> <i>Setting a watch expression to break program execution</i><!--/caption-->
</P>


<p><li>Run the Lab11 project.</li></p>

<p><li>Run the Standard EXE client application and click the <B>cmdTestMTSDLL</B> command button.</li></p>

<p>The CDebug class goes into break mode after the SquareIt function runs.</p>
</ol>

</BODY>
</HTML>



