<HTML>
<HEAD>
<TITLE>Lesson 2: Using Network Monitor</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmnet.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch04b.htm">[Previous]</A> <A HREF="ch04d.htm">[Next]</A><P>



<A NAME="169"><H1>Lesson 2: Using Network Monitor</H1></A>

<p>In this lesson, you will learn how to use Network Monitor to troubleshoot network problems. When using Network Monitor, you should remember two key points:</p>

<ol>
<p><li>Run Network Monitor at low-usage times or for short periods of time. This decreases the effect on system performance caused by Network Monitor.</li></p>

<p><li>Capture only as many statistics as you need for evaluation. This prevents you from capturing too much information to make a reasonably quick diagnosis of the problem.</li></p>
</ol>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li>Capture data using Network Monitor</li></p>

<p><li>Examine frames using Network Monitor</li></p>

<p><li>View data with Network Monitor</li></p>
</ul>

<p><b>Estimated lesson time: 40 minutes</b></p>
</blockquote></div>
</p>

<A NAME="170"><H2>Examining Frames</H2></A>

<p>Network Monitor can capture frames sent to and from a network adapter. Frames are made up of many different pieces of information, including:</p>

<ul>
<p><li>The protocol being used</li></p>

<p><li>The source address of the computer that sent the message</li></p>

<p><li>The destination address of the frame</li></p>

<p><li>The length of the frame</li></p>
</ul>

<p><li><b>To capture network frames</b></li></p>

<ol>
<p><li>Click Start, point to Programs, select Administrative Tools, then choose Network Monitor.</li></p>

<p>If you are prompted for a default network on which to capture frames, select the local network from which you want to capture data by default.</p>

<p><li>On the Capture menu, click Start.</li></p>
</ol>

<A NAME="171"><H2>Viewing Data</H2></A>

<p>After you have captured data, you can view it in the Network Monitor user interface as illustrated in Figure 4.2. Network Monitor performs some data analysis automatically because it translates raw capture data and organizes it into the structure of a logical frame. Network Monitor also displays overall network segment statistics, including:</p>

<ul>
<p><li>Broadcast frames</li></p>

<p><li>Multicast frames</li></p>

<p><li>Network utilization</li></p>

<p><li>Total bytes received per second</li></p>

<p><li>Total frames received per second</li></p>
</ul>

<p><div class="note"><blockquote><b>NOTE</b><HR>For security reasons, Windows 2000 Network Monitor captures only 
those frames, including broadcast and multicast frames, sent to or from the local computer.
</blockquote></div></p>

<p>
<A HREF="javascript:fullSize('04ntk02x.htm')"> <img src="images/04ntk02.JPG" width=404 height=268 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 4.2</b> <i>The Network Monitor user interface</i><!-- /caption -->
</p>

<p>Network Monitor acts as a Network Driver Interface Specification-Compliant (NDIS) driver to copy frames to the capture buffer, a resizable storage area in memory. The default size is 1 MB; you can adjust the size manually as needed. Make sure there is enough memory free to allow for this.</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>
Because Network Monitor uses the local-only mode of NDIS instead of promiscuous mode (in which the network adapter passes on all frames sent on the network), you can use Network Monitor even if your network adapter does not support promiscuous mode. Networking performance is not affected when you use an NDIS driver to capture frames. (Putting the network adapter in promiscuous mode can add 30 percent or more to the load on the CPU.)
</blockquote></div></p>

<p>Network Monitor displays session statistics from the first 100 unique network sessions it detects. To reset statistics and see information on the next 100 network sessions detected, on the Capture menu, click Clear Statistics. The Network Monitor Capture window includes the panes listed in Table 4.1.</p>

<p><b>Table 4.1</b> <i>Statistics Displayed in the Capture Window</i></p>

<p>
	<table valign="top" cellpadding="5" width="95%">
	
		<tr>
			<th>Pane</th>
			<th>Displays</th>
		</tr>

		<tr>
			<td valign="top">Graph</td>
			<td valign="top">A graphical representation of the activity currently taking place on the network</td>
		</tr>

		<tr>
			<td valign="top">Session Stats</td>
			<td valign="top">Statistics about individual sessions currently taking place on the network</td>
		</tr>

		<tr>
			<td valign="top">Station Stats</td>
			<td valign="top">Statistics about the sessions participated in by the computer running Network Monitor</td>
		</tr>

		<tr>
			<td valign="top">Total Stats</td>
			<td valign="top">Summary statistics about the network activity detected since the capture process began</td>
		</tr>
		
	</table>
</p>	

<p>To capture only those frames that originate with specific computers, determine the addresses of the computers on your network and associate the address with its Domain Name System (DNS) or NetBIOS name. After these associations are made, you can save the names to an address database (.adr) file that can be used to design capture filters and display filters. A capture filter allows you to specify criteria for inclusion in or exclusion from the capture. Figure 4.3 shows the Capture Filter dialog box, accessed from the Capture menu or by pressing F8 in the Capture window.</p>

<p>
<A HREF="javascript:fullSize('04ntk03x.htm')"> <img src="images/04ntk03.JPG" width=404 height=331 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 4.3</b> <i>The Capture Filter dialog box</i><!-- /caption -->
</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>Capture filters can significantly increase the processor's workload because each packet must be processed through the filter and either saved or discarded. In some cases, using complex filters might result in missed frames.
</blockquote></div></p>

<p>To design a capture filter, specify decision statements in the Capture Filter dialog box. By specifying a pattern match in a capture filter, you can</p>

<ul>
<p><li>Limit a capture to frames consisting of specific data types</li></p>

<p><li>Capture frames sent using a specific protocol</li></p>

<p><li>Use a capture trigger to initiate actions following the capture</li></p>
</ul>

<p>Table 4.2 describes the trigger types you can use to specify the condition that starts the trigger.</p>

<p><b>Table 4.2</b> <i>Descriptions of Capture Triggers</i></p>

<p>
	<table valign="top" cellpadding="5" width="95%">
	
		<tr>
			<th>Trigger Type</th>
			<th>Description</th>
		</tr>

		<tr>
			<td valign="top">Nothing</td>
			<td valign="top">No trigger is initiated. This is the default.</td>
		</tr>

		<tr>
			<td valign="top">Pattern Match</td>
			<td valign="top">Initiates the trigger when the specified pattern occurs in a captured frame.</td>
		</tr>

		<tr>
			<td valign="top">Buffer Space</td>
			<td valign="top">Initiates the trigger when a specified amount of the capture buffer is filled.</td>
		</tr>

		<tr>
			<td valign="top">Pattern Match Then Buffer Space</td>
			<td valign="top">Initiates the trigger when the pattern occurs, and is followed by a specified percentage of the capture buffer being filled.</td>
		</tr>

		<tr>
			<td valign="top">Buffer Space Then Pattern Match</td>
			<td valign="top">Initiates the trigger when the specified percentage of the capture buffer fills, and is followed by the occurrence of the pattern in a captured frame.</td>
		</tr>
		
		<tr>
			<td valign="top">No Action</td>
			<td valign="top">No action is taken when a trigger condition is met. This is the default. Even though you select <b>No Action</b>, the computer beeps when the trigger condition is met.</td>
		</tr>

		<tr>
			<td valign="top">Stop Capture</td>
			<td valign="top">Stops the capture process when the trigger condition is met.</td>
		</tr>

		<tr>
			<td valign="top">Execute Command Line</td>
			<td valign="top">Runs a program or batch file when a trigger condition is met. If you select this option, provide a command or the path to a program or batch file.</td>
		</tr>
		
	</table>
</p>


<p><div class="note"><blockquote><b>NOTE</b><HR>
If your computer uses multiple network adapters, either switch between the two adapters or run multiple instances of Network Monitor. To switch between adapters, on the Capture menu, click Networks, then select a different adapter.
</blockquote></div></p>

<p>After capturing data, you might want to save it. For example, it is useful to save captures before starting another capture (to prevent loss of the captured data) if you think you might need to analyze the data later or if you need to document network use or problems. When you save captured data, the data in the capture buffer is written to a capture (.cap) file.</p>

<A NAME="172"><H2>Using Display Filters</H2></A>

<p>Similar to a capture filter, you can use a display filter like a database query to specify which frames to display. Because a display filter operates on data that has already been captured, it does not affect the contents of the Network Monitor capture buffer. A frame can be filtered based on the following data:</p>

<ul>
<p><li>The frame's data-link layer or network layer source or destination address.</li></p>

<p><li>The protocols used to send the frame or packet.</li></p>

<p><li>The properties and values the frame contains. (A property is a data field within a protocol header. A protocol's properties, collectively, indicate the purpose of the protocol.)</li></p>
</ul>

<p>To design a display filter, specify decision statements in the Display Filter dialog box. Information in the Display Filter dialog box is in the form of a decision tree, which is a graphical representation of a filter's logic. When you modify display filter specifications, the decision tree reflects these modifications. Table 4.3 lists various types of filter items you can use.</p>

<p><b>Table 4.3</b> <i>Display Filter Types</i></p>

<p>
	<table valign="top" cellpadding="5" width="95%">
	
		<tr>
			<th>Filter Item</th>
			<th>Description</th>
		</tr>

		<tr>
			<td valign="top">Protocol</td>
			<td valign="top">Specifies the protocols or protocol properties</td>
		</tr>

		<tr>
			<td valign="top">Address Filter<br> 
(default is ANY &lt;--&gt; ANY)</td>
			<td valign="top">Specifies the computer addresses on which you want to capture data</td>
		</tr>

		<tr>
			<td valign="top">Property</td>
			<td valign="top">Specifies property instances that match your display criteria</td>
		</tr>

	</table>
</p>

<p>With display filters, you use AND, OR, and NOT logic, and, unlike a capture filter, you can use more than four address filter expressions. When you display captured data, all available information about the captured frames appears in the Frame Viewer window. To display only those frames sent by a specific protocol, edit the Protocol line in the Display Filter dialog box. Protocol properties are made up of information extracted from the protocol's data. Because the purpose of protocols varies, properties differ from one protocol to another. Suppose, for example, that you have captured a large number of frames using the Server Message Block (SMB) protocol but want to examine only those frames in which the SMB protocol was used to create a directory on your computer. In this instance, you can examine only frames where the SMB command property is equal to make directory. Additionally, you can display only those frames originating from a specific computer, by editing the ANY &lt;- -&gt; ANY line in the Display Filter dialog box.</p>

<A NAME="173"><H2>Reviewing Captured Data</H2></A>

<p>Perform the steps in the following list as part of your routine for reviewing and analyzing captured data:</p>

<ul>
<p><li>Follow a session using source and destination IP address and port numbers.</li></p>

<p><li>If you find a Reset, focus on the sequence numbers and acknowledgments that precede it.</li></p>

<p><li>Use a calculator to see which acknowledgments are associated with the data sent.</li></p>

<p><li>Try to understand the activity you are seeing:</li></p>

<ul>
<p><li>Is the sender doing retries?</li></p>

<p>If so, note the number of retries and the time elapsed. The default number of retries for Transmission Control Protocol/Internet Protocol (TCP/IP) is 5. This value might be different for other protocols.</p>

<p><li>Did the sender back up and re-send the previous packet?</li></p>

<p><li>Is the receiver asking for a missed frame by acknowledging a previous sequence number?</li></p>
</ul>
</ul>

<p>A reset can be caused by time-outs at the TCP layer or by time-outs of higher-layer protocols. Resets originating at the TCP layer should be easy to read from the trace. It might be more difficult to determine the cause of resets originating from higher-layer protocols such as the SMB.</p>

<p>For example, an SMB read might time out in 45 seconds and cause a reset of the session even though communications are slow but working at the TCP layer. The trace might only narrow down what component is at fault. From there you might need to use other troubleshooting methods to determine the cause.</p>

<p>To see TCP sequencing when higher-layer protocols are present, start Network Monitor and edit the Expression dialog box, using the steps in the following practice. Figure 4.4 shows the Expression dialog box.</p>

<p>
<A HREF="javascript:fullSize('04ntk04x.htm')"> <img src="images/04ntk04.JPG" width=404 height=268 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 4.4</b> <i>The Expression dialog box</i><!-- /caption -->
</p>

<p>
<img src="images/practic.JPG" width=90 height=72 border="0">
</p>

<A NAME="174"><H2>Practice: Capturing Frames with Network Monitor</H2></A>

<p>You can use Network Monitor to capture frames from your network data stream and copy those frames to a temporary capture file. In this practice, you will use Network Monitor to display statistics for the captured frames dynamically in the Capture window, and design a capture filter to copy only the frames that match your specific criteria.</p>

<p><li><b>To see TCP sequencing</b></li></p>

<ol>
<p><li>Start Network Monitor.</li></p>

<p><li>Display captured data.</li></p>

<p><li>On the Display menu, click Options.</li></p>

<p><li>Select Auto (based on protocols in the display filter), then click OK.</li></p>

<p><li>From the Display menu, click Filter.</li></p>

<p><li>Double-click Protocol=Any.</li></p>

<p><li>Click the Protocol tab, then click Disable All.</li></p>

<p><li>In the Disabled Protocols list box, select TCP.</li></p>

<p><li>Click the Enable button, then click OK.</li></p>

<p><li>On the Capture menu, click Start.</li></p>
</ol>

<A NAME="175"><H2>Network Monitor Performance Issues</H2></A>

<p>Network Monitor creates a memory-mapped file for its capture buffer. For best results, make sure to create a capture buffer large enough to accommodate the traffic you need. In addition, although you cannot adjust the frame size, you can store only part of the frame, thus reducing the amount of wasted capture buffer space. For example, if you are interested only in the data in the frame header, set the frame size (in bytes) to the size of the header frame. Network Monitor discards the frame data as it stores frames in the capture buffer, thereby using less capture buffer space.</p>

<A NAME="176"><H2>Detecting Network Monitor</H2></A>

<p>To help protect your network from unauthorized use of Network Monitor installations, Network Monitor can detect other installations of Network Monitor that are running on the local segment of your network. When Network Monitor detects other Network Monitor installations running on the network, it displays the following information:</p>

<ul>
<p><li>The name of the computer</li></p>

<p><li>The name of the user logged on at the computer</li></p>

<p><li>The state of Network Monitor on the remote computer (running, capturing, or transmitting)</li></p>

<p><li>The adapter address of the remote computer</li></p>

<p><li>The version number of Network Monitor on the remote computer</li></p>
</ul>

<p>In some instances, your network architecture might prevent one installation of Network Monitor from detecting another. For example, if an installation is separated from yours by a router that does not forward multicasts, your installation cannot detect that installation.</p>

<A NAME="177"><H2>Lesson Summary</H2></A>

<p>Network Monitor monitors the network data stream, which consists of all information transferred over a network at any given time. You can use a display filter to determine which frames to display. To design a capture filter, specify decision statements in the Capture Filter dialog box. After you have captured data, you can view it in the Network Monitor user interface. Make sure you specify a capture buffer large enough to accommodate the traffic you need.</p>

</BODY>
</HTML>





