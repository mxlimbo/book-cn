<HTML>
<HEAD>
<TITLE>Lesson 1: Introducing and Enabling IPSec</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmnet.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch05a.htm">[Previous]</A> <A HREF="ch05c.htm">[Next]</A><P>



<A NAME="190"><H1>Lesson 1: Introducing and Enabling IPSec</H1></A>

<p>IPSec is the long-term direction for secure networking. It provides a key line of defense against private network and Internet attacks, balancing ease of use with security. This lesson discusses the technologies collectively referred to as Internet Protocol Security (IPSec).</p>

<p><div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li>Explain the benefits of IPSec</li></p>

<p><li>Describe the architecture of IPSec</li></p>
</ul>

<p><b>Estimated lesson time: 50 minutes</b></p>
</blockquote></div></p>

<A NAME="191"><H2>Internet Protocol Security</H2></A>

<p>As the Internet has evolved, along with intranets, the need for security has 
increased. The main areas of concern are that network traffic is safe from</p>

<ul>
<p><li>Data modification while en route</li></p>

<p><li>Interception, viewing, or copying when intercepted</li></p>

<p><li>Being accessed by unauthenticated parties</li></p>
</ul>

<p>IPSec is a framework of open standards for ensuring private, secure communications over IP networks through the use of cryptographic security services. The Microsoft Windows 2000 implementation of IPSec is based on standards developed by the Internet Engineering Task Force (IETF) IPSec working group. IPSec has two goals:</p>

<ol>
<p><li>To protect IP packets</li></p>

<p><li>To provide a defense against network attacks</li></p>
</ol>

<p>Both goals are met through the use of cryptography-based protection services, security protocols, and dynamic key management. This foundation provides both the strength and flexibility to protect communications among computers on a 
private network and in remote sites connected by the Internet, and dial-up clients. It can even be used to filter data packets on a network.</p>

<p>IPSec is based on an end-to-end security model, meaning that the only computers that must know about IPSec are the sending and receiving computers. Each handles security at its respective end, with the assumption that the medium over which the communication takes place is not secure. Routers that forward packets between the source and destination are not required to support IPSec. This model allows IPSec to be successfully deployed for your existing enterprise scenarios:</p>

<ul>
<p><li>Local area network (LAN): client/server, peer to peer</li></p>

<p><li>Wide area network (WAN): router to router</li></p>

<p><li>Remote access: dial-up clients and Internet access from private networks</li></p>
</ul>

<A NAME="192"><H2>In-Depth Defense</H2></A>

<p>Data must be protected from interception, modification, or access by unauthorized parties. Network attacks can result in system downtime and public exposure of sensitive information.</p>

<p>Network protection strategies generally focus only on preventing attacks from outside the private network by using firewalls, secure routers (security gateways), and user authentication of dial-up access. This is referred to as perimeter security, and it does not protect against attacks from within the network.</p>

<p>User-access control security methods (smart cards, Kerberos version 5 authentication) are not adequate to protect against most network-level attacks, because they rely solely on user names and passwords. Many computers are shared by multiple users. As a result, the computer is often left in a logged-on state, making it unsecured. If a user name and password have been hijacked, user-access 
control security cannot stop the attacker's access to network resources.</p>

<p>Physical-level protection strategies protect the actual network wires from being accessed and the network access points from being used. However, these strategies cannot guarantee protection when the data crosses multiple networks, as it must on the Internet. Instead, the best method of protecting data is provided with IPSec's end-to-end model: The sending computer encrypts the data prior to transmission (before it ever reaches the network wires) and the receiving computer decrypts the data only after it has been received. For this reason, IPSec should be one of the components in a layered enterprise security plan. It protects your private data in a public environment by providing a strong, cryptography-based defense against attacks. Used in combination with strong user-access control, perimeter, and physical-level security, IPSec ensures an in-depth defense for your data.</p>

<A NAME="193"><H2>Benefits of IPSec</H2></A>

<p>Windows 2000 IPSec is implemented transparently to the user. Users do not have to be in the same domain to communicate with IPSec protection. They can each be in any trusted domain in the enterprise. IPSec Management allows administration to be centralized. Security policies are created by a domain administrator for the most common communication scenarios. These policies are stored in the 
directory service and assigned to domain policies.</p>

<p>When each computer logs on to the domain, it automatically downloads its security policy, avoiding the need to configure each computer individually. Windows 2000 IPSec provides the following advantages to help achieve a high level of secure communications with a low cost of use:</p>

<ul>
<p><li>Centralized security policy administration, which reduces administrative overhead costs.</li></p>

<p><li>Transparency of IPSec to users and applications.</li></p>

<p><li>Flexibility in configuring security policies that meet the needs of a diverse enterprise.</li></p>

<p><li>Confidentiality services, which prevent unauthorized access to sensitive data as it passes between communicating parties.</li></p>

<p><li>Strong authentication services verify the identity of both the sender and receiver to prevent security compromises caused by using falsely claimed identities.</li></p>

<p><li>Each packet is encrypted using time-specific information to prevent data from being captured and later replayed.</li></p>

<p><li>Long key lengths and dynamic rekeying during ongoing communications help protect against attacks.</li></p>

<p><li>Secure links end to end for private network users within the same domain or across any trusted domain in the enterprise.</li></p>

<p><li>Secure links end to end based on IP address between remote users and users in any domain in the enterprise.</li></p>
</ul>

<A NAME="194"><H3>Simplified Deployment</H3></A>

<p>To achieve secure communications with a low cost of ownership, Windows 2000 simplifies the deployment of IPSec with the following features:</p>

<p><b>Integration with the Windows 2000 Security Framework</b></p>

<p>IPSec uses the Windows 2000 secure domain as a trust model. By default, IPSec policies use the Windows 2000 default authentication (Kerberos V5 authentication) method to identify and trust communicating computers. Computers that are members of a Windows 2000 domain or trusted domain can easily establish IPSec secured communications.</p>

<p><b>Centralized IPSec Policy Administration at the Active Directory Level</b></p>

<p>IPSec policies can be assigned through the Group Policy features of Active Directory. This allows the IPSec policy to be assigned at the domain or organizational unit level, which eliminates the administrative overhead of configuring each computer individually.</p>

<p><b>Transparency of IPSec to Users and Applications</b></p>

<p>IPSec's high level of protection comes from its implementation at the IP transport level (network Layer 3). Implementing security at Layer 3 (see Figure 5.1) provides protection for upper-layer protocols in the Transmission Control Protocol/Internet Protocol (TCP/IP) protocol suite, such as TCP, User Datagram Protocol (UDP), Hypertext Transfer Protocol (HTTP), and even custom protocols that send traffic at the IP layer. The primary benefit of securing information at this low level is that all applications and services using IP for transport of data can be protected with IPSec. This is an improvement over other security mechanisms that operate above Layer 3, such as Secure Sockets Layer (SSL), which only protects applications that use SSL. If protection were required for all applications, then modifications to each application would be necessary.</p>

<p>
<img src="images/05ntk01.JPG" width=369 height=205 border="0">
</p><p>
<!-- caption --><b>Figure 5.1</b> <i>Layer 3 protection</i><!-- /caption -->
</p>

<p><b>Flexible Security Configuration</b></p>

<p>The security services within each policy can be customized to meet the majority of security requirements for the network and data traffic.</p>

<p><b>Automatic Key Management</b></p>

<p>IPSec services dynamically exchange and manage cryptography-based keys between communicating computers.</p>

<p><b>Automatic Security Negotiation</b></p>

<p>IPSec services dynamically negotiate a mutual set of security requirements between communicating computers, eliminating the need for both computers to have identical policies.</p>

<p><b>Public Key Infrastructure Support</b></p>

<p>Using public key certificates for authentication is supported to allow authentication and secure communication with computers that do not belong to a Windows 2000 trusted domain.</p>

<p><b>Preshared Key Support</b></p>

<p>If authentication using the Kerberos V5 protocol or public key certificates is not possible, a preshared key (a shared, secret password) can be configured to enable authentication and trust between the communicating computers.</p>

<A NAME="195"><H2>IP Security Process</H2></A>

<p>This is an overview of the IP Security process, as illustrated in Figure 5.2:</p>

<ul>
<p><li>An IP packet matches an IP filter that is part of an IPSec policy.</li></p>

<p><li>The IPSec policy can have several optional security methods. The IPSec driver needs to know which method to use to secure the packet. The IPSec driver requests that Internet Security Association and Key Management Protocol (ISAKMP) negotiate a security method and security key.</li></p>

<p><li>ISAKMP negotiates a security method and sends it plus a security key to the IPSec driver.</li></p>

<p><li>The method and key become the IPSec security association (SA). The IPSec driver stores this SA in its database.</li></p>

<p><li>Both communicating hosts need to encrypt or decrypt IP traffic, so both need to know and store the SA.</li></p>
</ul>

<p>
<img src="images/05ntk02.JPG" width=353 height=373 border="0">
</p><p>
<!-- caption --><b>Figure 5.2</b> <i>IP Security process overview</i><!-- /caption -->
</p>

<A NAME="196"><H2>IPSec Architecture</H2></A>

<p>IPSec is implemented in Windows 2000 using the following components:</p>

<ul>
<p><li>IPSec policy agent</li></p>

<p><li>ISAKMP/Oakley Key Management Service</li></p>

<p><li>IPSec driver</li></p>

<p><li>IPSec model</li></p>
</ul>

<A NAME="197"><H3>IPSec Policy Agent Service</H3></A>

<p>The policy agent is an IPSec mechanism residing on each Windows 2000 computer. The policy agent starts automatically when the computer is started. The policy agent performs the following tasks at the interval specified in the IPSec policy, as illustrated in Figure 5.3:</p>

<ol>
<p><li>Retrieves the computer's assigned IPSec policy from Windows 2000 Active Directory.</li></p>

<p><li>If there are no IPSec policies in the directory service or if the policy agent cannot connect to the directory service, it attempts to read the policy from the computer's registry. The policy agent service stops if there are no IPSec policies in the directory service or registry.</li></p>

<p><li>If there are policies in the directory service, the data transfer of policy information from the directory service to the computer is protected with data integrity and encryption services.</li></p>

<p><li>Sends the policy information to the IPSec driver, the ISAKMP/Oakley service, and the computer's registry.</li></p>
</ol>

<p>
<img src="images/05ntk03.JPG" width=404 height=448 border="0">
</p><p>
<!-- caption --><b>Figure 5.3</b> <i>Tasks performed by the policy agent</i><!-- /caption -->
</p>

<A NAME="198"><H3>ISAKMP/Oakley Key Management Service</H3></A>

<p>This service is an IPSec mechanism residing on each computer running Windows 2000. Before IP datagrams can be transmitted from one computer to another, a security association must be established between the two computers. A security association is a set of parameters that defines the common security services and mechanisms used to protect the communication, such as keys and security properties.</p>

<p>The ISAKMP centralizes security association management, reducing connection time. The Oakley protocol generates the actual keys that will be used to encrypt and decrypt the transferred data. ISAKMP/Oakley performs a two-phase operation:</p>

<ol>
<p><li>Establishes a secure channel between the two computers for the communication. To achieve this, it authenticates computer identities, and exchanges keying data to establish the shared, secret key the computers will use to encrypt and decrypt the data.</li></p>

<p><li>Establishes a security association between the two computers, which is passed to the IPSec driver, along with the shared key, on both the sending and receiving computers.</li></p>
</ol>

<p>The policy agent automatically starts the ISAKMP/Oakley service. This service will not start automatically or manually unless the policy agent service is running. If a security association cannot be established, the IPSec policy can be configured to either block communication or accept unsecured communication.</p>

<A NAME="199"><H3>IPSec Driver</H3></A>

<p>The IPSec driver (IPSEC.SYS) resides on each computer running Windows 2000. The driver watches all IP datagrams for a match with a filter list in the computer's security policy. The filter list defines which computers and networks require secure communications. If a filter match is found, the IPSec driver on the sending computer uses the SA and shared key to encrypt the data and sends it to the 
receiving computer. The IPSec driver on the receiving computer decrypts the transferred data and passes it to the receiving application.</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>
The policy agent automatically starts the IPSec driver.
</blockquote></div></p>

<A NAME="200"><H3>The IPSec Model</H3></A>

<p>Figure 5.4 shows two users on intranet computers running Windows 2000 Server. Both Computer A and Computer B have an active IPSec policy.</p>

<ol>
<p><li>Alice launches the File Transfer Protocol (FTP) application from Host A and sends data to Bob, who will receive it on Host B.</li></p>

<p><li>The IPSec driver on Host A notifies the ISAKMP/Oakley service that IPSec is needed for this communication by using the policies in the registry written by the policy agent.</li></p>

<p><li>The ISAKMP/Oakley services on Host A and Host B establish a shared key and SA.</li></p>

<p><li>The IPSec drivers on Host A and Host B each receive the key and SA.</li></p>

<p><li>The IPSec driver on Host A uses the key to encrypt the data and sends the data to Host B.</li></p>

<p><li>Host B's IPSec driver decrypts the data and passes it to the receiving application, where Bob retrieves the data.</li></p>
</ol>

<p>
<A HREF="javascript:fullSize('05ntk04x.htm')"> <img src="images/05ntk04.JPG" width=404 height=349 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 5.4</b> <i>IPSec policy flow to encrypt data between two computers</i><!-- /caption -->
</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>
Any routers or switches that are in the path between the communicating computers should only participate in forwarding the encrypted IP datagrams to their destination. However, if a firewall or other security gateway is between the communicating computers, IP forwarding must be enabled or special filtering must be created to permit forwarding of encrypted IP datagrams.
</blockquote></div></p>

<A NAME="201"><H2>Considerations for IPSec</H2></A>

<p>IPSec provides encryption of outgoing packets, but at a cost in performance. IPSec implements symmetric encryption of network data that is very efficient. However, for servers supporting many simultaneous network connections, the additional cost of encryption is significant, so you need to plan to test IPSec using simulated network traffic before deploying it. Testing is also important if you are using a third-party hardware or software product to provide IP security. You can define IPSec policies for each domain. You can configure IPSec policies to</p>

<ul>
<p><li>Specify the types of authentication and the levels of confidentiality required between IPSec clients</li></p>

<p><li>Specify the lowest security level at which communications are allowed to occur between IPSec-aware clients</li></p>

<p><li>Allow or prevent communications with non-IPSec-aware clients</li></p>

<p><li>Require all communications to be encrypted for confidentiality, or you can allow communications in plaintext</li></p>
</ul>

<p>Consider using IPSec to provide security for the following applications:</p>

<ul>
<p><li>Peer-to-peer communications over your organization's intranet, such as legal-department or executive-committee communications.</li></p>

<p><li>Client/server communications to protect sensitive (confidential) information stored on servers.</li></p>

<p><li>Remote access (dial-up or virtual private network [VPN]) communications (For VPNs using IPSec with Layer Two Tunneling Protocol [L2TP], remember to set up Group Policy to permit auto enrollment for IPSec certificates. For detailed information about machine certificates for L2TP over IPSec VPN connections, see Windows 2000 Help.).</li></p>

<p><li>Secure router-to-router WAN communications.</li></p>
</ul>

<p>Consider the following strategies for IPSec in your network security deployment plan:</p>

<ul>
<p><li>Identify clients and servers to use IPSec communications.</li></p>

<p><li>Identify whether client authentication is based on Kerberos trust or digital certificates.</li></p>

<p><li>Describe each IPSec policy, including rules and filter lists.</li></p>

<p><li>Describe certificate services needed to support client authentication by digital certificates.</li></p>

<p><li>Describe enrollment processes and strategies to enroll users for IPSec certificates.</li></p>
</ul>

<A NAME="202"><H2>Lesson Summary</H2></A>

<p>IPSec is a framework of open standards for ensuring private, secure communications over IP networks through the use of cryptographic security services. IPSec is transparent to the user and provides a high level of secure communications with a low cost of use.</p>

<p>The architecture of IPSec is comprised of four major components: IPSec policy agent, ISAKMP/Oakley Key Management Service, IPSec driver, and IPSec model.</p>

</BODY>
</HTML>





