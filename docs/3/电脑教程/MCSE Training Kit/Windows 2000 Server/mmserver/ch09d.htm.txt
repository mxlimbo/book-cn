<HTML>
<HEAD>
<TITLE>Lesson 3: Dynamic Host Configuration Protocol Service</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmserver.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch09c.htm", "ch09e.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="453"><h1>Lesson 3: Dynamic Host Configuration Protocol Service</h1></A>
<p>The DHCP Service in Windows 2000 centralizes and manages the allocation of TCP/IP configuration information by assigning IP addresses and other TCP/IP configuration information automatically to computers that are setup as DHCP clients. Implementing the DHCP Service can eliminate many of the configuration problems associated with configuring TCP/IP manually. This lesson discusses the skills necessary and provides information to install and configure the DHCP Service. It also discusses the DHCP lease process.</p>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b> 

<ul>
<p><li>Install the DHCP Service</li></p>

<p><li>Create a scope for the DHCP Service and configure a range of addresses and a reservation for a DHCP scope</li></p>

<p><li>Back up and restore the DHCP database</li></p>
</ul>

<b>Estimated lesson time: 70 minutes</b> 
</blockquote></div>
</p>

<A NAME="454"><h2>Introduction to DHCP</h2></A>
<p>DHCP is a TCP/IP standard for simplifying the management of IP configuration. DHCP is an extension of the Bootstrap Protocol (BOOTP), which is based on the User Datagram Protocol/Internet Protocol (UDP/IP). BOOTP enables a booting host to configure itself dynamically.</p>

<p>Each time a DHCP client starts, it requests IP addressing information from a DHCP server. This addressing information includes the following:</p>

<ul>
<p><li>An IP address</li></p>

<p><li>A subnet mask</li></p>

<p><li>Optional values, such as a default gateway address, a DNS server address, or a WINS server address</li></p>
</ul>

<p>When a DHCP server receives a request for an IP address, it selects IP addressing information from a pool of addresses defined in its database and offers the IP addressing information to the DHCP client. If the client accepts the offer, the DHCP server leases the IP addressing information to the client for a specified period.</p>

<p><b>Manual versus automatic TCP/IP configuration</b></p>

<p>To understand why the DHCP Service is beneficial for configuring TCP/IP on clients, contrast the manual method of configuring TCP/IP with the automatic method using DHCP, as shown in the following table.</p>

<p><table cellpadding=5 width="95%"><tr>
<th>Configuring TCP/IP manually</th><th>Configuring TCP/IP using DHCP</th>
</tr><tr>
<td valign="top">Users can pick an IP address at random rather than obtaining a valid IP address from the network administrator. Using incorrect addresses can lead to network problems that can be difficult to trace to the source.</td> <td valign="top">Users no longer need to acquire IP addressing information from an administrator to configure TCP/IP. The DHCP Service supplies all the necessary configuration information to all the DHCP clients.</td></tr><tr> 
<td valign="top">Typing in the IP address, subnet mask, or default gateway can lead to problems ranging from difficulty communicating, if the default gateway or subnet mask is incorrect, to problems associated with a duplicate IP address.</td> <td valign="top">Valid IP addressing information ensures 
correct configuration, which eliminates most difficult-to-trace network problems.</td></tr><tr> 
<td valign="top">There is administrative overhead for networks if you frequently move computers from one subnet to another. For example, you must change the IP address and default gateway address for a client to communicate from a new location.</td> <td valign="top">Having servers running the DHCP Service on each subnet eliminates the overhead associated with having to manually reconfigure IP addresses, subnet masks, and default 
gateways when you move computers from one subnet to another. Note that a single DHCP server can support IP address allocation for multiple networks.</td></tr></table></p>

<A NAME="455"><h3>The DHCP Lease Process</h3></A>
<p>The DHCP Service allocates IP addressing information to client computers. The allocation of IP addressing information is called a <i>DHCP lease</i>. The DHCP lease process occurs when one of the following events occurs:</p>

<ul>
<p><li>TCP/IP is initialized for the first time on a DHCP client.</li></p>

<p><li>A client requests a specific IP address and is denied, possibly because the DHCP server dropped the lease.</li></p>

<p><li>A client previously leased an IP address but released the IP address and requires a new one. A DHCP lease can be manually released by typing <b>ipconfig /release</b> at a command prompt.</li></p>
</ul>

<p>DHCP uses a four-phase process to lease IP addressing information to 
a DHCP client for a specific period: DHCPDISCOVER, DHCPOFFER, DHCPREQUEST, and DHCPACK (Figure 9.5).</p>

<p>
<A HREF="javascript:fullSize('f09xx05gx.htm')"> <img src="images/f09xx05g.jpg" border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 9.5</b> <i>The DHCP lease process</i><!--/caption-->
</p>

<p><b>DHCPDISCOVER</b></p>

<p>The first step in the DHCP lease process is DHCPDISCOVER. To begin the DHCP lease process, a client initializes a limited version of TCP/IP and broadcasts a DHCPDISCOVER message requesting the location of a DHCP server and IP addressing information. Because the client does not know the IP address of a DHCP server, the client uses 0.0.0.0 as the source address and 255.255.255.255 as the destination address. The DHCPDISCOVER message contains the client's hardware address and computer name so that the DHCP servers can determine which client sent the request.</p>

<p><b>DHCPOFFER</b></p>

<p>The second step in the DHCP lease process is DHCPOFFER. All DHCP servers that receive the IP lease request and have a valid client configuration broadcast a DHCPOFFER message that includes the following information:</p>

<ul>
<p><li>The client's hardware address</li></p>

<p><li>An offered IP address</li></p>

<p><li>A subnet mask</li></p>

<p><li>The length of the lease</li></p>

<p><li>A server identifier (the IP address of the offering DHCP server)</li></p>
</ul>

<p>The DHCP server sends a broadcasted message because the client does not yet have an IP address. The DHCP client selects the IP address from the first offer that it receives. The DHCP server issuing the IP address reserves the address so that it cannot be offered to another DHCP client.</p>

<p><b>DHCPREQUEST</b></p>

<p>The third step in the DHCP lease process occurs after the client receives a DHCPOFFER from at least one DHCP server and selects an IP address. The client broadcasts a DHCPREQUEST message to all DHCP servers, indicating that it has accepted an offer. The DHCPREQUEST message includes the server identifier (IP address) of the server whose offer it accepted. All other DHCP servers then retract their offers and retain their IP addresses for the next IP lease request.</p>

<p><b>DHCPACK</b></p>

<p>The final step in a successful DHCP lease process occurs when the DHCP server issuing the accepted offer broadcasts a successful acknowledgment to the client in the form of a DHCPACK message. This message contains a valid lease for an IP address and possibly other configuration information.</p>

<p>When the DHCP client receives the acknowledgment, TCP/IP is completely initialized and the client is considered a bound DHCP client. Once bound, the client can use TCP/IP to communicate on the network.</p>

<p><b>DHCPNACK</b></p>

<p>If the DHCPREQUEST is not successful, the DHCP server broadcasts a negative acknowledgement (DHCPNACK). A DHCP server broadcasts a DHCPNACK if one of the following conditions are met:</p>

<ul>
<p><li>The client is trying to lease its previous IP address, and the IP address is no longer available.</li></p>

<p><li>The IP address is invalid because the client computer has been moved to a different subnet.</li></p>
</ul>

<p>When the client receives an unsuccessful acknowledgment, it resumes the DHCP lease process.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
If a computer has multiple network adapters bound to TCP/IP, the DHCP process occurs separately over each adapter. The DHCP Service assigns a unique and valid IP address to each adapter in the computer 
bound to TCP/IP.</blockquote></div>
</p>

<A NAME="456"><h3>IP Lease Renewal and Release</h3></A>
<p>All DHCP clients attempt to renew their lease when 50 percent of the lease time has expired. To renew its lease, a DHCP client sends a DHCPREQUEST message directly to the DHCP server from which it obtained the lease. If the DHCP server is available, it renews the lease and sends the client a DHCPACK message with the new lease time and any updated configuration parameters. The client updates its configuration when it receives the acknowledgment.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
Each time a DHCP client restarts, it attempts to lease the same IP address from the original DHCP server. If the lease request is unsuccessful and lease time is still available, the DHCP client continues to use the same IP address until the next attempt to renew the lease.</blockquote></div>
</p>

<p>If a DHCP client cannot renew its lease with the original DHCP server at the 50 percent interval, the client broadcasts a DHCPREQUEST to contact any available DHCP server when 87.5 percent of the lease time has expired. Any DHCP server can respond with a DHCPACK message (renewing the lease) or a DHCPNACK message (forcing the DHCP client to reinitialize and obtain a lease for a different IP address).</p>

<p>If the lease expires or a DHCPNACK message is received, the DHCP client must immediately discontinue using that IP address. The DHCP client then begins the DHCP lease process to lease a new IP address.</p>

<p><b>Using Ipconfig to Renew a Lease</b></p>

<p>Use the ipconfig command with the /renew switch to send a DHCPREQUEST message to the DHCP server to receive updated options and lease time. If the DHCP server is unavailable, the client continues using the current DHCP-supplied configuration options.</p>

<p><b>Using Ipconfig to Release a Lease</b></p>

<p>You can use the ipconfig command with the /release switch to cause a DHCP client to send a DHCPRELEASE message to the DHCP server and to release its lease. This is useful when you are moving a client to a different network and the client will not require its previous lease. TCP/IP communications with the client stops after you issue this command.</p>

<p>Microsoft DHCP clients do not initiate DHCPRELEASE messages when shutting down. If a client remains shut down for the length of its lease (and the lease is not renewed), the DHCP server might assign that client's IP address to a different client after the lease expires. A client has a better chance of receiving the same IP address during initialization if it does not send a DHCPRELEASE message.</p>

<p><img src="images/cd.JPG" border="0"></p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
For more information about DHCP and DHCP implementation, see the Supplemental Course Materials CD-ROM (\chapt09\articles\DHCP2000.doc) that accompanies this book.</blockquote></div>
</p>

<A NAME="457"><h2>Installing and Configuring the DHCP Service</h2></A>
<p>To implement DHCP, you must install and configure the DHCP Service on at least one computer running Windows 2000 Server within the TCP/IP network. The computer can be configured as a domain controller or as a stand-alone server. In addition, for DHCP to function properly, you must manually configure the TCP/IP settings for the server and set up the clients for dynamic address configuration.</p>

<p><b>Requirements for a Server Running the DHCP Service</b></p>

<p>A DHCP server requires a computer running Windows 2000 Server that is configured with the following:</p>

<ul>
<p><li>A static IP address, subnet mask, default gateway (if necessary), and other TCP/IP parameters. A DHCP server cannot be a DHCP client.</li></p>

<p><li>The DHCP Service.</li></p>

<p><li>An activated DHCP scope. A scope is a range of IP addresses that are available for lease or assignment to clients. Once the scope is created, it must be activated.</li></p>

<p><li>An authorization. The DHCP server must be authorized with Active Directory services.</li></p>
</ul>

<p><b>Requirements for DHCP Clients</b></p>

<p>A DHCP client requires a computer that is DHCP-enabled and running any of the following supported operating systems:</p>

<ul>
<p><li>Windows 2000</li></p>

<p><li>Windows NT Server 3.51 or later</li></p>

<p><li>Windows NT Workstation 3.51 or later</li></p>

<p><li>Windows