<HTML>
<HEAD>
<TITLE>Lesson 3: Dynamic Host Configuration Protocol Service</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmserver.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch09c.htm", "ch09e.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="453"><h1>Lesson 3: Dynamic Host Configuration Protocol Service</h1></A>
<p>The DHCP Service in Windows 2000 centralizes and manages the allocation of TCP/IP configuration information by assigning IP addresses and other TCP/IP configuration information automatically to computers that are setup as DHCP clients. Implementing the DHCP Service can eliminate many of the configuration problems associated with configuring TCP/IP manually. This lesson discusses the skills necessary and provides information to install and configure the DHCP Service. It also discusses the DHCP lease process.</p>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b> 

<ul>
<p><li>Install the DHCP Service</li></p>

<p><li>Create a scope for the DHCP Service and configure a range of addresses and a reservation for a DHCP scope</li></p>

<p><li>Back up and restore the DHCP database</li></p>
</ul>

<b>Estimated lesson time: 70 minutes</b> 
</blockquote></div>
</p>

<A NAME="454"><h2>Introduction to DHCP</h2></A>
<p>DHCP is a TCP/IP standard for simplifying the management of IP configuration. DHCP is an extension of the Bootstrap Protocol (BOOTP), which is based on the User Datagram Protocol/Internet Protocol (UDP/IP). BOOTP enables a booting host to configure itself dynamically.</p>

<p>Each time a DHCP client starts, it requests IP addressing information from a DHCP server. This addressing information includes the following:</p>

<ul>
<p><li>An IP address</li></p>

<p><li>A subnet mask</li></p>

<p><li>Optional values, such as a default gateway address, a DNS server address, or a WINS server address</li></p>
</ul>

<p>When a DHCP server receives a request for an IP address, it selects IP addressing information from a pool of addresses defined in its database and offers the IP addressing information to the DHCP client. If the client accepts the offer, the DHCP server leases the IP addressing information to the client for a specified period.</p>

<p><b>Manual versus automatic TCP/IP configuration</b></p>

<p>To understand why the DHCP Service is beneficial for configuring TCP/IP on clients, contrast the manual method of configuring TCP/IP with the automatic method using DHCP, as shown in the following table.</p>

<p><table cellpadding=5 width="95%"><tr>
<th>Configuring TCP/IP manually</th><th>Configuring TCP/IP using DHCP</th>
</tr><tr>
<td valign="top">Users can pick an IP address at random rather than obtaining a valid IP address from the network administrator. Using incorrect addresses can lead to network problems that can be difficult to trace to the source.</td> <td valign="top">Users no longer need to acquire IP addressing information from an administrator to configure TCP/IP. The DHCP Service supplies all the necessary configuration information to all the DHCP clients.</td></tr><tr> 
<td valign="top">Typing in the IP address, subnet mask, or default gateway can lead to problems ranging from difficulty communicating, if the default gateway or subnet mask is incorrect, to problems associated with a duplicate IP address.</td> <td valign="top">Valid IP addressing information ensures 
correct configuration, which eliminates most difficult-to-trace network problems.</td></tr><tr> 
<td valign="top">There is administrative overhead for networks if you frequently move computers from one subnet to another. For example, you must change the IP address and default gateway address for a client to communicate from a new location.</td> <td valign="top">Having servers running the DHCP Service on each subnet eliminates the overhead associated with having to manually reconfigure IP addresses, subnet masks, and default 
gateways when you move computers from one subnet to another. Note that a single DHCP server can support IP address allocation for multiple networks.</td></tr></table></p>

<A NAME="455"><h3>The DHCP Lease Process</h3></A>
<p>The DHCP Service allocates IP addressing information to client computers. The allocation of IP addressing information is called a <i>DHCP lease</i>. The DHCP lease process occurs when one of the following events occurs:</p>

<ul>
<p><li>TCP/IP is initialized for the first time on a DHCP client.</li></p>

<p><li>A client requests a specific IP address and is denied, possibly because the DHCP server dropped the lease.</li></p>

<p><li>A client previously leased an IP address but released the IP address and requires a new one. A DHCP lease can be manually released by typing <b>ipconfig /release</b> at a command prompt.</li></p>
</ul>

<p>DHCP uses a four-phase process to lease IP addressing information to 
a DHCP client for a specific period: DHCPDISCOVER, DHCPOFFER, DHCPREQUEST, and DHCPACK (Figure 9.5).</p>

<p>
<A HREF="javascript:fullSize('f09xx05gx.htm')"> <img src="images/f09xx05g.jpg" border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 9.5</b> <i>The DHCP lease process</i><!--/caption-->
</p>

<p><b>DHCPDISCOVER</b></p>

<p>The first step in the DHCP lease process is DHCPDISCOVER. To begin the DHCP lease process, a client initializes a limited version of TCP/IP and broadcasts a DHCPDISCOVER message requesting the location of a DHCP server and IP addressing information. Because the client does not know the IP address of a DHCP server, the client uses 0.0.0.0 as the source address and 255.255.255.255 as the destination address. The DHCPDISCOVER message contains the client's hardware address and computer name so that the DHCP servers can determine which client sent the request.</p>

<p><b>DHCPOFFER</b></p>

<p>The second step in the DHCP lease process is DHCPOFFER. All DHCP servers that receive the IP lease request and have a valid client configuration broadcast a DHCPOFFER message that includes the following information:</p>

<ul>
<p><li>The client's hardware address</li></p>

<p><li>An offered IP address</li></p>

<p><li>A subnet mask</li></p>

<p><li>The length of the lease</li></p>

<p><li>A server identifier (the IP address of the offering DHCP server)</li></p>
</ul>

<p>The DHCP server sends a broadcasted message because the client does not yet have an IP address. The DHCP client selects the IP address from the first offer that it receives. The DHCP server issuing the IP address reserves the address so that it cannot be offered to another DHCP client.</p>

<p><b>DHCPREQUEST</b></p>

<p>The third step in the DHCP lease process occurs after the client receives a DHCPOFFER from at least one DHCP server and selects an IP address. The client broadcasts a DHCPREQUEST message to all DHCP servers, indicating that it has accepted an offer. The DHCPREQUEST message includes the server identifier (IP address) of the server whose offer it accepted. All other DHCP servers then retract their offers and retain their IP addresses for the next IP lease request.</p>

<p><b>DHCPACK</b></p>

<p>The final step in a successful DHCP lease process occurs when the DHCP server issuing the accepted offer broadcasts a successful acknowledgment to the client in the form of a DHCPACK message. This message contains a valid lease for an IP address and possibly other configuration information.</p>

<p>When the DHCP client receives the acknowledgment, TCP/IP is completely initialized and the client is considered a bound DHCP client. Once bound, the client can use TCP/IP to communicate on the network.</p>

<p><b>DHCPNACK</b></p>

<p>If the DHCPREQUEST is not successful, the DHCP server broadcasts a negative acknowledgement (DHCPNACK). A DHCP server broadcasts a DHCPNACK if one of the following conditions are met:</p>

<ul>
<p><li>The client is trying to lease its previous IP address, and the IP address is no longer available.</li></p>

<p><li>The IP address is invalid because the client computer has been moved to a different subnet.</li></p>
</ul>

<p>When the client receives an unsuccessful acknowledgment, it resumes the DHCP lease process.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
If a computer has multiple network adapters bound to TCP/IP, the DHCP process occurs separately over each adapter. The DHCP Service assigns a unique and valid IP address to each adapter in the computer 
bound to TCP/IP.</blockquote></div>
</p>

<A NAME="456"><h3>IP Lease Renewal and Release</h3></A>
<p>All DHCP clients attempt to renew their lease when 50 percent of the lease time has expired. To renew its lease, a DHCP client sends a DHCPREQUEST message directly to the DHCP server from which it obtained the lease. If the DHCP server is available, it renews the lease and sends the client a DHCPACK message with the new lease time and any updated configuration parameters. The client updates its configuration when it receives the acknowledgment.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
Each time a DHCP client restarts, it attempts to lease the same IP address from the original DHCP server. If the lease request is unsuccessful and lease time is still available, the DHCP client continues to use the same IP address until the next attempt to renew the lease.</blockquote></div>
</p>

<p>If a DHCP client cannot renew its lease with the original DHCP server at the 50 percent interval, the client broadcasts a DHCPREQUEST to contact any available DHCP server when 87.5 percent of the lease time has expired. Any DHCP server can respond with a DHCPACK message (renewing the lease) or a DHCPNACK message (forcing the DHCP client to reinitialize and obtain a lease for a different IP address).</p>

<p>If the lease expires or a DHCPNACK message is received, the DHCP client must immediately discontinue using that IP address. The DHCP client then begins the DHCP lease process to lease a new IP address.</p>

<p><b>Using Ipconfig to Renew a Lease</b></p>

<p>Use the ipconfig command with the /renew switch to send a DHCPREQUEST message to the DHCP server to receive updated options and lease time. If the DHCP server is unavailable, the client continues using the current DHCP-supplied configuration options.</p>

<p><b>Using Ipconfig to Release a Lease</b></p>

<p>You can use the ipconfig command with the /release switch to cause a DHCP client to send a DHCPRELEASE message to the DHCP server and to release its lease. This is useful when you are moving a client to a different network and the client will not require its previous lease. TCP/IP communications with the client stops after you issue this command.</p>

<p>Microsoft DHCP clients do not initiate DHCPRELEASE messages when shutting down. If a client remains shut down for the length of its lease (and the lease is not renewed), the DHCP server might assign that client's IP address to a different client after the lease expires. A client has a better chance of receiving the same IP address during initialization if it does not send a DHCPRELEASE message.</p>

<p><img src="images/cd.JPG" border="0"></p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
For more information about DHCP and DHCP implementation, see the Supplemental Course Materials CD-ROM (\chapt09\articles\DHCP2000.doc) that accompanies this book.</blockquote></div>
</p>

<A NAME="457"><h2>Installing and Configuring the DHCP Service</h2></A>
<p>To implement DHCP, you must install and configure the DHCP Service on at least one computer running Windows 2000 Server within the TCP/IP network. The computer can be configured as a domain controller or as a stand-alone server. In addition, for DHCP to function properly, you must manually configure the TCP/IP settings for the server and set up the clients for dynamic address configuration.</p>

<p><b>Requirements for a Server Running the DHCP Service</b></p>

<p>A DHCP server requires a computer running Windows 2000 Server that is configured with the following:</p>

<ul>
<p><li>A static IP address, subnet mask, default gateway (if necessary), and other TCP/IP parameters. A DHCP server cannot be a DHCP client.</li></p>

<p><li>The DHCP Service.</li></p>

<p><li>An activated DHCP scope. A scope is a range of IP addresses that are available for lease or assignment to clients. Once the scope is created, it must be activated.</li></p>

<p><li>An authorization. The DHCP server must be authorized with Active Directory services.</li></p>
</ul>

<p><b>Requirements for DHCP Clients</b></p>

<p>A DHCP client requires a computer that is DHCP-enabled and running any of the following supported operating systems:</p>

<ul>
<p><li>Windows 2000</li></p>

<p><li>Windows NT Server 3.51 or later</li></p>

<p><li>Windows NT Workstation 3.51 or later</li></p>

<p><li>Windows 98</li></p>

<p><li>Windows 95</li></p>

<p><li>Windows for Workgroups 3.11 running Microsoft TCP/IP-32</li></p>

<p><li>Microsoft Network Client 3.0 for Microsoft MS-DOS with the real-mode TCP/IP driver</li></p>

<p><li>LAN Manager version 2.2c for MS-DOS (LAN Manager 2.2c for OS/2 is not supported.)</li></p>
</ul>

<A NAME="458"><h3>Installing the DHCP Service</h3></A>
<p>The first step in implementing DHCP is to install the DHCP Service. Before you install the DHCP Service, you should specify a static IP address, subnet mask, and default gateway address for the network adapter bound to TCP/IP in the computer designated as the DHCP server.</p>

<p>To install the DHCP Service, use the Add/Remove Programs utility in Control Panel. The DHCP Service starts automatically during installation and must be running to communicate with DHCP clients.</p>

<A NAME="459"><h3>The DHCP Snap-In</h3></A>
<p>You can use the DHCP snap-in, shown in Figure 9.6, for all DHCP management and configuration tasks. The DHCP snap-in provides access to detailed information about the DHCP scopes and options. The snap-in also allows you to create and modify scopes, view address leases, create and modify client reservations, and configure server, scope, and client reservation options.</p>

<p>
<A HREF="javascript:fullSize('f09xx06x.htm')"> <img src="images/f09xx06.jpg" border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 9.6</b> <i>The DHCP snap-in</i><!--/caption-->
</p>

<p>You can access the DHCP snap-in as a stand-alone MMC console or through the Computer Management snap-in. The DHCP snap-in can be installed by running Adminpak.msi or by installing the DHCP Service. Before the DHCP Service is installed, the DHCP snap-in is used to manage remote servers running the DHCP Service.</p>

<A NAME="460"><h3>Creating a DHCP Scope</h3></A>
<p>After you have installed the DHCP Service and it is running, the next step is to create a scope. The scope must be created before a DHCP server can lease an address to DHCP clients. A scope is a pool of valid IP addresses available for lease to DHCP clients.</p>

<p>When creating a DHCP scope, consider the following guidelines:</p>

<ul>
<p><li>You must create at least one scope for every DHCP server.</li></p>

<p><li>You must exclude static IP addresses from the scope.</li></p>

<p><li>You can create multiple scopes on a DHCP server to centralize administration and to assign IP addresses specific to a subnet. You can assign only one scope to a specific subnet.</li></p>

<p><li>DHCP servers do not share scope information. As a result, when you create scopes on multiple DHCP servers, ensure that the same IP addresses do not exist in more than one scope to prevent duplicate IP addressing.</li></p>
</ul>

<p>To create a scope, use the DHCP snap-in. The following table describes some of the parameters that you can specify when creating a new scope:</p>

<p><table cellpadding=5 width="95%"><tr>
<th>Parameter</th><th>Description</th>
</tr><tr>
<td valign="top">Name</td> <td valign="top">The name of the scope.</td></tr><tr>
<td valign="top">Description</td> <td valign="top">An optional description for the scope.</td></tr><tr>
<td valign="top">Start IP Address</td> <td valign="top">The starting IP address of the range of addresses that can be assigned to a DHCP client from this scope.</td></tr><tr>
<td valign="top">End IP Address</td> <td valign="top">The ending IP address of the range of addresses that can be assigned to a DHCP client from this scope.</td></tr><tr>
<td valign="top">Subnet Mask</td> <td valign="top">The subnet mask to assign to DHCP clients. You can specify the subnet mask by bit length or by the actual subnet mask.</td></tr><tr>
<td valign="top">Start IP Address (for excluded range)</td> <td valign="top">The starting IP address of the range to exclude from the 
pool of addresses. The addresses in this exclusion will not be assigned to DHCP clients. Use this feature if you have static IP addresses configured on non-DCHP clients.  (Assigning an excluded range is optional.)</td></tr><tr>
<td valign="top">End IP Address (for excluded range)</td> <td valign="top">The ending IP address of the range to exclude from the 
pool of addresses. The addresses in this exclusion will not be assigned to DHCP clients. Use this feature if you have static IP addresses configured on non-DCHP clients.  (Assigning an excluded range is optional.)</td></tr><tr>
<td valign="top">Lease Duration</td> <td valign="top">The number of days, hours, and minutes that a DHCP client lease is available before it must be renewed.</td></tr></table></p>

<p>Once you have created the scope, you must activate it to make it available for lease assignments. To activate a scope, select the scope and then select Activate from the Action menu.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
You must delete and re-create a scope to specify a new subnet mask or range of IP addresses.</blockquote></div>
</p>

<p><b>Configuring a DHCP Scope</b></p>

<p>Once you have created the DHCP scope, you can configure options for DHCP clients. There are three levels of scope options: server, scope, and client.</p>

<p><b>Server Options</b></p>

<p>Server options are available to all DHCP clients. Use server options when all clients on all subnets require the same configuration information. For example, you might want all clients configured to use the same WINS server. Server options are always used, unless scope or client options are configured. To configure server options, select Server Options and then select Configure Options from the Action menu.</p>

<p><b>Scope Options</b></p>

<p>Scope options are available only to clients who lease an address from the specific scope. For example, if you have a different scope for each subnet, you can define a unique default gateway address for each subnet. Scope options override server options. To configure scope options, select Scope Options from the specific scope and then select Configure Options from the Action menu.</p>

<p><b>Client Options</b></p>

<p>Client options are available to specific clients with reserved DHCP address leases. Client options are always used before scope or server options. To configure client options, select the specific client reservation and then select Configure Options from the Action menu.</p>

<p><b>Configuring DHCP Options</b></p>

<p>The following table describes some of the options available when you configure the DHCP server, scope, or client reservation. The Properties dialog box for the server, scope, or client reservation includes all the options supported by Microsoft DHCP.</p>

<p><table cellpadding=5 width="95%"><tr>
<th>Option</th><th>Description</th>
</tr><tr>
<td valign="top">003 Router</td> <td valign="top">The IP address of a router, such as the default gateway address. A locally defined default gateway on a client takes precedence over the DHCP option. To make sure that router information is sent to a client computer, verify that the Default Gateway text box on the client computer is empty (Figure 9.4).</td></tr><tr>
<td valign="top">006 DNS Servers</td> <td valign="top">The IP address of a DNS server. A locally defined DNS on a client takes precedence over the DHCP option. Make sure the Obtain DNS Server Address Automatically radio button is selected on the client computer (Figure 9.4).</td></tr><tr>
<td valign="top">015 DNS Domain Name</td> <td valign="top">The DNS domain name for client resolutions.</td></tr><tr>
<td valign="top">044 WINS/NBNS Servers</td> <td valign="top">The IP address of a WINS/NBNS server available to clients. If a WINS server address is configured manually on a client, that configuration overrides the values configured for this option.</td></tr><tr>
<td valign="top">046 WINS/NBT Node Type</td> <td valign="top">The type of network basic input/output system (NetBIOS) over TCP/IP name resolution to be used by the client. Options are 1 = B-node (broadcast), 
2 = P-node (peer), 4 = M-node (mixed), and 8 = H-node (hybrid).</td></tr><tr>
<td valign="top">047 NetBIOS Scope ID</td> <td valign="top">The local NetBIOS over TCP/IP scope ID. NetBIOS over TCP/IP communicate only with other NetBIOS hosts that are using the same scope ID.</td></tr></table></p>

<p>The following table describes the available value types used when configuring the DHCP options.</p>

<p><table cellpadding=5 width="95%"><tr>
<th>Value type</th><th>Description</th>
</tr><tr>
<td valign="top">IP Address</td> <td valign="top">The IP address of a server, for example, 003 Routers.</td></tr><tr>
<td valign="top">Long</td> <td valign="top">A 32-bit numeric value, for example, 035 ARP Cache Timeout.</td></tr><tr>
<td valign="top">String Value</td> <td valign="top">A string of characters, for example, 015 Domain Name.</td></tr><tr>
<td valign="top">Word</td> <td valign="top">A 16-bit numeric value of specific block sizes, for example, 022 Max DG Reassembly Size.</td></tr><tr>
<td valign="top">Byte</td> <td valign="top">A numeric value consisting of a single byte, for example, 046 WINS/NBT Node Type.</td></tr><tr>
<td valign="top">Binary</td> <td valign="top">A binary value, for example, 043 Vendor-Specific Information.</td></tr></table></p>

<p><b>Configuring a Client Reservation</b></p>

<p>For some DHCP clients, it is important that the same IP address be reassigned when their lease expires. For example, client computers that run TCP/IP server services might rely on a static IP address configuration to be identified by other clients on the network. For clients running server services, you can configure the DHCP service so that it always assigns the same IP address to them. This is called a client reservation and is created by using the New Reservation dialog box shown in Figure 9.7.</p>

<p>
<img src="images/f09xx07.jpg" border="0">
</p><p>
<!--caption--><b>Figure 9.7</b> <i>Using the New Reservation dialog box to add a client reservation</i><!--/caption-->
</p>

<p>Clients using static host name resolution might also require that critical servers maintain their IP address configuration. For example, if a server with a host name of SRV187 is on a network containing clients that accomplish name resolution using a static HOSTS or LMHOSTS file, SRV187 should be set up with a client reservation. Setting up the reservation ensures that SRV187 always leases the same IP address from the DHCP server. Non-WINS-enabled clients on the network must use the LMHOSTS file to resolve NetBIOS computer names. Non-DNS-enabled clients on the network must use the HOSTS file to resolve IP host names. Since the LMHOSTS and HOSTS files are static files containing name-to-IP-address mappings, name resolution using these files will fail if the IP address of SRV187 changes.</p>

<p>To configure a client reservation, select Reservations under the specific scope and then select New Reservation from the Action menu. Be certain to type in the correct IP address and MAC address when you configure the reservation. If you type the value for MAC Address incorrectly, it will not match the value sent by the DHCP client, and the DHCP Service will assign the client any available IP address instead of the IP address reserved for that client. If you replace the NIC in the client receiving a reservation, be sure to reconfigure the reservation to match the new MAC address.</p>

<A NAME="461"><h3>Authorizing the DHCP Server</h3></A>
<p>A DHCP server must be authorized in Active Directory services before it can assign IP addresses. Authorization is a security precaution that ensures that only authorized DHCP servers run on your network. To authorize a DHCP server, select the domain from the DHCP snap-in tree and then select Authorize from the Action menu.</p>

<p><img src="images/practic.JPG" border="0"></p>

<A NAME="462"><h3>Exercise 2: Installing and configuring the DHCP Service</h3></A>
<p>In this exercise, you install and configure the DHCP Service on Server01. You create a scope and configure a small range of addresses for the scope. As with the previous exercise, make sure that Server01 is on an isolated network so that it doesn't conflict with IP addressing in a larger network. You will complete some procedures on Server01 and other procedures on Server02.</p>

<p><li><b>Procedure 1: Reconfiguring TCP/IP to use a static IP address on Server01</b></li></p>


<p>In this procedure, you configure Server01 to use a static IP address; this is a prerequisite for installing the DHCP Service.</p>

<ol>
<p><li>Log on to Server01 as Administrator with a password of &quot;password.&quot;</li></p>

<p><li>Click Start, point to Settings, and then click Network And Dial-Up Connections.</li></p>

<p>The Network And Dial-Up Connections window appears.</p>

<p><li>Click Local Area Connection, click the File menu, and then click Properties.</li></p>

<p>The Local Area Connection Properties dialog box appears, displaying the network adapter in use and the network components used in this connection.</p>

<p><li>Click Internet Protocol (TCP/IP), and verify that the check box to the left of the entry is selected.</li></p>

<p><li>Click Properties.</li></p>

<p>The Internet Protocol (TCP/IP) Properties dialog box appears.</p>

<p><li>Click the Use The Following IP Address radio button.</li></p>

<p><li>In the IP address box, type 192.168.1.201, press Tab, and verify that in the Subnet mask box 255.255.255.0 appears.</li></p>

<p><li>Click OK.</li></p>

<p>A Microsoft TCP/IP message box appears stating that the DNS server list is empty and that the local IP address will be used since DNS was installed on the computer.</p>

<p><li>Click OK to accept the message.</li></p>

<p><li>Click OK to close the Local Area Connection Properties dialog box.</li></p>

<p><li>Minimize the Network And Dial-Up Connections window.</li></p>
</ol>

<p><li><b>Procedure 2: Determining the physical address of a computer</b></li></p>


<p>In this procedure, you determine the physical address of Server02. You will use this physical address (the MAC address) in a later procedure to configure a DHCP reservation.</p>

<ol>
<p><li>Verify that Server02 is connected to the same isolated network as Server01, and then log on to Server02 in the Microsoft domain as Administrator with a password of &quot;password.&quot;</li></p>

<p><li>Open a command prompt, and type <b>ipconfig /all | more</b> to determine the physical address (MAC address) of the &lt;<i>adapter type</i>&gt; adapter Local Area Network on Server02.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
If Server02 was configured with a valid IP address that Server01 could reach, you could ping the IP address from Server01, type <b>arp -a</b> , and then press Enter to determine from Server01 the MAC address of the network adapter in Server02.</blockquote></div>
</p>

<ol>
<p><li value="3">Record the physical address of Server02 in the line provided.</li></p>

<p>The physical address is the hardware address or the MAC address. It is the address permanently burned into your network adapter, and it should look something like 00-50-04-B4-3A-23.</p>

<p>MAC address:</p>

<p><li>Minimize the command prompt on Server02.</li></p>
</ol>

<p><li><b>Procedure 3: Installing the DHCP service</b></li></p>


<p>In this procedure, you install the DHCP Service on Server01.</p>

<ol>
<p><li>On Server01, click Start, point to Programs, and then point to Administrative Tools.</li></p>

<p>Notice that DHCP is listed in the list of Administrative Tools. The DHCP snap-in is present because you installed Adminpak.msi in an earlier chapter exercise. This is only the DHCP snap-in; DHCP is not installed on Server01.</p>

<p><li>Point to Settings on the Start menu, and then click Control Panel.</li></p>

<p><li>Double-click Add/Remove Programs.</li></p>

<p>The Add/Remove Programs window appears.</p>

<p><li>Click Add/Remote Windows Components in the left frame.</li></p>

<p>The Windows Components wizard appears.</p>

<p><li>In the Components box, click Networking Services, but do not click or change the status of the check box to the left of this option.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
The Networking Services check box is already selected because some networking services have already been installed on Server01.</blockquote></div>
</p>

<ol>
<p><li value="6">Click Details.</li></p>

<p>The Networking Services dialog box appears.</p>

<p>In the Subcomponents Of Networking Services box, select the Dynamic Host Configuration Protocol (DHCP) check box.</p>

<p><li>Click OK.</li></p>

<p>The Windows Components screen appears.</p>

<p><li>Click Next.</li></p>

<p>The Configuring Components screen makes the configuration changes you requested. A File Copy box appears as DHCP files are copied into the operating system folders.</p>

<p>The Completing The Windows Components Wizard screen appears.</p>

<p><li>Click Finish.</li></p>

<p><li>Close the Add/Remove Programs window.</li></p>

<p><li>Close Control Panel.</li></p>
</ol>

<p><li><b>Procedure 4: Creating and configuring a DHCP scope</b></li></p>


<p>In this procedure, you create and configure a DHCP scope on Server01.</p>

<ol>
<p><li>Click Start, point to Programs, point to Administrative Tools, and then click DHCP.</li></p>

<p>The DHCP snap-in appears.</p>

<p><li>Maximize the DHCP snap-in.</li></p>

<p><li>In the console tree, double-click Server01.microsoft.com[192.168.1.201].</li></p>

<p>A Configure The DHCP Server message appears in the details pane.</p>

<p><li>Read the message appearing in the details pane.</li></p>

<p><li>Click the Action menu, and then click New Scope.</li></p>

<p>The New Scope wizard appears.</p>

<p><li>Click Next.</li></p>

<p>The Scope Name screen appears.</p>

<p><li>In the Name text box, type <b>Server01 Scope</b>.</li></p>

<p><li>In the Description text box, type <b>Training network</b>, and then click Next.</li></p>

<p>The IP Address Range screen appears.</p>

<p><li>Type <b>192.168.1.70</b> in the Start box, and type <b>192.168.1.90</b> in the End box.</li></p>

<p>Notice that the subnet mask is set to a standard Class C address, 255.255.255.0, and that 24 bits are enabled; all bits in the first three octets in binary are set to 1.</p>

<p><li>Click Next.</li></p>

<p>The Add Exclusions screen appears.</p>

<p><li>In the Start Address box, type <b>192.168.1.76</b>.</li></p>

<p><li>In the End Address box, type <b>192.168.1.80</b>.</li></p>

<p><li>Click Add.</li></p>

<p>Notice that 192.168.1.76 to 192.168.1.80 appears in the Excluded Addresses box.</p>

<p><li>Click Next.</li></p>

<p>The Lease Duration screen appears. Read the information on this page, and notice that the default lease duration is 8 days.</p>

<p><li>Click Next to accept the default lease duration.</li></p>

<p>The Configure DHCP Options screen appears, asking if you would like to configure the most common DHCP options now.</p>

<p><li>Click the No, I Will Configure These Options Later radio button, and then click Next.</li></p>

<p>The Completing The New Scope Wizard screen appears.</p>

<p><li>Read the instructions on this screen, and then click Finish.</li></p>

<p>An icon representing the new scope appears in DHCP Manager.</p>

<p>The red arrow pointing down indicates that the scope is not activated. You will activate the scope in a later procedure.</p>
</ol>

<p><li><b>Procedure 5: Adding a reservation to a DHCP scope</b></li></p>


<p>In this procedure, you use the physical address of Server02 that you determined in Procedure 2 to add a reservation to a DHCP scope.</p>

<ol>
<p><li>From the DHCP snap-in running on Server01, click Scope [192.168.1.0] Server01 Scope in the console tree.</li></p>

<p>The scope contents appear in the details pane.</p>

<p><li>In the console tree, click Reservations and read the message appearing in the details pane.</li></p>

<p><li>Click the Action menu, and then click New Reservation.</li></p>

<p>The New Reservation dialog box appears.</p>

<p><li>In the Reservation Name text box, type <b>Server02</b>.</li></p>

<p><li>In the IP Address box, notice the first three octets are entered for you. In the fourth octet position, type <b>76</b>. The entire box should read: 192.168.1.76.</li></p>

<p><li>In the MAC Address box, type the physical address you determined in Procedure 2. Do not type in the dashes.</li></p>

<p>For example, for the physical address 00-50-04-B4-3A-23, you would type 005004B43A23 in the MAC Address text box.</p>

<p><li>In the Description text box, type <b>Reservation made by: &lt;<i>your name</i>&gt;</b>.</li></p>

<p>Notice that DHCP, BOOTP, or both types of clients can be configured to use this reservation. A BOOTP client could be a device like a legacy terminal or router. This type of client request is answered by the DHCP server, and additional configuration information can be downloaded. Dynamic BOOTP scopes are also supported. For more information on these configuration options, see the section in the DHCP online help file titled &quot;Supporting BOOTP Clients.&quot;</p>

<p><li>Under Supported types, select the DHCP Only radio button and then click Add.</li></p>

<p>Another New Reservation dialog box appears.</p>

<p><li>Click Close.</li></p>

<p><li>Notice that the reservation appears in the details pane.</li></p>

<p><li>In the console tree, click Scope [192.168.1.0] Server01 Scope.</li></p>

<p><li>Click the Action menu, and then click Activate.</li></p>

<p>Notice that the red down arrow to the right of the scope's name disappears. Notice also that the down arrow for server01.microsoft.com [192.168.1.201] still remains.</p>

<p><li>In the console tree, click server01.microsoft.com [192.168.1.201].</li></p>

<p><li>Click the Action menu, and then click Authorize to authorize this DHCP server in the Active Directory store.</li></p>

<p><li>Press the F5 key to refresh the display.</li></p>

<p>When a green up arrow appears next to server01.microsoft.com [192.168.1.201], the DHCP Service has been authorized.</p>

</ol>

<p><li><b>Procedure 6: Configuring scope options</b></li></p>


<p>In this procedure, you configure DHCP so that the preferred DNS Server and DNS domain name is sent to the DHCP client upon registration. This procedure is similar to setting server options, which apply to all DHCP clients using this server, and setting individual client options.</p>

<ol>
<p><li>In the console tree, expand server01.microsoft.com [192.168.1.201], expand Scope [192.168.1.0] Server Scope, and click Scope Options.</li></p>

<p><li>Click the Action menu, and then click Configure Options.</li></p>

<p>The Scope Options dialog box appears.</p>

<p><li>Select the 006 DNS Servers check box.</li></p>

<p>Options under Data Entry appears.</p>

<p><li>In the Server Name text box, type <b>Server01</b> and then click Resolve.</li></p>

<p>The IP address 198.168.1.201 appears in the IP Address box.</p>

<p><li>Click Add.</li></p>

<p><li>Scroll down in the Available Options box to find 015 DNS Domain Name.</li></p>

<p><li>Select the 015 DNS Domain Name check box.</li></p>

<p><li>In the String value box, type <b>microsoft.com</b> and then click OK.</li></p>

<p>DNS data will now be downloaded to DHCP client computers within 
this scope.</p>

<p><li>Leave the DHCP snap-in open; you will be using it in the next procedure.</li></p>
</ol>

<p><li><b>Procedure 7: Testing DHCP</b></li></p>


<p>In this procedure, you test the DHCP Service to verify that the IP address information you specified in the client reservation appears on Server02 and that the address lease appears on Server01.</p>

<ol>
<p><li>On Server02, verify that the Internet Protocol (TCP/IP) Properties dialog box shows the Obtain An IP Address Automatically and the Obtain DNS Server Address Automatically radio buttons selected.</li></p>

<p>If you are not sure how to complete this step, return to &quot;<A HREF="ch09c.htm#451">Exercise 1: Configuring and Testing TCP/IP</A>&quot; to review Procedure 3.</p>

<p><li>On Server02, restore the command prompt, type <b>ipconfig /renew</b> , and then press Enter.</li></p>

<p>After a few moments, the client reservation 192.168.1.76 is assigned to Server02.</p>

<p><li>At the command prompt, type <b>ipconfig /all | more</b> and then press Enter.</li></p>

<p>Notice that DHCP information has been sent to the client computer. You will see a DHCP-assigned IP address, subnet mask, DNS server address, and DNS domain name. Additional information such as the default gateway are commonly sent to the DHCP client.</p>

<p><li>To test that Server02 can communicate with Server01, type <b>ping server01</b>.</li></p>

<p>Notice that the server name is resolved to server01.microsoft.com and its IP address. This resolution is possible because the DNS information from Server01 was sent to Server02 in the DHCP data.</p>

<p><li>On Server01 in the DHCP snap-in, click Addresses Leases in the console tree.</li></p>


<p>Notice that server02.microsoft.com appears with an IP address of 192.168.1.76. Notice also that the lease expiration reads Reservation (Active). This is because a reserved address does not expire. A DHCP client without a reservation would show a date and time of expiration in the Lease Expiration column.</p>

<p><li>Close the DHCP snap-in on Server01, and close the command prompt on server02.</li></p>

</ol>

<A NAME="463"><h2>Backing Up and Restoring the DHCP Database</h2></A>
<p>You can edit the registry to specify the interval at which Windows 2000 backs up the DHCP database. In addition, you can manually restore the DHCP database by editing the registry.</p>

<A NAME="464"><h3>Backing Up the DHCP Database</h3></A>
<p>By default, Windows 2000 backs up the DHCP database every 60 minutes. Windows 2000 stores the backup copies of the file in the %systemroot%\System32\Dhcp\Backup\Jet\new folder.</p>

<p>You can change the default backup interval by changing the value, representing the number of minutes between backups, of the BackupInterval entry located in the registry under the following key:</p>

<p><table cellpadding=5 width="95%"><tr><td>
<pre>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ 
DHCPServer\Parameters
</pre></td></tr></table></p>

<A NAME="465"><h3>Restoring the DHCP Database</h3></A>
<p>By default, the DHCP Service restores a corrupt DHCP database automatically when you restart the DHCP Service. However, you can also manually restore the DHCP database file.</p>

<p>To manually restore the DHCP database, edit the registry, set the value for the RestoreFlag entry to 1, and then restart the DHCP Service. The RestoreFlag entry is located in the registry under the following subkey:</p>

<p><table cellpadding=5 width="95%"><tr><td>
<pre>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\ 
DHCPServer\Parameters
</pre></td></tr></table></p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
After the DHCP Service successfully restores the database, the server automatically changes the RestoreFlag parameter to the default value of 0.</blockquote></div>
</p>

<p>You can also restore the DHCP database file manually by copying the 
contents of the %systemroot%\System32\Dhcp\Backup\Jet folder to the %systemroot%\System32\Dhcp folder and then restarting the DHCP Service.</p>

<p>The following table describes some of the files stored in the %systemroot%\ 
System32\Dhcp directory:</p>

<p><table cellpadding=5 width="95%"><tr>
<th>File</th><th>Description</th>
</tr><tr>
<td valign="top">Dhcp.mdb</td> <td valign="top">The DHCP database file.</td></tr><tr>
<td valign="top">Tmp.edb</td> <td valign="top">A temporary file the DHCP Service creates for temporary database information while the DHCP Service is running.</td></tr><tr>
<td valign="top">J50.log and J50*.log</td> <td valign="top">Log files, including all transactions done with the database. The DHCP Service uses these files to recover data if necessary.</td></tr></table></p>

<p>
<div class="warning"><blockquote><b>IMPORTANT</b><hr>
Do not tamper with or remove these files.</blockquote></div>
</p>

<A NAME="466"><h2>Lesson Summary</h2></A>
<p>The DHCP Service in Windows 2000 centralizes and manages the allocation 
of TCP/IP configuration information by assigning IP addresses automatically 
to computers configured as DHCP clients. Each time a DHCP client starts, it requests IP addressing information from a DHCP server, including an IP address, a subnet mask, and optional values such as a default gateway. DHCP uses a four-phase process to lease IP addressing information to a DHCP 
client for a specific period of time: DHCPDISCOVER, DHCPOFFER, DHCPREQUEST, and DHCPACK. To implement DHCP, you must install 
and configure the DHCP Service on at least one computer running Windows 2000 Server within the TCP/IP network. In addition, you must create and activate a DHCP scope, which is a range of IP addresses available for lease 
to clients. You must also authorize the domain in Active Directory services. Once you have created the DHCP scope, you can configure options for DHCP clients. There are three levels of scope options: server, scope, and client. For some DHCP clients, you can create client reservations so that the DHCP service always assigns the same IP address to them. You can edit the registry to specify the interval at which Windows 2000 backs up the DHCP database. In addition, you can manually restore the DHCP database by editing the registry.</p>

</BODY>
</HTML>



