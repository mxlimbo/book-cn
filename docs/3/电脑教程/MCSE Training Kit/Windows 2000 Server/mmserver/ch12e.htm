<HTML>
<HEAD>
<TITLE>Lesson 4: Recovering from a Disaster</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmserver.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch12d.htm", "ch12f.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="717"><h1>Lesson 4: Recovering from a Disaster</h1></A>
<p>Reliability and availability are in part affected by your system's ability to recover from a disaster. Disaster recovery allows you to restore a computer so that you can log on and access system resources after a computer disaster has occurred. This lesson provides information on repairing a Windows 2000 installation, restoring data, and recovering a RAID-5 or mirrored volume.</p>

<p><img src="images/cd.JPG" border="0"></p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
For more information about Windows 2000 reliability and availability, see the Supplemental Course Materials CD-ROM (\chapt12\articles\ 
Win2000Reliability.doc) that accompanies this book.</blockquote></div>
</p>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b> 

<ul>
<p><li>Use Safe mode, the Recovery Console, and the Emergency Repair Disk to repair a Windows 2000 installation</li></p>

<p><li>Restore data that has been backed up</li></p>

<p><li>Recover a RAID-5 or RAID-1 volume</li></p>
</ul>

<b>Estimated lesson time: 60 minutes</b> 
</blockquote></div>
</p>

<A NAME="718"><h2>Repairing the Windows 2000 Installation</h2></A>
<p>Windows 2000 has several features that allow you to repair a system that does not start or load Windows 2000. These features are useful if some of your system files become corrupted or are accidentally erased, or if you have installed software or device drivers that cause your system to not work properly. Windows 2000 includes three methods that allow you to repair a system: Safe mode, the Recovery Console, and the Emergency Repair Disk (ERD).</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
You can also reinstall Windows 2000 over a damaged Windows 2000 system or install Windows 2000 into a separate folder. This may be time consuming, but it is useful if the emergency repair process does not solve your problem. If you reinstall Windows 2000, you might lose changes that have been made to your system, such as service pack upgrades.</blockquote></div>
</p>

<A NAME="719"><h3>Safe mode</h3></A>
<p>Safe mode lets you start your system with a minimal set of device drivers and services. For example, if newly installed device drivers or software are preventing your computer from starting, you might be able to start you computer in Safe mode and then remove the software or device drivers from your system. Safe mode does not work in all circumstances, especially if your system files are corrupted or missing or your hard disk is damaged or has failed.</p>

<p>In Safe mode, Windows 2000 uses default settings (VGA monitor, Microsoft mouse driver, and the minimum device drivers required to start Windows). If a symptom does not reappear when you start in Safe mode, you can eliminate the default settings and minimum device drivers as possible causes of the problem.</p>

<p>You can choose one of the following options when you start Safe mode:</p>

<ul>
<p><li><b>Safe Mode</b> Starts Windows 2000 and uses only basic files and drivers (mouse, except serial mice; monitor; keyboard; mass storage; base video; default system services; and no network connections). If your computer does not start successfully by using Safe mode, you might need to use the ERD to repair your system.</li></p>

<p><li><b>Safe Mode With Networking</b> Starts Windows 2000 with only basic files and drivers, plus network connections.</li></p>

<p><li><b>Safe Mode With Command Prompt</b> Starts Windows 2000 with only basic files and drivers. After logging on, the command prompt is displayed instead of the Windows desktop, Start menu, and Taskbar.</li></p>

<p><li><b>Enable Boot Logging</b> Starts Windows 2000 while logging all the installed drivers and services that were loaded (or not loaded) by the system to a file. This file is called ntbtlog.txt and is located in the %systemroot% directory. Safe mode, Safe mode with Networking, and Safe mode with Command Prompt add to the boot log a list of all the drivers and services that are loaded. The boot log is useful in determining the exact cause of system startup problems.</li></p>

<p><li><b>Enable VGA Mode</b> Starts Windows 2000 with the basic VGA driver. This mode is useful when you have installed a new driver for your video card that is causing Windows 2000 to not start properly. The basic video driver is always used when you start Windows 2000 in Safe mode (either Safe mode, Safe mode with Networking, or Safe mode with Command Prompt).</li></p>

<p><li><b>Last Known Good Configuration</b> Starts Windows 2000 with the registry information that Windows saved at the last shutdown. Use this option only in cases of incorrect configuration. Last Known Good Configuration does not solve problems caused by corrupted, incompatible, or missing drivers or files. Also, any changes made since the last successful startup will be lost.</li></p>

<p><li><b>Directory Service Restore Mode</b> Used to restore the SYSVOL directory and Active Directory services on a domain controller. This option is available only on domain controllers.</li></p>

<p><li><b>Debugging Mode</b> Starts Windows 2000 while sending debug information through a serial cable to another computer. This is an important mode for software developers.</li></p>
</ul>

<p>If you are using or have used Remote Install Services to install Windows 2000 on your computer, you might see additional options related to restoring or recovering your system through Remote Install Services.</p>

<p>To start Windows 2000 in Safe mode, restart your computer. Press F8 when you see the message Please Select The Operating System To Start. Use the arrow keys to highlight the appropriate Safe mode option, and then press Enter.</p>

<p>Safe mode helps you diagnose problems. If a symptom does not reappear when you start in Safe mode, you can eliminate the default settings and minimum device drivers as possible causes. If a newly added device or a changed driver is causing problems, you can use Safe mode to remove the device or reverse the change.</p>

<A NAME="720"><h3>Recovery Console</h3></A>
<p>The Recovery Console is a text-mode command interpreter that is separate from the Windows 2000 command prompt and allows the system administrator to gain access to the hard disk of a computer running Windows 2000, regardless of the file system (NTFS or FAT) used, for basic troubleshooting and system maintenance. Since starting Windows 2000 is not a prerequisite for using the Recovery Console, it can help you recover when your Windows 2000-based computer does not start properly or at all.</p>

<p>The Recovery Console allows you to obtain limited access to NTFS, FAT16, and FAT32 volumes without starting the graphical interface. The Recovery Console allows administrators and Microsoft Product Support Services technicians to start and stop services and repair the system in a very granular way. It can also be used to repair the master boot record and boot sector and to format volumes. The Recovery Console prevents unauthorized access to volumes by requiring the user to enter the system administrator password.</p>

<p><b>Starting the Recovery Console</b></p>

<p>To start the Recovery Console, start the computer from the Windows 2000 installation CDROM or the Windows 2000 Setup floppy disks. If you do not have Setup floppy disks and your computer cannot start from the Windows 2000 installation CDROM, use another computer and the Makeboot.exe or Makebt32.exe utility to create the Setup floppy disks.</p>

<p>If the Recovery Console was installed on the local hard disk, it can also be accessed from the Windows 2000 startup menu. However, if the master boot record or the system volume boot sector has been damaged, you need to start the computer by using either the Windows 2000 Setup floppy disks or the Windows 2000 installation CDROM to access the Recovery Console.</p>

<p>To add the Recovery Console to existing installations of Windows 2000, on the Start menu, click Run, and then type &lt;<b><i>cdrom&gt;</i>:\I386\Winnt32.exe /cmdcons</b> , where &lt;<i>cdrom</i>&gt; is the drive letter of the CDROM drive.</p>

<p>The installation of the Recovery Console requires approximately 7 MB of disk space on the system partition.</p>

<p>
<div class="warning"><blockquote><b>IMPORTANT</b><hr>
You cannot preinstall the Recovery Console on a computer that contains a mirrored volume. First break the mirror, and then install the Recovery Console. After the Recovery Console is installed, you can reestablish the mirrored volume.</blockquote></div>
</p>

<p>If the Recovery Console is not installed, run Windows 2000 Setup. Press Enter at the Setup Notification screen. Press R to repair a Windows 2000 installation, and then press C to use the Recovery Console.</p>

<p>Certain installations and configurations can affect how you use the Recovery Console:</p>

<ul>
<p><li>If there is more than one installation of Windows 2000 or Windows NT 4.0 or earlier, they are shown in the Recovery Console Startup menu.</li></p>

<p><li>Mirrored volumes appear twice in the Recovery Console Startup menu, but each entry has the same drive letter, so they are actually the same drive.</li></p>

<p><li>Changes made with the Recovery Console to mirrored volumes are mirrored.</li></p>
</ul>

<p>To access the disk by using the Recovery Console, press the number key representing the Windows 2000 installation that you want to repair, and then press Enter. The Recovery Console then prompts you for the administrator password. If you press Enter without typing a number, the Recovery Console exits and restarts the computer.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
To use the Recovery Console, you must know the password for the local Administrator account. If you do not have the correct password, Recovery Console does not allow access to the computer. If an incorrect password is entered three times, the Recovery Console quits and restarts the computer. However, you can use either the Group Policy snap-in or the Security Configuration And Analysis snap-in to enable automatic administrative logon. This setting is contained in the Security Options node, and the value name is Recovery Console: Allow automatic administrative logon.</blockquote></div>
</p>

<p>Once the password has been validated, you have full access to the Recovery Console but limited access to the hard disk. You can access the following partitions and folders on your computer:</p>

<ul>
<p><li>%systemroot% and subfolders of the Windows 2000 installation in which you are currently logged on</li></p>

<p><li>The root of all partitions, including %systemdrive%, the CD-ROM, and floppy drive with some restrictions (Floppy drive restrictions are outlined later in this lesson.)</li></p>
</ul>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
With the set command enabled, you can copy files to removable media, disable the file copy prompt, use wild cards with the Copy command, and access all paths on the system. The Set command is an optional Recovery Console command that can be enabled by using either the Group Policy snap-in or the Security Configuration And Analysis snap-in.</blockquote></div>
</p>

<p>The Recovery Console prevents access to other folders such as Program Files or Documents And Settings, as well as to folders containing other installations of Windows 2000. However, you can use the logon command to access an alternate installation. Alternatively, you can gain access to other installation folders by restarting the Recovery Console, choosing the number representing that installation, and then entering the administrator password for that installation.</p>

<p>You cannot copy a file from the local hard disk to a floppy disk, but you can copy a file from a floppy disk or a CD-ROM to any hard disk, and from a hard disk to another hard disk. However, with the set command enabled, you can copy files to a floppy disk. The Recovery Console displays an Access Is Denied error message when it detects invalid commands.</p>

<p>
<div class="warning"><blockquote><b>IMPORTANT</b><hr>
The set command makes use of Recovery Console environment variables to enable disk write access to floppy disks as well as enable other options. To enable the user to modify the restricted default Recovery Console environment variables, a policy setting must be made.</blockquote></div>
</p>

<p>The Recovery Console buffers previously entered commands and makes them available to the user with the up and down arrow keys. To edit a previously entered command, use Backspace to move the cursor to the point of the edit and retype the remainder of the command. At any point, you can quit the Recovery Console and restart the computer by typing <b>exit</b> at the command prompt.</p>

<p>Note that the Recovery Console might not map disk volumes with the same drive letters they have in Windows 2000. If you are having trouble copying files from one location to another, use the Map command from the Recovery Console to make sure that the drive mappings for both the source and the target locations are correct.</p>

<p>
<div class="tip"><blockquote><b>TIP</b><hr>
You can use the Help command to list the commands supported by the Recovery Console. In addition, the /? switch works with every Recovery Console command to display a help screen that includes a description of 
the command, its syntax, a definition of its parameters, and other useful information.</blockquote></div>
</p>

<A NAME="721"><h3>Emergency Repair Disk</h3></A>
<p>If your system does not start and using Safe mode or the Recovery Console has not helped, you can try using the ERD. Backup includes a wizard to help you create an ERD. If a system failure occurs, first start the system by using the Windows 2000 installation CDROM or the Windows 2000 Setup floppy disks, which can be created by running Makeboot.exe or Makebt32.exe from the Bootdisk folder of the Windows 2000 installation CDROM. In Text mode, type <b>r</b> to enter recovery options and type <b>r</b> again to enter Emergency Repair. Then use the ERD to restore core system files. Note that you cannot repair all disk problems by using the ERD.</p>

<p>Make sure to create an ERD when your computer is functioning well so that you are prepared if you need to repair system files. You can use the ERD to fix problems that might be preventing you from starting your computer. This includes problems with your registry, system files, partition boot sector, and startup environment. However, the ERD does not back up data or programs and is not a replacement for regular system backups.</p>

<p>The Windows 2000 ERD, unlike the ERD used with Windows NT, does not contain a copy of the registry files. The backup registry files are in the folder %systemroot%\Repair as they are in Windows NT. However, these files are from the original installation of Windows 2000. In the event of a problem, they can be used to return your computer to a usable state.</p>

<p>When you back up system state data, a copy of your registry files is placed in the folder %systemroot%\Repair\Regback. If your registry files become corrupted or are accidentally erased, use the files in this folder to repair your registry without performing a full restore of the system state data. This method is recommended for advanced users only and can also be accomplished by using the Recovery Console commands.</p>

<p><b>Creating the Emergency Repair Disk</b></p>

<p>When the ERD is created, the files described in the following table are copied from %systemroot%\Repair to a floppy disk.</p>

<p><table cellpadding=5 width="95%"><tr>
<th>File Name</th><th>Contents</th>
</tr><tr>
<td valign="top">Autoexec.nt</td> <td valign="top">A copy of %systemroot%\System32\Autoexec.nt, which is used to initialize the MS-DOS environment.</td></tr><tr>
<td valign="top">Config.nt</td> <td valign="top">A copy of %systemroot%\System32\Config.nt, which is used to initialize the MS-DOS environment.</td></tr><tr>
<td valign="top">Setup.log</td> <td valign="top">A log of which files were installed and of Cyclic Redundancy Check (CRC) information for use during the emergency repair process. This file has the read-only, system, and hidden attributes, and it is not visible unless you have configured My Computer to show all files or used the dir /a, dir /as or dir /ah command-line commands.</td></tr></table></p>

<p>Create the ERD after Windows 2000 is installed. Re-create the ERD after each service pack, system date, or updated driver is installed. Be sure to make a copy of your current ERD and store it in a secure location, perhaps off site.</p>

<p><b>Emergency Repair Process</b></p>

<p>If you have prepared an ERD, you can use it to help repair system files after starting the computer by using either the Windows 2000 installation CDROM or the Windows 2000 Setup floppy disks. However, the Windows 2000 installation CDROM is required for replacing any damaged files.</p>

<p>The ERD must include current configuration information. Make sure that you have an ERD for each installation of Windows 2000 on your computer, and never use an ERD from another computer.</p>

<p>When you start the emergency repair process, you will be asked to choose one of the following options:</p>

<ul>
<p><li><b>Manual Repair</b> To choose from a list of repair options, press M. It is recommended that only advanced users or administrators choose this option. Using it, you can repair system files, boot sector problems, and startup environment problems.</li></p>

<p><li><b>Fast Repair</b> To perform all repair options, press F. This is the easier option to use and does not require user input. If you choose this option, the emergency recovery process attempts to repair problems related to system files, the boot sector on your system disk, and your startup environment (if your computer has more than one operating system installed). This option also checks and repairs the registry files by loading and unloading each registry key. If a key is not successfully checked, it is automatically copied from the repair directory to the folder %systemroot%\System32\Config.</li></p>
</ul>

<p>If you select Manual Repair, the registry files are not checked. If you select Fast Repair and the folder %systemroot%\Repair is accessible, the registry files are checked. If the folder %systemroot%\Repair is inaccessible (for example, due to file system corruption), the registry files are not checked.</p>

<p>Manual Repair allows you to select from the following three options:</p>

<ul>
<p><li><b>Inspect Startup Environment</b> Inspect Startup Environment verifies that the Windows 2000 files in the system partition are correct. If any of the files needed to start Windows 2000 are missing or corrupted, Repair replaces them from the Windows 2000 installation CDROM. These include Ntldr and Ntdetect.com. If Boot.ini is missing, it is re-created.</li></p>

<p><li><b>Verify Windows 2000 System Files</b> Verify Windows 2000 System Files uses a checksum to verify that each installed file is good and matches the file that was installed from the Windows 2000 installation CDROM. If the recovery process determines that a file on the disk does not match what was installed, it displays a message that identifies the file and asks if you want to replace it. The emergency repair process also verifies that startup files, such as Ntldr and Ntoskrnl.exe, are present and valid.</li></p>

<p><li><b>Inspect Boot Sector</b> Inspect Boot Sector verifies that the boot sector on the system partition still references Ntldr. The Emergency Repair Process can only replace the boot sector for the system partition on the first hard disk. The Emergency Repair Process can also repair the boot sector for the system partition on the startup disk.</li></p>
</ul>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
If the boot sector is infected with a virus, boot the computer using an antivirus boot diskette. Instruct the antivirus program to inspect and cure the boot sector. An antivirus program for inspecting the boot sector is included on the Windows 2000 Server Installation CD-ROM in the \3RDPARTY\ 
CA_ANTIV folder. This program might not be included on the Windows 2000 Server installation CD-ROM included with this training kit.</blockquote></div>
</p>

<p><b>If the Emergency Repair Process Does Not Fix Your System</b></p>

<p>If you have performed the emergency repair process and the computer still does not operate normally, you can perform an in-place upgrade over the existing installation. This is a last resort before reinstalling the operating system. However, note that the time required to perform an upgrade is similar to the time it takes to reinstall the operating system.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
If you perform an in-place upgrade of your Windows 2000 existing installation, you might lose some customized settings of your system files.</blockquote></div>
</p>

<A NAME="722"><h2>Restoring Data</h2></A>
<p>The ability to restore corrupt or lost data is critical to all corporations and is the goal of all backup jobs. To ensure that you can successfully restore data, you should follow certain guidelines, such as keeping thorough documentation on all of your backup jobs. In addition, you must select the backup sets, files, and folders to restore. You can also specify additional settings based on your restore requirements. Windows Backup provides a Restore wizard to help you restore data, or you can restore data without using the wizard.</p>

<A NAME="723"><h3>Preparing to Restore Data</h3></A>
<p>When critical data is lost, you need to restore the data quickly. Use the following guidelines to prepare for restoring data:</p>

<ul>
<p><li>Base your restore strategy on the backup type you used for the backup. If time is critical when you are restoring data, your restore strategy must ensure that the backup types you choose for backups expedite the restore process. For example, use normal and differential backups so that you need to restore only the last normal backup and the last differential backup.</li></p>

<p><li>Perform a trial restore periodically to verify that Windows Backup is backing up your files correctly. A trial restore can uncover hardware problems that do not show up with backup file verifications. Restore the data to an alternate location, and then compare the restored data to the data on the original hard disk.</li></p>

<p><li>Keep documentation for each backup job. Create and print a detailed Backup log for each backup job. A detailed backup log contains a record of all files and folders that were backed up. By using the Backup log, you can quickly locate which piece of media contains the files you need to restore without having to load the catalogs. A <i>catalog</i> is an index of the files and folders from a backup job that Windows 2000 automatically creates and stores with the backup job on the computer running Windows Backup.</li></p>

<p><li>Keep a record of multiple backup jobs in a calendar format that shows the days on which you perform the backup jobs. For each job, note the backup type and identify the storage used, such as a tape number or removable disk name. Then, if you need to restore data, you can easily review several weeks' worth of backup jobs to select which type to use.</li></p>
</ul>

<A NAME="724"><h3>Selecting Backup Sets, Files, and Folders to Restore</h3></A>
<p>The first step in restoring data is to select the data to restore. You can select individual files and folders, an entire backup job, or a backup set. A <i>backup set</i> is a collection of files or folders from one volume that you back up during a backup job. If you back up two volumes on a hard disk during a backup job, the job has two backup sets. You can select the data to restore in the catalog.</p>

<p>To restore data, use the Restore wizard, which you access through Windows Backup. After you run the wizard, the initial settings for the restore process are displayed in the Completing The Restore Wizard screen. At this time, you can perform one of the following actions:</p>

<ul>
<p><li>Finish the restore process by clicking the Finish button. If you choose to finish the restore job, the Restore wizard requests verification for the source of the restore media and then performs the restore. During the restore process, the Restore wizard displays status information about the restore.</li></p>


<p><li>Specify advanced restore options by clicking the Advanced button.</li></p>
</ul>

<A NAME="725"><h3>Specifying Advanced Restore Settings</h3></A>
<p>The advanced settings in the Restore wizard vary, depending on the types of backup media from which you are restoring. After you have finished the Restore wizard, Windows Backup does the following:</p>

<ul>
<p><li>Prompts you to verify your selection of the source media to use to restore data. After the verification, Windows Backup starts the restore process.</li></p>

<p><li>Displays status information about the restore process. As with a backup process, you can choose to view the report (restore log) of the restore. It contains information about the restore, such as the number of files that have been restored and the duration of the restore process.</li></p>
</ul>

<p>The following table describes the advanced restore options.</p>

<p><table cellpadding=5 width="95%"><tr>
<th>Option</th><th>Description</th>
</tr><tr>
<td valign="top">Restore Files To</td> <td valign="top">The target location for the data you are restoring. You can choose from the following options:

<p><b>Original Location</b> Replaces corrupted or lost data.</p>

<p><b>Alternate Location</b> Restores an older version of a file or does a practice restore.</p>

<p><b>Single Folder</b> Consolidates the files from a tree structure into a single folder. For example, use this option if you want copies of specific files but do not want to restore 
the hierarchical structure of the files. If you select either 
an alternate location or a single folder, you must provide the path.</p></td></tr><tr>
<td valign="top">When Restoring A File That Is Already On My Computer</td><td valign="top">The options for whether or not to overwrite existing files. You can choose from the following options: 

<p><b>Do Not Replace The File On My Disk (Recommended)</b> Prevents accidental overwriting of existing data. This option is the default.</p>

<p><b>Replace The File On My Disk Only If The File On Disk Is Older Than The Backup Copy</b> Verifies that the most recent copy exists on the computer.</p>

<p><b>Always Replace The File On My Computer</b> Windows Backup does not provide a confirmation message if it encounters a duplicate file name during the restore operation.</p></td></tr><tr>
<td valign="top">Advanced Restore Options</td> <td valign="top">The options for whether or not to restore security or special 
system files. You can choose from the following options:

<p><b>Restore Security</b> Applies the original permissions to files you are restoring to an NTFS volume. Security settings include access permissions, audit entries, and ownership. This option is available only if you have backed up data from an NTFS volume and are restoring to an NTFS volume.</p>

<p><b>Restore Removable Storage Database</b> Restores the configuration database for Removable Storage Management (RSM) devices and the media pool settings. The database is located in %systemroot%\system32\remotestorage.</p>

<p><b>Restore Junction Points, And Restore File And Folder Data Under Junction Points To The Original Location</b>  
Restores junction points on your hard disk as well as the data the junction points refer to. If you have any mounted drives and you want to restore the data that mounted drives point to, you should select this check box. If you do not select this check box, the junction point will be restored but the data your junction point refers to might not be accessible.</p></td></tr></table></p>

<p><img src="images/practic.JPG" border="0"></p>

<A NAME="726"><h3>Exercise 2: Restoring Data</h3></A>
<p>In this exercise, you delete the Inetpub folder and then run a restore routine to restore the Inetpub folder. Complete this exercise on Server01.</p>

<p><li><b>Procedure 1: Deleting critical data</b></li></p>


<p>In this procedure, you intentionally delete Boot.ini. Typically, deleting critical files is an accident or a result of hardware failure.</p>

<ol>
<p><li>Double-click My Computer, and then double-click Local Disk (C:).</li></p>

<p>The Local Disk (C:) window appears.</p>

<p><li>Maximize the window.</li></p>

<p><li>Click the Tools menu, and then click Folder Options.</li></p>

<p>The Folder Options dialog box appears.</p>

<p><li>Click the View tab.</li></p>

<p><li>Clear the Hide Protected Operating System Files (Recommended) check box.</li></p>


<p>A Warning message box appears stating that you are about to show critical hidden and system files.</p>

<p><li>Click Yes.</li></p>

<p>The Folder Options dialog box appears.</p>

<p><li>Click OK.</li></p>

<p>More files appear in the Local Disk (C:) window.</p>

<p><li>Click once on boot.ini.</li></p>

<p><li>Click the File menu, and then click Delete.</li></p>

<p>A Confirm File Delete message box appears asking if you are sure you want to delete this critical file.</p>

<p><li>Click Yes.</li></p>

<p>The boot.ini file is now gone. While you could recover it from the Recycle Bin, you will use the restore program in the next procedure to recover the file backed up in Exercise 1.</p>

<p><li>Keep the Local Disk (C:) window maximized; it will be used in the next procedure.</li></p>
</ol>

<p><li><b>Procedure 2: Restoring critical data</b></li></p>


<p>In this procedure, you recover boot.ini from a backup set.</p>

<ol>
<p><li>In the Local Disk (C:) window, double-click Backup1.bkf.</li></p>

<p>The Backup - [Untitled] dialog box appears.</p>

<p><li>Click the Restore Wizard button.</li></p>

<p>The Welcome To The Restore Wizard screen appears.</p>

<p><li>Click Next.</li></p>

<p>The What To Restore screen appears, prompting you to select the backup media from which you wish to restore files.</p>

<p>Notice that the only media from which you can restore is a file and the backup files are listed according to the media label specified.</p>

<p><li>Under the What To Restore box, expand the first backup job you created in Exercise 1.</li></p>

<p>Notice that drive C appears as the first folder in the backup file. Windows Backup creates a separate backup set for each volume backed up. All folders and files backed up from a single volume appear under the drive letter for the volume.</p>

<p><li>Expand drive C.</li></p>

<p>The Backup File Name dialog box appears with C:\ Backup1.bkf in the Catalog Backup File text box.</p>

<p>If c:\Backup2.bkf appears, change the name to C:\Backup1.bkf.</p>

<p><li>Click OK.</li></p>

<p><li>When you are returned to the What To Restore screen, click on C:.</li></p>

<p>Boot.ini appears in the Name column.</p>

<p><li>In the Name column, click the Boot.ini check box and then click Next.</li></p>

<p>The Completing The Restore Wizard screen appears, prompting you to start the restore operation and use the default restore settings.</p>

<p><li>Click the Advanced button.</li></p>

<p>The Where To Restore screen appears, prompting you for a target location to restore files.</p>

<p><li>Click the drop-down list box to review the restore location options.</li></p>

<p><li>Verify that Original location is selected, and click Next.</li></p>

<p><li>The How To Restore screen appears, prompting you to specify how to process duplicate files during the restore job.</li></p>

<p><li>Verify that the Do Not Replace The File On My Disk (Recommended) radio button is selected, and then click Next.</li></p>

<p><li>The Advanced Restore Options screen appears, prompting you to select security options for the restore job.</li></p>

<p><li>Verify that the Restore Security check box is selected, clear the Restore Junction Points, Not The Folders And File Data They Reference check box, and then click Next.</li></p>

<p>The Completing The Restore Wizard screen appears, displaying a summary of the restore options you selected.</p>

<p><li>Click Finish to begin the restore process.</li></p>

<p>Windows Backup displays the Enter Backup File Name dialog box, prompting you to supply or verify the name of the backup file that contains the folders and files to be restored.</p>

<p><li>Verify that C:\ Backup1.bkf is entered in the Restore From Backup File text box, and then click OK.</li></p>

<p>The Selection Information dialog box appears.</p>

<p>The Restore Progress dialog box appears, providing the status of the restore operation, statistics on estimated and actual amount of data being processed, the time that has elapsed, and the estimated time that remains for the restore operation.</p>

<p><li>When the Restore Progress dialog box indicates that the restore is complete, click the Report button.</li></p>

<p>Notepad starts and displays the report. Notice that the details about the restore operation are appended to the Backup log. This provides a centralized location from which to view all status information for this backup and restore operation.</p>

<p><li>Examine the report, and then close Notepad.</li></p>

<p><li>In the Restore Progress dialog box, click Close.</li></p>

<p>Backup [Untitled] dialog box appears with the Welcome tab active.</p>

<p><li>Close the Backup [Untitled] dialog box.</li></p>

<p>The Local Disk (C:) window appears.</p>

<p><li>Notice that boot.ini has been restored.</li></p>

<p><li>Close the Local Disk (C:) window.</li></p>
</ol>

<A NAME="727"><h2>Recovering a Mirrored or RAID-5 Volume</h2></A>
<p>This section provides information about recovering from a mirrored volume failure and repairing a RAID-5 volume.</p>

<A NAME="728"><h3>Recovering from a Mirrored Volume Failure</h3></A>
<p>In a mirrored volume, the computer saves data to each member simultaneously. If one member fails, the functional member continues to operate.</p>

<p>To replace the failed member, you must first &quot;remove&quot; the failed disk from the mirrored volume. Using the Computer Management snap-in, you can isolate the working member as a separate volume. Then you can replace the failed disk with a functional disk.</p>

<p>To re-create the mirrored volume after replacing the failed disk, click the working partition in the Computer Management window, and then click Add Mirror. The computer then presents the option to mirror this partition to the replacement disk.</p>

<p>In Figure 12.14, drive D on disk 0 is mirrored on disk 1. Drive D on disk 1 is the secondary member of the mirrored volume.</p>

<p>
<A HREF="javascript:fullSize('f12xx14gx.htm')"> <img src="images/f12xx14g.jpg" border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 12.14</b> <i>Replacing a failed disk in a mirrored volume</i><!--/caption-->
</p>

<p>If the primary member of a mirrored volume, including the boot partition, fails, use a boot disk to start the computer and access the functioning member. The Boot.ini file on the boot disk must include the Advanced RISC Computing (ARC) path pointing to the mirrored partition. It is recommended that you create and test a boot disk immediately after implementing a mirrored volume.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
Replacing a failed member is not the only reason to remove a mirrored volume. You might also remove one member of a mirrored volume to reclaim the disk space for other purposes.</blockquote></div>
</p>

<A NAME="729"><h3>Repairing a RAID-5 Volume</h3></A>
<p>If a member of a RAID-5 volume fails, the computer continues to operate with access to all data. However, as data is requested, the Windows 2000 Server fault tolerance driver uses the data and parity bits on the remaining members to regenerate the missing data in RAM. During this regeneration, computer performance decreases.</p>

<p>To restore the computer's level of performance, you can replace the failed drive and then repair the RAID-5 volume. The fault tolerance driver reads the parity information from the parity information stripes on the remaining members, and then re-creates the data contained on the missing member. When complete, the fault tolerance driver writes the data to the new member.</p>

<A NAME="730"><h2>Lesson Summary</h2></A>
<p>Disaster recovery allows you to restore a computer so that you can log on and access system resources after a computer disaster has occurred. Windows 2000 includes three methods that allow you to repair a system: Safe mode, the Recovery Console, and the Emergency Repair Disk. Safe mode lets you start your system with a minimal set of device drivers and services. The Recovery Console is a text-mode command interpreter that is separate from the Windows 2000 command prompt and allows the system administrator to gain access to the hard disk of a computer running Windows 2000. The Emergency Repair Disk allows you to restore core system files. In addition to repairing a system, you should be able to restore data. Windows Backup provides a Restore wizard to help you restore data, or you can restore data without using the wizard. Also, if you have set up your system with disk fault tolerance, you can recover from a mirrored volume failure or repair a RAID-5 volume.</p>

</BODY>
</HTML>



