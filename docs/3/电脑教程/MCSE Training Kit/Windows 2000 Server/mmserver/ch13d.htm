<HTML>
<HEAD>
<TITLE>Lesson 3: Performance Console</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmserver.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch13c.htm", "ch13e.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="771"><h1>Lesson 3: Performance Console</h1></A>
<p>Windows 2000 provides two utilities for monitoring resource usage on your computer: the System Monitor snap-in and the Performance Logs And Alerts snap-in, both of which are pre-installed on the Performance console. The System Monitor snap-in allows you to track resource use and network throughput. The Performance Logs And Alerts snap-in allows you to collect performance data from local or remote computers.</p>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b> 
<ul>
<p><li>Use the Performance console snap-ins&#8212;System Monitor and Performance Logs And Alerts&#8212;to monitor resource usage on your computer</li></p>
</ul>
<b>Estimated lesson time: 40 minutes</b> 
</blockquote></div>
</p>

<A NAME="772"><h2>Introduction to the Performance Console</h2></A>
<p>The Performance console is a built-in utility you can access through the Administrative Tools program group. The Performance console is an MMC console that contains two pre-installed snap-ins: System Monitor and Performance Logs And Alerts (Figure 13.10).</p>

<p>
<A HREF="javascript:fullSize('f13xx10x.htm')"> <img src="images/f13xx10.jpg" border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 13.10</b> <i>System Monitor snap-in and the Performance Logs And Alerts snap-in in the Performance MMC console</i><!--/caption-->
</p>

<p>With System Monitor, you can collect and view real-time data about memory, disk, processor, network, and other activity in graph, histogram, or report form. Through Performance Logs And Alerts, you can configure logs to record performance data and set system alerts to notify you when a specified counter's value is above or below a defined threshold.</p>

<p>Monitoring system performance is an important part of maintaining and administering your Windows 2000 Server installation. You can use performance data for the following:</p>

<ul>
<p><li>To understand your workload and its effect on your system's resources</li></p>

<p><li>To observe changes and trends in workloads and resource usage so that you can plan for future upgrades</li></p>

<p><li>To test configuration changes or other tuning efforts by monitoring the results</li></p>


<p><li>To diagnose problems and target components or processes for optimization</li></p>
</ul>

<p>The System Monitor snap-in and the Performance Logs And Alerts snap-in provide detailed data about the resources used by specific components of the operating system and by server programs that have been designed to collect performance data. The graphs provide a display for performance-monitoring data; logs provide recording capabilities for the data; and alerts send notification to users by means of the Messenger service when a counter value reaches, rises above, or falls below a defined threshold.</p>

<p>Microsoft technical support often uses the results of performance monitoring to diagnose problems. Therefore, Microsoft recommends that you monitor system performance as part of your administrative routine.</p>

<A NAME="773"><h2>System Monitor Snap-In</h2></A>
<p>In Windows 2000, Performance Monitor has been replaced by System Monitor. With System Monitor, you can measure the performance of your own computer or other computers on a network. System Monitor allows you to perform the following tasks:</p>

<ul>
<p><li>Collect and view real-time performance data on a local computer or from remote computers</li></p>

<p><li>View data collected either currently or previously in a counter log</li></p>

<p><li>Present data in a printable graph, histogram, or report view</li></p>

<p><li>Incorporate System Monitor functionality into Microsoft Word or other applications in the Microsoft Office suite by means of <i>Automation</i></li></p>

<p><li>Create HTML pages from performance views</li></p>

<p><li>Create reusable monitoring configurations that can be installed on other computers that use MMC</li></p>
</ul>

<p>With System Monitor, you can collect and view extensive data about the usage of hardware resources and the activity of system services on computers you administer. You can define the data you want the graph to collect in the following ways:</p>

<ul>
<p><li><b>Type of data</b> To select the data to be collected, you can specify one or more counter instances of performance monitor objects. Some objects (such as the memory object) provide system resource counters; others provide counters on the operation of applications (for example, system services or Microsoft BackOffice applications).</li></p>

<p><li><b>Source of data</b> System Monitor can collect data from your local computer or from other computers on the network where you have permission. (By default, administrative permission is required.) In addition, you can include real-time data or data collected previously and saved in counter logs.</li></p>

<p><li><b>Sampling parameters</b> System Monitor supports manual, on-demand sampling or automatic sampling based on the time interval you specify. When viewing logged data, you can also choose starting and stopping times so that you can view data spanning a specific time range.</li></p>
</ul>

<A NAME="774"><h3>System Monitor Interface</h3></A>
<p>When you open the Performance console, the graph view and a toolbar appear by default and the graph area is blank. After you add counters to the graph, System Monitor begins charting counter values in this graph area (Figure 13.11). The console tree is hidden in Figure 13.11 for clarity.</p>

<p>
<A HREF="javascript:fullSize('f13xx11x.htm')"> <img src="images/f13xx11.jpg" border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 13.11</b> <i>System Monitor snap-in charting counter values in graph view</i><!--/caption-->
</p>

<p>As Figure 13.11 illustrates, there are three main areas in the System Monitor interface: the graph area, the legend, and the value bar.</p>

<p><b>Graph Area</b></p>

<p>You can choose to have data updated automatically or on demand. For updating on demand, use the Update Data button (camera toolbar icon) to start and stop the collection intervals. Click the Clear Display button (the second toolbar icon from the left) to remove all data from the display. To add counters to the graph, click the Add button (plus sign toolbar icon) and select the counters from the Add Counters dialog box.</p>

<p>The movement of the timer bar (vertical line in Figure 13.11) across the graph indicates the passing of each update interval. Regardless of the update interval, the view will show up to 100 samples. System Monitor compresses log data as necessary to fit it in the display. To see the compressed data in a log, click the Properties button (the fourth toolbar icon from the right), click the Source tab, select a log file, and then select a shorter time range. Shorter time ranges contain less data, so it is less likely that data points will be eliminated.</p>

<p>You can also define the following attributes of the graph:</p>

<ul>
<p><li>Type of display, with options for graph, histogram, or report</li></p>

<p><li>Background color of the detail pane and of the data display area</li></p>

<p><li>Size, type, and style of font used to show text in the display</li></p>

<p><li>Color, width, and style of line used to chart data</li></p>
</ul>

<p>To draw attention to a particular counter's data, use the highlighting feature. To do so, press Ctrl+H or click the Highlight button (light bulb toolbar icon), on the toolbar. When highlighting is in effect, the bar or line representing data for the selected counter changes color to white for most background colors (including the default color) or black for white or light-colored backgrounds.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
Default key settings in Microsoft Word may conflict with the Ctrl+H combination used for System Monitor highlighting. You might need to change these to support highlighting when the System Monitor control, %systemroot%\System32\Sysmon.ocx, is used in Microsoft Word.</blockquote></div>
</p>

<p><b>Legend</b></p>

<p>The names and associated information for the counters you select are shown in the legend, the set of columns beneath the graph. The legend displays the following information:</p>

<ul>
<p><li><b>Object</b> An <i>object</i> is a logical collection of counters associated with a resource or service that can be monitored.</li></p>

<p><li><b>Counter</b> A <i>counter</i> is a data item associated with an object. For each counter selected, System Monitor presents a value corresponding to a particular aspect of the performance defined for the object.</li></p>

<p><li><b>Instance</b> An <i>object instance</i> is a term used to distinguish between multiple occurrences of the same counter on a computer. Note that by default counter instances are listed by name and numerical index. This index appears after the instance name, represented by a pound sign (#) and a number. This index makes it easier to monitor multiple instances, for example, when you are monitoring threads of a process. To turn off the index display, click the Properties button and clear the Allow Duplicate Counter Instances check box.</li></p>
</ul>

<p>You can sort entries in ascending or descending order by object, counter, instance, or computer by clicking the appropriate column name in the counter legend. For example, to sort all counters by name, click Counter.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
To match a line in a graph with the counter it is charting values for, double-click a position in the graph line. The counter will be selected in the legend. If chart lines are close together, try to find a point in the graph where they diverge. Otherwise, System Monitor might not be able to pinpoint the value you are interested in.</blockquote></div>
</p>

<p><b>Value Bar</b></p>

<p>The value bar is located beneath the graph area and above the legend. The value bar contains the Last, Average, Minimum, and Maximum values for the counter currently selected. The values are calculated over the time period and number of samples displayed in the graph, not over the time that has elapsed since monitoring was started. The Duration value in the value bar indicates the total elapsed time displayed in the graph (based on the update interval).</p>

<A NAME="775"><h3>Monitoring System and Network Performance</h3></A>
<p>Network activity can influence the performance not only of your network components but of your system as a whole. You should monitor other resources along with network activity, such as disk, memory, and processor activity. System Monitor enables you to track network and system activity by using a single tool.</p>

<p>You should use the following counters as part of your normal monitoring configuration:</p>

<ul>
<p><li>Cache\Data Map Hits %</li></p>

<p><li>Cache\Fast Reads/sec</li></p>

<p><li>Cache\Lazy Write Pages/sec</li></p>

<p><li>Logical Disk\% Disk Space</li></p>

<p><li>Memory\Available Bytes</li></p>

<p><li>Memory\Nonpaged Pool Allocs</li></p>

<p><li>Memory\Nonpaged Pool Bytes</li></p>

<p><li>Memory\Paged Pool Allocs</li></p>

<p><li>Memory\Paged Pool Bytes</li></p>

<p><li>Processor(_Total)\% Processor Time</li></p>

<p><li>System\Context Switches/sec</li></p>

<p><li>System\Processor Queue Length</li></p>

<p><li>Processor(_Total)\Interrupts/sec</li></p>
</ul>

<p>Monitoring network activity with System Monitor involves examining performance data at each network layer, as defined in the Open Systems Interconnect (OSI) model. System Monitor provides performance objects for collection of data that reflects transmission rates, packet queue lengths, and other network performance data.</p>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
Because of the overhead of the protocol headers, actual transmission rates might differ from the rates specified for the wire or line in use.</blockquote></div>
</p>

<p>The following table provides information about the network layers and their associated performance objects.</p>

<table cellpadding=5 width="95%">
<tr><th valign="top">OSI layer</th> <th valign="top">Performance objects</th></tr>
<tr>
<td valign="top">Application, Presentation Session</td> 
<td valign="top">Browser, Server, Redirector, and Server Work Queues NBT Connection. (NBT is an abbreviation for NetBT, which means NetBIOS over TCP/IP; NetBIOS stands for network basic input/output system.)</td>
</tr>
<tr>
<td valign="top">Transport</td> 
<td valign="top">Protocol objects: TCP for the Transmission Control Protocol; UDP for the User Datagram Protocol, NetBEUI for NetBIOS, AppleTalk (installed by protocol).</td>
</tr>
<tr>
<td valign="top">Network</td> 
<td valign="top">Network Segment (installed when you install the Network Monitor driver), IP for the Internet Protocol, NWLink IPX/SPX for the Microsoft implementation of Internetwork Packet Exchange/Sequenced Packet Exchange (IPX/SPX). NWLink performance objects display only zeros for counters that report on frame activity. On systems running Windowsç‡¦T 4.0, installing the Network Monitor Agent also installs the Network Segment counters.</td>
</tr>
<tr>
<td valign="top">Data Link, Physical</td> 
<td valign="top">Network Interface. These counters are maintained by the driver and can report inaccurate or zero values because of problems with implementation of counters by the driver.</td>
</tr>
</table>

<p>When monitoring performance data for your network, you should begin with the lowest-level components and work your way up. Monitor the objects over periods ranging from days to weeks to a month. Using this data, determine a <i>performance baseline,</i> the level of performance you expect under typical workloads and usage. A performance baseline gives you a point from which to compare performance over time to identify growth trends, changing demands, or the emergence of a bottleneck. If performance within the baseline range becomes unsatisfactory, tune the network.</p>

<p>As with other resources, establish a baseline for network performance. When performance data is incompatible with your baseline values, investigate the cause. Abnormal network counter values on a server often indicate problems with the server's memory, processor, or disks. For that reason, the best approach to monitoring a server is to watch network counters in conjunction with Processor\% Processor Time, PhysicalDisk\% Disk Time, and Memory\Pages/sec.</p>

<p>For example, if a dramatic increase in Pages/sec is accompanied by a decrease in Bytes Total/sec handled by a server, the computer is probably running short of physical memory for network operations. Most network resources, including network adapters and protocol software, use unpaged memory. If a computer is paging excessively, it could be because most of its physical memory has been allocated to network activities, leaving a small amount of memory for processes that use paged memory. To verify this situation, check the computer's system event log for entries indicating that it has run out of paged or unpaged memory. Also monitor the unpaged pool memory and overall memory counters.</p>

<A NAME="776"><h3>Disk Objects and the Diskperf Utility</h3></A>
<p>Two primary disk objects contain counters in System Monitor, the PhysicalDisk, and LogicalDisk objects. The physical disk performance counters are enabled and the logical disk performance counters are disabled by default on Windows 2000 Server. The logical disk performance counters are enabled using the Diskperf command line utility. Use the diskperf -yv command to enable Logical Disk performance counters.</p>

<p>After this command is run, the computer must be rebooted. On reboot, the logical disk and physical disk performance counters will start. These counters are contained in the System Monitor-PhysicalDisk and LogicalDisk objects respectively.</p>

<p>There is a small performance cost for running these counters. If you are not monitoring disk performance, type <b>diskperf -n</b> to disable both disk objects and their counters.</p>

<p>You can selectively enable or disable both physical and logical disk performance counters using Diskperf.</p>

<A NAME="777"><h2>Performance Logs and Alerts Snap-In</h2></A>
<p>With Performance Logs And Alerts, you can collect performance data automatically from local or remote computers. You can view logged counter data by using System Monitor, or you can export the data to spreadsheet programs or databases for analysis and report generation. Note that, because logging runs as a service, data collection can occur regardless of whether any user is logged on to the computer being monitored.</p>

<p>The Performance Logs And Alerts snap-in allows you to perform the following tasks:</p>

<ul>
<p><li>Collect data in a comma-delimited or tab-separated format for easy import to spreadsheet programs. A binary log-file format is also provided for circular logging or for logging instances such as threads or processes that might begin after the log starts collecting data. (Circular logging is the process of continuously logging data to a single file, overwriting previous data with new data.)</li></p>

<p><li>View counter data during collection and after collection has stopped.</li></p>

<p><li>Define start and stop times, file names, file sizes, and other parameters for automatic log generation.</li></p>

<p><li>Manage multiple logging sessions from a single console window.</li></p>

<p><li>Set an alert on a counter, thereby stipulating that a message be sent, a program be run, or a log be started when the selected counter's value exceeds or falls below a specified setting.</li></p>
</ul>

<p>Similar to System Monitor, Performance Logs And Alerts supports the following: 1) defining performance objects, performance counters, and object instances and 2) setting sampling intervals for monitoring data about hardware resources and system services. Performance Logs And Alerts also offers these other options related to recording performance data:</p>

<ul>
<p><li>Starting and stopping logging&#8212;either manually on demand or automatically based on a user-defined schedule.</li></p>

<p><li>Creating trace logs. Using the default system data provider or another provider, trace logs record data when certain activities such as disk I/O operations or page faults occur. When the event occurs, the provider sends the data to the Performance Logs And Alerts service. This recording and sending data differs from the operation of counter logs; when counter logs are in use, the service obtains data from the system when the update interval has elapsed, rather than waiting for a specific event. A parsing tool is required to interpret the trace log output. Developers can create such a tool using application programming interfaces (APIs) provided on the Microsoft Web site, <i><a href="http://msdn.microsoft.com/" target="_window2">http://msdn.microsoft.com/</a>.</i></li></p>

<p><li>Defining a program that runs when a log is stopped.</li></p>

<p><li>Configuring additional settings for automatic logging, such as automatic file renaming, and setting parameters for stopping and starting a log based on the elapsed time or the file size.</li></p>
</ul>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
You can work with data from a log file while the service is collecting data and has the log file locked. For example, Microsoft Excel can import an active log file, but it will open a read-only version of the locked log.</blockquote></div>
</p>

<A NAME="778"><h3>Performance Logs And Alerts Interface</h3></A>
<p>In Performance Logs And Alerts, you can define settings for counter logs, trace logs, and alerts. The details pane of the console window shows logs and alerts that you have created (Figure 13.12).</p>

<p>
<A HREF="javascript:fullSize('f13xx12x.htm')"> <img src="images/f13xx12.jpg" border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 13.12</b> <i>Logs and alerts in the Performance Logs And Alerts snap-in</i><!--/caption-->
</p>

<p>You can define multiple logs or alerts to run simultaneously. Each log or alert is a saved configuration that you define. If you have configured the log for automatic starting and stopping, a single log can generate many individual log data files. For example, if you were generating a log file for each day's activity, one file would close at 11:59 P.M. today, and a new file would open at 12:00 A.M. tomorrow.</p>

<p>The following table explains the query summary information provided by the columns in the details pane.</p>

<table cellpadding=5 width="95%">
<tr><th valign="top">Column</th> <th valign="top">Description</th></tr>
<tr>
<td valign="top">Name</td> 
<td valign="top">This is the name of the log or alert. Think of this as a &quot;friendly name&quot; describing the type of data you are collecting or the condition you are monitoring. One log can generate multiple log files. Note that a sample log file, named System Overview, has been predefined for counter logging. You can start logging by using this file or by defining your own settings as appropriate.</td>
</tr>
<tr>
<td valign="top">Comment</td> 
<td valign="top">This can be any descriptive information about the log or alert.</td>
</tr>
<tr>
<td valign="top">Log File Type</td> 
<td valign="top">This is the log-file format you define. For alert, the type will always be alerts; for trace logs, it will always be sequential. For logs, this can be binary, binary circular, text-CSV (for comma-delimited text), or text-TSV (for tab-delimited text).</td>
</tr>
<tr>
<td valign="top">Log File Name</td> 
<td valign="top">This is the path and base file name you defined for the files generated by this log. The base file name is used for automatically naming new files.</td>
</tr>
</table>

<p>To see the parameters defined for each log, select the log name in the details pane and then select Properties from the Action menu. In the dialog box that appears, you can choose how to name your log files, when logging is scheduled to occur, and what performance objects and counters you want to monitor in your log.</p>

<p>If a log is currently running and collecting data (based on the schedule you defined for the log or alert), a green data icon appears next to the log or alert. If a red icon appears, the log or alert has been defined but is not currently running.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
You can configure more than one type of log to run at a time. One log can generate multiple log files if the restart option is selected or if you start and stop the log multiple times. However, you will not see these individual log files listed in the console window. Use Windows Explorer to view a listing of these files.</blockquote></div>
</p>

<A NAME="779"><h2>Lesson Summary</h2></A>
<p>The Performance tool in the Administrative Tools program group contains two utilities for monitoring resource usage on your computer: the System Monitor snap-in and the Performance Logs And Alerts snap-in. System Monitor allows you to measure the performance of your own computer or other computers on a network. With System Monitor, you can collect and view extensive data about the usage of hardware resources and the activity of system services on computers you administer. There are three main areas in the System Monitor interface: the graph area, the legend, and the value bar. System Monitor provides performance objects for collection of data that reflects transmission rates, packet queue lengths, and other network performance data. Each object is a logical collection of counters. For each counter selected, System Monitor presents a value corresponding to a particular aspect of the performance defined for the performance object. With Performance Logs And Alerts, you can collect performance data
automatically from local or remote computers. Similar to System Monitor, Performance Logs And Alerts allows you to define performance objects, performance counters, and object instances and set sampling intervals for monitoring data about hardware resources and system services. In Performance Logs And Alerts, you define settings for counter logs, trace logs, and alerts. The details pane of the console window shows logs and alerts that you have created.</p>

</BODY>
</HTML>



