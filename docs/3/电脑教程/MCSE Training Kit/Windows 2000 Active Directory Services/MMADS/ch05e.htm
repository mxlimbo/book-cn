<html>
<head>
<title>Lesson 4: Monitoring and Troubleshooting DNS for Active Directory</title>
<link rel="STYLESHEET" type="text/css" href="mmads.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</head>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch05d.htm", "ch05f.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="247"><h1>Lesson 4: Monitoring and Troubleshooting DNS for Active Directory</h1></A>
<p>This lesson explains the monitoring options available for DNS servers. It also describes problems you may encounter that relate to configuring DNS for Active Directory and possible solutions to these problems.</p>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li> Monitor DNS server</li></p>

<p><li> Troubleshoot DNS configuration for Active Directory</li></p>
</ul>

<b>Estimated lesson time: 10 minutes</b>
</blockquote></div>
</p>

<A NAME="248"><h2>Monitoring DNS Servers</h2></A>
<p>Windows 2000 Server includes two options for monitoring DNS servers:</p>

<ul>
<p><li> Default logging of DNS server event messages to the DNS server log</li></p>

<p><li> Optional debug options for trace logging to a text file on the DNS server computer</li></p>
</ul>

<A NAME="249"><h3>DNS Server Event Logging</h3></A>
<p>For Windows 2000 Server, DNS server event messages are kept separate from events raised by other applications and services in the DNS server log, which can be viewed using Event Viewer. The DNS server log contains basic predetermined events logged by the DNS server service, such as when the DNS server starts 
and stops.</p>

<p>You can also use Event Viewer to view and monitor client-related DNS events. These events appear in the system log and are written by the DNS client service at any computers running Windows 2000 (all versions).</p>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
For details on using the Event Viewer, see <A HREF="ch14a.htm">Chapter 14</A>, &quot;Managing Active Directory Performance.&quot;</blockquote></div>
</p>

<A NAME="250"><h3>Debug Options</h3></A>
<p>The DNS console allows you to set additional logging options to create a temporary trace log as a text-based file of DNS server activity. The file created and used for this feature, DNS.LOG, is stored in the <i>systemroot</i>\System32\Dns folder. For Windows 2000 DNS servers, the debug logging options described in Table 5.2 are supported for use.</p>

<p><b>Table 5.2</b> <i>DNS Server Debug Logging Options</i></p>

<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th>Logging Option</th>
<th>Description</th>
</tr>
<tr>
<td valign="top">Query</td>
<td valign="top">Logs queries received by the DNS server service from clients</td>
</tr>
<tr>
<td valign="top">Notify</td>
<td valign="top">Logs notification messages received by the DNS server service from other servers</td>
</tr>
<tr>
<td valign="top">Update</td>
<td valign="top">Logs dynamic updates received by the DNS server service from other computers</td>
</tr>
<tr>
<td valign="top">Questions</td>
<td valign="top">Logs the contents of the question section for each DNS query message processed by the DNS server service</td>
</tr>
<tr>
<td valign="top">Answers</td>
<td valign="top">Logs the contents of the answer section for each DNS query message processed by the DNS server service</td>
</tr>
<tr>
<td valign="top">Send</td>
<td valign="top">Logs the number of DNS query messages sent by the DNS server service</td>
</tr>
<tr>
<td valign="top">Receive</td>
<td valign="top">Logs the number of DNS query messages received by the DNS server service</td>
</tr>
<tr>
<td valign="top">UDP</td>
<td valign="top">Logs the number of DNS requests received by the DNS server service over a UDP port</td>
</tr>
<tr>
<td valign="top">TCP</td>
<td valign="top">Logs the number of DNS requests received by the DNS server service over a TCP port</td>
</tr>
<tr>
<td valign="top">Full Packets</td>
<td valign="top">Logs the number of full packets written and sent by the DNS server service</td>
</tr>
<tr>
<td valign="top">Write Through</td>
<td valign="top">Logs the number of packets written through by the DNS server service and back to the zone</td>
</tr>
</table>
</p>

<p>By default, all debug logging options are disabled. When selectively enabled, the DNS server service can perform additional trace-level logging of selected types of events or messages for general troubleshooting and debugging of the server.</p>

<p>Debug logging can be resource-intensive, affecting overall server performance and consuming disk space. Therefore, it should only be used temporarily when more detailed information about server performance is needed.</p>

<p><li> <b>To set DNS Server debug options</b></li></p>

<ol>
<p><li> In the DNS console tree, right-click the name server, then click Properties.</li></p>

<p><li> On the Logging tab, select the debug options you want to log, then click OK.</li></p>
</ol>

<A NAME="251"><h2>DNS Troubleshooting Scenarios</h2></A>
<p>Table 5.3 describes some zone problems you may encounter and possible 
solutions to these problems.</p>

<p><b>Table 5.3</b> <i>Troubleshooting Scenarios for Zone Problems</i></p>

<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th colspan="2">Symptom: A problem related to zone transfers</th>
</tr>
<tr>
<th>Cause</th>
<th>Solution</th>
</tr>
<tr>
<td valign="top">The DNS server service is stopped or the zone is paused.</td>
<td valign="top">Verify that the master (source) and secondary (destination) DNS servers involved in completing transfer of the zone are both started and that the zone is not paused at either server.</td>
</tr>
<tr>
<td valign="top">The DNS servers used during a transfer do have network connectivity with each other. </td>
<td valign="top">Eliminate the possibility of a basic network connectivity problem between the two servers. Using the PING command, ping each DNS server by its IP address from its remote counterpart. Both ping tests should succeed. If not, investigate and resolve intermediate network connectivity issues.</td>
</tr>
<tr>
<td valign="top">The serial number is the same at both the source and destination servers. Because the value is the same at both servers, no zone transfer occurs between the servers.</td>
<td valign="top">Using the DNS console, perform the following tasks: On the Start of Authority (SOA) tab, increase the value of the serial number for the zone at the master server (source) to a number greater than the value at the applicable secondary server (destination). Initiate zone transfer at the secondary server. </td>
</tr>
<tr>
<td valign="top">The master server (source) and its targeted secondary server (destination) are having inter-operability-related problems.</td>
<td valign="top">Investigate possible causes for any problems related to interoperability between Windows 2000 DNS servers and other DNS servers running different implementations, such as an older version of the Berkeley Internet Name Domain (BIND) distribution.</td>
</tr>
<tr>
<td valign="top">The zone has resource records or other data that cannot be interpreted by the DNS server.</td>
<td valign="top">Verify that the zone does not contain incompatible data, such as unsupported resource record types or data errors. Also, verify that the server has not been configured in advance to prevent loading a zone when bad data is found and investigate its method for checking names. These settings can be configured using DNS console.</td>
</tr>
<tr>
<td valign="top">Authoritative zone data is incorrect.</td>
<td valign="top">If a zone transfer continues to fail, ensure that the zone does not contain nonstandard data. To determine if erroneous zone data is a likely source for a failed zone transfer, look in the DNS server event log for messages. </td>
</tr>

<tr>
<th colspan="2">Symptom: Zone delegation appears to be broken</th>
</tr>
<tr>
<th>Cause</th>
<th>Solution</th>
</tr>
<tr>
<td valign="top">Zone delegations are not configured correctly.</td>
<td valign="top">Review how zone delegations are used and revise your zone configurations as needed.</td>
</tr>
</table>
</p>

<p>Table 5.4 describes some problems you may encounter with dynamic updates and possible solutions to these problems.</p>

<p><b>Table 5.4</b> <i>Troubleshooting Scenarios for Dynamic Updates</i></p>
<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th colspan="2">Symptom: The client is not performing dynamic updates</th>
</tr>
<tr>
<th>Cause</th>
<th>Solution</th>
</tr>
<tr>
<td valign="top">The client (or its DHCP server) does not support the use of the DNS dynamic update protocol.</td>
<td valign="top">Verify that your clients or servers support the DNS dynamic update protocol using the options for dynamic update support provided in Windows 2000. In order for client computers to be registered and updated dynamically with a DNS server, either: 		Install or upgrade client computers to Windows 2000 or install and use a Windows 2000 DHCP server on your network to lease client computers.</td>
</tr>
<tr>
<td valign="top">The client was not able to register and update with the DNS server because of missing or incomplete DNS configuration.</td>
<td valign="top">Verify that the client is fully and correctly configured for DNS, and update its configuration as needed. To update the DNS configuration for a client, either: Configure a primary DNS suffix at the client computer for static TCP/IP clients or configure a connection-specific DNS suffix for use at one of the installed network connections at the client computer.</td>
</tr>
<tr>
<td valign="top">The DNS client attempted to update its information with the DNS server but failed because of a problem related to the server.</td>
<td valign="top">If a client can reach its preferred and alternate DNS servers as configured, it is likely that the cause of its failed updates can be found elsewhere. At Windows 2000 client computers, use Event Viewer to check the System log for any event messages that explain why attempts by the client to dynamically update its host (A) or pointer (PTR) resource records failed.</td>
</tr>
<tr>
<td valign="top">The DNS server does not support dynamic	updates.</td>
<td valign="top">Verify that the DNS server used by the client can support the DNS dynamic update protocol, as described in RFC 2136. For Windows DNS servers, only Windows 2000 DNS servers support dynamic updates. The DNS server provided with Windows NT Server 4.0 does not.</td>
</tr>
<tr>
<td valign="top">The DNS server supports dynamic updates but is not	configured to accept them.</td>
<td valign="top">Verify that the primary zone where clients require updates is configured to allow dynamic updates. For Windows 2000 DNS servers, the default for a new primary zone is to not accept dynamic updates. At the DNS server that loads the applicable primary zone, modify zone properties to allow updates.</td>
</tr>
<tr>
<td valign="top">The zone database is not available.</td>
<td valign="top">Verify that the zone exists. Verify that the zone is available for update. For a standard primary zone, verify that the zone file exists at the server and that the zone is not paused. Secondary zones do not support dynamic updates. For Active Directory-integrated zones, verify that the DNS server is running as a domain controller and has access to the Active Directory database where zone data is stored.</td>
</tr>
</table>
</p>


<A NAME="252"><h2>Lesson Summary</h2></A>
<p>In this lesson you learned about the monitoring options available for DNS servers. You also examined some DNS configuration problems you may encounter and possible solutions to these problems.</p>

</BODY>
</HTML>







