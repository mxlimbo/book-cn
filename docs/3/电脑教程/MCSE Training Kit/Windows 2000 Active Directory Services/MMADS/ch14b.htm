<html>
<head>
<title>Lesson 1: Active Directory Performance Monitoring Tools</title>
<link rel="STYLESHEET" type="text/css" href="mmads.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</head>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch14a.htm", "ch14c.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="779"><h1>Lesson 1: Active Directory Performance Monitoring Tools</h1></A>
<p>Monitoring Active Directory performance is an important part of maintaining and administering your Microsoft Windows 2000 installation. You use Active Directory performance data to</p>

<ul>
<p><li>Understand Active Directory performance and the corresponding effect on your system's resources</li></p>

<p><li>Observe changes and trends in performance and resource usage so you can plan for future upgrades</li></p>

<p><li>Test configuration changes or other tuning efforts by monitoring the results</li></p>

<p><li>Diagnose problems and target components or processes for optimization</li></p>
</ul>

<p>This lesson introduces you to the Active Directory performance monitoring tools and guides you through the steps required to set up Active Directory performance monitoring.</p>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li>Describe the purpose of the Event Viewer console</li></p>

<p><li>Use the Event Viewer console to view event logs</li></p>

<p><li>Describe the components of the Performance console</li></p>

<p><li>Describe the purpose of the System Monitor</li></p>

<p><li>Use the System Monitor to monitor performance counters</li></p>

<p><li>Describe the purpose of counter logs, trace logs, and alerts</li></p>

<p><li>Use Performance Logs and Alerts to create counter logs, trace logs, and alerts</li></p>
</ul>

<b>Estimated lesson time: 50 minutes</b>
</blockquote></div>
</p>

<A NAME="780"><h2>Performance Monitoring Tools</h2></A>
<p>Windows 2000 provides several tools for monitoring Active Directory performance. On the Administrative Tools menu, the Event Viewer console allows you to view log files and error messages sent by applications. The Performance console provides a graphical way to view performance of Active Directory according to measurements, or counters, that you select. The Performance console also provides a means to log activity or send alerts according to those measurements and view the logs either printed or online.</p>

<A NAME="781"><h2>The Event Viewer Console</h2></A>
<p>Windows 2000 provides the Event Viewer console as a way to monitor Windows-wide events such as application, system, and security events, and service-specific events such as directory service events. These events are recorded in event logs. For example, if you need detailed information about when directory partitions are being replicated, you would study the File Replication Service log in the Event Viewer.</p>

<p>Also, if you experience problems with Active Directory, it is recommended that the directory service event logs be the <i>first</i> item that you use to investigate the causes of the problem. By using information from the event log, you can better understand the sequence and types of events that led up to a particular performance problem.</p>

<p>In <A HREF="ch13a.htm">Chapter 13</A>, you learned about using Event Viewer to view, locate, filter, and archive information contained in Windows 2000 security logs and to configure security logs. The procedures for each of these tasks are similar for the event logs used to monitor Active Directory performance. These logs are described in Table 14.1.</p>

<p><b>Table 14.1</b> <i>Event Logs for Monitoring Active Directory Performance</i></p>

<table cellpadding=5 width="95%">
<tr><th valign="top">Log</th> <th valign="top">Description</th></tr>

<tr><td valign="top">Application</td> 
<td valign="top">Contains errors, warnings, or information that applications, such as a database server or an e-mail program, generate. The application developer presets which events to record.</td></tr>

<tr><td valign="top">Directory Service</td> 
<td valign="top">Contains errors, warnings, and information that Active Directory generates (see Figure 14.1).</td></tr>

<tr><td valign="top">File Replication Service</td> 
<td valign="top">Contains errors, warnings, and information that the File Replication service generates.</td></tr>

<tr><td valign="top">System</td> 
<td valign="top">Contains errors, warnings, and information that Windows 2000 generates. Windows 2000 presets which events to record.</td></tr>
</table>

<p>
<A HREF="javascript:fullSize('14wtk01x.htm')"> <img src="images/14wtk01.JPG" width=404 height=255 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 14.1</b> <i>The Directory Service log</i><!-- /caption -->
</p>


<A NAME="782"><h2>The Performance Console</h2></A>
<p>The Performance console allows you to monitor conditions within local and remote computers anywhere in your network and to summarize performance at selected intervals. The Performance console can use various counters for monitoring real-time resource usage. It can log results into a file so that you can view and diagnose historical performance problems. With appropriate permissions, it can monitor resource usage of other computers that run server services on the network. The Performance console can also be used for collecting baseline performance data, then configured to send alerts to the Event Log or other locations about exceptions to the baseline.</p>

<p>The Performance console contains two snap-ins: System Monitor (an ActiveX control) and Performance Logs and Alerts.</p>

<A NAME="783"><h2>System Monitor</h2></A>
<p>With System Monitor, you can measure Active Directory performance on your own computer or other computers on a network:</p>

<ul>
<p><li>Collect and view real-time performance data on a local computer or from several remote computers.</li></p>

<p><li>View data collected either currently or previously recorded in a counter log.</li></p>

<p><li>Present data in a printable graph, histogram, or report view.</li></p>

<p><li>Incorporate System Monitor functionality into Microsoft Word or other applications in the Microsoft Office suite by means of Automation.</li></p>

<p><li>Create HTML pages from performance views.</li></p>

<p><li>Create reusable monitoring configurations that can be installed on other computers using Microsoft Management Console (MMC).</li></p>
</ul>

<p>A sample System Monitor is shown in Figure 14.2.</p>

<p>You can define the Active Directory data you want to collect in the following ways:</p>

<ul>
<p><li><b>Type of data.</b> To select the data to be collected, you specify performance objects and performance counters.</li></p>

<p><li><b>Source of data.</b> System Monitor can collect data from your local computer or from other computers on the network where you have permission. (By default, administrative permission associated with the task is required.) In addition, you can include real-time data or data collected previously using counter logs.</li></p>

<p><li><b>Sampling parameters.</b> System Monitor supports manual, on-demand sampling or automatic sampling based on a time interval you specify. When viewing logged data, you can also choose starting and stopping times so that you can view data spanning a specific time range.</li></p>


<p>
<A HREF="javascript:fullSize('14wtk02x.htm')"> <img src="images/14wtk02.JPG" width=404 height=285 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 14.2</b> <i>A sample System Monitor</i><!-- /caption -->
</p>
</ul>

<p>In addition to options for defining data content, you have considerable flexibility in designing the appearance of your System Monitor views:</p>

<ul>
<p><li><b>Type of display.</b> System Monitor supports chart, histogram, and report views.</li></p>

<p><li><b>Display characteristics.</b> For any of the three display types, you can define the characteristics, colors, and fonts for the display.</li></p>
</ul>

<A NAME="784"><h3>Defining Data for Monitoring</h3></A>
<p>To begin monitoring data, you specify performance objects and performance counters. A <i>performance object</i> is a logical connection of counters that is associated with a resource or service that can be monitored. For the purposes of monitoring Active Directory, you monitor the activity of the NTDS (NT Directory Service) performance object. By using System Monitor, you can track the activity of performance objects through the use of counters. <i>Performance counters</i> refer to the multitude of conditions that can apply to a performance object. For example, if you need to find out the number of connected Lightweight Directory Access Protocol (LDAP) client sessions, you can select the LDAP Client Sessions counter under the NTDS performance object and then view the current activity by using System Monitor.</p>

<A NAME="785"><h3>The NTDS Performance Object Counters</h3></A>
<p>The NTDS performance object contains many performance counters that provide statistics about Active Directory performance. After determining the statistics you want to monitor you must find the matching performance counters.</p>

<p>Performance counters can provide some baseline analysis information for capacity and performance planning. Typically, counters that are suited for capacity planning contain the word &quot;total&quot; in their name. These counters fall into three types: statistic counters, ratio counters, and accumulative counters. <i>Statistic counters</i> show totals per second, for example: DRA (Directory Replication Agent) Inbound Properties Total/Sec, which is the total number of object properties received from inbound replication partners. <i>Ratio counters</i> show percentage of total, for example: DS (Directory Service) % Writes From LDAP, which is the percentage of directory writes coming from LDAP query. <i>Accumulative counters</i> show totals since Active Directory was last started, for example: DRA Inbound Bytes Total Since Boot, which is the total number of bytes replicated in, the sum of the number of uncompressed bytes (never compressed) and the number of compressed bytes (after compression).</p>

<p>Each counter has its own guidelines and limits. The counters in Table 14.2 are of special interest for the reasons described.</p>

<p><b>Table 14.2</b> <i>Important Active Directory System Monitor Counters on the NTDS Performance Object</i></p>

<table cellpadding=5 width="95%">
<tr><th valign="top">Counter</th> <th valign="top">Description</th></tr>

<tr><td valign="top">DRA Inbound Bytes Compressed (Between Sites, After Compression)/Sec</td>
<td valign="top">The compressed size (in bytes) of inbound compressed replication data (size after compression, from Directory System Agents [DSAs] in other sites).</td></tr>

<tr><td valign="top">DRA Inbound Bytes Compressed (Between Sites, Before Compression)/Sec</td>
<td valign="top">The original size (in bytes) of inbound compressed replication data (size before compression, from DSAs in other sites).</td></tr>

<tr><td valign="top">DRA Inbound Bytes Not Compressed (Within Site)/Sec</td>
<td valign="top">The number of bytes received through inbound replication that were not compressed at the source&#8212;that is, from other DSAs in the same site.</td></tr>

<tr><td valign="top">DRA Inbound Bytes Total/Sec</td> 
<td valign="top">The total number of bytes received through replication, per second. It is the sum of the number of uncompressed bytes (never compressed) and the number of compressed bytes (after compression).</td></tr>

<tr><td valign="top">DRA Inbound Full Sync Objects Remaining</td>
<td valign="top">The number of objects remaining until the full synchronization process is completed, or set.</td></tr>

<tr><td valign="top">DRA Inbound Objects/Sec</td> 
<td valign="top">The number of objects received, per second, from replication partners through inbound replication.</td></tr>

<tr><td valign="top">DRA Inbound Objects Applied/Sec</td>
<td valign="top">The rate, per second, at which replication updates are received from replication partners and applied by the local directory service. This count excludes changes that are received but not applied (for example, when the change is already present). This indicates how much replication update activity is occurring on the server as a result of changes generated on other servers.</td></tr>

<tr><td valign="top">DRA Inbound Objects Filtered/Sec</td>
<td valign="top">The number of objects received per second from inbound replication partners that contained no updates that needed to be applied.</td></tr>

<tr><td valign="top">DRA Inbound Object Updates Remaining in Packet</td>
<td valign="top">The number of object updates received in the current directory replication update packet that have not yet been applied to the local server. This tells you whether the monitored server is receiving changes but taking a long time applying them to the database.</td></tr>

<tr><td valign="top">DRA Inbound Properties Applied/Sec</td>
<td valign="top">The number of properties that are applied through inbound replication as a result of reconciliation logic.</td></tr>

<tr><td valign="top">DRA Inbound Properties Filtered/Sec</td>
<td valign="top">The number of property changes that are already 
known received during the replication.</td></tr>

<tr><td valign="top">DRA Inbound Properties Total/Sec</td>
<td valign="top">The total number of object properties received per 
second from inbound replication partners.</td></tr>

<tr><td valign="top">DRA Inbound Values (DNs Only)/Sec</td>
<td valign="top">The number of object property values received from inbound replication partners that are Distinguished Names (DNs), per second. This includes objects that reference other objects. Distinguished Names values, such as group or distribution list memberships, are more expensive to apply than other kinds of values because group or distribution list objects can include hundreds and thousands of members and therefore are much bigger than a simple object with only one or two attributes. This counter might explain why inbound changes are slow to be applied to the database.</td></tr>

<tr><td valign="top">DRA Inbound Values Total/Sec</td>
<td valign="top">The total number of object property values received 
 from inbound replication partners per second. Each 
 inbound object has one or more properties, and each 
 property has zero or more values. Zero values indicate 
 property removal.</td></tr>

<tr><td valign="top">DRA Outbound Bytes Compressed (Between Sites, After Compression)/Sec</td>
<td valign="top">The compressed size (in bytes) of outbound compressed replication data, after compression, from DSAs in other sites.</td></tr>

<tr><td valign="top">DRA Outbound Bytes Compressed (Between Sites, Before Compression)/Sec</td>
<td valign="top">The original size (in bytes) of outbound compressed replication data, before compression, from DSAs in other sites.</td></tr>

<tr><td valign="top">DRA Outbound Bytes Not Compressed (Within Site)/Sec</td>
<td valign="top">The number of bytes replicated out that were not compressed; that is, from DSAs in the same site.</td></tr>

<tr><td valign="top">DRA Outbound Bytes Total/Sec</td>
<td valign="top">The total number of bytes replicated out per second. 
 The sum of the number of uncompressed bytes (never 
 compressed) and the number of compressed bytes 
 (after compression).</td></tr>

<tr><td valign="top">DRA Outbound Objects/Sec</td> 
<td valign="top">The number of objects replicated out per second.</td></tr>

<tr><td valign="top">DRA Outbound Objects Filtered/Sec</td>
<td valign="top">The number of objects acknowledged by outbound replication that required no updates. They also represent objects that the outbound partner did not already have.</td></tr>

<tr><td valign="top">DRA Outbound Properties/Sec</td> 
<td valign="top">The number of properties replicated out per second. This tells you whether a source server is returning objects or not.</td></tr>

<tr><td valign="top">DRA Outbound Values (DNs Only)/Sec</td>
<td valign="top">The number of object property values containing Distinguished Names sent to outbound replication partners. Distinguished Name values, such as group or distribution list memberships, are more expensive to read than other kinds of values because group or distribution list objects can include hundreds and thousands of members and therefore are much bigger than a simple object with only one or two attributes.</td></tr>

<tr><td valign="top">DRA Outbound Values Total/Sec</td>
<td valign="top">The number of object property values sent to outbound replication partners per second.</td></tr>

<tr><td valign="top">DRA Pending Replication Synchronizations</td>
<td valign="top">The number of directory synchronizations that are queued for this server but not yet processed. This helps in determining replication backlog; the larger the number, the larger the backlog.</td></tr>

<tr><td valign="top">DRA Sync Requests Made</td> 
<td valign="top">The number of synchronization requests made to replication partners.</td></tr>

<tr><td valign="top">DS Directory Reads/Sec</td> 
<td valign="top">The number of directory reads per second.</td></tr>

<tr><td valign="top">DS Directory Writes/Sec</td> 
<td valign="top">The number of directory writes per second.</td></tr>

<tr><td valign="top">DS Security Descriptor Suboperations/Sec</td>
<td valign="top">The number of Security Descriptor Propagation suboperations per second. One Security Descriptor Propagation operation is made up of many suboperations. A suboperation roughly corresponds to an object the propagation causes the propagator to examine.</td></tr>

<tr><td valign="top">DS Security Descriptor Propagations Events</td>
<td valign="top">The number of Security Descriptor Propagation events that are queued but not yet processed.</td></tr>

<tr><td valign="top">DS Threads in Use</td> 
<td valign="top">The current number of threads in use by the directory 
 service (different than the number of threads in the directory service process). Threads in Use is the number 
 of threads currently servicing client application programming interface (API) calls and can be used to 
 indicate whether additional processors can be of benefit.</td></tr>

<tr><td valign="top">Kerberos Authentications/Sec</td> 
<td valign="top">The number of times per second that clients use a 
 ticket to this domain controller to authenticate this 
 domain controller.</td></tr>

<tr><td valign="top">LDAP Bind Time</td> 
<td valign="top">The time (in milliseconds) taken for the last  successful LDAP binding.</td></tr>

<tr><td valign="top">LDAP Client Sessions</td> 
<td valign="top">The number of connected LDAP client sessions.</td></tr>

<tr><td valign="top">LDAP Searches/Sec</td>
<td valign="top">The number of search operations per second performed by LDAP clients.</td></tr>

<tr><td valign="top">LDAP Successful Binds/Sec</td> 
<td valign="top">The number of successful LDAP binds per second.</td></tr>

<tr><td valign="top">NTLM Authentications</td> 
<td valign="top">The number of NT LAN Manager (NTLM) authentications per second serviced by this domain controller.</td></tr>

<tr><td valign="top">XDS Client Sessions</td> 
<td valign="top">The number of connected Extended Directory Service (XDS) client sessions. This indicates the number of connections from other Windows NT services and the 
Windows NT Administrator program.</td></tr>

</table>

<A NAME="786"><h3>Monitoring Performance Counters</h3></A>
<p>You can select the performance counters to monitor and then view them graphically in the System Monitor as a chart, histogram, or log file data display.</p>

<p><li><b>To monitor Active Directory performance counters</b></li></p>

<ol>
<p><li>From the Start menu, select Programs, point to Administrative Tools, then click Performance.</li></p>

<p><li>Right-click the System Monitor details pane and click Add Counters.</li></p>

<p><li>In the Add Counters dialog box (see Figure 14.3):</li></p>


<ul>
<p><li>To monitor any computer on which the monitoring console is run, click Use Local Computer Counters.</li></p>

<p><li>To monitor a specific computer, regardless of where the monitoring console is run, click Select Counters From Computer and select a computer name from the list (the name of the local computer is selected by default).</li></p>
</ul>

<p>
<img src="images/14wtk03.JPG" width=398 height=438 border="0">
</p><p>
<!-- caption --><b>Figure 14.3</b> <i>The Add Counters dialog box</i><!-- /caption -->
</p>



<p><li>In the Performance Object list, select the NTDS performance object.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
For a description of a particular counter (see Figure 14.3), click the name of the counter from the list, then click Explain.</blockquote></div>
</p>

<ol>
<p><li value="5">Select the counters to monitor.</li></p>


<ul>
<p><li>To monitor all counters for the NTDS performance object, click All Counters.</li></p>
</ul>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
Because there are many counters, monitoring all counters will affect 
processing time and is not a practical solution.</blockquote></div>
</p>
<ol> 
<ul>
<p><li>To monitor only selected counters, click Select Counters From List and select the counters you want to monitor. You can select multiple counters by clicking on a counter and holding the Ctrl key.</li></p>
</ul>


<p><li value="6">Click Add.</li></p>

<p><li>When you are finished adding counters, click Close.</li></p>


<P>The counters that you selected appear in the lower part of the screen; each counter is represented by its own color. Choose either the chart, histogram, or report display view by clicking the appropriate toolbar button.</P>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
When creating a System Monitor snap-in for export, make sure to select Use Local Computer Counters on the Select Counters dialog box. Otherwise, System Monitor obtains data from the computer named in the text box, regardless of where the snap-in is installed.</blockquote></div>
</p>

<A NAME="787"><h2>Performance Logs and Alerts</h2></A>
<p>The Performance Logs and Alerts snap-in provides you with the ability to create counter logs, trace logs, and system alerts automatically from local or remote computers.</p>

<A NAME="788"><h3>Counter Logs</h3></A>
<p>Similar to System Monitor, counter logs support the definition of performance objects and performance counters and setting sampling intervals for monitoring data about hardware resources and system services. Counter logs collect performance counter data in a comma-separated or tab-separated format for easy import to spreadsheet or database programs. You can view logged counter data using System Monitor or export the data to a file for analysis and report generation.</p>

<A NAME="789"><h3>Trace Logs</h3></A>
<p>Using the default system data provider or another nonsystem provider, trace logs record data when certain activities such as a disk I/O operation or a page fault occur. When the event occurs, the provider sends the data to the Performance Logs and Alerts service. This differs from the operation of counter logs; when counter logs are in use, the service obtains data from the system when the update interval has elapsed, rather than waiting for a specific event.</p>

<p>Active Directory nonsystem providers include those for NetLogon, Kerberos, 
Security Accounts Manager (SAM), and Windows NT Active Directory Service. These providers generate trace log files containing messages that may be used to track the operations performed.</p>

<p>A parsing tool is required to interpret the trace log output. Developers can 
create such a tool using APIs provided on the Microsoft Developer Web site (<i><a href="http://msdn.microsoft.com/" target="_window2">http://msdn.microsoft.com/</i>).</p>

<A NAME="790"><h3>Logging Options</h3></A>
<p>For both counter and trace logs you can</p>

<ul>
<p><li>Define start and stop times, filenames, file types, file sizes, and other parameters for automatic log generation and manage multiple logging sessions from a single console window.</li></p>

<p><li>Start and stop logging either manually on demand or automatically based on a user-defined schedule.</li></p>

<p><li>Configure additional settings for automatic logging, such as automatic file renaming, and set parameters for stopping and starting a log based on the elapsed time or the file size.</li></p>

<p><li>Define a program that runs when a log is stopped.</li></p>

<p><li>View logs during collection as well as after collection has stopped. Because logging runs as a service, data collection occurs regardless of whether any user is logged on to the computer being monitored.</li></p>
</ul>

<A NAME="791"><h3>Counter and Trace Logging Requirements</h3></A>
<p>To create or modify a log, you must have Full Control permission for the following registry key, which controls the Performance Logs and Alerts service:</p>

<p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SysmonLog 
\Log Queries</p>

<p>Administrators usually have this permission by default. Administrators can grant permission to users by using the Security menu in REGEDT32.EXE.</p>

<p>To run the Performance Logs and Alerts service (which runs in the background when you configure a log), you must have permission to start or otherwise 
configure services on the system. Administrators have this right by default and can grant it to users by using group policy. To log data on a remote computer, the Performance Logs and Alerts service must run under an account that has access to the remote system.</p>

<A NAME="792"><h3>Creating a Counter Log</h3></A>
<p>To create a counter log you first define the counters you want to log and then set log file and scheduling parameters.</p>

<p><li><b>To create a counter log</b></li></p>

<ol>
<p><li>From the Start menu, select Programs, point to Administrative Tools, then click Performance.</li></p>

<p><li>Double-click Performance Logs And Alerts, then click Counter Logs.</li></p>

<p>Any existing logs will be listed in the details pane. A green icon indicates that a log is running; a red icon indicates that a log has been stopped.</p>


<p><li>Right-click a blank area of the details pane, then click New Log Settings.</li></p>

<p><li>In the New Log Settings dialog box, in the Name box, type the name of the log, then click OK.</li></p>

<p><li>In the General tab of the counter log's dialog box, type the name of the path and filename of the log file in the Current Log File Name box, then click Add.</li></p>

<p><li>In the Select Counters dialog box, choose the computer for which you want to log counters.</li></p>

<ul>
<p><li>To log counters from the computer on which the Performance Logs and Alerts service will run, click Use Local Computer Counters.</li></p>

<p><li>To log counters from a specific computer regardless of where the service is run, click Select Counters From Computer and select the name of the computer you want to monitor from the list.</li></p>
</ul>

<p><li>In the Performance Object list, select an object to log.</li></p>

<p><li>Select the counters you want to log from the list, then click Add.</li></p>

<p><li>Click Close when you have finished selecting counters to log.</li></p>

<p><li>In the Log Files tab of the counter log's dialog box, configure the options shown in Figure 14.4 and described in Table 14.3.</li></p>

<p><b>Table 14.3</b> <i>Options on the Log Files Tab</i></p>

<table cellpadding=5 width="95%">
<tr><th valign="top">Option</th> <th valign="top">Description</th></tr>

<tr><td valign="top">Location</td> 
<td valign="top">The name of the folder where you want the log file created, or click Browse to search for the folder.</td></tr>

<tr><td valign="top">File Name</td> 
<td valign="top">A partial or base name for the log file. You can use File Name in conjunction with End File Names With if appropriate. Appears on the details pane.</td></tr>

<tr><td valign="top">End File Names With</td>
<td valign="top">The suffix style you want from the list. Distinguish between individual log files with the same log filename that are in a group of logs that have been automatically generated.</td></tr>

<tr><td valign="top">Start Numbering At</td> 
<td valign="top">The start number for automatic file numbering, when you select nnnnnn as the End File Names With.</td></tr>

<tr><td valign="top">Log File Type</td> 
<td valign="top">The format you want for this log file:<br> 
<i>Text File&#8212;CSV</i> defines a comma-delimited log file (with a .csv extension). Use this format to export the log data to a spreadsheet program.<br> 
<i>Text File&#8212;TSV</i> defines a tab-delimited log file (with a .tsv 
extension). Use this format to export the log data to a spreadsheet program.<br> 
<i>Binary File</i> defines a sequential, binary-format log file (with a .blg extension). Use this file format if you want to be able to record data instances that are intermittent&#8212;that is, stopping and resuming after the log has begun running. Nonbinary file formats cannot accommodate instances that are not persistent throughout the duration of the log.<br> 
<i>Binary Circular File</i> defines a circular, binary-format log file (with a .blg extension). Use this file format to record data continuously to the same log file, overwriting previous records with new data.</td></tr>

<tr><td valign="top">Comment</td> 
<td valign="top">A comment or description for the log file. Appears in the 
details pane.</td></tr>

<tr><td valign="top">Log File Size</td>
<td valign="top"><i>Maximum Limit.</i> Data is continuously collected in a log file until it reaches limits set by disk quotas or the operating system. 
<i>Limit Of.</i> The maximum size (in kilobytes, up to two gigabytes) of the log file. Select this option if you want to do circular 
logging.</td></tr>
</table>

<p>
<img src="images/14wtk04.JPG" width=404 height=448 border="0">
</p><p>
<!-- caption --><b>Figure 14.4</b> <i>The Log Files tab of a counter log's dialog box</i><!-- /caption -->
</p>



<p><li value="11">In the Schedule tab of the counter log's dialog box, configure the options shown in Figure 14.5 and described in Table 14.4.</li></p>


<p><b>Table 14.4</b> <i>Options on the Schedule Tab</i></p>

<table cellpadding=5 width="95%">
<tr><th valign="top">Option</th> <th valign="top">Description</th></tr>

<tr><td valign="top">Start Log</td> 
<td valign="top"><i>Manually.</i> Logging will start manually.<BR> 
<i>At.</i> Logging will start according to the time and date parameters you set.</td></tr>

<tr><td valign="top">Stop Log</td> 
<td valign="top"><i>Manually.</i> Logging will stop manually.<br> 
<i>After.</i> Logging will stop after the time you specify.<br> 
<i>At.</i> Logging will stop at the time and date parameters you set.<br> 
<i>When The Log File Is Full.</i> Logging will stop when the log file reaches a maximum size.</td></tr>

<tr><td valign="top">When A Log File Closes</td> 
<td valign="top"><i>Start A New Log File.</i> Logging will resume in a new file after logging stops for the current log file.<br> 
<i>Run This Command.</i> A command you specify is run when a log file closes.</td></tr>
</table>

<p>
<img src="images/14wtk05.JPG" width=404 height=448 border="0">
</p><p>
<!-- caption --><b>Figure 14.5</b> <i>The Schedule tab of a counter log's dialog box</i><!-- /caption -->
</p>



<p><li>Click OK.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
When creating a Performance Logs and Alerts snap-in for export, make sure to select Use Local Computer Counters on the Select Counters dialog box. Otherwise, counter logs will obtain data from the computer named in the text box, regardless of where the snap-in is installed.</blockquote></div>
</p>

<A NAME="793"><h3>Creating a Trace Log</h3></A>
<p>To create a trace log you first define how you want events logged and then set log file and scheduling parameters.</p>

<p><li><b>To create a trace log</b></li></p>

<ol>
<p><li>From the Start menu, select Programs, point to Administrative Tools, then click Performance.</li></p>

<p><li>Double-click Performance Logs And Alerts, then click Trace Logs.</li></p>

<p>Any existing logs will be listed in the details pane. A green icon indicates that a log is running; a red icon indicates that a log has been stopped.</p>

<p><li>Right-click a blank area of the details pane, then click New Log Settings.</li></p>

<p><li>In the New Log Settings dialog box, in the Name box, type the name of the log, then click OK.</li></p>

<p>In the General tab of the trace log's Properties dialog box, the name of the path and filename of the log file is shown in the Current Log File Name box. By default, the log file is created in the PERFLOGS folder in the root directory, and a sequence number is appended to the filename you entered and the sequential trace file type with the .etl extension.</p>

<p><li>Select which events you want logged.</li></p>

<ul>
<p><li>Select Events Logged By System Provider for the default provider (the Windows kernel trace provider) to monitor processes, threads, and other activity. To define events for logging, click the check boxes as appropriate. This can create some performance overhead for the system.</li></p>

<p><li>Select Nonsystem Providers to select the trace data providers you want&#8212;for example, if you have written your own providers. Use the Add or Remove buttons to select or remove nonsystem providers.</li></p>
</ul>

<p>For a list of the installed providers and their status (enabled or not), click Provider Status.</p>

</ol>
<p>
<div class="note"><blockquote><b>NOTE</b><hr>
You can have only one trace log that uses the system provider running at a time. In addition, you cannot concurrently run multiple trace logs from the same nonsystem provider. If the system trace provider is enabled, nonsystem providers cannot be enabled, and vice versa. However, you can enable multiple nonsystem providers simultaneously.</blockquote></div>
</p>

<ol start="6">
<p><li>In the Log Files tab of the trace log's Properties dialog box, configure the options as you do for counter logs, except for the options shown in Table 14.5.</li></p>
</ol>

<p><b>Table 14.5</b> <i>Trace Log-Specific Options in the Log Files Tab</i></p>

<table cellpadding="5" border="0" width="95%">
<tr><th>Option</th><th>Description</th></tr>
<tr><td valign="top">Log File Type</td><td valign="top">The format you want for this log file:<br> <i>Circular Trace File.</i> Defines a circular trace log file (with an .etl extension). Use this file format to record data continuously to the same log file, overwriting previous records with new data.<br> <i>Sequential Trace File.</i> Defines a sequential trace log file (with an .etl extension) that collects data until it reaches a user-defined limit and then closes and starts a new file.</td></tr>
<tr><td valign="top">Log File Size</td><td valign="top"><i>Maximum Limit.</i> Data is continuously collected in a log file 
until it reaches limits set by disk quotas or the operating system.<br> <i>Limit Of.</i> The maximum size (in megabytes) of the log file. Select this option if you want to do circular logging.</td></tr>
</table>

<ol start="7">
<p><li>In the Schedule tab of the trace log's Properties dialog box, configure the options as shown for counter logs.</li></p>

<p><li>Click OK.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
Trace logging of file details and page faults can generate an extremely large amount of data. It is recommended that you limit trace logging using the file details and page fault options to a maximum of 2 hours.</blockquote></div>
</p>

<A NAME="794"><h3>Alerts</h3></A>
<p>Similar to System Monitor and counter logs, alerts support the use of performance objects and performance counters and setting sampling intervals for monitoring data about hardware resources and system services. Using this data, you can create an alert for a counter, which logs an entry in the application event log, sends a network message to a computer, starts a performance data log, or runs a program when the selected counter's value exceeds or falls below a specified setting.</p>

<p>You can start or stop an alert scan either manually on demand or automatically based on a user-defined schedule.</p>

<A NAME="795"><h3>Creating an Alert</h3></A>
<p>To create an alert you first define the counters you want to monitor for the alert and then set alert triggering and scheduling parameters.</p>

<p><li><b>To create an alert</b></li></p>

<ol>
<p><li>From the Start menu, select Programs, point to Administrative Tools, then click Performance.</li></p>

<p><li>Double-click Performance Logs And Alerts, then click Alerts.</li></p>

<p>Any existing alerts will be listed in the details pane. A green icon indicates that the alerts are running; a red icon indicates alerts have been stopped.</p>

<p><li>Right-click a blank area of the details pane and click New Alert Settings.</li></p>

<p><li>In the New Alert Settings dialog box, in the Name box, type the name of the alert, then click OK.</li></p>

<p><li>In the Comment box on the alert's dialog box, type a comment to describe the alert as needed, then click Add.</li></p>

<p><li>In the Select Counters dialog box, choose the computer for which you want to create an alert.</li></p>

<ul>
<p><li>To create an alert on the computer on which the Performance Logs and Alerts service will run, click Use Local Computer Counters.</li></p>

<p><li>To create an alert on a specific computer regardless of where the service is run, click Select Counters From Computer and specify the name of the computer.</li></p>
</ul>

<p><li>In the Performance Object list, select an object to monitor.</li></p>

<p><li>Select the counters you want to monitor, then click Add.</li></p>

<p><li>Click Close when you have finished selecting counters to monitor for the alert.</li></p>

<p><li>In the Alert When The Value Is list, specify Under or Over, and in the Limit box, specify the value that triggers the alert.</li></p>

<p><li>In the Sample Data Every section, specify the amount and the unit of measure for the update interval.</li></p>

<p><li>In the Action tab of the alert's dialog box, select when an alert is triggered as shown in Figure 14.6 and described in Table 14.6.</li></p>

<p><b>Table 14.6</b> <i>Options on the Action Tab</i></p>

<table cellpadding="5" border="0" width="95%">
<tr><th>Option</th><th>Description</th></tr>
<tr><td valign="top">Log An Entry In The Application Event Log</td><td valign="top">Creates an entry visible in Event Viewer</td></tr>
<tr><td valign="top">Send A Network Message To</td><td valign="top">Triggers the messenger service to send a message to the specified computer</td></tr>
<tr><td valign="top">Start Performance Data Log</td><td valign="top">Runs a specified counter log when an alert occurs</td></tr>
<tr><td valign="top">Run This Program</td><td valign="top">Triggers the service to create a process and run a specified program when an alert occurs</td></tr>
<tr><td valign="top">Command Line Arguments</td><td valign="top">Triggers the service to copy specified command-line arguments when the Run This Program option is used</td></tr>
</table>

<p><li>In the Schedule tab of the alert's dialog box, configure the options as shown for counter logs.</li></p>

<p><li>Click OK.</li></p>

<p>
<A HREF="javascript:fullSize('14wtk06x.htm')"> <img src="images/14wtk06.JPG" width=404 height=327 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 14.6</b> <i>The Action tab of an alert's dialog box and the Command Line Arguments dialog box</i><!-- /caption -->
</p>

</ol>
<p><img src="images/practic.JPG" width=92 height=74 border="0"></p>

<A NAME="796"><h2>Practice: Using System Monitor</h2></A>
<p>In this practice you monitor specified performance counters using System Monitor. Then you use Performance Logs and Alerts to create a counter log and an alert for the LDAP Searches/Sec counter.</p>

<A NAME="797"><h3>Exercise 1: Monitoring Performance Counters</h3></A>
<p>In this exercise you select performance counters to monitor and then view them graphically in the System Monitor as a chart, histogram, or log file data display.</p>

<p><li><b>To monitor Active Directory performance counters</b></li></p>

<ol>
<p><li>From the Start menu, select Programs, point to Administrative Tools, then click Performance.</li></p>

<p><li>In the console tree, click System Monitor.</li></p>

<p><li>Right-click the System Monitor details pane and click Add Counters.</li></p>

<p><li>Click Select Counters From Computer and ensure that the name of the local computer is selected.</li></p>

<p><li>In the Performance Object list, select the NTDS performance object.</li></p>

<p><li>Click Select Counters From List and select the DRA Pending Replication Synchronizations counter to monitor, then click Add.</li></p>

<p><li>Select the LDAP Searches/Sec counter to monitor, then click Add.</li></p>

<p><li>Click Close.</li></p>


<p>The counters that you selected appear in the lower part of the screen; each counter is represented by its own color. Choose either the chart, histogram, or report display view by clicking the appropriate toolbar button.</p>
</ol>

<A NAME="798"><h3>Exercise 2: Creating a Counter Log</h3></A>
<p>In this exercise you create a counter log by first defining the counters you want to log and then setting log file and scheduling parameters.</p>

<p><li><b>To create a counter log</b></li></p>

<ol>
<p><li>From the Start menu, select Programs, point to Administrative Tools, then click Performance.</li></p>

<p><li>Double-click Performance Logs And Alerts, then click Counter Logs.</li></p>

<p><li>Right-click a blank area of the details pane, then click New Log Settings.</li></p>

<p><li>In the New Log Settings dialog box, in the Name box, type <b>LDAP Searches Per Sec</b>, then click OK.</li></p>

<p><li>In the General tab of the LDAP Searches Per Sec dialog box, ensure that the default name of the path and filename of the log file in the Current Log File Name box is showing, then click Add.</li></p>

<p><li>In the Select Counters dialog box, click Select Counters From Computer and ensure that the name of the local computer is selected.</li></p>

<p><li>In the Performance Object list, select the NTDS performance object to log.</li></p>

<p><li>Select the LDAP Searches/Sec counter to log, click Add, then click Close.</li></p>

<p><li>In the Log Files tab, set the following options:</li></p>
<ul>
<p><li>Location: C:\PERFLOGS (where C:\ is the name of your system drive)</li></p>

<p><li>File Name: LDAP_SEARCHES_PER_SEC</li></p>

<p><li>End File Names With: nnnnnn</li></p>

<p><li>Start Numbering At: 1</li></p>

<p><li>Log File Type: Text File&#8212;CSV</li></p>

<p><li>Log File Size: Maximum Limit</li></p>
</ul>

<p><li>In the Schedule tab, set the following options:</li></p>
<ul>
<p><li>Start Log At: a time 3 minutes from now</li></p>
<p><li>Stop Log After: 2 minutes</li></p>
</ul>

<p><li>Click OK.</li></p>

<p><li>When the log starts in 3 minutes, open Active Directory Users and Computers, open and close various OUs and objects, then close Active Directory Users and Computers.</li></p>

<p><li>When the log has stopped, you can view the contents of the counter log by opening the file \PERFLOGS\LDAP_SEARCHES_PER_SEC_000001.CSV using a spreadsheet program such as Microsoft Excel.</li></p>
</ol>

<A NAME="799"><h3>Exercise 3: Creating an Alert</h3></A>
<p>In this exercise you create an alert by first defining the counters you want to monitor for the alert and then setting alert triggering and scheduling parameters.</p>

<p><li><b>To create an alert</b></li></p>

<ol>
<p><li>From the Start menu, select Programs, point to Administrative Tools, then click Performance.</li></p>

<p><li>Double-click Performance Logs And Alerts, then click Alerts.</li></p>

<p><li>Right-click a blank area of the details pane and click New Alert Settings.</li></p>

<p><li>In the New Alert Settings dialog box, in the Name box, type <b>LDAP Searches Above 5 Sec</b>, then click OK.</li></p>

<p><li>In the Comment box on the alert's dialog box, type <b>Alerts when LDAP Searches are more than 5 per second</b>, then click Add.</li></p>

<p><li>In the Select Counters dialog box, click Select Counters From Computer and ensure that the name of the local computer is selected.</li></p>

<p><li>In the Performance Object list, click the NTDS performance object to monitor.</li></p>

<p><li>Select the LDAP Searches/Sec counter to monitor, click Add, then click Close.</li></p>

<p><li>In the Alert When The Value Is box, specify Over, and in Limit, specify 5.</li></p>

<p><li>In the Sample Data Every section, specify the interval of 3 seconds.</li></p>

<p><li>In the Action tab, select the Log An Entry In The Application Event Log check box.</li></p>

<p><li>In the Schedule tab, set the following options:</li></p>
<ul>
<p><li>Start Scan At: a time 3 minutes from now</li></p>
<p><li>Stop Scan After: 2 minutes</li></p>
</ul>
<p><li>Click OK.</li></p>

<p><li>When the log starts in 3 minutes, open Active Directory Users and Computers, open and close various OUs and objects, then close Active Directory Users and Computers.</li></p>

<p><li>When the log has stopped, you can view the alerts in the Application Log in Event Viewer. View the alert information by double-clicking the log entries.</li></p>
</ol>

<A NAME="800"><h2>Lesson Summary</h2></A>
<p>In this lesson you learned about the Active Directory performance monitoring tools, the Event Viewer console, and the Performance console.</p>

<p>The Event Viewer console is a tool to monitor events such as application or system errors or the successful starting of a service. If you experience problems with Active Directory, it is recommended that the directory service event logs be the first item that you use to investigate the causes of the problem.</p>

<p>The Performance console allows you to monitor conditions within local and remote computers anywhere in your network and to summarize performance at selected intervals. The Performance console contains two snap-ins: System Monitor (an ActiveX control) and Performance Logs and Alerts. With System Monitor, you can measure Active Directory performance on your own computer or other computers on a network. The Performance Logs and Alerts snap-in provides you with the ability to create counter logs, trace logs, and system alerts automatically from local or remote computers.</p>

<p>In the practice portion of this lesson you monitored specified performance counters using System Monitor. Then you used Performance Logs and Alerts to create a counter log and an alert for the LDAP Searches/Sec counter.</p>

</BODY>
</HTML>







