<html>
<head>
<title>Lesson 2: Configuring Inter-Site Replication</title>
<link rel="STYLESHEET" type="text/css" href="mmads.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</head>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch06b.htm", "ch06d.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="266"><h1>Lesson 2: Configuring Inter-Site Replication</h1></A>
<p>Network connections are represented by site links. By creating site links and configuring their cost, replication frequency, and replication availability, you provide the directory service with information about how to use these connections to replicate directory data. You can improve site link connectivity by linking overlapping existing site links together into site link bridges, or you can bridge all site links and maximize connectivity. You can also designate a server, known as a bridgehead server, to serve as a contact point for the exchange of directory information between sites. This lesson explains how to configure inter-site replication.</p>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li> Configure inter-site replication</li></p>
</ul>

<p><b>Estimated lesson time: 25 minutes</b></p>
</blockquote></div>
</p>

<A NAME="267"><h2>Configuring Inter-Site Replication</h2></A>
<p>To configure inter-site replication you must complete the following tasks:</p>

<ol>
<p><li> Create site links (see <a href="ch06b.htm#257">Lesson 1</a>)</li></p>

<p><li> Configure site link attributes</li></p>

<p><li> Create site link bridges</li></p>

<p><li> Configure connection objects (optional)</li></p>

<p><li> Designate a preferred bridgehead server (optional)</li></p>
</ol>

<A NAME="268"><h2>Site Link Attributes</h2></A>
<p>You should provide site link cost, replication frequency, and replication availability information for all site links as part of the process of configuring inter-site 
replication.</p>

<A NAME="269"><h3>Site Link Cost</h3></A>
<p>Configure site link cost to assign a value for the cost of each available connection used for inter-site replication. If you have multiple redundant network connections, establish site links for each connection, and then assign costs to these site links that reflect their relative bandwidth. For example, if you have a high-speed T1 line and a dial-up network connection in case the T1 line is unavailable, configure a lower cost for the T1 line and a higher cost for the dial-up network connection. Active Directory always chooses the connection on a per-cost basis, so the cheaper connection will be used as long as it is available.</p>

<p><li> <b>To configure site link cost</b></li></p>

<ol>

<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p><li> Open the Inter-Site Transports folder and either the IP or SMTP folder, and right-click on the site link for which you want to configure site link cost. Click Properties.</li></p>

<p><li> On the Properties dialog box for the site link, shown in Figure 6.5, enter a value for the cost of replication in the Cost box. The default cost is 100; the lower the value, the higher the priority. For example, the cost of a T1 link might be 100, while the cost of a dial-up link might be 120.</li></p>

<p>
<A HREF="javascript:fullSize('06wtk05x.htm')"> <img src="images/06wtk05.JPG" width=404 height=480 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 6.5</b> <i>Properties dialog box for a site link</i><!-- /caption -->
</p>


<p><li> Click OK.</li></p>
</ol>

<A NAME="270"><h3>Replication Frequency</h3></A>
<p>Configure site link replication frequency for site links by providing an integer value that tells Active Directory how many minutes it should wait before using a connection to check for replication updates. The replication interval must be at least 15 and no more than 10,080 minutes (equal to one week). A site link must be available for any replication to occur, so if a site link is scheduled as unavailable when the number of minutes between replication updates has passed, no  replication will occur.</p>

<p><li> <b>To configure site link replication frequency</b></li></p>

<ol>

<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p><li> Open the Inter-Site Transports folder and either the IP or SMTP folder, and right-click on the site link for which you want to configure site replication frequency. Click Properties.</li></p>

<p><li> On the Properties dialog box for the site link, enter the number of minutes between replications in the Replicate Every box. The default time is 180; the value is processed as the nearest multiple of 15, ranging from a minimum of 15 to a maximum of 10,080 minutes (one week).</li></p>

<p><li> Click OK.</li></p>
</ol>

<A NAME="271"><h3>Replication Availability</h3></A>
<p>Configure site link replication availability to determine when a site link will be available for replication. Because SMTP is asynchronous, it typically ignores all schedules. Therefore, do not configure site link replication availability on SMTP site links unless</p>

<ul>
<p><li> The site links use scheduled connections</li></p>

<p><li> The SMTP queue is not on a schedule</li></p>

<p><li> Information is being exchanged directly from one server to another, and not through intermediaries, as is the case, for example, on a network backbone</li></p>
</ul>

<p><li><b> To configure site link replication availability</b></li></p>

<ol>

<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p><li> Open the Inter-Site Transports folder and either the IP or SMTP folder, and right-click on the site link for which you want to configure site link replication availability. Click Properties.</li></p>

<p><li> In the Properties dialog box for the site link, click Change Schedule.</li></p>

<p><li> On the Schedule For dialog box for the site link, shown in Figure 6.6, select the block of time when this connection is or is not available to replicate directory information, then click OK.</li></p>

<p><li> In the Properties dialog box for the site link, click OK.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
This procedure will have no effect if you have enabled Ignore Schedules on the Properties dialog box for the inter-site transport.</blockquote></div>
</p>
<ol>
<p>
<A HREF="javascript:fullSize('06wtk06x.htm')"> <img src="images/06wtk06.JPG" width=404 height=246 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 6.6</b> <i>Schedule for dialog box for a site link</i><!-- /caption -->
</p>
</ol>

<p><li> <b>To ignore schedules for an inter-site transport</b></li></p>

<ol>

<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p><li> Open the Inter-Site Transports folder and right-click either the IP or SMTP folder, then click Properties.</li></p>

<p><li> In the IP or SMTP Properties dialog box, on the General tab, click the Ignore Schedules check box.</li></p>

<p><li> Click OK.</li></p>
</ol>

<A NAME="272"><h2>Site Link Bridges</h2></A>
<p>When more than two sites are linked for replication and use the same transport, by default, all of the site links are &quot;bridged&quot; in terms of cost, assuming the site links have common sites. When site links are bridged, they are <i>transitive</i>. That is, all site links for a specific transport implicitly belong to a single site link bridge for that transport. So in the common case of a fully routed IP network (all sites can communicate with each other via IP), you do not have to configure any site link bridges. If your IP network is not fully routed, you can turn off the transitive site link feature for the IP transport, in which case all IP site links are considered intransitive and you configure site link bridges. A site link bridge is the equivalent of a disjoint network; all site links within the bridge can route transitively, but they do not route outside of the bridge.</p>

<p><li> <b>To create a site link bridge</b></li></p>

<ol>

<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p><li> Open the Inter-Site Transports folder and right-click either the IP or SMTP folder, and then click New Site Link Bridge.</li></p>

<p><li> In the New Object-Site Link Bridge dialog box, shown in Figure 6.7, type a name for the site link bridge in the Name box.</li></p>

<p>
<A HREF="javascript:fullSize('06wtk07x.htm')"> <img src="images/06wtk07.JPG" width=404 height=385 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 6.7</b> <i> New Object-Site Link Bridge dialog box</i><!-- /caption -->
</p>


<p><li> Click two or more sites to connect, then click Add.</li></p>

<p><li> Click OK.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
This procedure is redundant and will have no effect if you have enabled Bridge All Site Links on the Properties dialog box for the inter-site transport.</blockquote></div>
</p>

<p><li> <b>To bridge all site links for an inter-site transport</b></li></p>

<ol>

<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p><li> Open the Inter-Site Transports folder and right-click either the IP or SMTP folder, then click Properties.</li></p>

<p><li> In the IP or SMTP Properties dialog box, on the General tab, click the Bridge All Site Links check box.</li></p>

<p><li> Click OK.</li></p>
</ol>

<A NAME="273"><h2>Manually Configuring Connections</h2></A>
<p>Active Directory automatically creates and deletes connections under normal conditions. Although you can manually add or configure connections or force replication over a particular connection, normally you should allow replication to be automatically optimized based on information you provide to Active Directory Sites and Services about your deployment. Only create connections manually if you are certain the connection is required, and you want the connection to persist until manually removed.</p>

<p><li> <b>To manually configure connections</b></li></p>

<ol>

<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p><li> Double-click the site that contains the domain controller for which you want to manually add or configure a connection.</li></p>

<p><li> Open the Servers folder, open the domain controller, right-click NTDS Settings, and then click New Active Directory Connection.</li></p>

<p><li> In the Find Domain Controllers dialog box, click the domain controller that you want to include in the connection object and click OK.</li></p>

<p><li> In the New Object-Connection dialog box, enter a name for the new Connection object in the Name field and click OK.</li></p>
</ol>

<p><li><b>To force replication over a connection</b></li></p>

<ol>
<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p><li> Double-click the site that contains the connection over which you want to replicate directory information.</li></p>

<p><li> Open the Servers folder, select the domain controller, then open NTDS Settings.</li></p>

<p><li> Right-click the connection over which you want to replicate directory information, and click Replicate Now (see Figure 6.8).</li></p>

<p>
<A HREF="javascript:fullSize('06wtk08x.htm')"> <img src="images/06wtk08.JPG" width=404 height=244 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 6.8</b> <i>Forcing replication over a connection</i><!-- /caption -->
</p>

</ol>

<A NAME="274"><h2>Designating a Preferred Bridgehead Server</h2></A>
<p>Ordinarily, all domain controllers are used to exchange information between sites, but you can further control replication behavior by specifying a bridgehead server for inter-site replicated information. Establishing a bridgehead server provides some ranking or criteria for choosing which domain controller should be preferred as the recipient for inter-site replication. This bridgehead server then subsequently distributes the directory information via intra-site replication.</p>

<p>Bridgehead servers are the contact point for exchange of directory information between sites. You can specify a preferred bridgehead server if you have a computer with appropriate bandwidth to transmit and receive information. If there's typically a high level of directory information exchange, a computer with more bandwidth can ensure these exchanges are handled promptly. Matching the demands of your Active Directory deployment with a domain controller having the capacity to handle those demands will enable efficient updates of directory information.</p>

<p>You can specify multiple preferred bridgehead servers, but only one will be the active preferred bridgehead server at any time at a single site. If the active preferred bridgehead server fails, Active Directory will select another preferred bridgehead server to be the active preferred bridgehead server from the set you designate. If no active preferred bridgehead server is available and there are no other preferred bridgehead servers available for Active Directory to select, it will select another domain controller in the site to be the preferred bridgehead server. This can be a problem if the domain controller Active Directory selects does not have the bandwidth to efficiently handle the increased requirements posed by being a preferred bridgehead server.</p>

<p>You must specify a preferred bridgehead server if your deployment uses a firewall to protect a site. Establish your firewall proxy server as the preferred bridgehead server, making it the contact point for exchanging information with servers outside the firewall. If you do not do this, directory information may not be successfully exchanged.</p>

<p>Establishing a preferred bridgehead server designates that server as the preeminent server for information exchange over the protocol for which the site link is established. Other domain controllers could still exchange directory information if a need arises, but under normal conditions, the bridgehead server will be used as the first choice to receive and send all directory traffic.</p>

<p><li> <b>To designate a preferred bridgehead server</b></li></p>

<ol>

<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p><li> In the AD Sites and Services console tree, right-click the domain controller that you want to make a bridgehead server, then click Properties.</li></p>

<p><li> On the Properties dialog box for the domain controller, in the Transports Available For Inter-Site Data Transfer box, click the inter-site transport or transports for which this computer will be a preferred bridgehead server, then click Add.</li></p>

<p><li> Click OK.</li></p>
</ol>

<p><img src="images/practic.JPG" width=92 height=74 border="0"></p>

<A NAME="275"><h2>Practice: Configuring Inter-Site Replication</h2></A>
<p>In this practice you configure site link cost, replication availability, and replication frequency. Then you configure a site link bridge.</p>

<p><li><b> To configure site link cost</b></li></p>

<ol>

<p><li> Click Start, point to Programs, point to Administrative Tools, then click Active Directory Sites And Services.</li></p>

<p>The Active Directory Sites and Services console appears.</p>

<p><li> Open the Inter-Site Transports folder and the IP folder, and right-click the Redmond To Chicago site link you configured in the previous lesson. Click Properties.</li></p>

<p>The Redmond To Chicago Properties dialog box appears.</p>

<p><li> In the Cost box, type <b>20</b> for the cost of replication.</li></p>
</ol>

<p><li><b>To configure site link replication frequency</b></li></p>

<ol>
<p><li> In the Replicate Every box, type <b>120</b> for the number of minutes between replications.</li></p>
</ol>

<p><li><b>To configure site link replication availability</b></li></p>

<ol>
<p><li> Click Change Schedule.</li></p>

<p>The Schedule For Redmond To Chicago dialog box appears.</p>

<p><li> Make the connection available at all times except Monday through Friday from 8 AM to 9 AM and from 4 PM to 5 PM, then click OK.</li></p>

<p><li> On the Redmond To Chicago Properties dialog box, click OK.</li></p>
</ol>

<p><li><b>To create a site link bridge</b></li></p>

<ol>
<p><li> Open the Inter-Site Transports folder, right-click the IP folder, then click New Site Link Bridge.</li></p>

<p>The New Object-Site Link Bridge dialog box appears.</p>

<p><li> In the Name box, type <b>Redmond to Chicago Bridge</b>.</li></p>

<p><li> Ensure that the DEFAULTIPSITELINK and Redmond to Chicago site links are in the Site Links In This Site Link Bridge box, then click OK.</li></p>
</ol>

<A NAME="276"><h2>Lesson Summary</h2></A>
<p>In this lesson you learned that you should provide site link cost, replication frequency, and replication availability information for all site links as part of the process of configuring inter-site replication. Active Directory always chooses the connection on a per-cost basis so the cheaper connection will be used as long as it is available. You can improve site link connectivity by linking overlapping existing site links together into site link bridges, or you can bridge all site links and maximize connectivity. You also learned that you can designate a domain controller as a bridgehead server to specify which domain controller should be preferred as the recipient for inter-site replication.</p>

<p>In the practice portion of this lesson you configured site link cost, replication availability, and replication frequency. Then you configured a site link bridge.</p>

</BODY>
</HTML>







