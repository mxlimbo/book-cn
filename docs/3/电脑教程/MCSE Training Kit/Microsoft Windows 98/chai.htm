<HTML>
<HEAD>
<LINK REL=StyleSheet HREF="basicIE4.css" TYPE="text/css">
<TITLE>Appendix I -- Understanding PPTP</TITLE>
<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>


<FONT SIZE="+3">Appendix I</FONT>
<P>
<H1>Understanding PPTP</H1>
<P>
This appendix provides an overview of Point-to-Point Tunneling Protocol (PPTP). PPTP is a network protocol that enables the secure transfer of data from a remote client to a private enterprise server by creating a virtual private network (VPN) across TCP/IP-based data networks. PPTP supports on-demand, multi-protocol, virtual private networking over public networks, such as the Internet. <P>
The networking technology of PPTP is an extension of the remote access Point-to-Point protocol defined in the document referred to as RFC 1171 by the Internet Engineering Task Force (IETF) titled &quot;The Point-to-Point Protocol for the Transmission of Multi-Protocol Datagrams over Point-to-Point Links.&quot; PPTP is a network protocol that encapsulates PPP packets into IP datagrams for transmission over the Internet or other public TCP/IP-based networks. PPTP can also be used in private LAN-to-LAN networking.<P>
<H1>PPTP and Virtual Private Networking</H1>
<P>The PPTP protocol is included with the Windows&#160;NT Server version 4.0, Windows&#160;NT Workstation version 4.0, and Windows&#160;98 operating systems. Computers running these operating systems can use the PPTP protocol to securely connect to a private network as a remote access client by using a public data network such as the Internet. In other words, PPTP enables on-demand, virtual private networks over the Internet or other public TCP/IP-based data networks. PPTP can also be used by computers connected to a LAN to create a virtual private network across the LAN. <P>
An important feature in the use of PPTP is its support for virtual private networking through public-switched telephone networks (PSTNs). PPTP simplifies and reduces the cost of deploying an enterprise-wide, remote access solution for remote or mobile users because it provides secure and encrypted communications over public telephone lines and the Internet. PPTP eliminates the need for expensive, leased-line or private enterprise-dedicated communication servers because you can use PPTP over PSTN lines. <P>
Generally, there are three computers involved in every PPTP deployment:<P>
<UL>
<LI>A PPTP client <P>
<LI>A network access server <P>
<LI>A PPTP server<P>
</UL>
<P>
However, if you are creating a PPTP tunnel between a PPTP client and a PPTP server that are both connected to the same LAN, you do not need a network access server.<P>
The following section describes a typical PPTP scenario using these computers and explains how they relate to each other, it also fully defines each of these components.<P>
<H2>Typical PPTP Scenario</H2>
<P>A typical deployment of PPTP starts with a remote or mobile PPTP client that uses a local Internet Service Provider (ISP) to access a private enterprise LAN. This PPTP client can be running either Windows&#160;NT Server version 4.0, Windows&#160;NT Workstation version 4.0, or Windows&#160;98 operating systems. <P>
A PPTP client must make two connections to establish a PPTP tunnel. Figure I.1 shows these connections. The client first uses Dial-Up Networking and the remote access protocol, PPP, to connect to a network access server (NAS) at an ISP facility. Once connected, the client can send and receive packets over the Internet. The network access server uses the TCP/IP protocol for all traffic to the Internet.<P>

<HR><BLOCKQUOTE>
<B>Note</B><P>
Network access servers are also referred to as front-end processors (FEPs), dial-in servers or point-of-presence (POP) servers.
</BLOCKQUOTE><HR>
<P>
The client then uses Dial-Up Networking to make a second logical connection over the existing PPP connection. Data sent using this second connection is in the form of IP datagrams that contain PPP packets, referred to as <I>encapsulated PPP packets</I>.<P>
The second connection creates the virtual private networking (VPN) connection to a PPTP server<I> </I>on the private enterprise LAN (a computer running Windows&#160;NT Server version 4.0 and configured as a PPTP server). This connection is referred to as a <I>tunnel</I>.
<P>
<A HREF="javascript:fullSize('FIXX01x.htm')"> <IMG SRC="FIXX01.JPG" WIDTH=360 HEIGHT=120 BORDER=0 ALT = "Click to view at full size."> </A>
<P>

<caption>
<B>Figure I.1</B> <I>Creating a PPTP tunnel</I>
</caption>
<P>
<I>Tunneling </I>is the process of sending packets to a computer on a private network by routing them over some other network, such as the Internet (see Figure I.1). The other network's routers cannot access computers on the private network. However, tunneling enables the routing network to transmit the packet to an <I>intermediary</I> <I>computer</I>, a PPTP server that is connected to both the routing network and the private network. Both the PPTP client and the PPTP server use tunneling to securely route packets to a computer on the private network by using routers that only know the address of the private network intermediary server.<P>
When the PPTP server receives the packet from the routing network, it sends it across the private network to the destination computer. The PPTP server does this by processing the PPTP packet to obtain the private network computer name or address information in the encapsulated PPP packet. Note that the encapsulated PPP packet can contain multi-protocol data such as IP, IPX, or NetBEUI protocols. Because the PPTP server is configured to communicate across the private network by using private network protocols, it is able to read multi-protocol packets. <P>
Figure I.2 illustrates the multi-protocol support built into PPTP. A packet sent from the PPTP client to the PPTP server passes through the PPTP tunnel to a destination computer on the private network. 
<P>
<A HREF="javascript:fullSize('FIXX02x.htm')"> <IMG SRC="FIXX02.JPG" WIDTH=360 HEIGHT=115 BORDER=0 ALT = "Click to view at full size."> </A>
<P>



<caption>
<B>Figure I.2</B> <I>Connecting a Dial-Up Networking PPTP client to the private network</I>
</caption>
<P>PPTP encapsulates the encrypted and compressed PPP packets into IP datagrams for transmission over the Internet. The IP datagrams are created using a modified version of the Internet Generic Routing Encapsulation (GRE) protocol. (GRE is defined in RFCs 1701 and 1702). These IP datagrams are routed over the Internet until they reach the PPTP server that is connected to both the Internet and the private network. The PPTP server disassembles the IP datagram into a PPP packet and then decrypts the PPP packet using the network protocol of the private network. As mentioned earlier, the network protocols on the private network that are supported by PPTP are IPX, NetBEUI, and TCP/IP.<P>
<H2>PPTP Clients</H2>
A computer, such as a Microsoft client, that supports the PPTP network protocol can connect to a PPTP server in two ways:<P>
<UL>
<LI>By establishing a dial-up IP connection to an ISP's network access server <P>
<LI>By an IP-enabled LAN connection<P>
</UL>

PPTP clients that use an ISP's network access server must be configured with a modem, a PPTP driver, and a VPN device to make the separate connections to the ISP and the PPTP server. The first connection is a dial-up connection using the PPP protocol over the modem to an Internet Service Provider. The second connection is a VPN connection using PPTP, over the modem and the ISP connection, to tunnel across the Internet to a VPN device on the PPTP server. The second connection requires the first connection because the tunnel between the VPN devices is established by using the modem and PPP connection to the Internet.<P>
<P>
In contrast to PPTP clients that use an ISP's network access server, clients that use an IP-enabled LAN connection need only be configured with a PPTP driver and a VPN device. Because they are already connected to the LAN, they only need to make one connection: they must use a VPN device to create a connection to a PPTP server on a LAN.<P>

<H2>PPTP-enabled Network Access Servers at an ISP</H2>
The previous section describes how a PPTP-enabled dial-up client establishes a PPTP tunnel with a PPTP server. Dial-up clients that are not PPTP-enabled can also take advantage of PPTP by connecting to a PPTP-enabled network access server. The network access server then establishes the PPTP connection to a PPTP server.<P>
In this scenario, the dial-up client can be a Windows&#160;98-based, Windows&#160;NT-based, Apple Macintosh, or UNIX client. The architecture is fundamentally the same; however, all PPTP communication occurs between the network access server and the PPTP server.<P>
PPTP-enabled ISP network access servers are designed and built to accommodate a high number of dial-in clients. Such network access servers are built by companies such as 3Com, Ascend Communications, ECI Telematics, and U.S. Robotics, all members of the PPTP Forum. <P>
Contact your ISP to see if they provide a PPTP service and how you need to configure PPP and Dial-Up Networking to access the ISP server that supports PPTP. <P>
<H2>PPTP Servers on the Private LAN</H2>
<P>PPTP servers are servers with routing capabilities that are connected to a private network and to the Internet. In this document, a PPTP server is defined as a computer running Windows&#160;NT Server version 4.0 and RAS. PPTP is installed as a network protocol. During installation, PPTP is configured by adding virtual devices referred to as <I>virtual private networks</I> (VPNs) to RAS and Dial-Up Networking configurations. <P>
<H1>PPTP Architecture</H1>
<P>This section provides information about the architecture of PPTP under Windows&#160;NT Server version 4.0, Windows&#160;NT Workstation version 4.0, or Windows&#160;98. PPTP is designed to provide a secure method for reaching private networks over the Internet. <P>
This section describes:<P>
<UL>
<LI>The PPP protocol<P>
<LI>PPTP control connection<P>
<LI>PPTP data tunneling<P>
<LI><P>
</UL>
<H2>PPTP Architecture Overview</H2>
The secure communication created using the PPTP protocol typically involves three processes, each of which requires successful completion of the previous process. This document explains these three processes and how they work:<P>
<UL>
<LI>PPP Connection and Communication<P>
A PPTP client uses PPP to connect to an ISP by using a standard telephone line or ISDN line. This connection uses the PPP protocol to establish the connection and encrypt data packets.<P>
<LI>PPTP Control Connection<P>
Using the connection to the Internet established by the PPP protocol, the PPTP protocol creates a control connection from the PPTP client to a PPTP server on the Internet. This connection uses TCP to establish the connection and is called a PPTP <I>tunnel</I>.<P>
<LI>PPTP Data Tunneling<P>
Finally, the PPTP protocol creates IP datagrams containing encrypted PPP packets which are then sent through the PPTP tunnel to the PPTP server. The PPTP server disassembles the IP datagrams and decrypts the PPP packets, and then routes the decrypted packets to the private network.<P>
</UL>

<H2>PPP Protocol</H2>
<P>PPP is a remote access protocol used by PPTP to send multi-protocol data across TCP/IP-based networks. PPP encapsulates IP, IPX, and NetBEUI packets between PPP frames and sends the encapsulated packets by creating a point-to-point link between the sending and receiving computers. <P>
Most PPTP sessions are started by a client dialing up an ISP network access server. The PPP protocol is used to create the dial-up connection between the client and network access server and performs the following three functions:<P>

<UL>
<LI>Establishes, maintains, and ends the physical connection.<P>
The PPP protocol uses a sequence defined in RFC 1661 to establish, maintain, and end connections between remote computers. <P>
<LI>Authenticates users.<B><I> </I></B>PPTP clients are authenticated by using the PPP protocol.<P>
PPTP clients are authenticated by using the PPP protocol. Clear text, encrypted, or Microsoft encrypted authentication can be used by the PPP protocol. <P>
<LI>Creates PPP datagrams that contain encrypted IPX, NetBEUI, or IP packets. <P>
PPP creates datagrams which contain one or more encrypted IP, IPX, or NetBEUI data packets. Because the network packets are encrypted, all traffic between a PPP client and a network access server is secure.<P>
</UL>
This entire process is illustrated in Figure I.3:<P>
<P>
<A HREF="javascript:fullSize('FIXX03x.htm')"> <IMG SRC="fixx03.jpg" WIDTH=360 HEIGHT=392 BORDER="0" ALT = "Click to view at full size."> </A>
<P>
<caption>
<B>Figure I.3</B> <I>Creating a Dial-Up Networking PPP connection to an ISP</I>
</caption>

<H2>PPTP Control Connection</H2>
<P>The PPTP protocol specifies a series of control messages sent between the PPTP-enabled client and the PPTP server. The control messages establish, maintain, and end the PPTP tunnel. The following list presents the primary control messages used to establish and maintain the PPTP tunnel.<P>
<TABLE WIDTH="95%" BORDER="0" CELLPADDING="5">
<!-- Table 01 Row 01 -->
<TR>
<TD VALIGN="TOP"><B>Message Type</B></TD>
<TD VALIGN="TOP"><B>Purpose</B></TD>
</TR>
<!-- Table 01 Row 02 -->
<TR>
<TD VALIGN="TOP">PPTP_START_SESSION_REQUEST</TD>
<TD VALIGN="TOP">Starts session</TD>
</TR>
<!-- Table 01 Row 03 -->
<TR>
<TD VALIGN="TOP">PPTP_START_SESSION_REPLY</TD>
<TD VALIGN="TOP">Replies to start session request</TD>
</TR>
<!-- Table 01 Row 04 -->
<TR>
<TD VALIGN="TOP">PPTP_ECHO_REQUEST</TD>
<TD VALIGN="TOP">Maintains session</TD>
</TR>
<!-- Table 01 Row 05 -->
<TR>
<TD VALIGN="TOP">PPTP_ECHO_REPLY</TD>
<TD VALIGN="TOP">Replies to maintain session request</TD>
</TR>
<!-- Table 01 Row 06 -->
<TR>
<TD VALIGN="TOP">PPTP_WAN_ERROR_NOTIFY</TD>
<TD VALIGN="TOP">Reports an error on the PPP connection</TD>
</TR>
<!-- Table 01 Row 07 -->
<TR>
<TD VALIGN="TOP">PPTP_SET_LINK_INFO</TD>
<TD VALIGN="TOP">Configures the connection between client and PPTP server</TD>
</TR>
<!-- Table 01 Row 08 -->
<TR>
<TD VALIGN="TOP">PPTP_STOP_SESSION_REQUEST</TD>
<TD VALIGN="TOP">Ends session</TD>
</TR>
<!-- Table 01 Row 09 -->
<TR>
<TD VALIGN="TOP">PPTP_STOP_SESSION_REPLY</TD>
<TD VALIGN="TOP">Replies to end session request</TD>
</TR>
</TABLE>
<P>
Control messages are transmitted in control packets in a TCP datagram. One TCP connection is created between the PPTP client and the PPTP server. This connection is used to exchange control messages. A datagram contains an IP header, a TCP header, a PPTP control message, and appropriate trailers, similar to Figure I.4:

<P>
<A HREF="javascript:fullSize('FIXX04x.htm')"> <IMG SRC="fixx04.jpg" WIDTH=360 HEIGHT=153 BORDER="0" ALT = "Click to view at full size."> </A>
<P>
<caption>
<B>Figure I.4</B> <I>TCP datagram with PPTP control messages</I>
</caption>
<P>The exchange of messages between the PPTP client and the PPTP server over the TCP connection are used to create and maintain a PPTP tunnel. This entire process is illustrated in Figure I.5:<P>
<P>
<A HREF="javascript:fullSize('FIXX05x.htm')"> <IMG SRC="fixx05.jpg" WIDTH=360 HEIGHT=153 BORDER="0" ALT = "Click to view at full size."> </A>
<P>
<caption>
<B>Figure I.5</B> <I>Control connection to PPTP server over PPP connection to ISP</I>
</caption>
<P>Note that in this illustration, the control connection is for the scenario in which the remote access client is the PPTP client. In the scenario in which the remote access client is not PPTP-enabled and uses a PPTP-enabled ISP network access server, the PPTP control connection begins at the ISP server. <P>
<H2>PPTP Data Transmission</H2>
<P>After the PPTP tunnel has been established, user data is transmitted between the client and PPTP server. Data is transmitted in IP datagrams containing PPP packets. The IP datagrams are created using a modified version of the Internet GRE protocol. The IP datagram created by PPTP is similar to Figure I.6.<P>
<P>
<A HREF="javascript:fullSize('FIXX06x.htm')"> <IMG SRC="FIXX06.jpg" WIDTH=360 HEIGHT=225 BORDER=0 ALT = "Click to view at full size."> </A>
<P>
<caption>
<B>Figure I.6</B> <I>IP datagram containing encrypted PPP packet</I>
</caption>
<P>The IP delivery header provides the information necessary for the datagram to traverse the Internet. The GRE header is used to encapsulate the PPP packet within the IP datagram. The PPP packet was created by RAS. Note that the PPP packet is just an unintelligible block because it is encrypted. Even if the IP datagram were intercepted, it would be nearly impossible to decrypt the data. <P>

<H1>Understanding PPTP Security</H1>
<P>PPTP extends the strict authentication and encryption security available to computers running RAS under Windows&#160;NT Server version 4.0, Windows&#160;NT Workstation version 4.0, or Windows&#160;98 to PPTP clients on the Internet. PPTP also can protect the PPTP server and private network by ignoring all but PPTP traffic. Despite the strict security, it is very simple to use PPTP with existing firewalls. This section will help you understand and plan the following:<P>
<UL>
<LI>Authentication<P>
<LI>Access control<P>
<LI>Data encryption<P>
<LI>PPTP packet filtering<P>
<LI>Using third-party firewalls<P>
<LI><P>
</UL>
<H2>Authentication</H2>
<P>Initial dial-in authentication may be required by an ISP network access server. If this authentication is required, it is strictly to log on to the ISP network access server; it is not related to Windows&#160;NT-based authentication. Check with your ISP for their authentication requirements. You apply these requirements in the Dial-Up Networking configuration for that ISP.<P>
On the other hand, the PPTP tunnel server controls all access to your private network. That is, the PPTP server is a gateway to your private network. The PPTP server requires a standard Windows&#160;NT-based logon. All PPTP clients must supply a user name and password. Therefore, remote access logon using a computer running Windows&#160;NT Server version 4.0, Windows&#160;NT Workstation version 4.0, or Windows&#160;98 is as secure as logging on from a Windows-based computer connected to the local LAN.<P>
Authentication of remote PPTP clients is done by using the same PPP authentication methods used for any RAS client dialing directly to a RAS server. Microsoft's implementation of RAS supports the Challenge Handshake Authentication Protocol (CHAP), the Microsoft Challenge Handshake Authentication Protocol (MS-CHAP), and the Password Authentication Protocol (PAP) authentication schemes.<P>

<HR><BLOCKQUOTE>
<B>Note</B><P>
MS-CHAP authentication supports the MD4 hash as well as the earlier authentication scheme used in Microsoft LAN Manager.
</BLOCKQUOTE><HR>

<P>As with all user accounts, the user accounts of remote users reside in the Windows&#160;NT Server version 4.0 directory and are administered through User Manager for Domains. This provides centralized administration that is integrated with the private network's existing user accounts. Only accounts that have been granted specific access to the network through a trusted domain are permitted. Careful management of user accounts is necessary to reduce security risks.<P>
Having a secure password model in place is critical to successful deployment of PPTP because Internet connections are more susceptible to speed or &quot;demon dialer&quot; programs, which can literally crunch through thousands of password and username combinations. <P>
The only way to minimize this type of attack is to implement secure password policies. Passwords should be difficult to guess. For example, you can require that passwords contain uppercase letters, lowercase letters, numbers, and special characters. It is recommended that you require at least three different types of characters to ensure password uniqueness.<P>
<H2>Access Control</H2>
<P>After authentication, all access to a private LAN continues to use the Windows&#160;NT-based security model. Access to resources on NTFS drives, or to other network resources requires the proper permissions. It is recommended that the NTFS file system be used for file resources that are accessed by PPTP clients.<P>
<P>For more information about using security on NTFS drives or other network resources, see your product documentation or the Windows&#160;NT Workstation version 4.0, Windows&#160;NT Server version 4.0, or Windows&#160;98 Resource Kits.<P>
<H2>Data Encryption</H2>
<P>For data encryption, PPTP uses the Remote Access Server (RAS) &quot;shared-secret&quot; encryption process. It is referred to as a shared-secret encryption process because both ends of the connection share the encryption key. Under the Microsoft implementation of RAS, the shared secret is the user password. (Other encryption methods base the encryption on some key available in public; this second method of encryption is known as <I>public key encryption</I>.)<P>
PPTP uses the PPP encryption and PPP compression schemes. The Compression Control Protocol (CCP) used by PPP is used to negotiate encryption. <P>
The user name and password of the PPTP client is available to the PPTP server and supplied by the PPTP client. An encryption key is derived from the hashed password stored on both the client and server. The RSA RC4 standard is used to create this 40-bit session key based on the client password. This key is used to encrypt all data that is passed over the Internet, keeping the remote connection private and secure. <P>
The data in PPP packets is encrypted. The PPP packet containing a block of encrypted data is then encapsulated into a larger IP datagram for routing over the Internet to the PPTP server. If an Internet hacker intercepted your IP datagram, he or she would find only media headers, IP headers, and then the PPP packet containing a block of encrypted data. It would be indecipherable. <P>

<HR><BLOCKQUOTE>
<B>Note</B><P>
Users in the United States and Canada can obtain a 128-bit session key through a cryptography pack for use inside the U.S. Contact your Microsoft reseller for more information.
</BLOCKQUOTE><HR>

<H2>PPTP Packet Filtering</H2>
<P>Network security from malicious activity can be enhanced by enabling PPTP filtering on the PPTP server. When PPTP filtering is enabled, the PPTP server on the private network accepts and routes only PPTP packets from authenticated users. This prevents <I>all</I> other packets from entering the PPTP server and private network. In conjunction with PPP encryption, this ensures that only authorized encrypted data enters or leaves the private LAN.<P>
PPTP filtering is enabled on the PPTP server using the Protocols tab in the Network option of Control Panel in Windows&#160;NT Server. For step-by-step instruction on enabling PPTP filtering, see the white paper titled &quot;Installing, Configuring, and Using PPTP with Microsoft Clients and Servers&quot; which is available from <A HREF="http://www.microsoft.com/ntserver/basics/techpapers/default.asp"  TARGET="_blank">http://www.microsoft.com/ntserver/basics/techpapers/default.asp</A>.<P>
<H2>Using PPTP with Firewalls and Routers</H2>
<P>PPTP traffic uses TCP port 1723, and IP protocol uses ID 47, as assigned by the Internet Assigned Numbers Authority (IANA). PPTP can be used with most firewalls and routers by enabling traffic destined for TCP port 1723 and protocol 47 to be routed through the firewall or router.<P>
Firewalls ensure corporate network security by strictly regulating data that comes into<I> </I>the private network from the Internet. An organization can deploy a PPTP server running Windows&#160;NT Server version 4.0 behind its firewall. The PPTP server accepts PPTP packets passed to the private network from the firewall and extracts the PPP packet from the IP datagram, decrypts the packet, and forwards the packet to the computer on the private network. <P>

<HR><BLOCKQUOTE>
<B>Note</B><P>
For information about how to install, configure, and use PPTP on computers running Windows&#160;NT Server version 4.0, and Windows&#160;NT Workstation version 4.0, refer to Appendix J, &quot;Virtual Private Networking.&quot;
</BLOCKQUOTE><HR>

</BODY>
</HTML>