<HTML>
<HEAD>
   <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=gb2312">
   <META NAME="Author" CONTENT="FuGui">
   <META NAME="GENERATOR" CONTENT="Mozilla/4.04 [en] (Win95; I) [Netscape]">
   <TITLE>COM/DCOM如何传递数组</TITLE>
</HEAD>
<BODY>
COM/DCOM中如何传递数组:

<P>&nbsp;&nbsp;&nbsp; 因为COM/DCOM对象都不在Client程序运行的内存空间(内进程COM对象除外，即便如此，为了统一接口，内进程的COM也不得传递指针),而且在Win32中所有的程序都有自己独立的2GB的内存空间,程序与程序之间传递指针(内存地址)是毫无意义的，而数组、字符串等大量的数据在程序中都是分配一定的内存空间，然后用指针加内存偏移量来存取数据的，这时，如何在COM/DCOM对象中如何传递呢？
<BR>&nbsp;&nbsp;&nbsp; 在Win32中引入了一新变量Variant，可以通过Variant传递数组。具体的实现方法，用Delphi实现为：

<P>&nbsp;&nbsp;&nbsp; Server(COM/DCOM程序)端：
<BR>&nbsp;&nbsp;&nbsp; procedure TTestDCOM.Send4(Size: Integer; D1: OleVariant);
<BR>&nbsp;&nbsp;&nbsp; type
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; TData=array [0..999]
of Byte;
<BR>&nbsp;&nbsp;&nbsp; Var
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Data:TData;
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i:Integer;
<BR>&nbsp;&nbsp;&nbsp; begin
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; for i:=0 to Size-1
do begin
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
Data[i]:=D1[i];
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; end;
<BR>&nbsp;&nbsp;&nbsp; end;

<P>&nbsp;
<BR>&nbsp; Cleint端:

<P>&nbsp;&nbsp;&nbsp; Var
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D1:OleVariant;
<BR>&nbsp;&nbsp;&nbsp; begin
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D1:=VarArrayCreate([0,99],varByte);

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; {
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D1[1]:=45;
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; ....&nbsp;
//将值存入D1中

<P>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }
<BR>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; S.Send4(99,D1);&nbsp; //S是TestDCOM对象
<BR>&nbsp;&nbsp;&nbsp; end;
<BR>&nbsp;
<BR>&nbsp;
<BR>&nbsp;

<P>Copyright(C)<A HREF="mailto:fgui@usa.net">傅贵</A>，最后修改日期：1998.1.16
</BODY>
</HTML>
