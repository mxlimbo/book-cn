<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>Delphi 4增的Object Pascal</title>
</head>

<body bgcolor="#FFFFFF" text="#000000">
<font FACE="Arial" SIZE="6">

<p ALIGN="CENTER">Delphi 4</font><font SIZE="6">增的</font><font FACE="Arial"
SIZE="6">Object Pascal</font><font FACE="Times New Roman" SIZE="1"></p>

<p ALIGN="JUSTIFY"></font><font SIZE="1">　</font><font face="宋体" size="4">本附在於f明Delphi 
4新增的Object Pascal程式Z言。Y碚f，Delphi 4的Object Pascal增了以下状蟛糠郑</font></p>

<blockquote>
  <p ALIGN="JUSTIFY"><font face="宋体" size="4">新增加捣N榷ㄙY料型B。</font></p>
  <p ALIGN="JUSTIFY"><font face="宋体" size="4">Dynamic Arrays</font></p>
  <p ALIGN="JUSTIFY"><font face="宋体" size="4">Method and Routine Overloading</font></p>
  <p ALIGN="JUSTIFY"><font face="宋体" size="4">Default Parameters.</font></p>
  <p ALIGN="JUSTIFY"><font face="宋体" size="4">Implementating interfaces by delegation，可用以下的法：</font></p>
</blockquote>

<p><font face="宋体" size="4">　</font></p>

<p><font face="宋体" size="4">property MyInterface: IMyInterface read FMyInterface <br>
implements IMyInterface;</font></p>

<p><font face="宋体" size="4">新增的榷ㄙY料型B</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">整捣矫妫</font></p>

<blockquote>
  <p ALIGN="JUSTIFY"><font face="宋体" size="4">新增加<i>Int64</i>@NL度六十四位元，-2^63 
  to 2^63 - 1。</font></p>
  <p ALIGN="JUSTIFY"><font face="宋体" size="4">32-bit unsigned integer新增加<i>Longword</i>型B，0..4294967295。</font></p>
  <i><p ALIGN="JUSTIFY"><font face="宋体" size="4">Cardinal</i>的{整成c上述<i>Longword</i>型B相同。</font></p>
</blockquote>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">浮c捣矫妫</font></p>

<blockquote>
  <i><p ALIGN="JUSTIFY"><font face="宋体" size="4">Real</i>型B基於效率考量，由^去子48-bit{整成64-bits，</font></p>
  <p ALIGN="JUSTIFY"><font face="宋体" size="4">新增加<i>Real48</i>型B，精_度c^去的<i>Real</i>相同，仍是48-bit。</font></p>
</blockquote>

<p><font face="宋体" size="4">　</font></p>

<p><font face="宋体" size="4">Dynamic Array</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">Delphi 4世之前，Delphi程式O若需要BL度的列，在不得已的情r下，往往裼靡韵逻@N「表面上列的Z法，但H自己配置管理w」的方式硖理B列：</font></p>

<p><font face="宋体" size="4">#0001 procedure TForm1.Button1Click(Sender: TObject);</font></p>

<p><font face="宋体" size="4">#0002 type</font></p>

<p><font face="宋体" size="4">#0003 TIntegerArray = array[0..0] of integer; </font></p>

<p><font face="宋体" size="4">#0004 PIntegerArray = ^TIntegerArray;</font></p>

<p><font face="宋体" size="4">#0005 var</font></p>

<p><font face="宋体" size="4">#0006 pArrayOfInteger: PIntegerArray; </font></p>

<p><font face="宋体" size="4">#0007 j: integer;</font></p>

<p><font face="宋体" size="4">#0008 begin</font></p>

<p><font face="宋体" size="4">#0009 GetMem(pArrayOfInteger, 10 * SizeOf(Integer)); </font></p>

<p><font face="宋体" size="4">#0010 for j := 0 to 9 do</font></p>

<p><font face="宋体" size="4">#0011 pArrayOfInteger^[j] := j; </font></p>

<p><font face="宋体" size="4">#0012 FreeMem(pArrayOfInteger, 10 * SizeOf(Integer));</font></p>

<p><font face="宋体" size="4">#0013 end;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">如果用Delphi 4新增加的Dynamic 
Array，t可改用以下的方式：</font></p>

<p><font face="宋体" size="4">var MyFlexibleArray: array of Real;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">定x之後，以 <i>SetLength</i> 
函蹈淖列H配置的w大小，例如：</font></p>

<p><font face="宋体" size="4">SetLength(MyFlexibleArray, 20); // 0..19</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">方便很多，是幔咳粝胫道Dynamic 
ArrayHL度，分e以<i>High</i>c<i>Low</i>函蹬啵骰亍-1」r，表示是一列的L度榱悖例如：</font></p>

<p><font face="宋体" size="4">　</font></p>

<p><font face="宋体" size="4">#0001 procedure TForm1.Button2Click(Sender: TObject);</font></p>

<p><font face="宋体" size="4">#0002 var</font></p>

<p><font face="宋体" size="4">#0003 A: array of Integer;</font></p>

<p><font face="宋体" size="4">#0004 begin</font></p>

<p><font face="宋体" size="4">#0005 ShowMessage(IntToStr(High(A))); // <b>-1</b></font></p>

<p><font face="宋体" size="4">#0006 SetLength(A, 3);</font></p>

<p><font face="宋体" size="4">#0007 ShowMessage(IntToStr(High(A))); // 3</font></p>

<p><font face="宋体" size="4">#0008 A := nil;</font></p>

<p><font face="宋体" size="4">#0009 ShowMessage(IntToStr(High(A))); // -1</font></p>

<p><font face="宋体" size="4">#0010 end;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">上述的0008@列，指定<i>nil</i>值放列所配置到的w。</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">值得注意的是，Compiler於Dynamic 
ArrayK不自舆M行所^的「Copy-on-Write」。看以下的程式例：</font></p>

<p><font face="宋体" size="4">#0001 procedure TForm1.Button1Click(Sender: TObject);</font></p>

<p><font face="宋体" size="4">#0002 var</font></p>

<p><font face="宋体" size="4">#0003 A, B: array of Integer;</font></p>

<p><font face="宋体" size="4">#0004 begin</font></p>

<p><font face="宋体" size="4">#0005 SetLength(A, 1);</font></p>

<p><font face="宋体" size="4">#0006 A[0] := 1;</font></p>

<p><font face="宋体" size="4">#0007 B := A;</font></p>

<p><font face="宋体" size="4">#0008 B[0] := 2;</font></p>

<p><font face="宋体" size="4">#0009 ShowMessage(IntToStr(A[0])); // ==&gt; 2</font></p>

<p><font face="宋体" size="4">#0010 end;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">0008@列改的m是<i>B[0]</i>，但Compiler@然]有明到在可能修改列热r，㈥列热菅}u一份出恚Copy 
on (possible) Write），於是，0009@列程式@示的Y果仍是2。</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">於是，若要M行申列各索引目一σ坏热菅}u，只好自行圈一一}u，或者，裼幂^楹便的法 
── 呼叫Copy函担</font></p>

<p><font face="宋体" size="4">#0001 procedure TForm1.Button4Click(Sender: TObject);</font></p>

<p><font face="宋体" size="4">#0002 var</font></p>

<p><font face="宋体" size="4">#0003 A, B: array of Integer;</font></p>

<p><font face="宋体" size="4">#0004 begin</font></p>

<p><font face="宋体" size="4">#0005 SetLength(A, 1);</font></p>

<p><font face="宋体" size="4">#0006 A[0] := 1;</font></p>

<p><font face="宋体" size="4">#0007 B := Copy(A, 0, 1);</font></p>

<p><font face="宋体" size="4">#0008 B[0] := 2;</font></p>

<p><font face="宋体" size="4">#0009 ShowMessage(IntToStr(A[0])); // ==&gt; 1</font></p>

<p><font face="宋体" size="4">#0010 ShowMessage(IntToStr(B[0])); // ==&gt; 2</font></p>

<p><font face="宋体" size="4">#0011 end;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">最後，不要Dynamic Arrayc第二章提到的Open 
Array（_放列）搞混了。函式档拈_放列，Z法mcDynamic Array差不多，但_放列指的是：不限定魅牒式的列L度，Dynamic 
Arrayt是指：可L度的列，烧弋竟有所不同。以下是一t我涞某淌焦例，不y看出烧咧g的差：</font><b></p>

<p><font face="宋体" size="4">#0001 type</font></p>

<p><font face="宋体" size="4">#0002 TDynamicInteger = array of integer;</font></b></p>

<p><font face="宋体" size="4">#0003 </font></p>

<p><font face="宋体" size="4">　</font><b></p>

<p><font face="宋体" size="4">#0004 procedure Clear_OpenArray(var A: array of Integer);</font></b></p>

<p><font face="宋体" size="4">#0005 var</font></p>

<p><font face="宋体" size="4">#0006 I: Integer;</font></p>

<p><font face="宋体" size="4">#0007 begin</font></p>

<p><font face="宋体" size="4">#0008 for I := 0 to High(A) do A[I] := 0;</font></p>

<p><font face="宋体" size="4">#0009 // SetLength(A, 20); // 不可以@N</font></p>

<p><font face="宋体" size="4">#0010 end;</font></p>

<p><font face="宋体" size="4">#0011 </font></p>

<p><font face="宋体" size="4">#0012 // 注意, 以下煞N法又有不同喔</font></p>

<p><font face="宋体" size="4">#0013 // I: procedure Clear_DynamicArray(A: 
TDynamicInteger);</font></p>

<p><font face="宋体" size="4">#0014 // II: procedure Clear_DynamicArray(var A: 
TDynamicInteger);</font></p>

<p><font face="宋体" size="4">　</font><b></p>

<p><font face="宋体" size="4">#0015 procedure Clear_DynamicArray(var A: 
TDynamicInteger);</font></b></p>

<p><font face="宋体" size="4">#0016 var</font></p>

<p><font face="宋体" size="4">#0017 I: Integer;</font></p>

<p><font face="宋体" size="4">#0018 begin</font></p>

<p><font face="宋体" size="4">#0019 for I := 0 to High(A) do A[I] := 0;</font></p>

<p><font face="宋体" size="4">#0020 SetLength(A, 20); // 如果是Dynamic Array, 
可以@N</font></p>

<p><font face="宋体" size="4">#0021 end;</font></p>

<p><font face="宋体" size="4">#0022 </font></p>

<p><font face="宋体" size="4">#0023 procedure TForm1.Button3Click(Sender: TObject);</font></p>

<p><font face="宋体" size="4">#0024 var</font></p>

<p><font face="宋体" size="4">#0025 A: TDynamicInteger;</font></p>

<p><font face="宋体" size="4">#0026 begin</font></p>

<p><font face="宋体" size="4">#0027 SetLength(A, 3);</font></p>

<p><font face="宋体" size="4">#0028 Clear_OpenArray(A);</font></p>

<p><font face="宋体" size="4">#0029 ShowMessage(IntToStr(High(A))); // -1</font></p>

<p><font face="宋体" size="4">#0030 Clear_DynamicArray(A);</font></p>

<p><font face="宋体" size="4">#0031 // 以下@列的Y果, 要看 Cleary_DynamicArray 
的</font></p>

<p><font face="宋体" size="4">#0032 // 涤]有 var</font></p>

<p><font face="宋体" size="4">#0033 ShowMessage(IntToStr(High(A)));</font></p>

<p><font face="宋体" size="4">#0034 end;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">臀易⒁0004的<i>Clear_OpenArray</i>，魅氲氖恰赣烧成的列，不限定列的L度」，0015的<i>Clear_DynamicArray</i>的法t是「接受一可雨列L度的B列」，若不@，鼍妥成了_放列了。</font></p>

<p><font face="宋体" size="4">Method and Routine Overloading</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">所^的Method Overloading，蔚卣f：一以上的函式使用相同的函式名Q。@特性是Object 
PascalL久以硪恢庇腥讼胍s一直]有支援的期盼，K於，Delphi 4多了一保留字：<i>overload</i><b> 
</b>── 相同名Q的函式，只要在宣告r~外加上<i><b>overload</b></i>，即使函式的敌B不同，Delphi也呼叫r魅氲蒂Y料型B，Q定呼叫哪一函式。例如以下@t例子：</font></p>

<p><font face="宋体" size="4">#0001 //  Divide 都必overload保留字</font></p>

<p><font face="宋体" size="4">#0002 function Divide(X, Y: Double): Double; <b>overload;</b></font></p>

<p><font face="宋体" size="4">#0003 begin</font></p>

<p><font face="宋体" size="4">#0004 Result := X / Y;</font></p>

<p><font face="宋体" size="4">#0005 end;</font></p>

<p><font face="宋体" size="4">#0006 </font></p>

<p><font face="宋体" size="4">#0007 function Divide(X, Y: Integer): Integer; <b>overload;</b></font></p>

<p><font face="宋体" size="4">#0008 begin</font></p>

<p><font face="宋体" size="4">#0009 Result := X div Y;</font></p>

<p><font face="宋体" size="4">#0010 end;</font></p>

<p><font face="宋体" size="4">#0011 </font></p>

<p><font face="宋体" size="4">#0012 procedure TForm1.Button1Click(Sender: TObject);</font></p>

<p><font face="宋体" size="4">#0013 var</font></p>

<p><font face="宋体" size="4">#0014 a, b, c: integer;</font></p>

<p><font face="宋体" size="4">#0015 i, j, k: Double;</font></p>

<p><font face="宋体" size="4">#0016 begin</font></p>

<p><font face="宋体" size="4">#0017 a := 10;</font></p>

<p><font face="宋体" size="4">#0018 b := 3;</font></p>

<p><font face="宋体" size="4">#0019 i := 10;</font></p>

<p><font face="宋体" size="4">#0020 j := 3;</font></p>

<p><font face="宋体" size="4">#0021 c := Divide(a, b);</font></p>

<p><font face="宋体" size="4">#0022 k := Divide(i, j);</font></p>

<p><font face="宋体" size="4">#0023 ShowMessage(IntToStr(c)); // 3</font></p>

<p><font face="宋体" size="4">#0024 ShowMessage(FloatToStr(k)); // 3.333333...</font></p>

<p><font face="宋体" size="4">#0025 end;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">臀易⒁獾0002c0007@闪械<i>Divide</i>函担函得Q相同，但魅氲敌Bc函档骰刂K不相同，即使如此，0023c0024呼叫到<i>Divide</i>r，是r档男B型B，Q定呼叫哪一<i>Divide</i>。</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">很方便，是幔坑辛诉@特性，我就可以出用更V性更大的函旦ぉs不必槊恳环N情r各自取一函得Q，同r，@特性也使得函岛艚械姆绞礁橐恢拢真是一早支援的特性。除了一般的程序c函担物件的方法也可以裼<i>overload</i>法，於「<i>物件<b>.</b>方法</i>」的撰c呼叫，肯定更能提供便c性。</font><i></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">overload</i>可不可以用在不同的卧呢？答案是可以的，但是完全相同的函式宣告不能再一次。例如上述程式的0007-0010，可以移到其他卧，原淼卧只要<i>uses</i>@新的卧，函岛艚r仍然有Overloading的效果。可是，如果0007-0010的程式a移到其他卧s忘了h除原砦恢玫某淌剑Q句f，卧各有一完全L得一拥暮式，grDelphi就搞不清楚了，Y果自然是o法g。然啦！同一卧同一l生@邮乱彩遣辉S的，各Overloading的函式，在函式宣告上多少有些不同。</font></p>

<p><font face="宋体" size="4">Default Parameters</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">^去，函式如果定x了六担那N，作函式呼叫的原始ar，就一定得乖乖地魅肓担不S多也不S少。若是用「Default 
Parameters」，可以只魅胛（或者更少）。那．．．，那其他]o的翟觞Nk？]PS，函式炔康某淌⒆右灶AO值代入，稍後我f明其法。</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">e例碚f，Windows API中有一U好用的函到<i>MessageBox</i>，呼叫此函⒊霈F一通用υ盒，不管是@示息或者徵使用者意，都十分好用。像是以下@道⑹a生如次的υ盒，提醒使用者定期浞葙Y料：</font></p>

<p><font face="宋体" size="4">Application.MessageBox('程式要Y束了喔! 
得定期浞葙Y料',</font></p>

<p><font face="宋体" size="4">'息', MB_OK + MB_ICONINFORMATION);</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">　</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">除了@示Y料，由最後一担性地搭配各位元旗耍就可以u作出不同按o的υ盒，使用者「是」、「否」、「取消」等蔚}。</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">用Default Parameters的法，我可以一似以下的函担</font></p>

<p><font face="宋体" size="4">#0001 function MyMessageBox(Prompt: string;</font></p>

<p><font face="宋体" size="4">#0002 <b>Caption: string = '息';</b></font></p>

<p><font face="宋体" size="4">#0003 <b>Flag: LongInt = MB_OK + MB_ICONINFORMATION</b>): 
integer;</font></p>

<p><font face="宋体" size="4">#0004 begin</font></p>

<p><font face="宋体" size="4">#0005 Result := Application.MessageBox(</font></p>

<p><font face="宋体" size="4">#0006 PChar(Prompt), PChar(Caption), Flag);</font></p>

<p><font face="宋体" size="4">#0007 end;</font></p>

<p><font face="宋体" size="4">#0008 </font></p>

<p><font face="宋体" size="4">#0009 procedure TForm1.Button1Click(Sender: TObject);</font></p>

<p><font face="宋体" size="4">#0010 begin</font></p>

<p><font face="宋体" size="4">#0011 MyMessageBox('程式要Y束了喔! 
得定期浞葙Y料');</font></p>

<p><font face="宋体" size="4">#0012 end;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">如此一恚我既能有一完整支援<i>MessageBox</i>的函担只想@示文字r，也能有一精型式的函悼捎谩４蠹明@看得出恚翰槐成函怠</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">^察上述程式的法，其也U容易的，只不^是在定x函r，一憬o定初值。</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">不^，H邮秩r，是lF一些限制。^m@例子碚f，档念AO值一定得是常担另外，如果某一甸_始oAO值，接在後^的狄脖仨用Default 
Parameters的法。槭颤N得有@限制？以上例碚f，如果0001-0003我改成：</font></p>

<p><font face="宋体" size="4">#0001 function MyMessageBox(Prompt: string;</font></p>

<p><font face="宋体" size="4">#0002 <b>Caption: string = '息';</b></font></p>

<p><font face="宋体" size="4">#0003 <b>Flag: LongInt</b>): integer;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">那N，只魅颠M去r，Delphi怎N知道第二翟是<i>Captioin</i>或者是「<i>Caption</i>按AO值，第二荡入<i>Flag</i>」。Visual 
BasicΥ说慕夥ㄊ窃诤艚泻r，一明各得Qc值的，由於@故，Visual 
Basic甚至允S档拇涡虿煌也]PS，因椋各蹬c其值的PS在呼叫函式r已一阍]明清楚。很可惜的，Delphi 
4m有Default Parametets，但不支援以下的函岛艚蟹绞剑</font></p>

<p><font face="宋体" size="4">MyMessageBox('程式要Y束了喔! 
得定期浞葙Y料', Flag = ...);</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">m然如此，上述「如果某一甸_始oAO值，接在後^的狄脖仨用Default 
Parameters的法」@限制，多少是可以搭配前一的Overloading加以a：</font></p>

<p><font face="宋体" size="4">#0001 function MyMessageBox(Prompt: string;</font></p>

<p><font face="宋体" size="4">#0002 Caption: string = '息';</font></p>

<p><font face="宋体" size="4">#0003 Flag: LongInt = MB_OK + MB_ICONINFORMATION): 
integer; overload;</font></p>

<p><font face="宋体" size="4">#0004 begin</font></p>

<p><font face="宋体" size="4">#0005 Result := Application.MessageBox(</font></p>

<p><font face="宋体" size="4">#0006 PChar(Prompt), PChar(Caption), Flag);</font></p>

<p><font face="宋体" size="4">#0007 end;</font></p>

<p><font face="宋体" size="4">#0008 </font></p>

<p><font face="宋体" size="4">　</font><b></p>

<p><font face="宋体" size="4">#0009 function MyMessageBox(Prompt: string;</font></p>

<p><font face="宋体" size="4">#0010 Flag: LongInt;</font></p>

<p><font face="宋体" size="4">#0011 Caption: string = '息'</font></p>

<p><font face="宋体" size="4">#0012 ): integer; overload;</font></b></p>

<p><font face="宋体" size="4">#0013 begin</font></p>

<p><font face="宋体" size="4">#0014 Result := Application.MessageBox(</font></p>

<p><font face="宋体" size="4">#0015 PChar(Prompt), PChar(Caption), Flag);</font></p>

<p><font face="宋体" size="4">#0016 end;</font></p>

<p><font face="宋体" size="4">#0017 </font></p>

<p><font face="宋体" size="4">#0018 procedure TForm1.Button1Click(Sender: TObject);</font></p>

<p><font face="宋体" size="4">#0019 begin</font></p>

<p><font face="宋体" size="4">#0020 MyMessageBox('程式要Y束了喔! 
得定期浞葙Y料');</font></p>

<p><font face="宋体" size="4">#0021 MyMessageBox('ef我]告V你喔!', MB_OK);</font></p>

<p><font face="宋体" size="4">#0022 end;</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">（好┑某淌剑一再提醒要得浞荨:p）</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">臀易⒁膺@次改^的程式0009-0012，我重新{整了各档拇涡颍K且分e在赏名函刀技由狭<i>overload</i>保留字，@樱Delphi就知道呼叫的是哪一了。</font></p>

<p ALIGN="JUSTIFY"><font face="宋体" size="4">　</font></p>
</body>
</html>
