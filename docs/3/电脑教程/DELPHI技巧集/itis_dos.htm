<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<meta name="GENERATOR" content="Microsoft FrontPage 3.0">
<title>判断一个程序是否dos版本</title>
</head>

<body bgcolor="#FFFFFF" text="#000000">

<p>[本文摘自BBS, 不能保证绝对正确, 仅供参考]<br>
<br>
判断一个程序是否dos版本:<br>
<br>
将文件头读进来,判断是否Exe <br>
offset(0) -$5a45 'MZ'<br>
offset($80) = 'PE' WIN32 EXE<br>
offset($100) = 'NE' WIN16 EXE<br>
<br>
e_magic:SmallInt<br>
buffer:array[0..255] of byte;<br>
FStream:TFileStream;<br>
<br>
FStream:=TFileStream.Create(Filename,fmOpenRead+fmShareDenyNone);<br>
Try<br>
FStream.Read(buffer,256);<br>
if SmallInt(buffer[0]) &lt;&gt;$5A4D then<br>
FIsMSDos:=False<br>
else<br>
FIsMSDos:=True;<br>
<br>
nPos:=$80 <br>
<br>
if (buffer[nPos+0]='P') and (buffer[nPos+1]='E') and (buffer[nPos+2]=#0) and 
(buffer[nPos+3]=#0) then<br>
FIsPE:=True;<br>
<br>
finally<br>
FStream.Free;<br>
<br>
nPos:=$100 <br>
if (buffer[nPos+0]='N') and (buffer[nPos+1]='E') then<br>
FIsNE:=True;<br>
</p>
</body>
</html>
