<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>在Delphi3程序中自动检测、建立数据库别名</title>
</head>

<body bgcolor="#FFFFFF" text="#000000">

<p align="center">　<font color="#0000c0"></p>

<h2 align="center">在Delphi3 程 序 中 自 动 检 测、 建 立 数 据 库 别 名 
和 表 格 </font></h2>

<h3 align="center">湖 北 省 枝 江 市 委 办 公 室 曹 祖 权 </h3>

<p><font color="#ffffff">----</font> Delphi3 内 建 的Borland 数 据 库 引 擎(BDE)， 
使Delphi3 程 序 能 通 过 数 据 库 别 名(Database<br>
Alias) 十 分 方 便 地 访 问 各 种 类 型 的 数 据 库。然 而， 数 据 
库 别 名 的 建 立、 修 改、<br>
删 除 等 维 护 工 作，需 要 在 BDE Administrator 中 进 行， 数 据 库 中 
实 际 表 格 结 构 的 建<br>
立 和 维 护， 有 时 也 要 在DataBase Desktop 中 完 成， 这 给 用 户 增 
加 了 不 少 困 难。 有 没<br>
有 办 法 让 用 户 不 去 执 行BDE Administrator 和DataBase Desktop 这 两 个 
应 用 程 序， 就 可 直<br>
接 检 测、 建 立 数 据 库 别 名 和 库 中 的 表 格 呢 ？ 笔 者 通 过 
探 索， 得 到 了 一 种 可<br>
行 的 方 案， 现 以 笔 者 所 开 发 的 一 个 单 机 版 的 图 书 资 料 
管 理 系 统 为 例， 简 要<br>
加 以 说 明。 </p>

<p><font color="#ffffff">----</font> 一、 数 据 库 别 名(Alias) 的 定 义 和 检 
测 方 法 </p>

<p><font color="#ffffff">----</font> 当Type 为STANDARD 时, 别 名 定 义 最 为 简 
单， 这 时 仅 能 采 用PARADOX, DBASE,ASCIIDRV<br>
三 种 数 据 库 作 为 缺 省 的 驱 动 程 序(DEFAULT DRIVER)。 </p>

<p><font color="#ffffff">----</font> 另 外， 还 要 定 义 数 据 库 存 放 路 
径(PATH) 和ENABLE BCD， 才 能 建 立 一 个 完 整 的<br>
数 据 库 别 名。 </p>

<p><font color="#ffffff">----</font> Delphi 的 数 据 库 应 用 程 序 能 自 动 
提 供 一 个Session 组 件， 这 个 Session 组 件 即 为 应<br>
用 程 序 与BDE 的 接 口。 </p>

<p><font color="#ffffff">----</font> 1. 检 测 别 名 </p>

<p><font color="#ffffff">----</font> 通 过 调 用Session.GetAliasNames(list:Tstrings) 
方 法， 可 将 当 前BDE 配 置 中 的 所 有 数 据 库 别<br>
名 的 名 称 存 放 到List 字 符 串 列 表 中。 list.IndexOf(' 需 要 检 测 
的 别 名') 的 值 会 告 诉 我<br>
们 这 个 别 名 是 否 存 在 ( 其 值 为-1 时 不 存 在）。 </p>

<p><font color="#ffffff">----</font> 2. 增 加 一 个 新 的 别 名 </p>

<p><font color="#ffffff">----</font> Session 组 件 的 过 程AddStandardAlias(const 
Name, Path, DefaultDriver: string), 可 以 增 加 一 个 标 准<br>
类 型 的 数 据 库 别 名。 例 如 增 加 一 个 名 为Cntssamp， 缺 省 数 
据 库 驱 动 程 序 为<br>
PARADOX、 存 放 路 径 为c:\delphp11 的 别 名： </p>

<p><font color="#ffffff">----</font> 
Session.AddStandardAlias('Cntssamp','c:\delphp11','Paradox'); </p>

<p><font color="#ffffff">----</font> 3.BDE 配 置 文 件 存 盘 </p>

<p><font color="#ffffff">----</font> Session.SaveConfigFile; </p>

<p><font color="#ffffff">----</font> 二、 数 据 库 中 表 格 的 定 义 和 检 
测 方 法 </p>

<p><font color="#ffffff">----</font> 数 据 库 中 表 格 的 定 义、 维 护 和 
使 用， 只 有 在 数 据 库 别 名 正 确 设 置 的 情 况<br>
下 才 有 意 义。 以TTable 组 件 为 例， 必 须 设 置 其DatabaseName 为 
一 个 实 际 存 在 的 别<br>
名。 </p>

<p><font color="#ffffff">----</font> 1. 检 测 表 格 是 否 存 在 </p>

<p><font color="#ffffff">----</font> 通 过 调 用Session.GetTableNames(const 
DatabaseName, </p>

<p><font color="#ffffff">----</font> Pattern: string; Extensions,SystemTables: Boolean; 
List: </p>

<p><font color="#ffffff">----</font> TStrings) 方 法， 可 将 当 前 指 定 数 据 
库 别 名 中 所 有 表 格 的 名 称 存 放 到 List 字 符<br>
串 列 表 中。list.IndexOf(' 需 要 检 测 的 表 格 名') 的 值 会 告 诉 我 
们 这 个 表 格 是 否 存 在(<br>
其 值 为-1 时 不 存 在）。 </p>

<p><font color="#ffffff">----</font> 2. 建 立 一 个 表 格 </p>

<p><font color="#ffffff">----</font> 第 一 步， 设 置TTable 组 件 的DataBase 
Name( 别 名)、TableName ( 表 格 名)、TableType( 数 据 库<br>
类 型); </p>

<p><font color="#ffffff">----</font> 第 二 步， 调 用Table.FieldDefs.Add(const Name: 
string; </p>

<p><font color="#ffffff">----</font> DataType: TFieldType; Size: Word; Required: Boolean) 
增 加 表 格的 各 个 字 段， 其 中Name 为 字 段<br>
名，DataType 为 字 段 类 型（ 常 用 的 有 ftInteger,ftString,ftDate,ftBoolean 
等）,Size 为 字 段 长 度，<br>
Required 为 该 字 段 是 否 允 许 有 空 值。 </p>

<p><font color="#ffffff">----</font> 第 三 步， 调 用Table.IndexDefs.Add(const Name, 
Fields: string; Options: TIndexOptions) 方 法 增 加 表 格<br>
的 索 引 文 件， 其 中 Name 为 索 引 文 件 名，Fields 为 索 引 字 
段，options 为 索 引 参 数 的 集<br>
合， 常 用 的 索 引 参 数 有ixPrimary( 主 键）、 ixDescending( 降 序)、 
ixUnique( 具 有 唯 一 值）<br>
等。 </p>

<p><font color="#ffffff">----</font> 第 四 步， 调 用Table.CreateTable 建 立 表 
格。 </p>

<p><font color="#ffffff">----</font> 三、 一 个 实 例 </p>

<p><font color="#ffffff">----</font> 在Form1.Formcreate 事 件 中 写 入 如 下 代 
码， 程 序 启 动 时， 将 自 动 检 测 是 否 存 在<br>
数 据 库 别 名Cntssamp， 如 果 没 有 则 建 立 之； 自 动 检 测 别 名Cntssamp 
中 是 否 存 在 表<br>
格TSK( 图 书 库)， 如 果 没 有 则 自 动 建 立 表 格TSK。 </p>

<pre>procedure TForm1.FormCreate(Sender: TObject);
var
  ap:TStringList;   {字符串列表变量}
  answer:Integer;
begin
  ap:=TStringlist.Create;
  Session.GetAliasNames(ap);   {取得别名列表}
  if (ap.IndexOf('Cntssamp')=-1) then   {判断别名是否存在}
  begin
    answer:=Application.MessageBox(
'别名Cntssamp不存在，
现在创建吗？','BDE信息窗口',mb_OKCancel);
    {增加一个名为Cngzsamp的数据库别名}
    if  answer=IDCANCEL then begin
       ap.Free;
       Exit;
    end;
Session.AddStandardAlias
('Cntssamp','c:\delphp11','Paradox');
    Session.SaveConfigFile;    {BDE配置文件存盘}
  end ;

  ap.Clear;      {取得别名Cngzsamp中的所有表格名称列表}
  Session.GetTableNames
('Cntssamp','',False,False,ap);
  if (ap.IndexOf('TSK')=
-1)  then  {判断表格是否存在}
  begin
     answer:=Application.MessageBox(
     '别名Cntssamp中不存在
表格TSK,现在创建吗？','表格信息窗口
',mb_OKCancel);
     if answer=IDCANCEL then begin
        ap.Free;
        Exit;
     end;
     with table1 do begin
      Active:=false;
      DatabaseName:='Cntssamp';    {数据库别名}
      TableName:='TSK';            {表格名}
      TableType:=ttParadox;        {数据库类型}
      with FieldDefs do begin      {增加字段}
        Clear;
        Add('SH',ftString,30,False);  {书号 String(30)}
        Add('SM',ftString,30,False);  {书名 String(30)}
        Add('CBS',ftString,20,False); {出版社 String(20)}
        Add('CBRQ',ftDate,0,False);   {出版日期 Date}
        Add('YS',ftInteger,0,False);   {页数 Integer}
      end;
      with IndexDefs do begin      {增加索引}
       Clear;                      {按书号字段建立主索引}
       Add('SHSY','SH',[ixPrimary,ixUnique]);
      end;
      CreateTable;      {创建表格}
    end;
  end ;
  ap.free;            {释放变量ap}
end;
</pre>

<p><font color="#ffffff">----</font> 四、 本 程 序 在Pwin95,Delphi3 环 境 下 调 
试 通 过。 </p>
</body>
</html>
