<HTML>
<HEAD>
<LINK REL=StyleSheet HREF="basicIE4.css" TYPE="text/css">
<TITLE>The EX31A Recordset Example</TITLE>

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY>
<A NAME="774"><H1>The EX31A Recordset Example</H1></A><P>You can use AppWizard to generate a complete forms-oriented database 
application, and that's what the Enroll tutorial is all about. If customers or 
users wanted a straightforward business database application like that, however, 
they probably wouldn't call in a Visual C++ programmer; instead, they might use 
a less technical tool, such as Microsoft Access. Visual 
C++ and the MFC ODBC classes are more appropriate for a complex application that might have an 
incidental need for database access. You can also use the classes to make your 
own general-purpose database query tool.
<P>The EX31A program isolates the database access code from user 
interface code so that you can see how to add ODBC database capability to any 
MFC application. You'll be using ClassWizard to generate a 
<I>CRecordset</I> class, but you won't be using the 
<I>CRecordView</I> class that AppWizard generates when you 
ask for a database view application.
<P>The EX31A application is fairly simple. It displays the rows from the 
student database table in a scrolling view, as shown in the screen at the end of this section. 
The student table is part of the Student Registration (Microsoft Access 97) 
sample database that's included with Visual C++.
<P>Here are the steps for building the EX31A example:<P>
<OL>
<B><LI>Copy the Student Registration database to your hard 
disk.</B> You can find the file stdreg32.mdb in the 
\Samples\VC98\Mfc\Database\Stdreg 
directory on the Visual C++ MSDN CD-ROM. Copy it to the new 
project directory on your hard disk, and make sure the copy does not have 
its read-only attribute set.
<P><B><LI>Run the ODBC Data Source Administrator to install the Student 
Registration data source.</B> Click the ODBC icon in the Windows 
Control Panel. The Visual C++ Setup program should have already 
installed the required ODBC drivers on your hard disk. If you are running 
Windows 95, click the Drivers button to see whether the Microsoft 
Access driver is available. If you're running Windows 98, click the Drivers tab 
to see whether the Microsoft Access driver is available. (If the Microsoft 
Access driver is not available, rerun Visual C++ Setup.) Click the Add 
button (in Windows 98, the Add button is on the User DSN tab), 
choose Microsoft Access Driver in the Add Data Source dialog box (in 
Windows 98, select the Microsoft Access Driver in the Create New Data Source 
dialog box and click the Finish button), and fill in the ODBC 
Microsoft Access 97 Setup dialog box as shown here.

<P><A HREF="javascript:fullSize('G31OG01x.htm')"> <img src="G31OG01.JPG" width=404 height=268 border=0 ALT = "Click to view at full size."> </A><P>
<P>
Set the database to point to stdreg32.mdb using the Select 
button. Finally, click the OK button.
<P>
<DIV CLASS=note>
<BLOCKQUOTE>
<IMG SRC="note.jpg" width=123 height=18 BORDER="0"><P>
If you are using Microsoft Windows NT version 4.0, 
click on the ODBC icon in the Windows Control Panel and then click 
on the ODBC Drivers tab to see whether the Microsoft Access 
Driver is available. On the User DSN tab, click the Add button, 
choose Microsoft Access Driver in the Create New Data Source dialog 
box, click the Finish button, and then fill in the dialog box as shown above.
</BLOCKQUOTE></DIV>

<B><LI>Run AppWizard to produce 
\vcpp32\ex31a\.</B> Specify an SDI application (Step 1 dialog box) with 
<I>CScrollView</I> as the view's class type (Step 
6 dialog box). Select the Header Files Only option from the 
AppWizard Step 2 dialog box, as shown here.

<P><A HREF="javascript:fullSize('g31og02x.htm')"> <img src="g31og02.jpg" width=404 height=325 border=0 ALT = "Click to view at full size."> </A><P>

<B><LI>Use ClassWizard to create the 
<I>CEx31aSet</I> recordset class.</B> Choose New from the Add Class menu, and then fill in the New Class dialog box as shown here.

<P><img src="g31og03x.gif" width=404 height=366 border=0><P>

<B><LI>Select the Student Registration database's Student table for 
the <I>CEx31aSet</I> class.</B> When you click the OK button in the New Class 
dialog box, ClassWizard displays the Database Options dialog box. 
Select the Student Registration data source, and select the Dynaset option 
as shown here.

<P><IMG SRC="g31og04.gif" width=402 height=270 BORDER="0"><P>

<P>After you select the data source, ClassWizard prompts you to select 
a table. Select Student, as shown here.

<P><IMG SRC="g31og05.gif" width=341 height=231 BORDER="0"><P>

<B><LI>Examine the data members that ClassWizard 
generates.</B> Click on the Member Variables tab for the newly generated 
<I>CEx31aSet</I> class. ClassWizard should have generated data members based on student 
column names, as shown here.

<P><A HREF="javascript:fullSize('g31og06x.htm')"> <img src="g31og06.jpg" width=404 height=290 border=0 ALT = "Click to view at full size."> </A><P>

<B><LI>Declare an embedded recordset object in 
ex31aDoc.h.</B> Add the following public data member in the 
<I>CEx31aDoc </I>class declaration:
<P><PRE><B>CEx31aSet m_ex31aSet;</B></PRE>
<P><B><LI>Edit the ex31aDoc.cpp file.</B> Add the line
<P><PRE><B>#include &quot;ex31aSet.h&quot;</B></PRE>
<P>just before the line
<P><PRE>#include &quot;ex31aDoc.h&quot;</PRE>
<P><B><LI>Declare a recordset pointer in 
ex31aView.h.</B> Add the following private data member in the 
<I>CEx31aView</I> class declaration:
<P><PRE><B>CEx31aSet* m_pSet;</B></PRE>
<P><B><LI>Edit the <I>OnDraw</I> and 
<I>OnInitialUpdate</I> functions in ex31aView.cpp.</B>
Add the following boldface code:
<P><PRE>void CEx31aView::OnDraw(CDC* pDC)
{
    <B>TEXTMETRIC tm;
    pDC-&gt;GetTextMetrics(&amp;tm);
    int nLineHeight=tm.tmHeight+tm.tmExternalLeading;
    CPoint pText(0,0);

    int y = 0;
    CString str;</B>
    <B>if (m_pSet-&gt;IsBOF()) { // detects empty recordset
        return;
    }
    m_pSet-&gt;MoveFirst();   // fails if recordset is empty
    while (!m_pSet-&gt;IsEOF()) {
        str.Format(&quot;%ld&quot;, m_pSet-&gt;m_StudentID);
        pDC-&gt;TextOut(pText.x, pText.y, str);
        pDC-&gt;TextOut(pText.x+1000, pText.y, m_pSet-&gt;m_Name);
        str.Format(&quot;%d&quot;, m_pSet-&gt;m_GradYear);
        pDC-&gt;TextOut(pText.x+4000, pText.y, str);
        m_pSet-&gt;MoveNext();
        pText.y -= nLineHeight;
    }</B>
}
void CEx31aView::OnInitialUpdate() 
{
    CScrollView::OnInitialUpdate();
    CSize sizeTotal(8000, 10500);

    <B>SetScrollSizes(MM_HIENGLISH, sizeTotal);

    m_pSet = &amp;GetDocument()-&gt;m_ex31aSet;
    // Remember that documents/views are reused in SDI applications!
    if (m_pSet-&gt;IsOpen()) {
        m_pSet-&gt;Close();
    }
    m_pSet-&gt;Open();</B>
} </PRE>
<P>Also in ex31aView.cpp, add the line
<P><PRE><B>#include &quot;ex31aSet.h&quot;</B></PRE>
<P>just before the line
<P><PRE>#include &quot;ex31aDoc.h&quot;</PRE>
<P><B><LI>Edit the ex31a.cpp file.</B> Add the line
<P><PRE><B>#include &quot;ex31aSet.h&quot;</B></PRE>
<P>just before the line
<P><PRE>#include &quot;ex31aDoc.h&quot;</PRE>
<P><B><LI>Build and test the EX31A 
application.</B> Does the resulting screen look like the one shown here?
<P>

<A HREF="javascript:fullSize('G31OG07x.htm')"> <img src="G31OG07.JPG" width=404 height=263 border=0 ALT = "Click to view at full size."> </A>
<P>
</OL>
<DIV CLASS=note>
<BLOCKQUOTE>
<B>Adding ODBC Capability to an MFC Application</B><P>
If you need to add ODBC capability to an existing MFC 
application, make the following changes to the project:

<LI>Add the following line at the end of StdAfx.h:
<P><PRE>#include &lt;afxdb.h&gt;</PRE>
<LI>Edit the RC file in text mode. After the line
<P><PRE>&quot;#include &quot;&quot;afxprint.rc&quot;&quot; // printing print preview resources\r\n&quot;</PRE>
<P>add the line
<P><PRE>&quot;#include &quot;&quot;afxdb.rc&quot;&quot;    // database resources\r\n&quot;</PRE>
<P>And after the line
<P><PRE>#include &quot;afxprint.rc&quot;    // printing print preview resources</PRE>
<P>add the line
<P><PRE>#include &quot;afxdb.rc&quot;       // database resources</PRE>

</BLOCKQUOTE></DIV>
</BODY>
</HTML>



