<HTML>
<HEAD>
<LINK REL=StyleSheet HREF="basicIE4.css" TYPE="text/css">
<TITLE>Programming for the Printer</TITLE>

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY>
<A NAME="413"><H1>Programming for the Printer</H1></A><P>The application framework does most of the work for printing and print 
preview. To use the printer effectively, you must understand the sequence of function 
calls and know which functions to override.
<H2>The Printer Device Context and the 
<I>CView::OnDraw</I> Function</H2>
<P>When your program prints on the printer, it uses a device context object of 
class <I>CDC</I>. Don't worry about where the object comes from; the application 
framework constructs it and passes it as a parameter to your view's 
<I>OnDraw</I> function. If your application uses the printer to duplicate the display, the 
<I>OnDraw</I> function can do double duty. If you're displaying, the 
<I>OnPaint</I> function<I> </I>calls <I>OnDraw</I> and the device context is the display context. If you're printing, 
<I>OnDraw</I> is called by another <I>CView</I> virtual function, 
<I>OnPrint</I>, with a printer device context as a parameter. The 
<I>OnPrint</I> function is called once to print an entire page.
<P>In print preview mode, the <I>OnDraw</I> parameter is actually a pointer to 
a <I>CPreviewDC</I> object. Your <I>OnPrint</I> and 
<I>OnDraw</I> functions work the same regardless of whether you're printing or previewing.
<A NAME="414"><H2>The <I>CView::OnPrint</I> Function</H2></A><P>You've seen that the base class <I>OnPrint</I> function calls 
<I>OnDraw</I> and that <I>OnDraw</I> can use both a display device context and a printer device context. The 
mapping mode should be set before <I>OnPrint</I> is called. You can override 
<I>OnPrint</I> to print items that you don't need on the display, such as a title page, headers, and 
footers. The <I>OnPrint</I> parameters are as follows:
<UL>
<LI>A pointer to the device context<P>
<LI>A pointer to a print information object 
(<I>CPrintInfo</I>) that includes page dimensions, the current page number, and the maximum 
page number<P>
</UL>
<P>In your overridden <I>OnPrint</I> function, you can elect not to call 
<I>OnDraw</I> at all to support print logic that is totally independent of the display logic. 
The application framework calls the <I>OnPrint</I> function once for each page to 
be printed, with the current page number in the 
<I>CPrintInfo</I> structure. You'll soon find out how the application framework determines the page number.
<A NAME="415"><H2>Preparing the Device Context&#151;The <I>CView::OnPrepareDC</I> Function</H2></A><P>If you need a display mapping mode other than 
<I>MM_TEXT</I> (and you often do), that mode is usually set in the view's 
<I>OnPrepareDC</I> function. You override this function yourself if your view class is derived directly from 
<I>CView</I>, but it's already overridden if your view is derived from 
<I>CScrollView</I>. The <I>OnPrepareDC</I> 
function is called in <I>OnPaint</I> immediately before the call to 
<I>OnDraw</I>. If you're printing, the same 
<I>OnPrepareDC</I> function is called, this time immediately before 
the application framework calls <I>OnPrint</I>. Thus, the mapping mode is set before 
both the painting of the view and the printing of a page.
<P>The second parameter of the <I>OnPrepareDC</I> function is a pointer to a 
<I>CPrintInfo</I> structure. This pointer is valid only if 
<I>OnPrepareDC</I> is being called prior to printing. You can test for this condition by calling the 
<I>CDC</I> member function <I>IsPrinting</I>. The 
<I>IsPrinting</I> function is particularly handy if you're 
using <I>OnPrepareDC</I> to set different mapping modes for the display and the printer.
<P>If you do not know in advance how many pages your print job 
requires, your overridden <I>OnPrepareDC</I> function can detect the end of the 
document and reset the <I>m_bContinuePrinting</I> flag in the 
<I>CPrintInfo</I> structure. When this flag is 
<I>FALSE</I>, the <I>OnPrint</I> function won't be called again and control will 
pass to the end of the print loop.
<A NAME="416"><H2>The Start and End of a Print Job</H2></A><P>When a print job starts, the application framework calls two 
<I>CView</I> functions, <I>OnPreparePrinting</I> and 
<I>OnBeginPrinting</I>. (AppWizard generates the 
<I>OnPreparePrinting</I>, <I>OnBeginPrinting</I>, and 
<I>OnEndPrinting</I> functions for you if you select the Printing And Print Preview option.) The first function, 
<I>OnPreparePrinting</I>, is called before the display of the Print dialog. If you know the 
first and last page numbers, call 
<I>CPrintInfo::SetMinPage</I> and <I>CPrintInfo::SetMaxPage</I> in 
<I>OnPreparePrinting</I>. The page numbers you pass to these functions will 
appear in the Print dialog for the user to override.
<P>The second function, <I>OnBeginPrinting</I>, is called after the Print dialog 
exits. Override this function to create Graphics Device Interface (GDI) objects, 
such as fonts, that you need for the entire print job. A program runs faster if you 
create a font once instead of re-creating it for each page.
<P>The <I>CView</I> function <I>OnEndPrinting</I> is called at the end of the print 
job, after the last page has been printed. Override this function to get rid of 
GDI objects created in <I>OnBeginPrinting</I>.
<P>The following table summarizes the important overridable 
<I>CView</I> print loop functions.
<P><TABLE WIDTH="95%" CELLPADDING="5">
<TR><TD VALIGN="TOP"><B>Function</B></TD><TD VALIGN="TOP"><B>Common Override Behavior</B></TD></TR>
<TR><TD VALIGN="TOP"><I>OnPreparePrinting</I></TD><TD VALIGN="TOP">Sets first and last page numbers</TD></TR>
<TR><TD VALIGN="TOP"><I>OnBeginPrinting</I></TD><TD VALIGN="TOP">Creates GDI objects</TD></TR>
<TR><TD VALIGN="TOP"><I>OnPrepareDC</I> (for each page)</TD><TD VALIGN="TOP"> Sets mapping mode and optionally detects end of print job</TD></TR>
<TR><TD VALIGN="TOP"><I>OnPrint</I></TD><TD VALIGN="TOP"> Does print-specific output and then calls 
<I>OnDraw</I> (for each page)</TD></TR>
<TR><TD VALIGN="TOP"><I>OnEndPrinting</I></TD><TD VALIGN="TOP">Deletes GDI objects</TD></TR>
</TABLE>

</BODY>
</HTML>



