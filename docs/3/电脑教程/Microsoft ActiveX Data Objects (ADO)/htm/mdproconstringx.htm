<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>ConnectionString、ConnectionTimeout 和 State 属性范例</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h3><a name="mdproconstringx"></a>ConnectionString、ConnectionTimeout 和 State 属性范例</h3>
<p>
该范例说明了使用 <b>ConnectionString</b> 属性打开 <b>Connection</b> 对象的不同方法。同时还使用 <b>ConnectionTimeout</b> 属性设置连接超时时间，并使用 <b>State</b> 属性检查连接的状态。该过程运行时需要 <b>GetState</b> 函数。</p>
<pre>Public Sub ConnectionStringX()

   Dim cnn1 As ADODB.Connection
   Dim cnn2 As ADODB.Connection
   Dim cnn3 As ADODB.Connection
   Dim cnn4 As ADODB.Connection

   ' 不使用数据源名 (DSN) 打开连接。
   Set cnn1 = New ADODB.Connection
   cnn1.<span class=cfe><b>ConnectionString</b></span> = "driver={SQL Server};" &amp; _
      "server=bigsmile;uid=sa;pwd=pwd;database=pubs"
   cnn1.<span class=cfe><b>ConnectionTimeout</b></span> = 30
   cnn1.Open
   
   ' 使用 DSN 和 ODBC 标记打开连接。
   Set cnn2 = New ADODB.Connection
   cnn2.<span class=cfe><b>ConnectionString</b></span> = "DSN=Pubs;UID=sa;PWD=pwd;"
   cnn2.Open
   
   ' 使用 DSN 和 OLE DB 标记打开连接。
   Set cnn3 = New ADODB.Connection
   cnn3.<span class=cfe><b>ConnectionString</b></span> = "Data Source=Pubs;User ID=sa;Password=pwd;"
   cnn3.Open
   
   ' 使用 DSN 和单个参数而非连接字符串打开连接。
   Set cnn4 = New ADODB.Connection
   cnn4.Open "Pubs", "sa", "pwd"
 
   ' 显示连接的状态。
   MsgBox "cnn1 state: " &amp; GetState(cnn1.<span class=cfe><b>State</b></span>) &amp; vbCr &amp; _
      "cnn2 state: " &amp; GetState(cnn2.<span class=cfe><b>State</b></span>) &amp; vbCr &amp; _
      "cnn3 state: " &amp; GetState(cnn3.<span class=cfe><b>State</b></span>) &amp; vbCr &amp; _
      "cnn4 state: " &amp; GetState(cnn4.<span class=cfe><b>State</b></span>)

   cnn4.Close
   cnn3.Close
   cnn2.Close
   cnn1.Close

End Sub

Public Function GetState(intState As Integer) As String

   Select Case intState
      Case adStateClosed
         GetState = "adStateClosed"
      Case adStateOpen
         GetState = "adStateOpen"
   End Select

End Function</pre>
</BODY>
</HTML>
