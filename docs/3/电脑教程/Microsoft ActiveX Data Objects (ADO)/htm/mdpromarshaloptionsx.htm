<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>MarshalOptions 属性范例</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h3><a name="mdpromarshaloptionsx"></a>MarshalOptions 属性范例</h3>
<p>
该范例使用 <b>MarshalOptions</b> 属性，指定将哪些行（所有行还是已修改的行）发送回服务器。</p>
<pre>Public Sub MarshalOptionsX()

   Dim rstEmployees As ADODB.Recordset
   Dim strCnn As String
   Dim strOldFirst As String
   Dim strOldLast As String
   Dim strMessage As String
   Dim strMarshalAll As String
   Dim strMarshalModified As String
   
   ' 使用雇员表的姓名打开记录集。
   strCnn = "Provider=sqloledb;" &amp; _
      "Data Source=srv;Initial Catalog=pubs;User Id=sa;Password=; "
   Set rstEmployees = New ADODB.Recordset
   rstEmployees.CursorType = adOpenKeyset
   rstEmployees.LockType = adLockOptimistic
   rstEmployees.CursorLocation = adUseClient
   rstEmployees.Open "SELECT fname, lname " &amp; _
      "FROM Employee ORDER BY lname", strCnn, , , adCmdText

   ' 存储原始数据。
   strOldFirst = rstEmployees!fname
   strOldLast = rstEmployees!lname
   
   ' 更改编辑缓冲区中的数据。
   rstEmployees!fname = "Linda"
   rstEmployees!lname = "Kobara"

   ' 显示缓冲区中的内容并让用户输入。
   strMessage = "Edit in progress:" &amp; vbCr &amp; _
      " Original data = " &amp; strOldFirst &amp; " " &amp; _
      strOldLast &amp; vbCr &amp; " Data in buffer = " &amp; _
      rstEmployees!fname &amp; " " &amp; rstEmployees!lname &amp; vbCr &amp; vbCr &amp; _
      "Use Update to replace the original data with " &amp; _
      "the buffered data in the Recordset?"
   strMarshalAll = "Would you like to send all the rows " &amp; _
               "in the recordset back to the server?"
   strMarshalModified = "Would you like to send only " &amp; _
               "modified rows back to the server?"
 
   If MsgBox(strMessage, vbYesNo) = vbYes Then
      If MsgBox(strMarshalAll, vbYesNo) = vbYes Then
         rstEmployees.<span class=cfe><b>MarshalOptions</b></span> = adMarshalAll
         rstEmployees.Update
      ElseIf MsgBox(strMarshalModified, vbYesNo) = vbYes Then
         rstEmployees.<span class=cfe><b>MarshalOptions</b></span> = adMarshalModifiedOnly
         rstEmployees.Update
      End If
   End If
   
   ' 显示结果数据。
   MsgBox "Data in recordset = " &amp; rstEmployees!fname &amp; " " &amp; _
      rstEmployees!lname

   ' 恢复原始数据，因为这只是演示。
   If Not (strOldFirst = rstEmployees!fname And _
         strOldLast = rstEmployees!lname) Then
      rstEmployees!fname = strOldFirst
      rstEmployees!lname = strOldLast
      rstEmployees.Update
   End If

   rstEmployees.Close

End Sub</pre>
</BODY>
</HTML>
