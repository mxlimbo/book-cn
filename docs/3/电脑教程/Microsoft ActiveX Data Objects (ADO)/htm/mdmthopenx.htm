<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>Open 和 Close 方法范例</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h3><a name="mdmthopenx"></a>Open 和 Close 方法范例</h3>
<p>
该范例使用已经打开的 <b>Recordset</b> 和 <b>Connection</b> 对象的 <b>Open</b> 和 <b>Close</b> 方法。</p>
<pre>Public Sub OpenX()

   Dim cnn1 As ADODB.Connection
   Dim rstEmployees As ADODB.Recordset
   Dim strCnn As String
   Dim varDate As Variant

   ' 打开连接。
      strCnn = "Provider=sqloledb;" &amp; _
      "Data Source=srv;Initial Catalog=pubs;User Id=sa;Password=; "
   Set cnn1 = New ADODB.Connection
   cnn1.Open strCnn
   
   ' 打开雇员表。
   Set rstEmployees = New ADODB.Recordset
   rstEmployees.CursorType = adOpenKeyset
   rstEmployees.LockType = adLockOptimistic
   rstEmployees.Open "employee", cnn1, , , adCmdTable

   ' 将第一个雇员记录的受雇日期赋值给变量，然后更改受雇日期。
   varDate = rstEmployees!hire_date
   Debug.Print "Original data"
   Debug.Print "&nbsp; Name - Hire Date"
   Debug.Print "&nbsp; " &amp; rstEmployees!fName &amp; " " &amp; _
      rstEmployees!lName &amp; " - " &amp; rstEmployees!hire_date
   rstEmployees!hire_date = #1/1/1900#
   rstEmployees.Update
   Debug.Print "Changed data"
   Debug.Print "&nbsp; Name - Hire Date"
   Debug.Print "&nbsp; " &amp; rstEmployees!fName &amp; " " &amp; _
      rstEmployees!lName &amp; " - " &amp; rstEmployees!hire_date

   ' 再查询 Recordset 并重置受雇日期。
   rstEmployees.Requery
   rstEmployees!hire_date = varDate
   rstEmployees.Update
   Debug.Print "Data after reset"
   Debug.Print "&nbsp; Name - Hire Date"
   Debug.Print "&nbsp; " &amp; rstEmployees!fName &amp; " " &amp; _
      rstEmployees!lName &amp; " - " &amp; rstEmployees!hire_date

   rstEmployees.Close
   cnn1.Close

End Sub
</pre>
<p class=label>
<b>VBScript 版本</b></p>
<p>
下面是使用 VBScript 编写、并用于 Active Server Page (ASP) 的相同范例。如需查看该完整功能范例，请使用与 IIS 一同安装并位于 C:\InetPub\ASPSamp\AdvWorks 的数据源 AdvWorks.mdb，来创建名为 AdvWorks 的系统“数据源名称”(DSN)。这是 Microsoft Access 数据库文件。请使用查找命令定位文件 Adovbs.inc，并将其放入计划使用的目录中。请将以下代码剪切并粘贴到记事本或其他文本编辑器中，另存为“ADOOpen.asp”。这样，便可在任何客户端浏览器中查看结果。</p>
<pre>&lt;!-- #Include file="ADOVBS.INC" --&gt;
&lt;HTML&gt;&lt;HEAD&gt;
&lt;TITLE&gt;ADO Open Method&lt;/TITLE&gt;
&lt;/HEAD&gt;&lt;BODY&gt; 
&lt;FONT FACE="MS SANS SERIF" SIZE=2&gt;
&lt;Center&gt;&lt;H3&gt;ADO Open Method&lt;/H3&gt;
&lt;TABLE WIDTH=600 BORDER=0&gt;
&lt;TD VALIGN=TOP ALIGN=LEFT COLSPAN=3&gt;&lt;FONT SIZE=2&gt;
&lt;!--- 用于创建 2 个记录集的 ADO 连接 --&gt;
&lt;% 
Set OBJdbConnection = Server.CreateObject("ADODB.Connection") 
OBJdbConnection.Open "AdvWorks" 
SQLQuery = "SELECT * FROM Customers" 
' 第一个记录集 RSCustomerList
Set RSCustomerList = OBJdbConnection.Execute(SQLQuery) 
' 第二个记录集 RsProductist
Set RsProductList = Server.CreateObject("ADODB.Recordset")
RsProductList.CursorType = adOpenDynamic
RsProductList.LockType = adLockOptimistic
RsProductList.Open "Products", OBJdbConnection 
%&gt;
&lt;TABLE COLSPAN=8 CELLPADDING=5 BORDER=0&gt;

&lt;!-- Customer 表的 BEGIN 列标头行 --&gt;

&lt;TR&gt;&lt;TD ALIGN=CENTER BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;Company Name&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;Contact Name&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER WIDTH=150 BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;E-mail address&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;City&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;State/Province&lt;/FONT&gt;&lt;/TD&gt;&lt;/TR&gt;

&lt;!-- 显示 Customer 表的 ADO 数据 --&gt;
&lt;% Do While Not RScustomerList.EOF %&gt;
  &lt;TR&gt;&lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt; 
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RSCustomerList("CompanyName")%&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RScustomerList("ContactLastName") &amp; ", " %&gt; 
  &lt;%= RScustomerList("ContactFirstName") %&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt;
  &lt;%= RScustomerList("ContactLastName")%&gt; 
 &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RScustomerList("City")%&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RScustomerList("StateOrProvince")%&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;&lt;/TR&gt; 
&lt;!-Next Row = Record Loop 并添加到 html 表 --&gt;
&lt;% 
RScustomerList.MoveNext 
Loop 
RScustomerList.Close
OBJdbConnection.Close
%&gt;
&lt;/TABLE&gt;
&lt;HR&gt;
&lt;TABLE COLSPAN=8 CELLPADDING=5 BORDER=0&gt;

&lt;!-- Product List 表的 BEGIN 列标头行 --&gt;

&lt;TR&gt;&lt;TD ALIGN=CENTER BGCOLOR="#800000"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;Product Type&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR="#800000"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;Product Name&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER WIDTH=350 BGCOLOR="#800000"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;Product Description&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR="#800000"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;Unit Price&lt;/FONT&gt;&lt;/TD&gt;&lt;/TR&gt;
&lt;!-- 显示 ADO Data 的 Product List --&gt;
&lt;% Do While Not RsProductList.EOF %&gt;
  &lt;TR&gt;  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt; 
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RsProductList("ProductType")%&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt; 
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RsProductList("ProductName")%&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt;
 &nbsp; &lt;%= RsProductList("ProductDescription")%&gt; 
 &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RsProductList("UnitPrice")%&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;
  
&lt;!--&nbsp; Next Row = Record --&gt;
&lt;% 
RsProductList.MoveNext 
Loop 
' 从 Memory Freeing 删除对象。 
Set RsProductList = Nothing
Set OBJdbConnection = Nothing
%&gt;
&lt;/TABLE&gt;&lt;/FONT&gt;&lt;/Center&gt;&lt;/BODY&gt;&lt;/HTML&gt;
</pre>
</BODY>
</HTML>
