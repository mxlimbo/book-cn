<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>CacheSize 属性范例</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h3><a name="mdprocachesizex"></a>CacheSize 属性范例</h3>
<p>
该范例使用 <b>CacheSize</b> 属性，说明当使用和不使用记录数为 30 的缓存时，所执行的操作在性能上的差别。</p>
<pre>Public Sub CacheSizeX()

   Dim rstRoySched As ADODB.Recordset
   Dim strCnn As String
   Dim sngStart As Single
   Dim sngEnd As Single
   Dim sngNoCache As Single
   Dim sngCache As Single
   Dim intLoop As Integer
   Dim strTemp As String

   ' 打开 RoySched 表。
   strCnn = "Provider=sqloledb;" &amp; _
      "Data Source=srv;Initial Catalog=pubs;User Id=sa;Password=; "
   Set rstRoySched = New ADODB.Recordset
   rstRoySched.Open "roysched", strCnn, , , adCmdTable

   ' 枚举记录集对象两次并记录经历的时间。
   sngStart = Timer

   For intLoop = 1 To 2
      rstRoySched.MoveFirst

      Do While Not rstRoySched.EOF
         ' Execute a simple operation for the
         ' performance test.
         strTemp = rstRoySched!title_id
         rstRoySched.MoveNext
      Loop
   Next intLoop

   sngEnd = Timer
   sngNoCache = sngEnd - sngStart

   ' 以 30 个记录为一组缓存记录。
   rstRoySched.MoveFirst
   rstRoySched.<span class=cfe><b>CacheSize</b></span> = 30
   sngStart = Timer

   ' 枚举记录集对象两次并记录经历的时间。
   For intLoop = 1 To 2

      rstRoySched.MoveFirst
      Do While Not rstRoySched.EOF
         ' 执行一个简单操作，进行性能测试。
         strTemp = rstRoySched!title_id
         rstRoySched.MoveNext
      Loop
   Next intLoop

   sngEnd = Timer
   sngCache = sngEnd - sngStart

   ' 显示性能结果。
   MsgBox "Caching Performance Results:" &amp; vbCr &amp; _
      "   No cache: " &amp; Format(sngNoCache, _
      "##0.000") &amp; " seconds" &amp; vbCr &amp; _
      "   30-record cache: " &amp; Format(sngCache, _
      "##0.000") &amp; " seconds"
   rstRoySched.Close

End Sub</pre>
</BODY>
</HTML>
