<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>BeginTrans、CommitTrans 和 RollbackTrans 方法</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h1><a name="mdmthbegintrans"></a>BeginTrans、CommitTrans 和 RollbackTrans 方法</h1>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:请参阅">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="mdmthBeginTrans_C">
</object>&nbsp;&nbsp;&nbsp;<object id=alink_2 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:范例">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="mdmthBeginTrans_X">
</object>&nbsp;&nbsp;&nbsp;<object id=alink_3 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:应用于">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="mdmthBeginTrans_A">
</object></p>
<p>
这些事务方法按如下方式管理 <a href="mdobjconnection.htm">Connection</a> 对象中的事务进程：
<ul type=disc>
<li>
<b>BeginTrans</b> - 开始新事务。<br><br></li>
<li>
<b>CommitTrans</b> - 保存任何更改并结束当前事务。它也可能启动新事务。<br><br></li>
<li>
<b>RollbackTrans</b> - 取消当前事务中所作的任何更改并结束事务。它也可能启动新事务。</li>
</ul>
<p class=label>
<b>语法</b></p>
<p>
<i>level</i> <b>=</b> <i>object</i><b>.BeginTrans()</b></p>
<p>
<i>object</i><b>.BeginTrans</b></p>
<p>
<i>object</i><b>.CommitTrans</b></p>
<p>
<i>object</i><b>.RollbackTrans</b></p>
<p class=label>
<b>返回值</b></p>
<p>
<b><i>BeginTrans</i></b> 可以作为函数调用，用于返回指示事务嵌套层次的长整型变量。</p>
<p class=label>
<b>参数</b></p>
<p>
<i>object&nbsp;&nbsp;&nbsp;</i><b>Connection</b> 对象。</p>
<p class=label>
<b>Connection</b></p>
<p>
如果希望以独立单元保存或取消对源数据所做的一系列更改，请使用这些具有 <b>Connection </b>对象的方法。例如在货币转帐时，必须从帐户中减去某个数额并将其对等数额添加到另一个帐户。无论其中的哪个更新失败，都将导致帐户收支不平衡。在打开的事务中进行这些更改可确保只能选择进行全部更改或不作任何更改。</p>
<p class=indent>
<B><b>注意&nbsp;&nbsp;&nbsp;</b></B>并非所有提供者都支持事务。需验证提供者定义的属性“Transaction DDL”是否出现在 <b>Connection </b>对象的 <b>Properties </b>集合中，如果在则表示提供者支持事务。如果提供者不支持事务，调用其中的某个方法将返回错误。</p>
<p>
一旦调用了<b> BeginTrans</b> 方法，在调用<b> CommitTrans</b> 或<b> RollbackTrans</b> 结束事务之前，提供者将不再立即提交所作的任何更改。</p>
<p>
对于支持嵌套事务的提供者来说，调用已打开事务中的 <b>BeginTrans </b>方法将开始新的嵌套事务。返回值将指示嵌套层次：返回值为 1 表示已打开顶层事务（即事务不被另一个事务所嵌套），返回值为 2 表示已打开第二层事务（嵌套在顶层事务中的事务），依次类推。调用 <b>CommitTrans </b>或 <b>RollbackTrans </b>只影响最新打开的事务；在处理任何更高层事务之前必须关闭或回卷当前事务。</p>
<p>
调用 <b>CommitTrans </b>方法将保存连接上打开的事务中所做的更改并结束事务。调用 <b>RollbackTrans </b>方法还原打开事务中所做的更改并结束事务。在未打开事务时调用其中任何一种方法都将引发错误。</p>
<p>
取决于 <b>Connection</b> 对象的 <a href="mdproattributes.htm">Attributes</a> 属性，调用 <b>CommitTrans </b>或 <b>RollbackTrans </b>方法都可以自动启动新事务。如果 <b>Attributes </b>属性设置为 <b>adXactCommitRetaining</b>，提供者在 <b>CommitTrans </b>调用后会自动启动新事务。如果 <b>Attributes </b>属性设置为 <b>adXactAbortRetaining</b>，提供者在调用 <b>RollbackTrans </b>之后将自动启动新事务。</p>
<p class=label>
</p>
<p class=label>
<b>远程数据服务</b></p>
<p>
<b>BeginTrans</b>、<b>CommitTrans</b> 和 <b>RollbackTrans</b> 方法在客户端<b> Connection</b> 对象上无效。</p>
</BODY>
</HTML>
