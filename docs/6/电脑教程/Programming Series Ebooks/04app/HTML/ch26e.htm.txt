<HTML>
<HEAD>
<TITLE>Waking a Thread</TITLE>
<link rel="STYLESHEET" type="text/css" href="advwin4.css">
<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch26d.htm">[Previous]</A> <A HREF="ch26f.htm">[Next]</A><P>

<A NAME="352"><H1>Waking a Thread</H1></A>

<p>When a thread calls <i>GetMessage</i> or <i>WaitMessage</i> and
there are no messages for the thread or windows created by the thread,
the system can suspend the thread so that it is not scheduled any CPU
time. However, when a message is posted or sent to the thread, the
system sets a wake flag indicating that the thread should now be
scheduled CPU time to process the message. Under normal circumstances,
the user is not typing or moving the mouse and no messages are being
sent to any of the windows. This means that most of the threads in the
system are not being scheduled any CPU time.</p>

<A NAME="353"><H2>The Queue Status Flags</H2></A>

<p>When a thread is running, it can query the status of its queues by
calling the <i>GetQueueStatus</i> function:</p>

<p><table cellpadding=5><tr><td>
<PRE>
DWORD燝etQueueStatus(UINT爁uFlags);
</pre></td></tr></table></p>

<p>The <i>fuFlags</i> parameter is a flag or a set of flags ORed
together that allows you to test for specific wake bits. The following
table shows the possible flag values and their meanings.</p>

<p><table cellpadding=5 width="95%">
<tr><th>Flag</th>
<th>Message in the Queue</th></tr>

<tr><td valign="top">QS_KEY</td>
<td valign="top">WM_KEYUP, WM_KEYDOWN, WM_SYSKEYUP, or WM_SYSKEYDOWN</td></tr>

<tr><td valign="top">QS_MOUSEMOVE</td>
<td valign="top">WM_MOUSEMOVE</td></tr>

<tr><td valign="top">QS_MOUSEBUTTON</td>
<td valign="top">WM_?BUTTON* (Where ? is L, M, or R, and * is DOWN, UP, or DBLCLK)</td></tr>

<tr><td valign="top">QS_MOUSE</td>
<td valign="top">Same as QS_MOUSEMOVE | QS_MOUSEBUTTON</td></tr>

<tr><td valign="top">QS_INPUT</td>
<td valign="top">Same as QS_MOUSE | QS_KEY</td></tr>

<tr><td valign="top">QS_PAINT</td>
<td valign="top">WM_PAINT</td></tr>

<tr><td valign="top">QS_TIMER</td>
<td valign="top">WM_TIMER</td></tr>

<tr><td valign="top">QS_HOTKEY</td>
<td valign="top">WM_HOTKEY</td></tr>

<tr><td valign="top">QS_POSTMESSAGE</td>
<td valign="top">Posted message (other than from a hardware input event). This flag is identical to QS_ALLPOSTMESSAGE except that this flag is cleared when the queue has no posted messages in the desired message filter range.</td></tr>

<tr><td valign="top">QS_ALLPOSTMESSAGE</td>
<td valign="top">Posted message (other than from a hardware input event). This flag is identical to QS_POSTMESSAGE except that this flag is only cleared when the queue has absolutely no posted messages (regardless of any message filter range).</td></tr>

<tr><td valign="top">QS_ALLEVENTS</td>
<td valign="top">Same as QS_INPUT | QS_POSTMESSAGE | QS_TIMER | QS_PAINT | QS_HOTKEY</td></tr>

<tr><td valign="top">QS_QUIT</td>
<td valign="top"><i>PostQuitMessage</i> has been called. Note that this flag is not documented and does not exist in the WinUser.h file. It is used internally by the system.</td></tr>

<tr><td valign="top">QS_SENDMESSAGE</td>
<td valign="top">Message sent by another thread</td></tr>

<tr><td valign="top">QS_ALLINPUT</td>
<td valign="top">Same as QS_ALLEVENTS | QS_SENDMESSAGE</td></tr>
</table></p>

<p>When you call the <i>GetQueueStatus</i> function, the <i>fuFlags</i>
parameter tells <i>GetQueueStatus</i> the types of messages to check
for in the queues. The fewer the number of QS_* identifiers you OR
together, the faster the call executes. Then when <i>GetQueueStatus</i>
returns, the types of messages currently in the thread's queues can
be found in the high word of the return value. This returned set of
flags will always be a subset of what you asked for. For example,
let's say you make the following call:</p>

<p><table cellpadding=5><tr><td>
<PRE>
BOOL爁PaintMsgWaiting