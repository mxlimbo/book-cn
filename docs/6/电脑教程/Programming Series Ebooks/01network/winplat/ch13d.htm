<HTML>
<HEAD>
<TITLE>Internet Group Management Protocol</title>
<link rel="STYLESHEET" type="text/css" href="Library.css">


</head>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch13c.htm" , "ch13e.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>



<A NAME="409"><H1>Internet Group Management Protocol</H1></A>

<p>The IGMP protocol is used by IP multicasting to manage membership to multicast groups. Consult <A HREF="ch11a.htm">Chapter 11</A> for information on how to use Winsock to join and leave multicast groups. When an application joins a multicast group, it sends an IGMP message to every router on a local network, using the special address 224.0.0.2. This address is known as the all-routers group. This IGMP message tells the routers that there is a recipient for any data destined for the given multicast address. The routers forward data for this multicast group if and only if a recipient is interested in receiving that data. Without this ability, multicast data is nothing more than a broadcast.</p>

<p>To make matters a bit more confusing, there are two versions of the IGMP protocol: version 1 and version 2. They are described in RFC 1112 and RFC 2236, respectively. The major difference between them is that version 1 has no method for a host to tell the router to stop forwarding data destined for a multicast group. In other words, when a host decides to drop group membership, the host does not notify the router and the router continues to forward data for that group until it sends a group query for that group and no one responds. Version 2 of the protocol adds an explicit &quot;leave&quot; message so hosts can notify routers immediately when they are dropping membership. Additionally, the header formats for the two versions are slightly different. Figure 13-3 illustrates the version 1 header, while Figure 13-4 shows the version 2 header. At only 8 bytes in length, both headers are simple.</p>

<p>
<A HREF="javascript:fullSize('F13JI03x.htm')"> <img src="images/F13JI03.JPG" width=404 height=108 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 13-3.</b> <i>IGMPv1 header format</i><!-- /caption -->
</p>

<p>
<A HREF="javascript:fullSize('F13JI04x.htm')"> <img src="images/F13JI04.JPG" width=404 height=108 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 13-4.</b> <i>IGMPv2 header format</i><!-- /caption -->
</p>

<p>Version 1 has two 4-bit fields. The first field is the IGMP version, and the second field is the IGMP message type. In version 2, a single 8-bit field replaces these two fields. Additionally, the unused field in version 1 becomes the maximum response time field. The Max Response Time field is meaningful only in Membership Query messages: it specifies the maximum time allowed before sending a responding report in units of 0.1 second. In all other messages, the sender sets this field to 0 and receivers ignore it.</p>

<p>For IGMPv1, the version field is always set to 1 and the type field is one of two possible values, shown in Table 13-2. Routers use the host membership query (0x1) to determine which multicast groups the host is using. In this case, the group address field is 0. The router sends the packet to the all-hosts address (224.0.0.1). If any hosts are still members of any group, each host sends a host membership report (IGMP message type 0x2) back to the all-routers address with the address to which it is joined. When a host first joins a group, a host membership report message is sent to the all-routers group as well.</p>

<p>As shown in Table 13-3, version 2 of IGMP adds two new message types: version 2 membership report (0x16) and leave group (0x17). Notice that the other two messages are the same as the version 1 messages (host membership query and membership report), even though their assigned values are different. However, remember that the version 2 IGMP packet condenses the version and type fields into a single field, and 0x11 is 00010001 in binary, which neatly makes itself look like an IGMP packet with version equal to 1 and type equal to 1.</p>

<p><b>Table 13-2.</b> <i>IGMP version 1 message types</i></p>

<table cellpadding="5" border="0" width="95%">
<tr><th><i>Type</i></th><th><i>Description</i></th></tr>
<tr><td valign="top">0x1</td><td valign="top">Host membership query</td></tr>
<tr><td valign="top">0x2</td><td valign="top">Host membership report</td></tr>
</table>

<p><b>Table 13-3.</b> <i>IGMP version 2 message types</i></p>

<table cellpadding="5" border="0" width="95%">
<tr><th><i>Type</i></th><th><i>Description</i></th></tr>
<tr><td valign="top">0x11</td><td valign="top">Membership query</td></tr>
<tr><td valign="top">0x12</td><td valign="top">Version 1 membership report</td></tr>
<tr><td valign="top">0x16</td><td valign="top">Version 2 membership report</td></tr>
<tr><td valign="top">0x17</td><td valign="top">Leave group</td></tr>
</table>

<p>The membership query (0x11) in version 2 is different from the membership query in version 1 in one minor way. Not only can it do the general query, as in version 1, it can also query for membership on a network for a specific group address. It does this by sending a membership query packet to the all-hosts group with a specific group in the group address field for which it wants to query. The version 2 membership report is new, as it allows the use of the maximum timeout field that controls the amount of time hosts have to respond to the query before it stops forwarding IP multicast traffic for the given group.</p>

</BODY>
</HTML>




