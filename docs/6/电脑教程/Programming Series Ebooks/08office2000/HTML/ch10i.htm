<HTML>
<HEAD>
<TITLE>Supporting saveSnapshot</TITLE>
<link rel="STYLESHEET" type="text/css" href="webcomp.css">
<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch10h.htm">[Previous]</A> <A HREF="ch10j.htm">[Next]</A><P>

<A NAME="204"><H1>Supporting saveSnapshot</H1></A>

<P>So far, we have discussed how the Stock Ticker control obtains new data and 
how the Spreadsheet control updates the stock portfolio with new data as it arrives. 
However, assuming a user has taken the time to enter a set of symbols to watch and 
filled out the portfolio section of the spreadsheet, it is also helpful to let the user save 
the current portfolio so that he or she can open the page later and see current data 
inputs to the complete portfolio. To enable this, we can save a user's portfolio to a 
server using the technique described in <A HREF="ch08a.htm">Chapter 8</A>; however, many users would be leery 
of letting a program save their private financial information to a network server. 
Instead, most users prefer to save the portfolio to their local file system.</P>

<P>At first, this might seem as easy as telling a user to choose the File|Save As 
menu item and save the page on his or her computer. But if you try this with a page of 
your own, you will find that Internet Explorer saves the page 
<I>as it originally arrived from the web 
server.</I> Any changes made to the spreadsheet after it was loaded will not 
be saved because Internet Explorer does not ask the controls on the page to 
repersist themselves. Instead, Internet Explorer persists the &lt;object&gt; and &lt;param&gt; tags as 
they originally came from the web server, losing all changes made since.</P>

<P>The Internet Explorer team realized that this was not optimal, and they 
also wanted to enable developers to save the current contents of other HTML controls 
such as text boxes, check boxes, and drop-down lists. To allow controls to save their 
current state when the user saves a page to his or her local machine, Internet Explorer 
defined a new behavior in version 5 called 
<I>saveSnapshot</I>. Behaviors are a whole new 
area of functionality for Internet Explorer 5, and discussing behaviors in general is 
beyond the scope of this book. However, I will explain here how the saveSnapshot 
behavior works and how you can include it in your web pages to support saving the 
current state of an OWC control.</P>

<P>In Internet Explorer 5, when the user chooses the File|Save As menu item, 
the browser examines all elements on the page, looking for any that the developer 
indicated should have the saveSnapshot behavior. For each control marked with 
the saveSnapshot behavior, Internet Explorer asks the control to persist its current state 
into a property bag, which is the standard mechanism used to save and load control 
properties. Internet Explorer saves the control's current property values in the page 
written to the local machine, enabling a user to open the page later and resume working.</P>

<P>To enable this behavior, the Internet Explorer documentation says you 
must include a specific &lt;meta&gt; tag in the &lt;head&gt; section and add the saveSnapshot 
behavior to each control that needs the ability to save its current state. I have found 
that the &lt;meta&gt; tag seems to be optional&#8212;Internet Explorer seems to save 
snapshots whether this tag is included or not. However, it is always a good idea to 
follow directions in these cases since you never know when such a tag will suddenly 
be required. The &lt;meta&gt; tag looks like this:</P>

<P><table cellpadding=5 width="95%"><tr><td>
<PRE>
&lt;head&gt;
&lt;!-- Other head section information omitted --&gt;

&lt;meta content=snapshot name=save&gt;
</pre></td></tr></table></p>

<P>After adding this &lt;meta&gt; tag, you next need to add the saveSnapshot 
behavior to your various controls. When adding a behavior to many controls at once, it is 
often useful to define a style class in your &lt;style&gt; section:</P>

<P><table cellpadding=5 width="95%"><tr><td>
<PRE>
&lt;style&gt;
&lt;!-- Other style information omitted --&gt;

.saveSnapshot 
{
    behavior: url(#default#saveSnapshot)
}
&lt;/style&gt;
</pre></td></tr></table></p>

<P>You can implement behaviors by using the new behavior style attribute. 
The saveSnapshot behavior is one of Internet Explorer's built-in behaviors, so I set the 
value of the behavior style attribute to url(#default#savesnapshot), which is the syntax 
for naming built-in behaviors. This style block defines a style class called 
saveSnapshot (though you can call it anything you want), which I can now use as the class 
attribute of any HTML element I want to have saved. If you want to do so with the 
Spreadsheet control, you need to use HTML that looks like this:</P>

<P><table cellpadding=5 width="95%"><tr><td>
<PRE>
&lt;div id=div1 class=saveSnapshot&gt;
&lt;object classid=&quot;clsid:0002E510-0000-0000-C000-000000000046&quot;
id=&quot;Spreadsheet1&quot; width=&quot;576&quot; height=&quot;288&quot;&gt;
&lt;!-- &lt;param&gt; tags omitted --&gt;
&lt;/object&gt;
&lt;/div&gt;
</pre></td></tr></table></p>

<P>The astute reader is probably wondering why I used the saveSnapshot style 
class on a &lt;div&gt; tag surrounding the Spreadsheet control's &lt;object&gt; tag. Theoretically, 
you should be able to use the class on the &lt;object&gt; tag itself and not include a &lt;div&gt; 
at all. However, the &lt;div&gt; tag is a required workaround to another Internet 
Explorer problem. Internet Explorer does not notice when the saveSnapshot behavior is 
used on an &lt;object&gt; tag, so you must wrap another HTML tag around your &lt;object&gt; 
tag. The easiest and least obtrusive tag to use is &lt;div&gt; because it has no visible 
manifestation and provides only a logical grouping of elements. Attaching the 
saveSnapshot style to the &lt;div&gt; tag causes Internet Explorer to persist all tags within &lt;div&gt;, 
which in this case is the Spreadsheet control's &lt;object&gt; tag. It's a hack, but it works. 
Perhaps the Internet Explorer development team will fix this in their next version.</p>

<P>You can also include the saveSnapshot behavior style attribute on each 
control or element instead of defining a style class. To do so, include the following 
style attribute on any HTML element you want to have saved:</P>

<P><table cellpadding=5 width="95%"><tr><td>
<PRE>
style=&quot;behavior:url(#default#savesnapshot)&quot;
</pre></td></tr></table></p>

<P>Keep in mind that the saveSnapshot behavior is new to Internet Explorer 
5. Previous versions of Internet Explorer will safely ignore this behavior.</P>

</BODY>
</HTML>





