<HTML>
<HEAD>
<TITLE>Part V: Creating the Magazine Articles</TITLE>
</HEAD>
<BODY BGCOLOR = "#ffffff">
<H1>Part V: Creating the Magazine Articles</H1>
<P>In this part of the project, you will create an ASP page to dynamically 
generate the magazine content based on the entries in the Magazine data 
source. ActiveX Data Objects (ADO) will read the data source and build the 
magazine article, and the linked style sheet will format the page.
<H2>
<B>Step 1</B>
</H2>
<P>If you don't already have the Magazine project open, open it now. 
Choose New from the File menu. In the New dialog box, insert a new ASP page, name 
it CONTENT.ASP, and click OK.
<H2>
<B>Step 2</B>
</H2>
<P>Creating the article page is a simple matter of reading the data out of 
the database and generating the article content. Add the following code to 
the BODY section of CONTENT.ASP:
<PRE WIDTH="0">&lt;%
`&#160;Variables
Dim&#160;objConnection
Dim&#160;objRecordset
Dim&#160;strSQL

`&#160;Open&#160;data&#160;source
Set&#160;objConnection&#160;=&#160;Server.CreateObject(&quot;ADODB.Connection&quot;)
objConnection.Open&#160;&quot;Magazine&quot;

`&#160;Build&#160;SQL&#160;statement
strSQL&#160;=&#160;&quot;SELECT&#160;*&#160;FROM&#160;Articles,Sections&#160;&quot;
strSQL&#160;=&#160;strSQL&#160;&amp;&#160;&quot;WHERE&#160;Sections.ArticleID&#160;=&#160;Articles.ArticleID&#160;&quot;
strSQL&#160;=&#160;strSQL&#160;&amp;&#160;&quot;AND&#160;Articles.ArticleID&#160;=&#160;&quot;&#160;&amp;&#160;_
&#160;&#160;&#160;&#160;Request.QueryString(&quot;ArticleID&quot;)

`&#160;Get&#160;records
Set&#160;objRecordset&#160;=&#160;Server.CreateObject(&quot;ADODB.Recordset&quot;)
objRecordset.Open&#160;strSQL,&#160;objConnection

`&#160;Get&#160;article&#160;information
Dim&#160;strTitle
Dim&#160;strSubTitle
Dim&#160;strNote

strTitle&#160;=&#160;objRecordset(&quot;ArticleTitle&quot;)&#160;&amp;&#160;&quot;&quot;
strSubTitle&#160;=&#160;objRecordset(&quot;ArticleSubTitle&quot;)&#160;&amp;&#160;&quot;&quot;
strNote&#160;=&#160;objRecordset(&quot;ArticleNote&quot;)&#160;&amp;&#160;&quot;&quot;

`&#160;Article&#160;title
If&#160;strTitle&#160;&lt;&gt;&#160;&quot;&quot;&#160;Then
%&gt;
&#160;&#160;&#160;&#160;&lt;H1&gt;&lt;%=strTitle%&gt;&lt;/H1&gt;&lt;%
End&#160;If

`&#160;Article&#160;subtitle
If&#160;strSubTitle&#160;&lt;&gt;&#160;&quot;&quot;&#160;Then
%&gt;
&#160;&#160;&#160;&#160;&lt;H4&gt;&lt;%=strSubTitle%&gt;&lt;/H4&gt;&lt;%
End&#160;If

`&#160;Build&#160;article&#160;body
`&#160;Variables
Dim&#160;strSection
Dim&#160;strText

Do&#160;While&#160;Not&#160;objRecordset.EOF
&#160;&#160;&#160;&#160;`&#160;Get&#160;section&#160;header
&#160;&#160;&#160;&#160;strSection&#160;=&#160;objRecordset(&quot;SectionTitle&quot;)&#160;&amp;&#160;&quot;&quot;
&#160;&#160;&#160;&#160;If&#160;strSection&#160;&lt;&gt;&#160;&quot;&quot;&#160;Then
%&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;H2&gt;&lt;%=strSection%&gt;&lt;/H2&gt;&lt;%
&#160;&#160;&#160;&#160;End&#160;If

&#160;&#160;&#160;&#160;`&#160;Get&#160;section&#160;text
&#160;&#160;&#160;&#160;strText&#160;=&#160;objRecordset(&quot;SectionText&quot;)&#160;&amp;&#160;&quot;&quot;
&#160;&#160;&#160;&#160;If&#160;strText&#160;&lt;&gt;&#160;&quot;&quot;&#160;Then
%&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;%=strText%&gt;
&lt;%
&#160;&#160;&#160;&#160;End&#160;if

&#160;&#160;&#160;&#160;`&#160;Get&#160;next&#160;section
&#160;&#160;&#160;&#160;objRecordset.MoveNext
Loop

`&#160;Close&#160;database
objRecordset.Close
objConnection.Close
Set&#160;objRecordset&#160;=&#160;Nothing
Set&#160;objConnection&#160;=&#160;Nothing
%&gt;
</PRE>
<H2>
<B>Step 3</B>
</H2>
<P>The site style sheet manages font styles for the magazine articles. Add the 
following code to the HEAD section of CONTENT.ASP to establish a link to 
the style sheet:
<PRE WIDTH="0">&lt;LINK&#160;REL=STYLESHEET&#160;HREF=&quot;Magazine.css&quot;&gt;
</PRE>
<H2>
<B>Step 4</B>
</H2>
<P>Save your work, and preview the site by right-clicking DEFAULT.ASP and 
selecting Browse With from the pop-up menu. In the Browse With dialog 
box, choose Internet Explorer. From the table of contents, select an article to 
view, and verify that your site is working. The result should look like the 
example in Figure 8-6.<P>
<img src="pictures/F08XF06.JPG" width=600 height=454 border=0><P>
<B>Figure 8-6.</B>


<I>Viewing an article.</I>
<H2>
<B>Step 5</B>
</H2>
<P>The Content Linking component can not only produce a table of contents, 
but it can also navigate through the linked pages. In this portion of the 
project, you will use the component to create navigational tools&#151;two images that 
allow the user to move backward and forward through the linked pages. To 
start, change the CONTENT.ASP page attributes that display hyperlinks. In 
particular, change the &lt;BODY&gt; tag to prevent the images you use from being 
highlighted in the page. Use this code:
<PRE WIDTH="0">&lt;BODY&#160;LINK=&quot;White&quot;&#160;VLINK=&quot;White&quot;&#160;ALINK=&quot;White&quot;&gt;
</PRE>
<P>If you use hard-coded Web pages in your content linking text file, 
the Content Linking component can automatically generate the next and 
previous links. In this project, however, you are generating content from a 
database, so you must perform some trickery to build the navigational tools. Add the 
following code to the top of the BODY section in CONTENT.ASP to create 
the navigational tools:
<PRE WIDTH="0">&lt;%
`&#160;This&#160;code&#160;creates&#160;navigational&#160;tools&#160;for&#160;the&#160;site

`&#160;Variables
Public&#160;objLinker
Public&#160;intArticleID
Public&#160;intArticles

`&#160;Get&#160;Content&#160;Linking&#160;object&#160;info
Set&#160;objLinker&#160;=&#160;Server.CreateObject(&quot;MSWC.NextLink&quot;)

`&#160;Get&#160;ArticleID
intArticleID&#160;=&#160;CInt(Request.QueryString(&quot;ArticleID&quot;))
intArticles&#160;=&#160;CInt(objLinker.GetListCount(&quot;Magazine.txt&quot;))
%&gt;

&lt;!-- Navigational&#160;tools --&gt;
&lt;DIV&gt;
&lt;!-- Next&#160;article --&gt;
&lt;%If&#160;intArticleID&#160;&gt;&#160;1&#160;Then%&gt;
&#160;&#160;&#160;&#160;&lt;A&#160;HREF=
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;%=objLinker.GetNthURL(&quot;Magazine.txt&quot;,&#160;intArticleID&#160;-&#160;1)%&gt;&gt;
&#160;&#160;&#160;&#160;&lt;IMG&#160;ID=&quot;imgBack&quot;&#160;SRC=&quot;/Magazine/Images/Back.gif&quot;&gt;
&#160;&#160;&#160;&#160;&lt;/A&gt;
&lt;%End&#160;If%&gt;

&lt;!-- Previous&#160;article --&gt;
&lt;%If&#160;intArticleID&#160;&lt;&#160;intArticles&#160;Then%&gt;
&#160;&#160;&#160;&#160;&lt;A&#160;HREF=&lt;%=objLinker.GetNthURL(&quot;Magazine.txt&quot;,&#160;intArticleID&#160;+&#160;1)%&gt;&gt;
&#160;&#160;&#160;&#160;&lt;IMG&#160;ID=&quot;imgNext&quot;&#160;SRC=&quot;/Magazine/Images/Next.gif&quot;&gt;
&#160;&#160;&#160;&#160;&lt;/A&gt;
&lt;%End&#160;If%&gt;
</PRE>
<H2>
<B>Step 6</B>
</H2>
<P>When the user passes the mouse over one of the navigational controls, the 
page should provide some information about the article that will be displayed if 
the link is activated. You can show a description of the next link by using 
Dynamic HTML and the information in the content linking text file. In this step, 
you will create two &lt;FONT&gt; tags that link descriptions of the articles to the 
Next and Back icons. Add the following code to the BODY section of the page, 
just below the section that generates the image controls for navigation:
<PRE WIDTH="0">&lt;!-- Article&#160;descriptions --&gt;
&lt;%If&#160;intArticleID&#160;&gt;&#160;1&#160;Then%&gt;
&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&#160;ID=&quot;txtBack&quot;&#160;SIZE=4
&#160;&#160;&#160;&#160;STYLE=&quot;position:relative;visibility:hidden;color:red;margin-left:20px&quot;&gt;
&#160;&#160;&#160;&#160;&lt;%=objLinker.GetNthDescription(&quot;Magazine.txt&quot;,&#160;intArticleID&#160;-&#160;1)%&gt;
&#160;&#160;&#160;&#160;&lt;/FONT&gt;&lt;BR&gt;
&lt;%End&#160;If%&gt;

&lt;%If&#160;intArticleID&#160;&lt;&#160;intArticles&#160;Then%&gt;
&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&#160;ID=&quot;txtNext&quot;&#160;SIZE=4
&#160;&#160;&#160;&#160;STYLE=&quot;position:relative;visibility:hidden;color:red;margin-left:20px&quot;&gt;
&#160;&#160;&#160;&#160;&lt;%=objLinker.GetNthDescription(&quot;Magazine.txt&quot;,&#160;intArticleID&#160;+&#160;1)%&gt;
&#160;&#160;&#160;&#160;&lt;/FONT&gt;
&lt;%End&#160;If%&gt;
</PRE>
<H2>
<B>Step 7</B>
</H2>
<P>In the &lt;FONT&gt; tags, the visibility argument of the STYLE attribute is 
initially set to hidden. Therefore, neither of the descriptions is visible at the start. 
A description will be displayed when the mouse passes over one of the 
images. Create a SCRIPT section in the HEAD section of the page to trap the 
mouse events and display the appropriate text. Here is the code:
<PRE WIDTH="0">&lt;SCRIPT&#160;LANGUAGE=&quot;VBScript&quot;&gt;
&lt;!--

&#160;&#160;&#160;&#160;Sub&#160;imgBack_OnMouseOver()
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtBack.Style.Visibility&#160;=&#160;&quot;Visible&quot;
&#160;&#160;&#160;&#160;End&#160;Sub

&#160;&#160;&#160;&#160;Sub&#160;imgBack_OnMouseOut()
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtBack.Style.Visibility&#160;=&#160;&quot;Hidden&quot;
&#160;&#160;&#160;&#160;End&#160;Sub

&#160;&#160;&#160;&#160;Sub&#160;imgNext_OnMouseOver()
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtNext.Style.Visibility&#160;=&#160;&quot;Visible&quot;
&#160;&#160;&#160;&#160;End&#160;Sub

&#160;&#160;&#160;&#160;Sub&#160;imgNext_OnMouseOut()
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtNext.Style.Visibility&#160;=&#160;&quot;Hidden&quot;
&#160;&#160;&#160;&#160;End&#160;Sub

--&gt;
&lt;/SCRIPT&gt;
</PRE>
<H2>
<B>Step 8</B>
</H2>
<P>Save your work, and test the site. Your navigational controls and 
descriptions should be fully functional and should look like the example shown in Figure&#160;8-7.<P>
<img src="pictures/F08XF07.JPG" width=600 height=450 border=0><P>
<B>Figure 8-7.</B>


<I>The navigational tools.</I>








</BODY>
</HTML>
