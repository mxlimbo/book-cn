<HTML>
<HEAD>
<TITLE>Part VI: Searching the Site</TITLE>
</HEAD>
<BODY BGCOLOR = "#ffffff">
<H1>Part VI: Searching the Site</H1>
<P>In this part, you will create full-text search capability to provide an index 
for the magazine.
<H2>
<B>Step 1</B>
</H2>
<P>If you don't already have the Magazine project open, open it now. 
Choose New from the File menu. In the New dialog box, create a new ASP page, name 
it SEARCH.ASP, and click OK.
<H2>
<B>Step 2</B>
</H2>
<P>Open DEFAULT.ASP in Visual InterDev Editor. You need to add a form to 
this page to access the SEARCH.ASP page. A search string should be entered in 
a text field and passed to the search engine. Add the following code to the 
BODY section to place a hyperlink in the page:
<PRE WIDTH="0">&lt;!-- Index&#160;search&#160;form --&gt;
&lt;DIV&#160;STYLE=&quot;position:absolute;&#160;top:250px;&#160;left:400px;&#160;width:200;&quot;&gt;
&#160;&#160;&#160;&#160;&lt;CENTER&gt;
&#160;&#160;&#160;&#160;&lt;IMG&#160;SRC=&quot;/Magazine/Images/Search.gif&quot;&gt;&lt;BR&gt;
&#160;&#160;&#160;&#160;&lt;FORM&#160;ACTION=&quot;/Magazine/Search.asp&quot;&#160;METHOD=&quot;POST&quot;&gt;
&#160;&#160;&#160;&#160;&lt;INPUT&#160;NAME=&quot;SearchString&quot;&gt;&lt;BR&gt;
&#160;&#160;&#160;&#160;&lt;INPUT&#160;TYPE=&quot;SUBMIT&quot;&#160;VALUE=&quot;Search!&quot;&gt;
&#160;&#160;&#160;&#160;&lt;/FORM&gt;
&#160;&#160;&#160;&#160;&lt;/CENTER&gt;
&lt;/DIV&gt;
</PRE>
<P>Save and close DEFAULT.ASP.
<H2>
<B>Step 3</B>
</H2>
<P>Open SEARCH.ASP, your new search engine for the site. In this page, you 
will open a connection to the database, provide a text search mechanism, and 
build a list of hyperlinks to the appropriate documents.<P>
Start by linking SEARCH.ASP to the site style sheet to maintain a 
consistent look. Add the following code to the HEAD section of SEARCH.ASP:
<PRE WIDTH="0">&lt;LINK&#160;REL=STYLESHEET&#160;HREF=&quot;Magazine.css&quot;&gt;
</PRE>
<H2>
<B>Step 4</B>
</H2>
<P>The actual search is performed by creating a query against the database, 
using the keyword submitted by the user. If the keyword appears in an 
article's text, a hyperlink is generated in the results page. In this step, you will use 
ADO to run the query and show the results of the search.
<P><HR><BLOCKQUOTE>
<B>NOTE:</b> The SQL statement for this exercise can be tricky to 
write. Although spread out across several lines of code, an example of 
the final statement might look like this:
</BLOCKQUOTE><HR>
<P>SELECT * FROM Articles, Sections WHERE Sections.ArticleID 
= Articles.ArticleID AND Sections.SectionText LIKE `%VBScript%'<P>
Add the following code to the BODY section of SEARCH.ASP to 
complete the page:
<PRE WIDTH="0">&lt;H1&gt;Here&#160;are&#160;the&#160;results&#160;of&#160;your&#160;search...&lt;/H1&gt;

&lt;%
`&#160;Variables
Dim&#160;objConnection
Dim&#160;objRecordset
Dim&#160;strSQL

`&#160;Open&#160;data&#160;source
Set&#160;objConnection&#160;=&#160;Server.CreateObject(&quot;ADODB.Connection&quot;)
objConnection.Open&#160;&quot;Magazine&quot;

`&#160;Build&#160;SQL&#160;statement
strSQL&#160;=&#160;&quot;SELECT&#160;*&#160;FROM&#160;Articles,Sections&#160;&quot;
strSQL&#160;=&#160;strSQL&#160;&amp;&#160;&quot;WHERE&#160;Sections.ArticleID&#160;=&#160;Articles.ArticleID&#160;&quot;
strSQL&#160;=&#160;strSQL&#160;&amp;&#160;&quot;AND&#160;Sections.SectionText&#160;LIKE&#160;`%&quot;&#160;&amp;&#160;_
&#160;&#160;&#160;&#160;Request.Form(&quot;SearchString&quot;)&#160;&amp;&#160;&quot;%'&quot;
`&#160;Get&#160;records
Set&#160;objRecordset&#160;=&#160;Server.CreateObject(&quot;ADODB.Recordset&quot;)
objRecordset.Open&#160;strSQL,&#160;objConnection%&gt;

&lt;TABLE&gt;
&lt;%
Do&#160;While&#160;Not&#160;objRecordset.EOF
%&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;A&#160;HREF=&quot;Content.asp?ArticleID=&lt;%=objRecordset(&quot;ArticleID&quot;)%&gt;&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;H3&gt;&lt;%=objRecordset(&quot;ArticleTitle&quot;)%&gt;&lt;/H3&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/A&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&lt;%
&#160;&#160;&#160;&#160;'&#160;Get&#160;next&#160;record
&#160;&#160;&#160;&#160;objRecordset.MoveNext
Loop
%&gt;
&lt;/TABLE&gt;
</PRE>
<H2>
<B>Step 5</B>
</H2>
<P>Save your work, and test the site. Try searching for a 
keyword. Your result should look like Figure 8-8.<P>
<img src="pictures/F08XF08.JPG" width=600 height=459 border=0><P>
<B>Figure 8-8.</B>


<I>Search results.</I>








</BODY>
</HTML>
