<HTML>
<HEAD>
<TITLE>Part IV:Taking Orders</TITLE>
</HEAD>
<BODY BGCOLOR = "#ffffff">
<H1>Part IV:Taking Orders</H1>
<P>In this part, you will take orders from the catalog and write them to a 
database by using the ADC.
<H2>
<B>Step 1</B>
</H2>
<P>Open the Catalog project. To add a new Web page for taking product 
orders, choose New from the File menu. In the New dialog box, add a new ASP 
page, name the page ORDERS.ASP, and click OK.
<H2>
<B>Step 2</B>
</H2>
<P>Right-click the file ORDERS.ASP in the project window, and choose Open 
With from the menu. In the Open With dialog box, open the file with 
Microsoft FrontPage Editor. Change the page's background color to white by 
selecting Background from the Format menu.<P>
To insert a banner into the page, choose Image from the Insert menu. 
In the Image dialog box, insert the image from the following location:
<PRE WIDTH="0">/CATALOG/IMAGES/ORDER.JPG
</PRE>
<P>Insert a horizontal rule below the image by choosing Horizontal 
Line from the Insert menu.
<H2>
<B>Step 3</B>
</H2>
<P>To insert a table for the orders, choose Insert Table from the Table menu. 
In the Insert Table dialog box, create a table with 2 columns and 10 rows. In 
the first column, add text to the cells to identify the fields in the table as 
Date, Product, First Name, Last Name, Address1, Address2, City, State, and Zip.
<H2>
<B>Step 4</B>
</H2>
<P>Save your work, and return to Visual InterDev. Open ORDERS.ASP in 
the Visual InterDev text editor. Identify the table that you inserted in 
FrontPage Editor, and modify the table to add text boxes and a pushbutton to the 
page. The finished form should look like the one pictured in Figure 7-10 on 
page 172. The code is shown on the following pages.
<PRE WIDTH="0">&lt;TABLE&#160;BORDER=&quot;0&quot;&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;Date&lt;/STRONG&gt;&lt;/FONT&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;DATASRC=&quot;#datOrders&quot;&#160;DATAFLD=&quot;Date&quot;&#160;NAME=&quot;txtDate&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;Product&lt;/STRONG&gt;&lt;/FONT&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;DATASRC=&quot;#datOrders&quot;&#160;DATAFLD=&quot;Product&quot;&#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NAME=&quot;txtProduct&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;First&#160;Name&lt;/STRONG&gt;&lt;/FONT&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;DATASRC=&quot;#datOrders&quot;&#160;DATAFLD=&quot;FirstName&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NAME=&quot;txtFirstName&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;Last&#160;Name&lt;/STRONG&gt;&lt;/FONT&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;DATASRC=&quot;#datOrders&quot;&#160;DATAFLD=&quot;LastName&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NAME=&quot;txtLastName&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;Address1&lt;/STRONG&gt;&lt;/FONT&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;DATASRC=&quot;#datOrders&quot;&#160;DATAFLD=&quot;Address1&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NAME=&quot;txtAddress1&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;Address2&lt;/STRONG&gt;&lt;/FONT&gt;&amp;nbsp;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;DATASRC=&quot;#datOrders&quot;&#160;DATAFLD=&quot;Address2&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;NAME=&quot;txtAddress2&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;City&lt;/STRONG&gt;&lt;/FONT&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;DATASRC=&quot;#datOrders&quot;&#160;DATAFLD=&quot;City&quot;&#160;NAME=&quot;txtCity&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;State&lt;/STRONG&gt;&lt;/FONT&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;DATASRC=&quot;#datOrders&quot;&#160;DATAFLD=&quot;State&quot;&#160;NAME=&quot;txtState&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;Zip&lt;/STRONG&gt;&lt;/FONT&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;DATASRC=&quot;#datOrders&quot;&#160;DATAFLD=&quot;Zip&quot;&#160;NAME=&quot;txtZip&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&#160;&#160;&#160;&#160;&lt;TR&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;FONT&#160;FACE=&quot;Verdana&quot;&gt;&lt;STRONG&gt;&lt;/STRONG&gt;&lt;/FONT&gt;&amp;nbsp;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;TD&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;INPUT&#160;TYPE=&quot;BUTTON&quot;&#160;NAME=&quot;cmdOrder&quot;&#160;VALUE=&quot;Order!&quot;&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&lt;/TD&gt;
&#160;&#160;&#160;&#160;&lt;/TR&gt;
&lt;/TABLE&gt;
</PRE>
<P><img src="pictures/F07XF10.JPG" width=600 height=452 border=0><P>
<B>Figure 7-10.</B>


<I>The Orders form.</I>
<H2>
<B>Step 5</B>
</H2>
<P>The table you created will be filled by the ADC, which will read the Orders 
table from the database and store the new order information. Add the following 
lines to the BODY section of your code to connect to the database:
<PRE WIDTH="0">&lt;!--&#160;The&#160;Advanced&#160;Data&#160;Control&#160;--&gt;
&lt;OBJECT&#160;ID=&quot;datOrders&quot;
&#160;&#160;&#160;&#160;CLASSID=&quot;CLSID:BD96C556-65A3-11D0-983A-00C04FC29E33&quot;
&#160;&#160;&#160;&#160;ALIGN=&quot;baseline&quot;&#160;BORDER=&quot;0&quot;&#160;WIDTH=&quot;50&quot;&#160;HEIGHT=&quot;50&quot;&gt;
&#160;&#160;&#160;&#160;&lt;PARAM&#160;NAME=&quot;Connect&quot;&#160;VALUE&#160;=&quot;DSN=HomePage&quot;&gt;
&#160;&#160;&#160;&#160;&lt;PARAM&#160;NAME&#160;=&quot;Server&quot;&#160;VALUE&#160;=&quot;<B><I>[your&#160;Web&#160;server]</I></B>&quot;&gt;
&#160;&#160;&#160;&#160;&lt;PARAM&#160;NAME&#160;=&quot;SQL&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;VALUE=&quot;SELECT&#160;*&#160;FROM&#160;Orders&#160;WHERE&#160;FirstName=`New&#160;Customer'&quot;&gt;
&lt;/OBJECT&gt;
</PRE>
<H2>
<B>Step 6</B>
</H2>
<P>Although the ADC can handle recordsets on the client, it cannot add 
new records to the database. You will have to rely on the ActiveX Data 
Objects (ADO) to add new records. (You can still use the ADC to update entries.) 
Add the following lines to the HEAD section of your code to generate a new record:
<PRE WIDTH="0">&lt;%

`&#160;Add&#160;a&#160;new&#160;blank&#160;record&#160;to&#160;the&#160;database
Set&#160;db&#160;=&#160;Server.CreateObject(&quot;ADODB.Connection&quot;)
db.Open&#160;&quot;HomePage&quot;

`&#160;Create&#160;SQL
strSQL&#160;=&#160;&quot;INSERT&#160;INTO&#160;Orders&#160;(FirstName,&#160;Product)&#160;VALUES&#160;&quot;&#160;&amp;&#160;_
&#160;&#160;&#160;&#160;&quot;(`New&#160;Customer','&quot;&#160;&amp;&#160;Request.QueryString(&quot;Product&quot;)&#160;&amp;&#160;&quot;`)&quot;

db.Execute&#160;strSQL

%&gt;
</PRE>
<H2>
<B>Step 7</B>
</H2>
<P>When all the data is filled in, you will want to save the new order in the 
database. However, before you allow the data to be saved, you should validate 
the values in the text fields. Add the following SCRIPT section to your code 
to perform the data validation:
<PRE WIDTH="0">&lt;SCRIPT&#160;LANGUAGE=&quot;VBScript&quot;&gt;
&lt;!--

&#160;&#160;&#160;&#160;Function&#160;Validate()
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Validate&#160;=&#160;True

&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;`&#160;Validate&#160;date
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;If&#160;Not&#160;IsDate(txtDate.Value)&#160;Then
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MsgBox&#160;&quot;Invalid&#160;date!&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Validate&#160;=&#160;False
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;End&#160;If

&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;`&#160;Validate&#160;text&#160;fields
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;If&#160;txtProduct&#160;=&#160;&quot;&quot;&#160;Or&#160;_
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtFirstName&#160;=&#160;&quot;&quot;&#160;Or&#160;_
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtLastName&#160;=&#160;&quot;&quot;&#160;Or&#160;_
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtAddress1&#160;=&#160;&quot;&quot;&#160;Or&#160;_
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtCity&#160;=&#160;&quot;&quot;&#160;Or&#160;_
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtState&#160;=&#160;&quot;&quot;&#160;Or&#160;_
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;txtZip&#160;=&#160;&quot;&quot;&#160;Then
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;MsgBox&#160;&quot;Please&#160;fill&#160;in&#160;all&#160;fields!&quot;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;Validate&#160;=&#160;False
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;End&#160;If
&#160;&#160;&#160;&#160;End&#160;Function

--&gt;
&lt;/SCRIPT&gt;
</PRE>
<H2>
<B>Step 8</B>
</H2>
<P>After the data has been validated, it can be saved in the database. To save 
the data, use the OnClick event of the cmdOrder button. Here is the code:
<PRE WIDTH="0">Sub&#160;cmdOrder_OnClick()
&#160;&#160;&#160;&#160;`&#160;Validate&#160;the&#160;data
&#160;&#160;&#160;&#160;If&#160;Not&#160;Validate&#160;Then&#160;Exit&#160;Sub

&#160;&#160;&#160;&#160;`&#160;Submit&#160;the&#160;form&#160;to&#160;the&#160;Orders&#160;table
&#160;&#160;&#160;&#160;datOrders.SubmitChanges

&#160;&#160;&#160;&#160;`&#160;Thank&#160;the&#160;customer
&#160;&#160;&#160;&#160;MsgBox&#160;&quot;Thanks&#160;for&#160;your&#160;order!&quot;

&#160;&#160;&#160;&#160;`&#160;Move&#160;to&#160;the&#160;home&#160;page
&#160;&#160;&#160;&#160;Window.Navigate&#160;&quot;default.htm&quot;
End&#160;Sub
</PRE>
<H2>
<B>Step 9</B>
</H2>
<P>Save your work, and view the site in Internet Explorer 4.0.







</BODY>
</HTML>
