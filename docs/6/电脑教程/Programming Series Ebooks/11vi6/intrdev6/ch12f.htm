<HTML>
<HEAD>
<LINK REL=StyleSheet HREF="Library.css" TYPE="text/css">
<TITLE>Database Projects</TITLE>


</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch12e.htm", "ch13a.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>
<A NAME="232"><H1>Database Projects</H1></A>
<P>Database projects are collections of one or more data connections that 
enable you to access your server database from within Visual InterDev. 
Database projects are also available within Visual C++ and Visual J++. Using 
database projects in addition to Web projects gives you the following benefits: 

</P>
<UL>
<P><LI>Data connections aren't required in a database project until you 
want to run a SQL script against a database. In addition, you can 
rename data connections in a database project.
</LI>
</P>
<P><LI>You can use source control to ensure that the database and its 
structure are under the administrator's control.
</LI>
</P>
<P><LI>You can easily deploy the database to other projects. 
</LI></P>
</UL>



<P>One of the main benefits of working with database projects is that 
you can create and manage database objects using SQL scripts. You can also 
put these files under Microsoft Visual SourceSafe control. 

</P>
<P>To create a database project:

</P>
<OL>
<P><LI>  Choose File|New Project from the main menu.
</LI>
</P>
<P><LI>  Select the Database Projects folder in the New Project dialog 
box, as shown in Figure 12-20.
</LI>
</P>
<P><LI>  Enter the name of the new database project, and click Open.
</LI>
</P>
<P><LI>  Select the data source from the Select Data Source dialog box, 
and click OK.
</LI>
</P>
<P><LI>  If connecting to SQL Server, enter the Login ID and Password for 
the data connection and click OK.
</LI>
</P>
</OL>
<P>
<A HREF="javascript:fullSize('f12lh20x.htm')"> <IMG SRC="images/f12lh20.jpg" width=404 height=283 border=0 ALT="Click to view at full size."> </A>
</P>
<P>
<!-- CAPTION --><B>Figure 12-20.</B> <I>The New Project dialog box showing the New Database Project icon.</I><!-- /CAPTION -->

</P>
<P>Once you have created a database project, you can use SQL script 
files to create and manage your database objects and store other frequently used 
SQL commands. 

</P>
<P>To create a new SQL script file and add it to a project in Visual InterDev:

</P>
<OL>
<P><LI>   Expand the database project folder in the Project Explorer.
</LI>
</P>
<P><LI>   Right-click the data connection, and choose Add SQL Script from 
the context menu. The Add Item dialog box is displayed, as shown 
in Figure 12-21.
</LI>
</P>
<P><LI>    Select the SQL Script icon in the right pane. Enter a name for the 
SQL script in the Name text box, and click Open. The SQL Editor 
window is displayed, and the SQL script is added to the Project 
Explorer under the data connection node.
</LI>
</P>
<P><LI>   In the SQL Editor window, enter SQL statements that define 
the database objects you want to add to the database project. 
</LI></P>
</OL>
<P>
<A HREF="javascript:fullSize('f12lh21x.htm')"> <IMG SRC="images/f12lh21.jpg" width=404 height=249 border=0 ALT="Click to view at full size."> </A>
</P>
<P>
<!-- CAPTION --><B>Figure 12-21.</B> <I>The Add Item dialog box, where you can create a new SQL script or choose from an existing SQL template.</I><!-- /CAPTION -->

</P>
<P>As you can see in Figure 12-21, you can use the SQL templates 
already supplied in addition to creating new SQL script files. You can select a SQL 
script file that creates a table, view, stored procedure, trigger, or query. If you 
select the Database Query option, Visual InterDev will launch the Query Designer. 
If you select any of the other options, Visual InterDev will launch the source 
code editor with the template SQL code ready for you to customize. Figure 
12-22 shows the template code for creating a new table.

</P>
<P>Visual InterDev makes it easy for you to generate SQL scripts for 
any existing database objects within your database project. You can select a 
single database object from within Data View or select multiple database objects. 

</P>
<P>To create a SQL script for creating a database object:

</P>
<OL>
<P><LI>  Within Data View, select one or more database objects for which 
you want to generate a SQL script to create the objects.
</LI>
</P>
<P><LI>  Once you have selected the database objects, simply right-click 
them and choose the Copy SQL Script command from the context menu. 
</LI>
</P>
<P><LI>  From within Project Explorer, right-click the data connection 
object and choose Paste.
</LI>
</P>
</OL>




<P>Your SQL script will now be added to the project. If you are using source 
control, you'll be prompted about whether you want to add the SQL file to 
source control on the server. The prompt is shown in Figure 12-23.
</P>
<P>
<A HREF="javascript:fullSize('f12lh22x.htm')"> <IMG SRC="images/f12lh22.jpg" width=404 height=303 border=0 ALT="Click to view at full size."> </A>
</P>
<P>
<!-- CAPTION --><B>Figure 12-22.</B> <I>A database project showing the template SQL code for creating a new table.</I><!-- /CAPTION -->
</P>
<P>
<A HREF="javascript:fullSize('f12lh23x.htm')"> <IMG SRC="images/f12lh23.jpg" width=404 height=315 border=0 ALT="Click to view at full size."> </A>
</P>
<P>
<!-- CAPTION --><B>Figure 12-23.</B> <I>The Push Add To Server dialog box asks you whether you want to add your SQL script to source control.</I><!-- /CAPTION -->

</P>
<P>The following code shows an example of a SQL script that is 
generated for the Login table in the VI-Bank project. You can see that the script 
includes not only the CREATE TABLE statement but also the appropriate SQL syntax 
to add various constraints such as primary and foreign key constraints and 
check constraints.

</P>
<P><PRE>If Exists (Select * From sysobjects Where 
    name = 'Login' And user_name(uid) = 'dbo')
    Drop Table dbo.Login
Go

Create Table dbo.Login
    (
    ssn numeric(18, 0) Not Null,
    userid varchar(8) Not Null,
    password varchar(8) Not Null
    )
Go
Alter Table dbo.Login Add Constraint
    PK_Login Primary Key Nonclustered
    (
    ssn
    )
Go
Alter Table dbo.Login Add Constraint
    CK_Login Check (len(password) &gt;= 4)
Go
Alter Table dbo.Login Add Constraint
    FK_Login_Customer Foreign Key
    (
    ssn
    ) References dbo.Customer
    (
    ssn
    )
Go
</PRE>

</P>
<P>In addition to SQL Server database objects, the Copy SQL Script 
command also works with Oracle views, triggers, stored procedures, and functions, 
but not with Oracle tables and synonyms.

</P>
<P>To execute a SQL script:

</P>
<OL>
<P><LI>   Within Project Explorer, select the script or scripts you want to 
execute. You can select more than one script at a time.
</LI>
</P>
<P><LI>   Right-click, and choose Execute from the popup menu.
</LI>
</P>
</OL>




<A NAME="233"><H2>Adding a Database Project to Source Control</H2></A><P>Database projects consist of folders and SQL script files. You can add these 
files and folders to source control just as you do with other files, such as HTML 
and Active Server Pages Web pages. 

</P>
<P>To add a database project to source control:

</P>
<OL>
<P><LI>   In Project Explorer, right-click the database project name and 
choose Add To Source Control from the context menu.
</LI>
</P>
<LI><P>   Login to Visual SourceSafe by entering your Username and 
Password, as shown in Figure 12-24.

</P>
<P>
<IMG SRC="images/f12lh24.gif" width=287 height=152 border="0">
</P>
<P>
<!-- CAPTION --><B>Figure 12-24.</B> <I>The Visual SourceSafe Login dialog box.</I><!-- /CAPTION -->

</P>
</LI>
<P><LI>   Enter a project name in the Add To SourceSafe Project dialog 
box, and click OK.
</LI>
</P>
<P><LI>   Click OK on the Add To Source Control dialog box to add any 
existing files within the database project to source control.
</LI>
</P>
</OL>




<P>Once you have placed your project under source control, you can 
check files in and out by selecting the file you want to work with, right-clicking 
to access the context menu, and then choosing the relevant menu option. In 
addition to being able to check files in and out, you can also undo the 
check-out status of any file. When a file is checked out for modification within your 
database project, you'll see a red check mark alongside the file within 
Project Explorer. When a file is checked in to Visual SourceSafe, you'll see a blue 
padlock icon alongside the file.

</P>
<P>In addition to the right-click menu, you can access even more 
source control functionality by choosing Project|Source Control from the main 
menu. Figure 12-25 shows the available options on the Source Control menu.

</P>
<P>In Figure 12-25, you'll see that the highlighted menu item is labeled 
SourceSafe. This menu item allows you to launch the Visual SourceSafe Explorer if 
you have it installed on your workstation. The Visual SourceSafe Explorer is a 
client tool that interacts with a Visual SourceSafe database in much the same way as 
a database project does. You do not need to have this tool installed on your 
workstation to place scripts under source control, but it can provide you with 
another interface for working with your Visual SourceSafe database. Figure 12-26 
shows the Visual SourceSafe Explorer after it has been launched from Visual 
InterDev. You can see that the Account_Balance.sql script is currently checked out to 
user Admin under a check-out folder on the user's workstation.
</P>
<P>
<IMG SRC="images/f12lh25.gif" width=272 height=283 border="0">
</P>
<P>
<!-- CAPTION --><B>Figure 12-25.</B> <I>The menu options displayed after choosing Project|Source Control within a database project.</I><!-- /CAPTION -->
</P>
<P>
<A HREF="javascript:fullSize('f12lh26x.htm')"> <IMG SRC="images/f12lh26.jpg" width=404 height=257 border=0 ALT="Click to view at full size."> </A>
</P>
<P>
<!-- CAPTION --><B>Figure 12-26.</B> <I>Visual SourceSafe Explorer showing a SQL script named Account_Balance.sql that is checked out to the Admin user.</I><!-- /CAPTION -->
</P>
</BODY>
</HTML>




