<HTML>
<HEAD>
<TITLE>Huge Hierarchy</title>
<link rel="STYLESHEET" type="text/css" href="progado.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</head>
<BODY bgcolor="#ffffff" text="#000000">
<A HREF="chabd.htm">[Previous]</A> <A HREF="chabf.htm">[Next]</A><P>

<h1>Huge Hierarchy</h1>

<p>Although <a href="ch14a.htm">Chapter 14</a> covers hierarchical recordsets in some depth, I
wanted to build a sample that illustrates how helpful they can be in
certain situations. The Huge Hierarchy sample retrieves information
from the sample Northwind database into, well, a huge hierarchy.</p>

<p>Before we talk about the structure of the hierarchy, let's
briefly talk about how the code connects to your database. The Huge
Hierarchy sample uses a copy of the modSettingsFile module to interact
with a local settings file. The connection string that was last used
successfully is stored in this settings file. If you are running this
sample for the first time or if you couldn't connect to your
database the last time you ran this sample, the initialization code
displays the familiar Data Link Properties dialog box, prompting you to
indicate the location of a Northwind database. (If you don't have
SQL Server 7 or Microsoft Data Engine [MSDE] installed and you
don't have a copy of the sample Microsoft Access database, you can
create your own copy with the Make Northwind sample described later in
this appendix.) You don't have to specify in the Data Link
Properties dialog box that you plan to use MSDataShape (the OLE DB
provider for data shaping). The code in the sample handles that for
you.</p>

<p>Once you connect to a Northwind database, the Huge Hierarchy sample
displays a multiple-document interface (MDI) parent form that lists the
available customers in a drop-down list box. Select a customer, and
click the Go button to display the hierarchy of information on the
customer's orders in a new MDI child form, as shown in Figure
B-4.</p>

<p>
<A HREF="javascript:fullSize('F0Bno04x.htm')"> <img src="images/F0Bno04.JPG" width=404 height=351 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure B-4. </b> <i>Hierarchy containing a customer's orders. </i><!-- /caption -->
</p>



<p>Now let's talk about the hierarchy itself. This sample retrieves
all order information for a customer into a hierarchical recordset and
displays that data on a form. That customer's orders are grouped
first by the employee who took the order. For each employee, you can
see information about that employee, the number of orders that the
employee placed for this customer, and the combined total for those
orders. You can navigate through the employees who placed orders for
this customer by using the horizontal scroll bar that appears above the
employee information.</p>

<p>Below the employee information, the sample displays in a grid each
of the orders the employee placed for this customer. This information
includes the total cost of the order and the total number of items in
the order&#8212;information that does not appear in the Northwind
database's Orders table. The data shape provider's aggregation
features let you gather this information from each order's child
data, pulled from the Order Details table. Because each order can be
sent through a different shipper, information about the shipper
that's handling the selected order appears beneath the grid of
orders. The sample also displays the items in each order in a grid
beneath the shipper information, as well as information about the
product ordered.</p>

<p>The MDI child form that displays all this information is called
frmHugeHierarchy, and the code that generates the hierarchical
Recordset is located in the form's <i>Load</i> event. Figure B-5
breaks down this mammoth query, making it easier to follow.</p>

<p>
<A HREF="javascript:fullSize('FBPno05x.htm')"> <img src="images/FBPno05.JPG" width=404 height=223 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure B-5. </b> <i>Hierarchical query and its syntax. </i><!-- /caption -->
</p>



<p>Figure B-5 uses the shorthand &lt;Orders Query&gt;&#8212;rather than
including that portion of the query&#8212;to save space and make the
hierarchical query easier to follow. Here are those queries, copied
from the <i>Form_Load</i> procedure:</p>

<p><table cellpadding=5 width="95%"><tr><td>
<pre>
strOrdersQuery