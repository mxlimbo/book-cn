<HTML>
<HEAD>
<TITLE>Chapter 12 -- Windows 98 Compatibility Notes</TITLE>
<link rel="STYLESHEET" type="text/css" href="waltoney.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</head>
<BODY bgcolor="#ffffff" text="#000000">
<p>
<A HREF="ch12d.htm">[Previous]</A> <A HREF="chaaa.htm">[Next]</a>
</p>

<A NAME="426"><H1>Windows 98 Compatibility Notes</H1></A>

<p>Windows 98 uses completely different technology for installing and maintaining devices than
Windows 2000. In this section, I'll describe some of the ways this might affect you.</p>

<A NAME="427"><H2>Property Page Providers</H2></A>

<p>A property page provider for a new device class must be a 16-bit DLL. Look at SAMCLS16 on
the companion disc if you want to see an example, and don't discard your 16-bit compiler
just yet!</p>

<A NAME="428"><H2>Registry Usage</H2></A>

<p>Windows 98 uses a software registry key to locate device drivers. To initialize this key,
your Windows 98 install section should have an <b>AddReg</b> directive similar to this
example:</p>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>[DriverInstall]
AddReg=DriverAddReg 
<i>&lt;other install directives&gt;</i>

[DriverAddReg]
HKR,,DevLoader,,*ntkern
HKR,,NTMPDriver,,pktdma.sys</pre>
</td></tr>
</table>
</p>

<p>That is, you designate NTKERN.VXD as the device loader for your device, and you designate
your WDM driver as the <b>NTMPDriver</b> for which NTKERN looks. In addition, you omit a <b>
.Services</b> section because Windows 98 doesn't use it.</p>

<p>In contrast to Windows 2000, Windows 98 puts standard and nonstandard device properties in the
hardware key instead of separating the nonstandard properties into a <b>Device Parameters</b> 
subkey. This turns out to be lucky, since you can't use <b>IoGetDeviceProperty</b> to
retrieve standard properties in Windows 98. (See the next section for the reason.)</p>

<A NAME="429"><H2>Getting Device Properties</H2></A>

<p>Windows 98 (including Windows 98 Second Edition) incorrectly implements IoGetDeviceProperty
for the standard properties in a device's hardware key. To retrieve these properties in a
WDM driver, you should use <b>IoOpenDeviceRegistryKey</b> and interrogate the property by name.
The DEVPROP sample illustrates how to do this for the standard device description property.</p>

<A NAME="430"><H2>Application Launching</H2></A>

<p>Windows 98 doesn't have a service manager, so you can't run AutoLaunch as a service.
The next best thing is an executable named in the registry's <b>Run</b> keyword. Part of
the AutoLaunch package is an ALNCH98.EXE applet that can be executed in this way. It provides a
tray icon that you can use if you want it to halt.</p>
</body>
</html>







