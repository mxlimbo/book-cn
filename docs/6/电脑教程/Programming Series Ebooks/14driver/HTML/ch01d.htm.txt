<HTML>
<HEAD>
<TITLE>Sample Code</TITLE>
<link rel="STYLESHEET" type="text/css" href="waltoney.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</head>
<BODY bgcolor="#ffffff" text="#000000">
<p>
<A HREF="ch01c.htm">[Previous]</A> <A HREF="ch01e.htm">[Next]</a>
</p>

<A NAME="17"><H1>Sample Code</H1></A>

<p>The companion disc contains a great many sample drivers and test programs. I crafted each
sample with a view toward illustrating a particular issue or technique that the text discusses.
Each of the samples is, therefore, a &quot;toy&quot; that you can't just ship after
changing a few lines of code. I wrote the samples this way on purpose. Over the years, I've
observed that programmer-authors tend to build samples that illustrate their prowess at
overcoming complexity rather than samples that teach beginners how to solve basic problems, so
I won't do that to you. Chapters <a href="ch07a.htm">7</a> and <a href="ch11a.htm">11</a> have some drivers that work with &quot;real&quot;
hardware, namely development boards from the makers of a PCI chip set and a USB chip set. Apart
from that, however, all the drivers are for nonexistent hardware.</p>

<p>In nearly every case, I built a simple user-mode test program that you can use to explore
the operation of the sample driver. These test programs are truly tiny: they contain just a few
lines of code and are concerned only with whatever point the driver sample attempts to
illustrate. Once again, I think it's better to give you a simple way to exercise the driver
code that I assume you're really interested in instead of trying to show off every MFC
programming trick I ever learned.</p>

<p>You're free to use all of the sample code in this book in your own projects without
paying me or anyone else a royalty. (Of course, you must consult the detailed license agreement
at the end of the book&#8212;this paraphrase is not intended to override that agreement in any
way.) There are few cases in which I ask that you get my permission before redistributing one
of my sample modules as a freestanding piece of software, however; these include GENERIC.SYS
(discussed in Appendix B) and WDMSTUB.VXD (discussed in Appendix A). I'll gladly give
permission, but I will need to ask your company to agree to some conditions designed to ensure
that if a bunch of readers all decide to ship copies of these modules along with their
production drivers, end users receive up-to-date and reliable versions. See the companion disc
for more information on redistribution.</p>

<A NAME="18"><H2>The Companion Disc</H2></A>

<p>The CD-ROM that comes with this book contains the complete source code and an executable
copy of each sample. It also contains a few utility programs that you might find useful in your
own work. Open the file WDMBOOK.HTM in your Web browser for an index to the samples and an
explanation of how to use these tools.</p>

<p>The setup program on the disc gives you the option to install all of the samples on your own
disk or to leave them on the CD-ROM. However, setup will not install any kernel-mode components
on your system. Setup will ask your permission to add some environment variables to your
AUTOEXEC.BAT file. The build procedure for the samples relies on these environment variables.
They will be correctly set the next time you reboot your Windows 2000 or Windows 98 computer.
Setup will also install the necessary registry entries to define a SAMPLE class of device, to
which each of the sample drivers belongs.</p>

<p>If your computer runs both Windows 2000 and Windows 98, I recommend performing a full
install under one OS and a compact install under the other. Additionally, I recommend allowing
the setup program to modify your AUTOEXEC.BAT under just one OS. If you follow these
suggestions, setup will be able to make necessary changes in both registry databases but will
copy the sample code only one time. (Note that Windows 2000 interprets your AUTOEXEC.BAT file
at startup time to set environment variables. That's why the setup program needs to modify
this file.)</p>

<p>Each sample includes an HTML file that explains (very briefly) what the sample does, how to
build it, and how to test it. I recommend that you read the file before trying to install the
sample, because some of the samples have unusual installation requirements. Once you've
installed a sample driver, you'll find that the Device Manager has an extra property page
from which you can view the same HTML file. (See Figure 1-6.)</p>

<p>
<A HREF="javascript:fullSize('F01wi06x.htm')"> <img src="images/F01wi06.JPG" width=404 height=438 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 1-6.</b> <i>A custom Device Manager property page for sample drivers.</i><!--/caption-->
</p>


<A NAME="19"><H2>How the Samples Were Created</H2></A>

<p>There's a good reason why my sample drivers look like they all came out of a cookie
cutter: they did. Faced with so many samples to write, I decided to write a custom application
wizard. The wizard functionality in Microsoft Visual C++ version