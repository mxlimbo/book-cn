<html>
<head>
<title>网络编程基础篇之CGI</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<link rel="stylesheet" href="ebook.css" type="text/css">
</head>
<body leftmargin="0" topmargin="0" background="bg.jpg">
<table width="100%" cellspacing="0">
  <tr>
    <td valign="top" bgcolor="#FFD26A">
      <table width="180" height="100%">
        <tr align="center" valign="top">
          <td>
            <p><img src="image.jpg"></p>
            <p><a href="list.htm"><img src="bd.gif" border="0"></a><br>
              <a href="09.htm"><img src="ap.gif" border="0"></a></p>
          </td>
        </tr>
        <tr align="center" valign="bottom">
          <td><a href="11.htm"><img src="np.gif" border="0"></a></td>
        </tr>
      </table>
    </td>
    <td valign="top">
      <blockquote>
        <div align="center"><img src="title.gif"></div>
        <!--正文开始-->
        <font color="#0000FF">10.留言本</font><br>
        <br>
        留言本在网页设计中占有相当重要的地位，以至于可以和记数器相提并论。留言本可以用许多编程语言来设计，当然使用最多的还是perl和vb两种。现在我们将谈谈在编写留言本中最应该注意的问题，并将给出一个不算很完整的程序代码。同时提供一个C语言的win-cgi程序供大家下载。<br>
      <br>
      就现在的情况来看，一个标准的guest-book程序一般包括三个文件。提交表单文件<br>
      （form.html)、cgi处理文件(guest-book.cgi)和最后的输出文件（book.html)。有些vb程序以access数据库为后台存储格式，以方便用户查找留言。下面给出了留言本的工作流程。<br>
      <br>
        <font color="#0000FF">10.1 form.html</font><br>
      首先我们来看看form.html的文件内容：<br>
      &lt;html&gt;<br>
      &lt;title&gt;guest-book.html&lt;/title&gt;<br>
      &lt;h1&gt;留言本&lt;/h1&gt;<br>
      &lt;form method="post" action="/cgi-shl/guest-book.cgi"&gt;<br>
      &lt;p&gt;名字：&lt;input name="name" size="20"&gt;<br>
      &lt;p&gt;email:&lt;input name="email" size="30"&gt;<br>
      &lt;p&gt;意见：&lt;textarea name="suggest" cols=30 rows=4&gt;&lt;/textarea&gt;<br>
      &lt;/textarea&gt;&lt;p&gt;<br>
      &lt;input type="submit" value="提交"&gt;<br>
      &lt;input type="reset" value="取消"&gt;<br>
      &lt;/form&gt;&lt;/html&gt;<br>
        &lt;form method="post" action="/cgi-bin/guest-book.cgi"&gt;<br>
      将此表单的提交后的动作交给guest-book.cgi程序。<br>
      <br>
        <font color="#0000FF">10.2 guest-book.cgi</font><br>
        #!/usr/bin/perl<br>
      <br>
      print"Content-type:text/html\n\n";<br>
      read(STDIN,$buffer,$ENV{'CONTENT_LENGTH'})；<br>
      @pairs=split(/&amp;/,$buffer);<br>
      foreach $pair(@pairs){<br>
      ($name,$value)=split(/=/,$pair);<br>
      $value=~tr/+//;<br>
      $value=~s/%([a-f A-F 0-9][a-f A-F 0-9])/pack("C",hex($1))/eg;<br>
      $FORM{$name}=$value;<br>
      }<br>
      print"&lt;title&gt;留言本&lt;/title&gt;";<br>
      print"&lt;h1&gt;留言本&lt;/h1&gt;";<br>
      <br>
      foreach $check(values%FORM){<br>
      if($check eq""){<br>
      print"&lt;hr size=3&gt;";<br>
      print"&lt;h2&gt;请不要留空";<br>
      exit(0);<br>
      }<br>
      }<br>
      <br>
      $FORM{'suggest'}=~s/cM\n/&lt;br&gt;\n/g;<br>
      <br>
      $filename="c:/httpd/htdocs/book.html";<br>
      <br>
      open(FILE,"&gt;&gt; $filename");<br>
      print FILE "名字：$FORM{'name'}&lt;br&gt;\n";<br>
      print FILE "Email:&lt;a href="mailto:$FORM{'email'}&gt;$FORM{'email'}&lt;/a&gt;&lt;br&gt;\n"}";<br>
      print FILE "留言：$FORM{'suggest'}";<br>
      close{FILE};<br>
      <br>
      print "&lt;h2&gt;谢谢留言&lt;/h2&gt;";<br>
      <br>
      print"&lt;a href=\"book.html\"&gt;请观看留言本&lt;/a&gt;";<br>
      <br>
      <br>
      exit(0);<br>
      <br>
      这个程序相当简陋，但它具有了所有的CGI-Guest程序的特点，我们一一分析如下：<br>
      首先，<br>
      read(STDIN,$buffer,$ENV{'CONTENT_LENGTH'})；<br>
      @pairs=split(/&amp;/,$buffer);<br>
      foreach $pair(@pairs){<br>
      ($name,$value)=split(/=/,$pair);<br>
      $value=~tr/+//;<br>
      $value=~s/%([a-f A-F 0-9][a-f A-F 0-9])/pack("C",hex($1))/eg;<br>
      $FORM{$name}=$value;<br>
      }<br>
      这是一段表单分析的语句，在前面的程序里，估计大家也都见过了。<br>
      <br>
      其次：<br>
      foreach $check(values%FORM){<br>
      if($check eq""){<br>
      print"&lt;hr size=3&gt;";<br>
      print"&lt;h2&gt;请不要留空";<br>
      exit(0);<br>
      }<br>
      }<br>
      做输入字段的检查，看看是否有留空的现象。从前这种任务都是要CGI程序来验证的，比如email是否输入的是mail地址等检查。不过现在我们可以通过javascript来做这样的检查，这样服务器的负担将大大减轻。<br>
      <br>
      最后：<br>
      $filename="c:/httpd/htdocs/book.html";<br>
      <br>
      open(FILE,"&gt;&gt; $filename");<br>
      print FILE "名字：$FORM{'name'}&lt;br&gt;\n";<br>
      print FILE "Email:&lt;a href="mailto:$FORM{'email'}&gt;$FORM{'email'}&lt;/a&gt;&lt;br&gt;\n"}";<br>
      print FILE "留言：$FORM{'suggest'}";<br>
      close{FILE};<br>
      <br>
      print "&lt;h2&gt;谢谢留言&lt;/h2&gt;";<br>
      <br>
      print"&lt;a href=\"book.html\"&gt;请观看留言本&lt;/a&gt;";<br>
      <br>
      <br>
      exit(0);<br>
      输出内容到文件和屏幕上。完成留言的程序。<br>
        <font color="#000000"><br>
        <font color="#0000FF">10.3 book.html</font></font><br>
      这个程序中book.html没有什么特别的要求，可以不用写，就让程序自动生成。<br>
      现在有的cgi程序，对book.html也有设定，比如在&lt;head&gt;&lt;/head&gt;之间就写上注释<br>
      &lt;!--这是留言开始--!&gt;<br>
      &lt;!--这是留言结束--!&gt;<br>
      这样，在程序对留言数据操作的时候，就可以忽略掉文件内的其他内容。<br>
      <br>
      最后，我为各位找到一个用C写的guestbook程序，它是在win平台上运行的，具有非常好的兼容性。同时它采用了临时文件的方式来传递信息。所以你需要设定.ini文件。<br>
      <br>
        在这里下载<a
    href="Guestbook.zip">guestbook</a>程序，安装请参考readme文件<br>
        <br>
        <!--正文结束-->
        <center>
      <hr>
      <p>本书由<a href="http://www.huiniao.com/">【灰鸟资讯】</a>免费制作<br>
          想要更多的免费电子图书，请光临<br>
          <a href="http://www.huiniao.com">http://www.huiniao.com</a></p>
      </center>
      </blockquote>
    </td>
  </tr>
</table>
</body>
</html>
