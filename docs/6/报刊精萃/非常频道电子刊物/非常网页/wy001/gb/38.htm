<html>
<head>
<title>聊天室技术 -- 密谈的实现</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<link rel="stylesheet" href="all.css">
</head>
<body background="bodybg.jpg" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<table border="0" cellpadding="0" cellspacing="0" width="776" align="center">
  <tr valign="top"> 
    <td colspan="5" background="topbg.jpg"><img src="top1.jpg" width="100" height="38" border="0"><img src="link.jpg" width="259" height="38" border="0" usemap="#Map"><map name="Map"><area shape="rect" coords="178,6,251,29" href="39.htm"><area shape="rect" coords="91,6,164,29" href="37.htm"><area shape="rect" coords="12,6,85,29" href="content.htm"></map></td>
    <td width="35"><img src="top2.jpg" width="35" height="38" border="0"></td>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="776" background="tablebg.jpg" align="center">
  <tr valign="top">
    <td width="149"><img src="left.jpg" width="149" height="365" border="0"></td>
    <td align="center"><br>
      <br>
      <table width="580" border="0" cellspacing="0" cellpadding="0">
        <tr> 
          <td> 
            <table align=center bgcolor=#ffcc33 border=1 bordercolordark=#ffad00 
      bordercolorlight=#de5210 cellpadding=3 cellspacing=0 class=P9-13 
      width="95%">
              <tbody> 
              <tr bgcolor="#ffad00"> 
                <td class=P9-13><b>□...聊天室技术 -- 密谈的实现</b></td>
              </tr>
              <tr> 
                <td> 
                  <p class=P9-13> 
                  <p><font color="#000000">聊天室技术&nbsp;-&nbsp;密谈的实现 <br>
                    </font></p>
                  <p><font color="#000000">每个聊天室都提供了密谈功能,来为那些需要私下里进行交流的聊友提供方便,这</font><font color="#000000">里把我的聊天室实现私聊的方法介绍如下: 
                    <br>
                    </font></p>
                  <p><font color="#000000">1&nbsp;对发送信息的处理 <br>
                    </font></p>
                  <p><font color="#000000">每句私聊都要显示在自己和私聊对象的屏幕上,而其他人不能够看到.这里先对发 
                    </font></p>
                  <p><font color="#000000">言内容进行处理,然后再保存到发言文件里面! <br>
                    </font></p>
                  <p><font color="#000000">//$split为分隔符号 <br>
                    </font></p>
                  <p><font color="#000000">messagesend.php <br>
                    </font></p>
                  <p><font color="#000000">&lt;? <br>
                    </font></p>
                  <p><font color="#000000">//判断是否私聊发言 <br>
                    </font></p>
                  <p><font color="#000000">if($secret&nbsp;==&nbsp;"on") <br>
                    </font></p>
                  <p><font color="#000000">{ <br>
                    </font></p>
                  <p><font color="#000000">//在发言前面加上标记&lt;!--+私聊标记+对象+发言者+--&gt;&nbsp;其中+代表分隔符 
                    </font></p>
                  <p><font color="#000000">//第一个标记为&nbsp;secret&nbsp;表示为私聊,后面的是聊天对象和自己的名字,保证这两 
                    </font></p>
                  <p><font color="#000000">个人能看到 <br>
                    </font></p>
                  <p><font color="#000000">$message&nbsp;=&nbsp;"&lt;!--$splitsecret$split$talkto$split$name$split--&gt;&lt;font&nbsp;c 
                    </font></p>
                  <p><font color="#000000">olor=ff0000&gt;密谈&lt;/font&gt;$message"; 
                    <br>
                    </font></p>
                  <p><font color="#000000">} <br>
                    </font></p>
                  <p><font color="#000000">else <br>
                    </font></p>
                  <p><font color="#000000">{ <br>
                    </font><font color="#000000"> </font></p>
                  <p><font color="#000000">//如果第一个标记为&nbsp;open&nbsp;表示公开,后面同样为对象和自己的名字 
                    </font></p>
                  <p><font color="#000000">$message&nbsp;=&nbsp;"&lt;!--$splitopen$split$talkto$split$name$split--&gt;$message" 
                    </font></p>
                  <p><font color="#000000">; <br>
                    </font></p>
                  <p><font color="#000000">} <br>
                    </font></p>
                  <p><font color="#000000">//然后保存到文件中 <br>
                    </font></p>
                  <p><font color="#000000">?&gt; <br>
                    </font><font color="#000000"> </font></p>
                  <p><font color="#000000">2&nbsp;显示私聊的方法 <br>
                    </font><font color="#000000"> </font></p>
                  <p><font color="#000000">对每个新的发言读入后先进行处理判断,在主动刷新程序里面进行. <br>
                    </font></p>
                  <p><font color="#000000">messageflush.php <br>
                    </font></p>
                  <p><font color="#000000">&lt;? <br>
                    </font></p>
                  <p><font color="#000000">//分割发言内容 <br>
                    </font></p>
                  <p><font color="#000000">$tempmessage&nbsp;=&nbsp;split($split,$message[0],99); 
                    <br>
                    </font></p>
                  <p><font color="#000000">//如果发言不是密谈,或者私聊对象是自己,或者发送这句私聊的是自己,那就显示 
                    </font></p>
                  <p><font color="#000000">这句话,否则不显示 <br>
                    </font></p>
                  <p><font color="#000000">if(&nbsp;($tempmessage[1]&nbsp;!=&nbsp;"secret")&nbsp;||&nbsp;($tempmessage[2]&nbsp;==&nbsp;$name)&nbsp;||&nbsp;( 
                    </font></p>
                  <p><font color="#000000">$tempmessage[3]&nbsp;==&nbsp;$name)&nbsp;) 
                    <br>
                    </font></p>
                  <p><font color="#000000">{ <br>
                    </font></p>
                  <p><font color="#000000">//显示私聊 <br>
                    </font></p>
                  <p><font color="#000000">print("parent.u.document.writeln("$message[0]"); 
                    "); <br>
                    </font></p>
                  <p><font color="#000000">} <br>
                    </font></p>
                  <p><font color="#000000">?&gt; <br>
                    </font></p>
                  <p><font color="#000000">通过这种简单的方法,我们实现了私聊, <br>
                    </font></p>
                  <p><font color="#000000">注意: <br>
                    </font></p>
                  <p><font color="#000000">　前面的保存文件处理时,对发言的判断文字前后有&lt;!--&nbsp;和&nbsp;--&gt;这样在屏幕显示 
                    </font></p>
                  <p><font color="#000000">时就可以不用特殊处理了! </font></p>
                  </td>
              </tr>
              </tbody>
            </table>
            
          </td>
        </tr>
      </table>
      <br>
      <table width="580" cellspacing="0" cellpadding="0" border="0">
        <tr> 
          <td> 
            <table border=0 align=center>
              <tr> 
                <td width=101 height="21"> 
                  <div align="center"><a href="37.htm">上一页</a></div>
                </td>
                <td width=99 height="21"> 
                  <div align="center"><a href="content.htm">目　录</a></div>
                </td>
                <td width=100 height="21"> 
                  <div align="center"><a href="39.htm">下一页</a></div>
                </td>
              </tr>
            </table>
            <p align=center>□ 编辑整理：<a href="http://www.verychannel.com">非常频道</a> 
            <hr width="80%" noshade size="2">
            <p align=center>本书由“<a href="http://www.eshunet.com/">E书时空</a>”免费制作； 
              <br>
              想要更多的免费电子图书，请光临 <br>
              <a href="http://www.eshunet.com/">http://www.eshunet.com/</a></p>
            </td>
        </tr>
      </table>
    </td>
  </tr>  
</table>
<table width="776" border="0" cellspacing="0" cellpadding="0" align="center">
  <tr>
    <td><img src="bottom.jpg" width="776" height="15"></td>
  </tr>
</table>
</body>
</html>

