<html>
<head>
<title>做个ADSL+LINUX软路由器</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<link rel="stylesheet" href="all.css">
</head>
<body bgcolor="#ffffff" background="bg.jpg" leftmargin="0" topmargin="0" marginwidth="0" marginheight="0">
<div align="center">
<table border="0" cellpadding="0" cellspacing="0" width="776">
  <tr valign="top">
      <td colspan="4" background="topbg.jpg"><img name="layout_r1_c1" src="toptu.jpg" width="106" height="35" border="0"><img name="layout_r1_c2" src="yema.jpg" width="256" height="35" border="0" usemap="#layout_r1_c2Map"><map name="layout_r1_c2Map"><area shape="rect" coords="176,8,238,28" href="11.htm"><area shape="rect" coords="88,8,150,28" href="09.htm"><area shape="rect" coords="8,8,70,28" href="content.htm"></map></td>
      <td width="29"><img name="layout_r1_c5" src="tutop.jpg" width="29" height="35" border="0"></td>
  </tr>
</table>
  <table border="0" cellpadding="0" cellspacing="0" width="776" align="center">
    <tr valign="top"> 
      <td rowspan="4" width="151" background="leftbg.jpg"><img name="layout_r2_c1" src="tu0.jpg" width="151" height="182" border="0"><br>
        <img name="layout_r4_c1" src="sidnzhoukan.jpg" width="151" height="216" border="0"></td>
      <td rowspan="4" colspan="2" background="bg.jpg"> <br>
        <table width="580" cellspacing="0" cellpadding="0" border="0" align="center">
          <tr> 
            <td height="22"> 
              <p align="center" class="h">做个ADSL+LINUX软路由器</p>
            </td>
          </tr>
        </table>
        <br>
        <table width="580" border="0" cellspacing="0" cellpadding="0" align="center">
          <tr> 
            <td>
              <table align=center bgcolor=#ffcc33 border=1 bordercolordark=#ffad00 
      bordercolorlight=#de5210 cellpadding=3 cellspacing=0 class=P9-13 
      width="95%">
                <tbody> 
                <tr bgcolor=#ffad00> 
                  <td class=P9-13><b>□...做个ADSL+LINUX软路由器</b></td>
                </tr>
                <tr> 
                  <td> 
                    <p class=P9-13>
                    <font color=#000000> 
                    <p>刘昊川・yesky </p>
                    <p>　　本解决方案主要针对公司、学校、网吧等需用一条ADSL将整个局网连上INTERNET，适合于10 -50台计算机的中小型网络用户。对于10台以下计算机的用WINAGTE、SYGATE就蛮好用。 
                    </p>
                    <p>　　让我们来看看具体环境先，某公司总部办公室21间、计算机30台。组成10-100MB对等局域网，用一条ADSL宽带线路跑，以前用WINGATE将局域网连上INTERNET，后来觉得不爽我又用WINDOWS2000双网卡做了个NAT地址转换，使用网关和透明协议拖。这下下感觉舒服些了。呵呵，用了不久又发现些不大不小的毛病：比如内部互发OICQ慢啊，访问SINA.COM.CN等个别网站有问题啊等等。MS的东东看似简单但是当你想微调一下系统的时候，你就会突然发现原来人生多么无奈啊。痛定思痛！：（我毅然决定放弃WINDOWS2000，改用LINUX！！</p>
                    <p></p>
                    <p>要用LINUX得搞台机器吧，东拼西凑好不容易搞了一台。各位看官请看： INTEL FX主板+PENTIUM 75芯片+16MB内存+540MB硬盘+512K显卡+DE220 
                      10MB网卡。软件嘛随便找个LINUX发行版，我手头有REDHAT 6.2 核心是2.2.14，按SERVER的安装方式，经过长达48分钟左右的安装，可爱的#提示符出现在大家面前！各位看客也可以根据自己的具体情况安装。</p>
                    <p></p>
                    <p>　　硬件、软件都装好了，下面开始具体配置。（加了#提示符号表示输入命令）</p>
                    <p></p>
                    <p>1、用ifconfig看看网络配置</p>
                    <p></p>
                    <p>[root@localhost /root]#ifconfig</p>
                    <p>lo Link encap:Local Loopback </p>
                    <p>inet addr:127.0.0.1 Mask:255.0.0.0</p>
                    <p>UP LOOPBACK RUNNING MTU:3924 Metric:1</p>
                    <p>RX packets:23 errors:0 dropped:0 overruns:0 frame:0</p>
                    <p>TX packets:23 errors:0 dropped:0 overruns:0 carrier:0</p>
                    <p></p>
                    <p></p>
                    <p></p>
                    <p>　　只有lo没找到网卡。不急，自己配。我是DLINK的DE220 IRQ=3 IO=300，兼容NE2000。在/etc/conf.modules 
                      加两句。 </p>
                    <p></p>
                    <p>具体如下：</p>
                    <p></p>
                    <p>[root@localhost /root]#cd /etc</p>
                    <p>[root@localhost /root]#vi conf.modules</p>
                    <p>alias eth0 ne </p>
                    <p>options eth0 io=0x300 irq=3 </p>
                    <p></p>
                    <p>IO和IRQ可以根据你自己的网卡设置</p>
                    <p></p>
                    <p>如果不能插入就按INSERT，加完就按ESC。再按: ，再输入w 存盘，再q 退出。如果不放心就 #more 
                      conf.modules 看看写进去没有。</p>
                    <p></p>
                    <p></p>
                    <p></p>
                    <p>一般市面上ISA的便宜网卡都兼容NE2000。如果是新手在LINUX下安装网卡的可能会遇到这样那样的问题，多在网上找找看看，一般都能解决。要提醒大家最好别用PNP即插即用模式，在LINUX出了问题不好解决，简直是场噩梦。</p>
                    <p></p>
                    <p></p>
                    <p>2、下面配置网卡IP地址， 在/etc/sysconfig/network-scripts下有个文件</p>
                    <p></p>
                    <p>ifcfg-eth0 写成如下：</p>
                    <p></p>
                    <p>DEVICE=eth0 </p>
                    <p>IPADDR=192.168.0.254 </p>
                    <p></p>
                    <p>这是网卡的IP地址，以后客户机的网关就是这个地址。</p>
                    <p></p>
                    <p>NETMASK=255.255.255.0</p>
                    <p>NETWORK=192.168.0.0</p>
                    <p>BROADCAST=192.168.0.255</p>
                    <p>ONBOOT=yes</p>
                    <p>BOOTPROTO=none </p>
                    <p></p>
                    <p>重起就能找到网卡。 </p>
                    <p></p>
                    <p>我们再[root@localhost /root]#ifconfig</p>
                    <p>eth0 Link encap:Ethernet HWaddr 00:40:05:64:11:28 </p>
                    <p>　　 inet addr:192.168.0.254 Bcast:192.168.0.255 Mask:255.255.255.0</p>
                    <p>UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</p>
                    <p>RX packets:347573 errors:0 dropped:0 overruns:0 frame:0</p>
                    <p>TX packets:40194 errors:0 dropped:0 overruns:0 carrier:0</p>
                    <p>collisions:35 txqueuelen:100 </p>
                    <p>Interrupt:3 Base address:0x300 </p>
                    <p></p>
                    <p>lo Link encap:Local Loopback </p>
                    <p>inet addr:127.0.0.1 Mask:255.0.0.0</p>
                    <p>UP LOOPBACK RUNNING MTU:3924 Metric:1</p>
                    <p>RX packets:23 errors:0 dropped:0 overruns:0 frame:0</p>
                    <p>TX packets:23 errors:0 dropped:0 overruns:0 carrier:0</p>
                    <p>collisions:0 txqueuelen:0</p>
                    <p></p>
                    <p>哈哈，eth0找到网卡了，配置也正确，恭喜恭喜！进行下一步。</p>
                    <p></p>
                    <p></p>
                    <p>3、下一步做ADSL的驱动。去http://www.roaringpenguin.com/pppoe/rp-pppoe-2.6.tar.gz 
                      下个驱动程序先，大概85K大小。 考到/root去。</p>
                    <p></p>
                    <p>然后 #tar xvfz rp-pppoe-2.6.tar.gz</p>
                    <p>#cd rp-pppoe-2.6</p>
                    <p>#./go</p>
                    <p></p>
                    <p>开始安装，装好就#make一下下，开始配置ADSL。</p>
                    <p></p>
                    <p>Welcome to the Roaring Penguin ADSL client setup. First, 
                      I will run some checks on your system to make sure the PPPoE 
                      client is installed properly... Looks good! Now, please 
                      enter some information:</p>
                    <p></p>
                    <p>USER NAME</p>
                    <p></p>
                    &gt;&gt;&gt; Enter your PPPoE user name (default): 
                    <p></p>
                    <p>这里输入在电信局申请的adsl的帐号</p>
                    <p></p>
                    <p>INTERFACE</p>
                    &gt;&gt;&gt; Enter the Ethernet interface connected to the 
                    ADSL modem For Solaris, this is likely to be something like 
                    /dev/hme0. For Linux, it will be ethn, where 'n' is a number.(default 
                    eth0): 
                    <p></p>
                    <p>问你用哪片网卡拨号，默认是第一片eth0就可以了</p>
                    <p></p>
                    <p>Do you want the link to come up on demand, or stay up continuously? 
                      If you want it to come up on demand, enter the idle time 
                      in seconds after which the link should be dropped. If you 
                      want the link to stay up permanently, enter 'no' (two letters, 
                      lower-case.)</p>
                    <p></p>
                    <p>NOTE: Demand-activated links do not interact well with 
                      dynamic IP addresses. You may have some problems with demand-activated 
                      links.</p>
                    &gt;&gt;&gt; Enter the demand value (default no): 
                    <p></p>
                    <p>用缺省的no就可以了。</p>
                    <p></p>
                    <p>Please enter the IP address of your ISP's primary DNS server. 
                      If your ISP claims that 'the server will provide DNS addresses', 
                      enter 'server' (all lower-case) here. If you just press 
                      enter, I will assume you know what you are doing and not 
                      modify your DNS setup.</p>
                    &gt;&gt;&gt; Enter the DNS information here: 
                    <p></p>
                    <p>这里填你ISP的DNS地址，成都用61.139.2.69,辅助DNS成都可用202.98.127.32</p>
                    <p></p>
                    <p>PASSWORD</p>
                    &gt;&gt;&gt; Please enter your PPPoE password: 
                    <p></p>
                    <p>ADSL拨号密码这个东东。</p>
                    <p></p>
                    <p>搞定！爽爽，用#adsl-start 就可以开始拨号。如果连接成功系统会提示你：…….connect </p>
                    <p></p>
                    <p>用ifconfig看看。[root@localhost /root]# ifconfig</p>
                    <p></p>
                    <p>eth0 Link encap:Ethernet HWaddr 00:40:05:64:11:28</p>
                    <p>inet addr:192.168.0.254 Bcast:192.168.0.255 Mask:255.255.255.0</p>
                    <p>UP BROADCAST RUNNING MULTICAST MTU:1500 Metric:1</p>
                    <p>RX packets:347573 errors:0 dropped:0 overruns:0 frame:0</p>
                    <p>TX packets:40194 errors:0 dropped:0 overruns:0 carrier:0</p>
                    <p>collisions:35 txqueuelen:100</p>
                    <p>Interrupt:3 Base address:0x300</p>
                    <p></p>
                    <p>lo Link encap:Local Loopback</p>
                    <p>inet addr:127.0.0.1 Mask:255.0.0.0</p>
                    <p>UP LOOPBACK RUNNING MTU:3924 Metric:1</p>
                    <p>RX packets:23 errors:0 dropped:0 overruns:0 frame:0</p>
                    <p>TX packets:23 errors:0 dropped:0 overruns:0 carrier:0</p>
                    <p>collisions:0 txqueuelen:0</p>
                    <p></p>
                    <p>ppp0 Link encap:Point-to-Point Protocol</p>
                    <p>inet addr:61.157.91.227 P-t-P:61.157.91.1 Mask:255.255.255.255</p>
                    <p>UP POINTOPOINT RUNNING NOARP MULTICAST MTU:1492 Metric:1</p>
                    <p>RX packets:20498 errors:0 dropped:0 overruns:0 frame:0</p>
                    <p>TX packets:19187 errors:0 dropped:0 overruns:0 carrier:0</p>
                    <p>collisions:0 txqueuelen:10</p>
                    <p></p>
                    <p>看见ppp0没有！</p>
                    <p>4、最后一步：配置ipchains伪装IP。</p>
                    <p></p>
                    <p>在 /etc/sysconfig的network文件里保证要有这句： FORWARD_IPV4=true</p>
                    <p></p>
                    <p>然后改/etc/rc.d/rc.local这个文件，加入以下内容</p>
                    <p></p>
                    <p>route add -net 192.168.0.0 netmask 255.255.255.0 eth0</p>
                    <p>depmod -a</p>
                    <p>modprobe ip_masq_ftp</p>
                    <p>modprobe ip_masq_irc</p>
                    <p>modprobe ip_masq_raudio</p>
                    <p>/sbin/ipchains -P forward DENY</p>
                    <p>/sbin/ipchains -A forward -s 192.168.0.0/24 -j MASQ</p>
                    <p></p>
                    以防万一：# echo 1 &gt; /proc/sys/net/ipv4/ip_forward 这样一下下。存盘，退出，重启，完。是不是很简单啊！这样一台最简单的软路由就做好了，其实ipchains功能很强大，这里就不详细再讲了如有需要我会另外找时间再写。 
                    <p></p>
                    <p></p>
                    <p>5、配置的你每台客户机，如果用WINDOWNS系列，只要在网络设置的网卡的TCP/IP中加入网关192.168.0.254 
                    </p>
                    <p></p>
                    <p>注意：如果没用LINUX做DNS的话还要加DNS地址，成都的DNS地址是： 61.139.2..69和202.98.127.32 
                    </p>
                    <p></p>
                    <p>算算成本一台这样的机器加一套不要钱的LINUX最多花个300-500的（本人连显示器都不要，安装的时候用用，之后就用TELNET远程管理）。这套搭配功能无比强大，稳定，高效，安全。</p>
                    </font><font color=#000000><a 
            href="http://www.verychannel.com/club/" target=_blank></a></font></td>
                </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </table>
        <br>
        <table width="580" cellspacing="0" cellpadding="0" border="0" align="center">
          <tr> 
            <td> 
              <table border=0 align=center>
                <tr> 
                  <td width=101 height="21"> 
                    <div align="center"><a href="09.htm">上一页</a></div>
                  </td>
                  <td width=99 height="21"> 
                    <div align="center"><a href="content.htm">目　录</a></div>
                  </td>
                  <td width=100 height="21"> 
                    <div align="center"><a href="11.htm">下一页</a></div>
                  </td>
                </tr>
              </table>
              <p align=center>□ 编辑整理：<a href="http://www.verychannel.com">非常频道</a> 
              <hr width="80%" noshade size="2">
              <p align=center>本书由“<a href="http://www.eshunet.com/">E书时空</a>”免费制作； 
                <br>
                想要更多的免费电子图书，请光临 <br>
                <a href="http://www.eshunet.com/">http://www.eshunet.com/</a></p>
              
              
            </td>
          </tr>
        </table>
      </td>
    <td rowspan="4" width="29" background="rightbg.jpg"></td>
  </tr>
  <tr valign="top"> </tr>
</table>
</div>
</body>
</html>

