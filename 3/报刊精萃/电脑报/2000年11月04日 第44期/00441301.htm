 
<HTML>
<!-- #BeginTemplate "/Templates/software.dwt" --> 
<HEAD>
<META HTTP-EQUIV='Content-Type' CONTENT='text/html; charset=gb2312'>
<META NAME='author' CONTENT='William Wan'>
<LINK REL='STYLESHEET' HREF='epcw.css' TYPE='text/css'>
<!-- #BeginEditable "doctitle" --> 
<TITLE>电脑报电子版 --用好Linux的启动盘（下）</TITLE>
<!-- #EndEditable --> 
<style type="text/css">
<!--
.centertitle {  font-weight: bold; text-align: center; line-height: 35px; font-size: 9pt; color: #000000}
.lefttitle {  line-height: 35px; font-weight: bold; font-size: 9pt; color: #000000}
-->
</style>
</HEAD>
<BODY BGCOLOR='white'>
<span class="centertitle"></span> 
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='6' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='top'> 
    <TD WIDTH='100%'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='Center'>
  <TR> 
    <TD WIDTH='145' BGCOLOR='#CCCC99' 	ALIGN='Center' VALIGN='top'><a href='http://www.yesky.com' target="_blank"><img src='images/logo.gif' width='140' height='60' alt='天极网' border='0'></a></TD>
    <TD WIDTH='470' BGCOLOR='#CCCC99' HEIGHT='50'> 
      <a href="http://chat.yesky.com/" target="_blank"><img src="images/0823-3.gif" width="468" height="60" border="0" alt="天极聊天室"></a>
    </TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='2' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR> 
    <TD WIDTH='100%'><IMG SRC='../../images/pixel.gif' WIDTH='1' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE BORDER='0' WIDTH='615' CELLSPACING='0' CELLPADDING='0' HEIGHT='3' ALIGN='Center' BGCOLOR='#CCCC99'>
  <TR VALIGN='bottom'> 
    <TD WIDTH='100%'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<table width='615' border='0' cellspacing='0' cellpadding='2' align='Center'>
  <tr> 
    <td width='615' colspan='2'><font color="#FF6666">当前位置：</font><a href='http://www.cpcw.com'>《电脑报》电子版</a> 
      &gt; <A HREF='http://www.cpcw.com/all.html'>2000年</A> &gt; <a href="index.html"><!-- #BeginEditable "%C6%DA" -->44期<!-- #EndEditable --></a> 
      &gt; <!-- #BeginEditable "%C0%B8%C4%BF" --><a href="software.html">软件世界</a><!-- #EndEditable --> 
      &gt; <!-- #BeginEditable "%B1%EA%CC%E2" -->{用好Linux的启动盘（下）}<!-- #EndEditable --></td>
  </tr>
</table>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' BGCOLOR='#FFCC66' ALIGN='center'>
  <TR> 
    <TD><SPAN CLASS='title'>《 <!-- #BeginEditable "%CE%C4%D5%C2%CD%B7" -->{用好Linux的启动盘（下）}<!-- #EndEditable --> 
      》</SPAN></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD><!-- #BeginEditable "%CE%C4%D5%C2%C4%DA%C8%DD" -->{　　2.2 创建根文件系统<br>
      　　Linux内核识别两种可以直接拷贝到RAMDISK的文件系统，它们是minix 和ext2，ext2性能更好。mke2fs缺省情况下在1.44M的软盘上产生360个信息节点，使用压缩格式的根文件系统需要更多的信息节点，所以使用如下命令创建文件系统可以创建2000个信息节点，而且一般不会用完。<br>
      　　mke2fs －m 0 －i 2000 /dev/ram0<br>
      　　mke2fs将会自动判断设备容量的大小并相应地配置自身，－m 0参数防止它给root保留空间，这样会腾出更多的有用空间。接着把虚拟盘挂在节点/mnt上：<br>
      　　mount －t ext2 /dev/ram0 /mnt/floppy<br>
      　　接着是创建目录。根文件系统最少应该有如下8个目录：<br>
      　　/dev ― 设备<br>
      　　/proc ― proc 文件系统所需目录<br>
      　　/etc ― 系统配置文件<br>
      　　/sbin ― 重要的系统程序<br>
      　　/bin ― 基本应用程序<br>
      　　/lib ― 共享函数库<br>
      　　/mnt ― 装载其他磁盘节点<br>
      　　/usr ― 附加应用程序<br>
      　　执行如下命令创建这些目录：<br>
      　　＃cd /mnt/floppy<br>
      　　＃mkdir dev proc etc sbin bin lib mnt usr<br>
      　　接下来的工作就是确定各个目录下的内容了：<br>
      　　・/dev：/dev中含有系统不可缺少的设备文件。可以把现有系统中/dev的文件拷贝过来，然后删除不必要的文件。命令cp －dpR /dev 
      /mnt会拷贝/dev整个目录但不拷贝文件内容，dp开关保证链接文件仍然不变，不会拷贝链接所指原文件，而且属性不变。如果你没有SCSI设备，删除所有的以sd开头的文件。如果你不想使用串口设备，删除所有以cua开头的文件。不过记住一定要保留console、kmem、mem、null、ram、tty1等文件。<br>
      　　・/etc：这个目录中含有一些必不可少的系统配置文件。这下面的文件比较多，那么到底哪些文件是必需的，哪些可有可无呢？由于这下面的文件一般是一些文本文件，都不是很大，干脆全部保留算了。<br>
      　　我的启动盘中含有不到15个配置文件，大致可分为3部分：<br>
      　　・rc.d/＊ ― 系统启动脚本<br>
      　　・fstab ― 列出要登录的文件系统<br>
      　　・inittab ― 包含启动过程参数<br>
      　　而且这些文件都是最简单的。rc应该包括：<br>
      　　＃!/bin/sh<br>
      　　/bin/mount －av<br>
      　　/bin/hostname yjy<br>
      　　fstab应包括：<br>
      　　/dev/ram0 / ext2 defaults<br>
      　　/dev/fd0 / ext2 defaults<br>
      　　/proc /proc proc defaults<br>
      　　inittab包括：<br>
      　　id:2:initdefault:<br>
      　　si::sysinit:/etc/rc<br>
      　　1:2345:respawn:/sbin/getty 9600 tty1<br>
      　　2:23:respawn:/sbin/getty 9600 tty2<br>
      　　・/bin和/sbin：该目录中包含有必不可少的应用程序，如ls, mv, cat，你可以根据自己的需要选择，不过一定要记住包括以下程序：init, 
      getty，login, mount，运行你的rc的外壳shell。<br>
      　　・/lib: 该目录中包含有你的启动盘启动过程中所需要的共享函数库，如果缺少必须的函数库，系统会停止启动或出现一大堆错误信息，所以一定要注意。<br>
      　　几乎所有的程序都需要libc库，列一下目录/lib中的libc：<br>
      　　％ ls －l /lib/libc＊<br>
      　　－rwxr－xr－x 1 root root 4016683 Apr 16 18:48 libc－2.1.1.so＊<br>
      　　lrwxrwxrwx 1 root root 13 Apr 10 12:25 libc.so.6 －&gt; libc－2.1.1.so＊<br>
      　　libc.so.6的6表示版本号，它指向的文件才是你真正需要的。<br>
      　　查看每一个程序使用的函数库，用命令ldd，如：<br>
      　　％ ldd /sbin/mke2fs<br>
      　　libext2fs.so.2 =&gt; /lib/libext2fs.so.2 (0x40014000)<br>
      　　libcom_err.so.2 =&gt; /lib/libcom_err.so.2 (0x40026000)<br>
      　　libuuid.so.1 =&gt; /lib/libuuid.so.1 (0x40028000)<br>
      　　libc.so.6 =&gt; /lib/libc.so.6 (0x4002c000)<br>
      　　/lib/ld－linux.so.2 =&gt; /lib/ld－linux.so.2 (0x40000000)<br>
      　　输出右边的库都是必须的，有的可能是链接文件。<br>
      　　在/lib目录下你还必须有函数库装载器，这个装载器或是ld.so (对 a.out 库) 或是 ld－linux.so (对 ELF 库)。新版本的ldd一般会告诉你所需库的装载器。<br>
      　　把装载器和库拷贝到/lib后，再仔细检查一遍，一定保证没有遗漏。<br>
      　　2.3 模块<br>
      　　如果你有一个模块化的内核，你还得考虑需要加载的模块，它们都位于/lib/modules,你可以把不是很重要的模块放到别的盘上，当系统启动后再加载，这样会节省启动盘的空间。<br>
      　　2.4 打包<br>
      　　一旦你完成了上述工作，卸下虚拟盘，拷贝到一个文件中，然后压缩。<br>
      　　umount /mnt<br>
      　　dd if=/dev/ram0 bs=1k | gzip －v9&gt;rfs.gz<br>
      　　压缩结束后，你就拥有了一个压缩的根文件系统，不过你得检查它的大小，如果大了，你还得删除一些东西。<br>
      　　3．组织引导盘<br>
      　　有了根文件系统和内核之后，最后的工作就是把它们组织在一起。<br>
      　　先检查总文件的大小，如果超出1.44MB，就得考虑重新创建所需或用两张磁盘，即使用两张磁盘，你的根文件系统也得小于1.44MB。<br>
      　　接着就是确定是用LILO控制启动还是直接用拷贝到盘上的内核控制启动。用LILO的好处是你能增加支持初始化硬件的参数到内核中，缺点是较复杂且占用珍贵的磁盘空间，不过我还是建议使用LILO控制系统启动。下面我就介绍用LILO的过程，直接用拷贝到盘上的内核控制启动的方法就不作叙述了。<br>
      　　用LILO控制启动首先就得写一个LILO配置文件，以下是一个最简单的配置文件，但是已经够用了。<br>
      　　boot =/dev/fd0<br>
      　　install =/boot/boot.b<br>
      　　map =/boot/map<br>
      　　read－write<br>
      　　backup =/dev/null<br>
      　　compact<br>
      　　image = KERNEL<br>
      　　label = Bootdisk<br>
      　　root =/dev/fd0<br>
      　　参数说明见相关资料。然后把它命名为bdlilo.conf。　接下来就是创建一个内核文件系统。把一张干净的软盘插入软驱，在上面创建ext2文件系统。<br>
      　　mke2fs －i 8192 －m 0 /dev/fd0 50<br>
      　　“－i 8192”表示每8192位创建一个信息节点。接着登录系统：<br>
      　　mount /dev/fd0 /mnt/floppy<br>
      　　rm －rf /mnt/floppy/lost＋found<br>
      　　mkdir /mnt/floppy{boot,dev}<br>
      　　删去目录/ lost＋found,创建两个目录/boot和/dev，再执行：<br>
      　　cp －R /dev/{null,fd0} /mnt/floppy/dev<br>
      　　接着拷贝启动加载器boot.b到目录/boot中，<br>
      　　cp /boot/boot.b /mnt/floppy/boot<br>
      　　最后，拷贝你创建的配置文件bdlilo.conf和内核到内核文件系统的根目录下，<br>
      　　cp bdlilo.conf KERNEL /mnt/floppy<br>
      　　现在，根文件系统所需的所有文件都准备就绪了。再执行下面的命令可以帮助安装LILO引导器到软盘的根文件系统上面：<br>
      　　lilo －v －C bdlilo.conf －r /mnt<br>
      　　OK，可以运行它了，如果运行结果没有错误就表明成功，否则就应该仔细检查一下上面的设置。}<!-- #EndEditable --></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR> 
    <TD>&nbsp;</TD>
    <TD ALIGN='right'><A HREF='#top'>页 首</A></TD>
  </TR>
</TABLE>
<BR>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='0' ALIGN='center'>
  <TR ALIGN='center' VALIGN='bottom'> 
    <TD HEIGHT='6'><IMG SRC='../../images/dot.gif' WIDTH='615' HEIGHT='1'></TD>
  </TR>
</TABLE>
<TABLE WIDTH='615' BORDER='0' CELLSPACING='0' CELLPADDING='2' ALIGN='center'>
  <TR ALIGN='center'> 
    <TD> 
      <script language="JavaScript" src="http://www.cpcw.com/download/yeskye.js">
</script>
    </TD>
    <TD> <noscript></noscript> <a href='/'>《电脑报》版权所有</a>，<a href='mailto:webmaster@yesky.com'>YESKY网</a>设计制作发布</TD>
  </TR>
</TABLE>
</BODY>
<!-- #EndTemplate -->
</HTML>
