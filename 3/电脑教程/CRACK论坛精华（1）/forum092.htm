<html>
<head>
<title>看雪学苑</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<style type="text/css">
<!--
.p8 {  font-size: 8pt}
.p9 {  font-size: 9pt}
a:hover {  color: #00FF00}
a {  text-decoration: none}
.p12 {  font-size: 12pt; font-weight: bold; color: #FF3333}
-->
</style>
</head>

<body bgcolor="#FFFFFF">
<span class="p9"><font color=blue>标 题:</font>请高手破此软件, impex 2.0,3.0. 郭大志老师请看(correct 
url) (144字)<br>
<font color=blue>发信人:</font>letterweb<br>
<font color=blue>时 间:</font>2000-6-8 14:44:44 <br>
<font color=blue>详细信息:</font><br>
</span>
<blockquote><span class="p9"> URL: http://bluecoffee.163.net/new.htm <br>
  <br>
  输入试验注册码号没有信息, 用TRW 干脆就不能输入试验码. <br>
  <br>
  是用VFOXPRO6.0编程, <br>
  是不是试用版, 无法破解? </span></blockquote>
<hr>
<p><span class="p9"><font color=blue>标 题:</font>既是FoxPro程序，用反编译程序试试，用SoftICE或TRW跟是一种痛苦，在VFP6R.DLL中出不来 
  (155字)<br>
  <font color=blue>发信人:</font>郭大志<br>
  <font color=blue>时 间:</font>2000-6-8 18:15:00 <br>
  <font color=blue>详细信息:</font><br>
  </span></p>
<blockquote><span class="p9"> 它的序列号放在c:\windows\system\serial.sys中。估计把这个文件拷到别的机器上就能用同样的注册码注册。 
  <br>
  <br>
  BTW，请不要叫我老师，岂敢好为人师，大家讨论讨论而已。 </span></blockquote>
<hr>
<p><span class="p9"><font color=blue>标 题:</font>到目前为止得到的结果如下 (3千字)<br>
  <font color=blue>发信人:</font>郭大志<br>
  <font color=blue>时 间:</font>2000-6-8 20:16:33 <br>
  <font color=blue>详细信息:</font><br>
  </span></p>
<blockquote><span class="p9"> 序列号放在c:\windows\system\serial.sys中， <br>
  注册码放在c:\windows\system\secret.sys中。 <br>
  这两个文件都是加密过的，算法很简单，用unfoxall（我只有demo版，而且这个demo版的40个文件限制无法去除，因强行修改40个文件限制会死机）对serial.exe进行反编译可以得到其加密和解密的算法。如下： 
  <br>
  <br>
  加密算法： <br>
  PROCEDURE secret <br>
  PARAMETER CSTRING <br>
  ESTRING = '' <br>
  NLONG = LEN(CSTRING) <br>
  FOR I = 1 TO NLONG <br>
  &nbsp; &nbsp; ESTRING = ESTRING + CHR(ASC(SUBSTR(CSTRING,I,1)) + I + NLONG) 
  <br>
  ENDFOR <br>
  RETURN ESTRING <br>
  ENDPROC <br>
  <br>
  解密算法： <br>
  PROCEDURE desecret <br>
  PARAMETER CSTRING <br>
  ESTRING = '' <br>
  NLONG = LEN(CSTRING) <br>
  FOR I = 1 TO NLONG <br>
  &nbsp; &nbsp; ESTRING = ESTRING + CHR(ASC(SUBSTR(CSTRING,I,1)) - I - NLONG) 
  <br>
  ENDFOR <br>
  RETURN ESTRING <br>
  ENDPROC <br>
  <br>
  用SoftICE跟踪它读取注册码后判断的过程，知道上述解密算法对应的汇编程序段如下： <br>
  0167:0C0746D7&nbsp; MOV&nbsp; &nbsp; &nbsp; ESI,ECX <br>
  0167:0C0746D9&nbsp; MOV&nbsp; &nbsp; &nbsp; EAX,[ESI]&nbsp; &nbsp; &nbsp; //取一个字节 
  <br>
  0167:0C0746DB&nbsp; SUB&nbsp; &nbsp; &nbsp; EAX,[EDX]&nbsp; &nbsp; &nbsp; //相减 
  <br>
  0167:0C0746DD&nbsp; JO&nbsp; &nbsp; &nbsp; &nbsp; 0C12995B <br>
  0167:0C0746E3&nbsp; MOV&nbsp; &nbsp; &nbsp; [ESI],EAX <br>
  0167:0C0746E5&nbsp; SUB&nbsp; &nbsp; &nbsp; EAX,EAX <br>
  <br>
  解开一个字符后，回到下面的地方，把解开的字符保存起来： <br>
  <br>
  0167:0C018C1F&nbsp; CALL&nbsp; &nbsp; &nbsp; 0C00CDEB&nbsp; &nbsp; //解开一个字符 
  <br>
  0167:0C018C24&nbsp; MOV&nbsp; &nbsp; &nbsp; ESI,EAX&nbsp; &nbsp; &nbsp; &nbsp; 
  //EAX中存放该字符 <br>
  0167:0C018C26&nbsp; MOV&nbsp; &nbsp; &nbsp; ECX,ESI <br>
  0167:0C018C28&nbsp; CALL&nbsp; &nbsp; &nbsp; 0C018C75 <br>
  0167:0C018C2D&nbsp; CMP&nbsp; &nbsp; &nbsp; ESI,000000FF <br>
  0167:0C018C33&nbsp; MOV&nbsp; &nbsp; &nbsp; EDI,EAX <br>
  0167:0C018C35&nbsp; JA&nbsp; &nbsp; &nbsp; &nbsp; 0C0D95E5 <br>
  0167:0C018C3B&nbsp; MOV&nbsp; &nbsp; &nbsp; EDX,EDI <br>
  0167:0C018C3D&nbsp; LEA&nbsp; &nbsp; &nbsp; ECX,[ESP+0E] <br>
  <br>
  之后它要把你输入的8位的注册码的前4位和后四位调换一下，比如我输入的为“12345678”，调换后变成“56781234”， <br>
  然后转换成一个数，对此数进行简单的浮点运算。 <br>
  <br>
  0167:0C09F332&nbsp; LEA&nbsp; &nbsp; &nbsp; EAX,[EDI*4+EDI] <br>
  0167:0C09F335&nbsp; LEA&nbsp; &nbsp; &nbsp; EDI,[EAX*2+ECX-30]&nbsp; //每次转换一个字符 
  <br>
  0167:0C09F339&nbsp; MOV&nbsp; &nbsp; &nbsp; AL,[ESP+11] <br>
  0167:0C09F33D&nbsp; INC&nbsp; &nbsp; &nbsp; ESI <br>
  0167:0C09F33E&nbsp; TEST&nbsp; &nbsp; &nbsp; AL,AL <br>
  0167:0C09F340&nbsp; JNZ&nbsp; &nbsp; &nbsp; 0C09F383 <br>
  0167:0C09F342&nbsp; XOR&nbsp; &nbsp; &nbsp; ECX,ECX <br>
  0167:0C09F344&nbsp; MOV&nbsp; &nbsp; &nbsp; CL,[ESI] <br>
  0167:0C09F346&nbsp; LEA&nbsp; &nbsp; &nbsp; EAX,[ECX-30] <br>
  0167:0C09F349&nbsp; CMP&nbsp; &nbsp; &nbsp; EAX,35 <br>
  0167:0C09F34C&nbsp; JA&nbsp; &nbsp; &nbsp; &nbsp; 0C09F367 <br>
  0167:0C09F34E&nbsp; XOR&nbsp; &nbsp; &nbsp; EDX,EDX <br>
  0167:0C09F350&nbsp; MOV&nbsp; &nbsp; &nbsp; DL,[EAX+0C09F424] <br>
  0167:0C09F356&nbsp; JMP&nbsp; &nbsp; &nbsp; [EDX*4+0C09F410] <br>
  0167:0C09F35D&nbsp; MOV&nbsp; &nbsp; &nbsp; EAX,[ESP+18] <br>
  0167:0C09F361&nbsp; TEST&nbsp; &nbsp; &nbsp; EAX,EAX <br>
  0167:0C09F363&nbsp; JZ&nbsp; &nbsp; &nbsp; &nbsp; 0C09F339 <br>
  0167:0C09F365&nbsp; JMP&nbsp; &nbsp; &nbsp; 0C09F311 <br>
  0167:0C09F367&nbsp; MOV&nbsp; &nbsp; &nbsp; CL,[ESP+2C] <br>
  0167:0C09F36B&nbsp; MOV&nbsp; &nbsp; &nbsp; AL,[ESI] <br>
  0167:0C09F36D&nbsp; CMP&nbsp; &nbsp; &nbsp; AL,CL <br>
  0167:0C09F36F&nbsp; JZ&nbsp; &nbsp; &nbsp; &nbsp; 0C09F378 <br>
  0167:0C09F371&nbsp; MOV&nbsp; &nbsp; &nbsp; BYTE PTR [ESP+11],01 <br>
  0167:0C09F376&nbsp; JMP&nbsp; &nbsp; &nbsp; 0C09F339 <br>
  0167:0C09F378&nbsp; MOV&nbsp; &nbsp; &nbsp; [ESP+11],BL <br>
  0167:0C09F37C&nbsp; MOV&nbsp; &nbsp; &nbsp; EBX,00000001 <br>
  0167:0C09F381&nbsp; JMP&nbsp; &nbsp; &nbsp; 0C09F339 <br>
  0167:0C09F383&nbsp; MOV&nbsp; &nbsp; &nbsp; EAX,[ESP+24] <br>
  0167:0C09F387&nbsp; MOV&nbsp; &nbsp; &nbsp; DL,[ESP+13] <br>
  0167:0C09F38B&nbsp; MOV&nbsp; &nbsp; &nbsp; [ESP+14],EDI&nbsp; &nbsp; //保存转换结果 
  <br>
  0167:0C09F38F&nbsp; MOV&nbsp; &nbsp; &nbsp; [EAX],DL <br>
  0167:0C09F391&nbsp; MOV&nbsp; &nbsp; &nbsp; AL,[ESP+12] <br>
  0167:0C09F395&nbsp; TEST&nbsp; &nbsp; &nbsp; AL,AL <br>
  0167:0C09F397&nbsp; JNZ&nbsp; &nbsp; &nbsp; 0C0EC5A9 <br>
  0167:0C09F39D&nbsp; MOV&nbsp; &nbsp; &nbsp; EAX,[ESP+18] <br>
  0167:0C09F3A1&nbsp; CMP&nbsp; &nbsp; &nbsp; EAX,09 <br>
  0167:0C09F3A4&nbsp; JG&nbsp; &nbsp; &nbsp; &nbsp; 0C0EC5BE <br>
  0167:0C09F3AA&nbsp; FILD&nbsp; &nbsp; &nbsp; DWORD PTR [ESP+14]&nbsp; //转换结果变成浮点数 
  <br>
  <br>
  离找到注册码还差一步，用SoftICE跟实在太累！ </span></blockquote>
<hr>
<p><span class="p9"><font color=blue>标 题:</font>搞定了 (1千字)<br>
  <font color=blue>发信人:</font>郭大志<br>
  <font color=blue>时 间:</font>2000-6-9 17:36:34 <br>
  <font color=blue>详细信息:</font><br>
  </span></p>
<blockquote><span class="p9"> 谢谢letterweb。我下载了unfoxall之后，反编译，找到如下判断注册码的代码，有了源程序显然很简单，如下： 
  <br>
  * -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- <br>
  *&nbsp; 文件名: CHECKSN.PRG &lt;-- 本文件由 UnFoxAll 创建 <br>
  * -=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=- <br>
  <br>
  <br>
  IF&nbsp; .NOT. FILE((CSERIAL)) .OR.&nbsp; .NOT. FILE((CSECRET))&nbsp; //检查文件cserial.sys和csecret.sys是否存在 
  <br>
  &nbsp; &nbsp; LREGISTER = .F.&nbsp; &nbsp; //不存在就未注册 <br>
  &nbsp; &nbsp; DO CHECKEXP&nbsp; &nbsp; &nbsp; &nbsp; //检查是否过期 <br>
  ELSE <br>
  &nbsp; &nbsp; NSERIAL = FOPEN((CSERIAL))&nbsp; &nbsp; &nbsp; //打开cserial.sys 
  <br>
  &nbsp; &nbsp; NSIZE = FSEEK(NSERIAL,0,2) <br>
  &nbsp; &nbsp; = FSEEK(NSERIAL,0,0) <br>
  &nbsp; &nbsp; NO = FREAD(NSERIAL,NSIZE)&nbsp; &nbsp; &nbsp; &nbsp; //读取序列号 <br>
  &nbsp; &nbsp; NO = DESECRET(NO)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
  &nbsp; &nbsp; &nbsp; //解密序列号 <br>
  &nbsp; &nbsp; = FCLOSE(NSERIAL) <br>
  &nbsp; &nbsp; NSECRET = FOPEN((CSECRET))&nbsp; //打开csecret.sys <br>
  &nbsp; &nbsp; NSIZE = FSEEK(NSECRET,0,2) <br>
  &nbsp; &nbsp; = FSEEK(NSECRET,0,0) <br>
  &nbsp; &nbsp; CKEY = FREAD(NSECRET,NSIZE)&nbsp; //读取注册码 <br>
  &nbsp; &nbsp; CKEY = DESECRET(CKEY)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
  //解密注册码 <br>
  &nbsp; &nbsp; = FCLOSE(NSECRET) <br>
  &nbsp; &nbsp; KEY1 = SUBSTR(CKEY,1,4)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //注册码的前四位 
  <br>
  &nbsp; &nbsp; KEY2 = SUBSTR(CKEY,5,8)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //注册码的后四位 
  <br>
  &nbsp; &nbsp; CKEY = KEY2 + KEY1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
  &nbsp; &nbsp; //前四位和后四位交换了一下 <br>
  &nbsp; &nbsp; CKEY = STR(VAL(CKEY) - 550331,8) //减去550331 <br>
  &nbsp; &nbsp; IF CKEY &lt;> NO&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //差等于序列号吗？ <br>
  &nbsp; &nbsp; &nbsp; LREGISTER = .F.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //不等则未注册 <br>
  &nbsp; &nbsp; &nbsp; DO CHECKEXP&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //检查是否过期 <br>
  &nbsp; &nbsp; ELSE <br>
  &nbsp; &nbsp; &nbsp; LREGISTER = .T.&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 
  &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //注册用户 <br>
  &nbsp; &nbsp; ENDIF <br>
  ENDIF <br>
  <br>
  至此可以很轻易地写出注册机。checkexp.prg是对时间进行判断，即判是否过期，时间放在文件setdate.sys中。 <br>
  <br>
  BTW：我下载的unfoxall中带的敌后武工队的注册机怎么不灵光，只好自己把unfoxall搞定了。 </span></blockquote>
<hr>
<p><span class="p9"><font color=blue>标 题:</font>try (461字)<br>
  <font color=blue>发信人:</font>郭大志<br>
  <font color=blue>时 间:</font>2000-6-10 0:09:04 <br>
  <font color=blue>详细信息:</font><br>
  </span></p>
<blockquote><span class="p9"> #include &lt;stdio.h> <br>
  <br>
  void main(void) <br>
  { <br>
  <br>
  &nbsp; &nbsp; long serial; <br>
  &nbsp; &nbsp; int k; <br>
  &nbsp; &nbsp; char buf[32]; <br>
  <br>
  &nbsp; &nbsp; printf("Input your serial:"); <br>
  &nbsp; &nbsp; scanf("%lu", &amp;serial); <br>
  <br>
  &nbsp; &nbsp; serial += 550331L; <br>
  &nbsp; &nbsp; sprintf(buf, "%08lu", serial); <br>
  <br>
  &nbsp; &nbsp; printf("Your registration code is :"); <br>
  &nbsp; &nbsp; for(k = 4; k &lt; 8; k++) putchar(buf[k]); <br>
  &nbsp; &nbsp; for(k = 0; k &lt; 4; k++) putchar(buf[k]); <br>
  &nbsp; &nbsp; putchar('\n'); <br>
  } <br>
  <br>
  实际上可以不用注册机，把别人的serial.sys 和secret.sys拷过来就可以用。 </span></blockquote>
<hr>
</body>
</html>
