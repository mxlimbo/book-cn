<html>

<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>用Delphi实现无边界窗体的移动</title>
</head>

<body bgcolor="#FFFFFF" text="#000000">

<p align="center"><big><big><big>用Delphi实现无边界窗体的移动</big></big></big><br>
宋爱平 </p>

<p>　　在用Delphi制作Windows程序的窗体时，窗体的边界有四种选择：对话框式（bsDialog），<br>
单边固定式（bsSingle），双边可变式（bsSizeable），无边界式（bsNone）。当设置为<br>
bsNone时，窗体也就没有标题条，很显然，程序运行以后就无法移动窗体了。事实上，无边界<br>
窗体是很有用的，例如，象Word里面的浮动式工具箱其实就是无边界窗体，它可以大大节约屏<br>
幕空间。那么，如何用Delphi实现这个功能呢？显然，这需要修改Windows的内部消息，也就<br>
是说，需要把“MouseDownonForm”这个消息改为“MouseDownonCaption”，这其中有三个关键：<br>
捕捉MouseDown消息、判断光标位置、发送MouseDown消息。如果光标在窗体中，则发送<br>
MouseDownonCaption消息。 <br>
<br>
　　在Delphi的对象巡检器中列出的所有事件是不能捕捉到Windows消息的，因为这些都是已<br>
经发出的消息，无法修改了。捕捉Windows消息有两种办法：一个就是增加一个消息处理句<br>
柄，直接处理Windows消息；另一个是对消息进行过滤，滤出所需消息。第二个办法比较常用，<br>
适用于各种情况，下面就是移动无边界窗体程序片断，加注释部分是手动加入的： 
<br>
<br>
　　unitUnit1； <br>
<br>
　　： <br>
<br>
　　type <br>
<br>
　　TForm1Κclass（TForm） <br>
<br>
　　procedureFormCreate（Sender：TObject）； <br>
<br>
　　： <br>
<br>
　　public <br>
<br>
　　｛申明消息过滤过程｝ <br>
<br>
　　procedureAppMessage（varMsg：TMsg；varHandled <br>
：Boolean）； <br>
<br>
　　： <br>
<br>
　　implementation <br>
<br>
　　procedureTForm1．FormCreate（Sender：TObject） <br>
； <br>
<br>
　　begin <br>
<br>
　　｛捕捉消息：将程序的收到消息事件与消息过滤过程 <br>
关联起来｝ <br>
<br>
　　Application．OnMessage：ΚAppMessage； <br>
<br>
　　end； <br>
<br>
　　procedureTForm1．AppMessage（varMsg：TMsg；var <br>
Handled：Boolean）； <br>
<br>
　　begin <br>
<br>
　　｛如果鼠标左键按下的话｝ <br>
<br>
　　ifMsg．messageΚWM―LButtonDownthen <br>
<br>
　　begin <br>
<br>
　　｛判断光标是否在用户工作区内｝ <br>
<br>
　　ifDefWindowProc（Handle，WM―NCHitTest，0，Get <br>
MessagePos）ΚHTClientthen <br>
<br>
　　begin <br>
<br>
　　｛发出鼠标在用户标题栏内被按下的消息｝ <br>
<br>
　　SendMessage（Handle，WM―NCLButtonDown， <br>
<br>
　　HTCaption，GetMessagePos）； <br>
<br>
　　Handled：Κtrue；｛消息处理完毕，窗体不再接受M <br>
ouseDown及Click事件，如果为false，程序的运行稍微有 <br>
些不正常。｝ <br>
<br>
　　end； <br>
<br>
　　end； <br>
<br>
　　end； <br>
<br>
　　end． <br>
<br>
　　程序在Delphi1．0、中文Windows3．2下运行通过。 </p>
</body>
</html>
