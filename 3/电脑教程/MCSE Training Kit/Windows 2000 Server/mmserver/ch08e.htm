<HTML>
<HEAD>
<TITLE>Lesson 4: Printing and Active Directory Services</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmserver.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch08d.htm", "ch08f.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="399"><h1>Lesson 4: Printing and Active Directory Services</h1></A>
<p>A directory service needs to make it easy for users to find printers. In
Windows 2000, the print subsystem is tightly integrated with Active Directory services, making it possible to search across a domain for printers at different locations.</p>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b> 

<ul>
<p><li>Describe how printing is integrated in Active Directory services</li></p>
</ul>

<b>Estimated lesson time: 20 minutes</b> 
</blockquote></div>
</p>

<A NAME="400"><h2>Overview of Printing and Active Directory Services</h2></A>
<p>Active Directory services is a distributed database shared by the domain controllers in a network. Information about printer queues, sites, names, and addresses is kept in the Active Directory store. This information must be sent by individual print servers, which is why it is important to keep the printer information contained in the Active Directory store up-to-date.</p>

<p>Pertinent characteristics of the relationship between print servers and Active Directory services include the following:</p>

<ul>
<p><li>Each print server is responsible for publishing its own printers in the Active Directory store.</li></p>

<p><li>The print server does not have an affinity to any specific domain controller. It dynamically finds a domain controller in the appropriate domain.</li></p>

<p><li>When a printer is updated on the print server, the changes are automatically propagated through Active Directory services to the Active Directory store.</li></p>

<p><li>Printers are published in the Active Directory store as printQueue objects. The published printQueue object contains a subset of the information stored on the print server for a printer.</li></p>
</ul>

<p>By default, printing is integrated with Active Directory services to work without administrative intervention. You need to make changes only if the default behavior is not acceptable. The default behavior includes the following:</p>

<ul>
<p><li>Any printer shared by a print server is published in Active Directory services. Administrative access to the host computer is still required to install and share a printer.</li></p>

<p><li>The printQueue object is placed in the print server's computer object in the Active Directory store.</li></p>
</ul>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
The printer does not appear below the Computer object in the Active Directory Users And Computers snap-in. Instead, using the Find command in the Active Directory Users And Computers snap-in, the result will display the printer associated with a server.</blockquote></div>
</p>

<ul>
<p><li>When any change occurs in the printer's configuration, the Active Directory object is updated. All the configuration information is re-sent to the Active Directory store even if some of it has remained unchanged.</li></p>

<p><li>If a print server disappears from the network, its printers are removed from Active Directory services.</li></p>
</ul>

<A NAME="401"><h2>Publishing Windows 2000 Printers</h2></A>
<p>You can publish only printers that are shared. Printer publishing is controlled by the List In The Directory check box on the printer's Sharing tab (Figure 8.7).</p>

<p>The Add Printer wizard does not let you change this setting when you create a printer. Printers that are added by using the Add Printer wizard are published by default. If you do not want a printer published in the Active Directory service, clear the List In The Directory check box on the Sharing tab of the printer's Properties dialog box.</p>

<p>
<div class="note"><blockquote><b>NOTE</b> <hr>
A print device connected to a universal serial bus (USB) port will likely be detected and as a consequence a printer will be installed for it automatically. In this case, you must manually share and publish the printer by using the Sharing tab.</blockquote></div>
</p>

<p>The printer is placed in the print server's computer object in Active Directory services. Once it has been placed in Active Directory services, the object can be moved or renamed from the Find Printers dialog box. This dialog box can be accessed from the Active Directory Users And Computers snap-in. Once the snap-in is opened, click the Action menu and then choose Find. From the Find drop-down list box, choose printers and then click Find Now. Figure 8.13 shows how to access the move feature in the Find Printers dialog box.</p>

<p>
<A HREF="javascript:fullSize('f08xx13x.htm')"> <img src="images/f08xx13.jpg" border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 8.13</b> <i>The Find Printers dialog box showing how to move a printer</i><!--/caption-->
</p>

<A NAME="402"><h3>Publishing Mechanism</h3></A>
<p>The print server sends data asynchronously to Active Directory services. Initially it sends the data after a one-second delay. If this fails, the server retries after a longer period and continues until it reaches a delay of 2 hours. At this point, the server retries at this interval until it is successful. During this pending phase, the message &quot;The Directory operation is still in progress&quot; is displayed on the Sharing tab of the printer's Properties dialog box.</p>

<p>The printer is published to a random domain controller, so a query might not show the printer until it has been replicated to all the domain controllers. For local domain controllers on the same site, the maximum delay is approximately 30 minutes, but the typical delay is 5 to 10 minutes. For intersite searches, the delay depends on the replication strategy of your organization.</p>

<A NAME="403"><h3>Pruning Orphans</h3></A>
<p>When a printer is deleted from a print server, the corresponding Active Directory object is removed. A program called an orphan pruner accomplishes this by running on each domain controller to periodically check for orphaned printer objects. If a printer does not exist, the object is deleted. The orphan pruner looks only at print servers in the same site as the domain controller on which it is running.</p>

<p>The orphan pruner is controlled by several policy settings. By default, if the orphan pruner cannot see a printer three times in a row at 8-hour intervals, it assumes the entry is no longer valid and deletes it.</p>

<p>However, there can be circumstances where the printer is no longer available, such as when the print server is being rebuilt or is powered off, so the print objects are removed because the Active Directory store must reflect only the print devices currently available. Once the server comes back up, its printers need to be republished. To cover this situation, a print server verifies that its printers are published when it restarts and the spooler starts up. You can force a restart by issuing the net stop spooler and net start spooler commands. Alternatively, you can use the Check Published State group policy. The Check Published State group policy is found in the Group Policy snap-in in the Printers folder under the Computer Configuration node.</p>

<A NAME="404"><h2>Supporting Windows NT Printers</h2></A>
<p>Printers that are on print servers running Windows NT 4.0 or Windows NT 3.51 can be published in Active Directory services by using the Active Directory Users And Computers snap-in. Once in the snap-in, a printer object is created in an organizational unit (OU), container, or domain node in much the same way that a user or group object is created. Alternately, you can use the Pubprn.vbs script, which is provided in the System32 folder. Pubprn.vbs is a Windows Script Host (WSH) file and requires two parameters. The print server computer name or UNC name (<font face="courier new" size="-1">\\&lt;<i>computername</i>&gt;\&lt;<i>sharename</i> &gt;</font>) is the first parameter. The second parameter is the ADSI path to which you want the information published in the directory. You can publish all printers on a server or specify single printers to be published. For example, to publish a single shared printer \\Server03\5L running on a Windows NT Server to the Sales OU in the microsoft.com domain using Pubprn.vbs, open a command prompt and type:</p>

<P><table cellpadding=5 width="95%"><TR><TD>
<PRE>
cscript %systemroot%\system32\pubprn.vbs \\server03\5L 
&quot;LDAP://OU=Sales,DC=microsoft,DC=com&quot;
</PRE>
</td></tr></table></P>

<p><div class="note"><blockquote><b>NOTE</b><HR>
You cannot use this command to publish printers running a Windows 2000 print server.</blockquote></div></p>

<A NAME="405"><h2>Group Policy Settings</h2></A>
<p>Active Directory services includes a set of group policies that apply to Windows 2000 printing. The policies are located in the Computer Configuration node of the Group Policy snap-in, under Administration Templates. For a description of each of these policies, open the Properties dialog box for a specific property and select the Explain tab.</p>

<A NAME="406"><h3>Printer Location Tracking</h3></A>
<p>Printer location tracking in Windows 2000 allows users to search for and find printers at their location or another specified location, according to attributes assigned to printers. Location tracking lets you design a location scheme and assign computers and printers to locations in your scheme. Location tracking overrides the standard method of locating and associating users and printers, which uses the IP address and subnet mask of a computer to estimate its physical location and proximity to other computers. The group policy Pre-Populate Printer Search Location Text is used to enable printer location tracking for a group of computers. For more information about printer location tracking and procedures for setting it up, see Windows 2000 Server Help.</p>

<A NAME="407"><h2>Lesson Summary</h2></A>
<p>In Windows 2000, the print subsystem is tightly integrated with Active Directory services, making it possible to search across a domain for printers at different locations. By default, the printing is integrated with Active Directory services so that it can work without administrative intervention. Any printer shared by a print server is published in Active Directory services. The printQueue object is placed in the print server's computer object in Active Directory services. When any change occurs in the printer's configuration, the Active Directory object is updated. If a print server disappears from the network, its printers are removed from the Active Directory store. You can publish only printers that are shared. Printer publishing is controlled by the List In The Directory check box on the Sharing tab of the printer's Properties dialog box. In addition, printers that are on print servers running Windows NT 3.51 or Windows NT 4.0 can be published in the Active Directory store by using the
Active Directory Users aAnd Computers snap-in or the Pubprn.vbs WSH file. Active Directory services also includes a set of group policies that apply to Windows 2000 printing.</p>

</BODY>
</HTML>



