<HTML>
<HEAD>
<TITLE>Lesson 3: Implementing IP Routing on a Remote Access Server</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmnet.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch11c.htm">[Previous]</A> <A HREF="ch11e.htm">[Next]</A><P>



<A NAME="480"><H1>Lesson 3: Implementing IP Routing on a Remote Access Server</H1></A>

<p>In this lesson, you will learn how to turn your remote access server into an IP router, update its routing tables, and implement demand-dial routing.</p>

<p><div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li>Install IP routing (Routing and Remote Access)</li></p>

<p><li>Describe how to update routing tables</li></p>

<p><li>Implement demand-dial routing</li></p>
</ul>



<p><b>Estimated lesson time: 30 minutes</b></p>
</blockquote></div></p>

<A NAME="481"><H2>Installing IP Routing</H2></A>

<p>Installing IP routing is very similar to installing remote access server. In fact, 
the same wizard is used for new installs, as the following practice shows. If you already have remote access installed, perform the following procedure to enable IP routing on your computer.</p>

<p><li><b>To enable IP Routing</b></li></p>

<ol>
<p><li>From the Routing and Remote Access Manager, right-click Properties, enable This Computer As A Router, then click OK.</li></p>

<p><li>Click Yes at the warning, You made changes to the router configuration that require the router to be restarted. Do you want to restart now?</li></p>
</ol>

<p>If you have not previously installed remote access server, the following practice outlines the steps.</p>

<p>
<img src="images/practic.JPG" width=90 height=72 border="0">
</p>

<A NAME="482"><H3>Practice: Enabling and Configuring a Routing and Remote Access Server</H3></A>

<p>In this procedure, you will install a Routing and Remote Access server using the Routing and Remote Access Manager (see Figure 11.11).</p>

<p><li><b>To install a Routing and Remote Access server</b></li></p>

<ol>
<p><li>Open the Routing and Remote Access Manager.</li></p>

<p><li>Right-click your machine name and choose Configure And Enable Routing And Remote Access.</li></p>

<p><li>In the Routing And Remote Access Server Setup Wizard, click Next.</li></p>

<p><li>On the Common Configurations page, select the Network Router radio button, then click Next.</li></p>


<p>
<A HREF="javascript:fullSize('11ntk11x.htm')"> <img src="images/11ntk11.JPG" width=404 height=285 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 11.11</b> <i>Managing a Routing and Remote Access server</i><!-- /caption -->
</p>


<p><li>On the Remote Client Protocols page, under Protocols, make sure that TCP/IP is listed, verify that Yes, All The Required Protocols Are On This List is selected, then click Next.</li></p>

<p><li>On the Demand Dial Connections page, make sure that No is specified from You Can Set Up Demand-Dial Routing Connections After This Wizard Finishes, then click Next.</li></p>

<p><li>Click Finish.</li></p>
</ol>

<A NAME="483"><H2>Updating the Routing Tables</H2></A>

<p>The routing decision is aided by knowing which network addresses (or network IDs) are available in the internetwork. This knowledge is obtained from a database called the routing table. The routing table is a series of entries called routes that contain information on where the network IDs of the internetwork are 
located. The routing table is not exclusive to a router. Hosts (nonrouters) also have a routing table that is used to determine the optimal route.</p>

<A NAME="484"><H3>Types of Routing Table Entries</H3></A>

<p>Each entry in the routing table is considered a route and is one of the 
following types:</p>

<ul>
<p><li><b>Network route.</b> A network route provides a route to a specific network ID in the internetwork.</li></p>

<p><li><b>Host route.</b> A host route provides a route to an internetwork address (network ID and node ID). Host routes are typically used to create custom routes to specific hosts to control or optimize network traffic. A host route is equivalent to a network route with a netmask of 255.255.255.255.</li></p>


<p><li><b>Default route.</b> A default route is used when no other routes in the routing table are found. For example, if a router or host cannot find a network route or host route for the destination, the default route is used. The default route simplifies the configuration of hosts. Rather than configuring hosts with routes for all the network IDs in the internetwork, a single default route is used to forward all packets with a destination network or internetwork address that was not found in the routing table. A default route is equivalent to a network route with a netmask of 0.0.0.0.</li></p>

</ul>



<A NAME="485"><H3>Routing Table Structure</H3></A>

<p>Figure 11.12 shows a routing table.</p>


<p>
<A HREF="javascript:fullSize('11ntk12x.htm')"> <img src="images/11ntk12.JPG" width=404 height=125 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 11.12</b> <i>Routing table</i><!-- /caption -->
</p>

<p>Each entry in the routing table consists of the following information fields:</p>

<ul>
<p><li><b>Destination.</b> The network ID or an internetwork address for a host route. On IP routers, there is an additional subnet mask field that determines the IP network ID from a destination IP address.</li></p>

<p><li><b>Gateway.</b> The address to which the packet is forwarded. The forwarding address is a hardware address or an internetwork address. For networks to which the host or router is directly attached, the forwarding address field may be the address of the interface that is attached to the network.</li></p>

<p><li><b>Interface.</b> The network interface that is used when packets are forwarded to the network ID. This is a port number or other type of logical identifier.</li></p>

<p><li><b>Metric.</b> A measurement of the preference of a route. Typically, the lowest metric is the most preferred route. If multiple routes exist to a given destination network, the route with the lowest metric is used. Some routing algorithms only store a single route to any network ID in the routing table, even when multiple routes exist. In this case, the metric is used by the router to determine which route to store in the routing table.</li></p>
</ul>



<p><div class="note"><blockquote><b>NOTE</b><HR>The preceding list is intended to be a representative list of fields in the routing tables used by routers. Actual fields in the routing tables for different routable protocols may vary.</blockquote></div>
</p>

<A NAME="486"><H2>Implementing Demand-Dial Routing</H2></A>

<p>A demand-dial interface is a router interface that will be brought up on demand based on network traffic. The demand-dial link is only initiated if the routing table shows that this interface is needed to reach the IP destination address. The routing table does not provide any discretion on who or what protocol can bring up the demand-dial link. It is simply based on where the traffic needs to go.</p>

<p>Demand-dial filters control what traffic will initiate the demand-dial link. Filters can be set to permit or deny particular source or destination IP addresses, ports, or protocols. Further control is offered through the use of time-of-day restrictions. Even though the demand-dial filter requirements are met, if the time of day is restricted by the configuration of dial-out hours, the router will not dial.</p>

<p>The fields described in the following section for IP, TCP, and User Datagram Protocol (UDP) headers can be used to configure demand-dial filters. Routing and Remote Access allows filtering on the following fields:</p>

<A NAME="487"><H3>IP Header</H3></A>

<p>An IP datagram includes an IP header of 20 bytes. The following list describes the key fields in the IP header:</p>

<ul>
<p><li><b>IP protocol.</b> An identifier of the IP client protocol. For example, TCP uses a Protocol ID of 6, UDP uses a Protocol ID of 17, and ICMP uses a Protocol ID of 1. The Protocol field is used to demultiplex an IP packet to the upper layer protocol.</li></p>

<p><li><b>Source IP address.</b> The source IP address stores the IP address of the originating host.</li></p>

<p><li><b>Destination IP address.</b> The destination IP address stores the IP address of the destination host. The destination IP address can be configured with a subnet mask, allowing an entire range of IP addresses (corresponding with a network ID) to be specified with a single filter entry.</li></p>
</ul>



<A NAME="488"><H3>TCP Header</H3></A>

<p>TCP uses byte-stream communications in which data contained by the TCP 
segment is considered as a sequence of bytes with no record or field boundaries. The following list describes the key fields in the TCP header:</p>

<ul>
<p><li><b>TCP source port.</b> The TCP source port is used to identify the source process that is sending the TCP segment.</li></p>


<p><li><b>TCP destination port.</b> The TCP destination port is used to identify the destination process for this TCP segment.</li></p>
</ul>



<A NAME="489"><H3>UDP Header</H3></A>

<p>UDP is used by applications that do not require an acknowledgment of receipt of data and that typically transmit small amounts of data at one time. The following list describes the key fields in the UDP header:</p>

<ul>
<p><li><b>UDP source port.</b> The UDP source port is used to identify the source process that is sending the UDP message.</li></p>


<p><li><b>UDP destination port.</b> The UDP destination port is used to identify the destination process for the UDP message.</li></p>
</ul>



<p><div class="note"><blockquote><b>NOTE</b><HR>A list of well-known ports can be found in %winroot%\system32\drivers\ etc\services or RFC 1700.</blockquote></div>
</p>

<A NAME="490"><H3>ICMP</H3></A>

<p>ICMP messages are encapsulated within IP datagrams so that they can be 
routed throughout an internetwork. The following list describes key fields in an ICMP packet:</p>

<ul>
<p><li><b>ICMP type.</b> The ICMP type indicates the type of ICMP packet (Echo Request vs. Echo Reply, and so on).</li></p>


<p><li><b>ICMP code.</b> The ICMP code indicates one of possible multiple functions within a given type.</li></p>
</ul>



<A NAME="491"><H3>Configuring Demand-Dial Filters</H3></A>

<p>Windows 2000 demand-dial routing allows the configuration of demand-dial 
filters and dial-out hours to prevent demand-dial connections from occurring.</p>

<p><li><b>To configure demand-dial filters</b></li></p>

<ol>
<p><li>Open the Routing and Remote Access Manager.</li></p>

<p><li>Click Routing Interfaces.</li></p>

<p><li>Right-click the demand-dial interface.</li></p>

<p><li>Choose Set Demand-Dial Filters.</li></p>

<p><li>In the Set Demand-Dial Filters dialog box, illustrated in Figure 11.13, click Add.</li></p>

<p>
<A HREF="javascript:fullSize('11ntk13x.htm')"> <img src="images/11ntk13.JPG" width=404 height=318 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 11.13</b> <i>IP demand-dial filters configuration</i><!-- /caption -->
</p>

</ol>

<p><b>Source and Destination IP Address</b></p>

<p>The source and destination IP address is configured with a subnet mask, allowing an entire range of IP addresses (corresponding to a network ID) to be specified with a single filter entry. For example, 10.45.45.45 mask 255.255.255.255 
applies to only one address, whereas 10.0.0.0 mask 255.0.0.0 applies to the entire Class A network.</p>

<p><b>Protocol</b></p>

<p>For each filter, various protocols can be used:</p>

<ul>
<p><li>TCP, TCP-established, and UDP are configured with source and destination ports.</li></p>

<p><li>ICMP is configured with ICMP type and ICMP code.</li></p>

<p><li>ANY means any protocol.</li></p>

<p><li>Other is used to specify an IP protocol ID. This can be entered as a protocol number or name. Protocol names are resolved to a protocol number using the PROTOCOL file in the %winroot%\system32\drivers\etc directory.</li></p>
</ul>



<p><b>Action</b></p>

<p>The demand-dial filtering is based on exceptions. You can either configure 
Routing and Remote Access to initiate connection only for the traffic defined by the filters, or initiate connection for all traffic except those defined by filters.</p>

<A NAME="492"><H3>Dial-Out Hours</H3></A>

<p>Dial-out hours are used to specify when the demand-dial connection can be made. With dial-out hours, you can specify the time of day and day of week that a demand-dial connection is either allowed or denied.</p>

<p><li><b>To configure time-of-day restrictions</b></li></p>

<ol>
<p><li>Open the Routing and Remote Access Manager.</li></p>

<p><li>Click Routing Interfaces.</li></p>

<p><li>Right-click the demand-dial interface.</li></p>

<p><li>Choose Dial-Out Hours.</li></p>

<p><li>In the Dial-Out Hours dialog box, illustrated in Figure 11.14, select the desired hours to permit or deny.</li></p>

<p>
<A HREF="javascript:fullSize('11ntk14x.htm')"> <img src="images/11ntk14.JPG" width=404 height=249 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 11.14</b> <i>The Dial-Out Hours dialog box</i><!-- /caption -->
</p>

</ol>

<A NAME="493"><H2>Lesson Summary</H2></A>

<p>In this lesson you learned how to turn your remote access server into an IP router or install Routing and Remote Access, update its routing tables, and implement demand-dial routing.</p>

</BODY>
</HTML>





