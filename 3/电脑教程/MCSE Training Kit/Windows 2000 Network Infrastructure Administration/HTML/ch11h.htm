<HTML>
<HEAD>
<TITLE>Lesson 7: Managing and Monitoring Remote Access</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmnet.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch11g.htm">[Previous]</A> <A HREF="ch11i.htm">[Next]</A><P>



<A NAME="511"><H1>Lesson 7: Managing and Monitoring Remote Access</H1></A>

<p>Managing and monitoring a remote access server can be done with several tools. In this lesson, you will learn about remote access logging, accounting, Netsh, Network Monitor, and various resource kit utilities.</p>

<p><div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li>Explain remote access logging</li></p>

<p><li>Describe accounting</li></p>

<p><li>Explain Netsh</li></p>

<p><li>Understand Network Monitor's role in remote access</li></p>

<p><li>List several resource kit utilities to monitor remote access</li></p>
</ul>



<p><b>Estimated lesson time: 30 minutes</b></p>
</blockquote></div></p>

<A NAME="512"><H2>Logging User Authentication and Accounting Requests</H2></A>

<p>IAS can create log files based on the authentication and accounting requests 
received from the NASs, collecting these packets in a centralized location. Setting up and using such log files to track authentication information, such as each 
accept, reject, and automatic account lockout, can help simplify administration 
of your service. You can set up and use logs to track accounting information, such as logon and logoff records, to help maintain records for billing purposes (see Figure 11.20).</p>


<p>
<img src="images/11ntk20.JPG" width=404 height=448 border="0">
</p><p>
<!-- caption --><b>Figure 11.20</b> <i>Remote Access logging</i><!-- /caption -->
</p>

<p>When you set up logging, you can specify</p>

<ul>
<p><li>The requests to be logged</li></p>

<p><li>The file format for the logs</li></p>

<p><li>The frequency with which new logs are started</li></p>

<p><li>The location where the logs are to be maintained</li></p>
</ul>



<p>You can also select the types of requests received by the IAS server that are 
to be logged:</p>

<ul>
<p><li>Accounting requests, including the following:</li></p>
<ul>
<p><li>Accounting-on requests, which are sent by the NAS to indicate that the NAS is online and ready to accept connections</li></p>

<p><li>Accounting-off requests, which are sent by the NAS to indicate that the NAS is going offline</li></p>

<p><li>Accounting-start requests, which are sent by the NAS (after the user is accepted by the IAS server) to indicate the start of a user session</li></p>

<p><li>Accounting-stop requests, which are sent by the NAS to indicate the end of a user session</li></p>
</ul>
<p><li>Authentication requests, including the following:</li></p>
<ul>
<p><li>Authentication requests, which are sent by the NAS on behalf of the connecting user. These entries in the log contain only incoming attributes.</li></p>


<p><li>Authentication accepts and rejects, which are sent by IAS to the NAS to indicate whether the user should be accepted or rejected. These entries contain only outgoing attributes.</li></p>

<p><li>Periodic status, to obtain interim accounting requests sent by some NASs during sessions.</li></p>

<p><li>Accounting-interim requests, which are sent periodically by the NAS during a user session (if the acct-interim-interval attribute is configured in the remote access profile on the IAS server to support periodic requests).</li></p>


<p>Initially, it is recommended that you select the first two options and refine your logging methods after you determine which data best matches your needs.</p>
</ul>
</ul>



<p>When you set up your servers, specify whether new logs are started daily, weekly, monthly, or when the log reaches a specific size. You can also specify that a single log is maintained continually (regardless of file size), but this is not recommended. The file naming convention for logs is determined by the log 
period you select. Because changing this option can result in overwriting of 
existing logs, you should copy logs to a separate file before changing the log 
period. By default, the log files are located in the %systemroot%\system32\ LogFiles folder, but you have the option of specifying a different location.</p>

<A NAME="513"><H3>Log File Records</H3></A>

<p>Attributes are recorded in Unicode Translation Format-8 (UTF-8) encoding in a comma-delimited format. The format of the records in a log file depends on the file format.</p>

<ul>
<p><li>In IAS-formatted log files, each record starts with a fixed-format header, which consists of the NAS IP address, user name, record date, record time, service name, and computer name, followed by attribute-value pairs.</li></p>

<p><li>In database-import log files, each record contains attribute values in a consistent sequence, starting with the computer name, service name, record date, and record time. An NAS may not use all of the attributes specified in the database-import log format, but the comma-delimited location for each of these predefined attributes is maintained, even for attributes that have no value specified in a record.</li></p>

</ul>



<A NAME="514"><H2>Accounting</H2></A>

<p>Routing and Remote Access can be configured to log accounting information in the following locations:</p>

<ul>
<p><li>Locally stored log files when configured for Windows accounting. The information logged and where it is stored are configured from the properties of the Remote Access Logging folder in the Routing and Remote Access snap-in.</li></p>

<p><li>At a RADIUS server when configured for RADIUS accounting. If the RADIUS server is an IAS server, the log files are stored on the IAS server. The information logged and where it is stored are configured from the properties of the Remote Access Logging folder in the Internet Authentication Service snap-in. </li></p>

</ul>



<p>The configuration of the Routing and Remote Access accounting provider 
is done from the Security tab from the properties of a remote access router in 
the Routing and Remote Access snap-in, as in Figure 11.21, or by using the Netsh tool.</p>


<p>
<img src="images/11ntk21.JPG" width=404 height=448 border="0">
</p><p>
<!-- caption --><b>Figure 11.21</b> <i>Remote Access accounting</i><!-- /caption -->
</p>

<A NAME="515"><H2>Netsh Command-Line Tool</H2></A>

<p>Netsh is a command-line and scripting tool for Windows 2000 networking 
components for local or remote computers. Netsh is supplied with Windows 2000. Netsh also provides the ability to save a configuration script in a text file for 
archival purposes or for configuring other servers.</p>

<p>Netsh is a shell that can support multiple Windows 2000 components through 
the addition of Netsh helper dynamic-link libraries (DLLs). A Netsh helper 
DLL extends Netsh functionality by providing additional commands to monitor or configure a specific Windows 2000 networking component. Each Netsh 
helper DLL provides a context (a group of commands for a specific networking 
component). Within each context, subcontexts can exist. For example, within the routing context, the subcontexts IP and IPX exist to group IP routing and IPX routing commands together.</p>

<p>For Routing and Remote Access, Netsh has the following contexts:</p>

<ul>
<p><li><b>Ras.</b> Use commands in the ras context to configure remote access configuration.</li></p>

<p><li><b>Aaaa.</b> Use commands in the aaaa context to configure the AAAA component used by both Routing and Remote Access and IAS.</li></p>


<p><li><b>Routing.</b> Use commands in the routing context to configure IP and IPX routing.</li></p>


<p><li><b>Interface.</b> Use commands in the interface context to configure demand-dial interfaces.</li></p>

</ul>



<A NAME="516"><H2>Network Monitor</H2></A>

<p>Network Monitor enables you to detect and troubleshoot problems on LANs and on WANs, including Routing and Remote Access links. With Network Monitor you can identify network traffic patterns and network problems. For example, you can locate client-to-server connection problems, find a computer that makes a disproportionate number of work requests, capture frames (packets) directly from the network, display and filter the captured frames, and identify unauthorized users on your network. For more information on Network Monitor, see <A HREF="ch04a.htm">Chapter 4</A>, &quot;Monitoring Network Activity.&quot;</p>

<A NAME="517"><H2>Resource Kit Utilities</H2></A>

<p>The following are Resource Kit Utilities that make the job of managing and monitoring Routing and Remote Access easier.</p>

<A NAME="518"><H3>RASLIST.EXE</H3></A>

<p>The RASLIST.EXE command-line tool displays Routing and Remote Access server announcements from a network. Raslist listens for Routing and Remote Access server announcements on all active network cards in the computer from which it is run. Its output shows which card received the announcement. Raslist is a monitoring tool. It may take a few seconds for the data to begin to appear; data will continue to appear until the tool is closed.</p>

<A NAME="519"><H3>RASSRVMON.EXE</H3></A>

<p>Using the RASSRVMON.EXE tool, you can monitor the remote access server activities on your server in greater detail than the standard Windows tools allow. Rassrvmon provides the following monitoring information:</p>

<ul>
<p><li>Server information such as the time of first call to server, time of most recent call to server, total calls, total bytes passed through server, peak connection count, total connect time, currently connected users, and their connection information.</li></p>


<p><li>Per Port information, which is the time of first call to port, time of most recent call to port, total connections to this port since server started, total bytes passed on this port, total errors on this port, and current port status.</li></p>

<p><li>Summary information such as statistics are kept for each unique user/computer combination since the start of the monitoring: total connect time, total bytes transmitted, connection count, average connect time, and total error count.</li></p>

<p><li>Individual connection information, which includes per-connection statistics for each connection: user name/computer name, IP address, connection establishment time, duration, bytes transmitted, error count, and line speed.</li></p>

</ul>



<p>To allow for more flexibility, the alerting is set up to run a program of your choosing. This gives you the flexibility to send mail, a page, a network popup, or any other action you can automate with an executable file name or a batch script.</p>

<A NAME="520"><H3>RASUSERS.EXE</H3></A>

<p>RASUSERS.EXE lets you list for a domain or a server all user accounts that have been granted permission to dial in to the network via Routing and Remote Access, a feature of Windows 2000 that implements remote access functionality.</p>

<A NAME="521"><H3>TRACEENABLE.EXE</H3></A>

<p>TRACEENABLE.EXE is a graphical user interface-based tool that enables tracing and displays current tracing options. Windows 2000 Routing and Remote Access has an extensive tracing capability that you can use to troubleshoot complex 
network problems. Tracing records internal component variables, function calls, and interactions. Separate Routing and Remote Access components can be 
independently enabled to log tracing information to files (file tracing). You must enable the tracing function by changing settings in the Windows 2000 registry using TRACEENABLE.EXE.</p>

<p><b>Using TRACEENABLE.EXE</b></p>

<p>As each tracing item is selected in the combo box, the values are displayed. Make your changes, then click Set. This will write your changes to the registry. To get console tracing, you must turn it on for the component, and turn it on with the master check box at the top of the Traceenable window. For example, to 
generate a log file for PPP:</p>

<ol>
<p><li>Select PPP from the drop-down list.</li></p>

<p><li>Click Enable File Tracing.</li></p>

<p><li>Click Set.</li></p>

<p>Tracing is now enabled for this component. In most cases the log file is 
created in %windir%\tracing.</p>
</ol>

<A NAME="522"><H2>Lesson Summary</H2></A>

<p>Managing and monitoring a remote access server is done with several tools. 
In this lesson, you learned about remote access logging, accounting, Netsh, 
Network Monitor, and various resource kit utilities.</p>

</BODY>
</HTML>





