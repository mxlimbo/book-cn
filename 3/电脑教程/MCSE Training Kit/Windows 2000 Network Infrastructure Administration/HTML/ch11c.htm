<HTML>
<HEAD>
<TITLE>Lesson 2: Configuring a Routing and Remote Access Server</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmnet.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch11b.htm">[Previous]</A> <A HREF="ch11d.htm">[Next]</A><P>



<A NAME="462"><H1>Lesson 2: Configuring a Routing and Remote Access Server</H1></A>

<p>Once Routing and Remote Access is installed, you can configure it for inbound connections, lock it down with RAPs, add remote access profiles for security, and control access with BAP. In this lesson, you will explore these configurable options.</p>

<p><div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li>Explain how to allow inbound connections</li></p>

<p><li>Create a RAP</li></p>

<p><li>Describe how to configure a remote access profile</li></p>

<p><li>Describe how to configure BAP</li></p>
</ul>



<p><b>Estimated lesson time: 45 minutes</b></p>
</blockquote></div></p>

<A NAME="463"><H2>Allowing Inbound Connections</H2></A>

<p>When Routing and Remote Access is started for the first time, Windows 2000 automatically creates five PPTP and five L2TP ports, as illustrated in Figure 11.3. The number of VPN ports that are available to any remote access server is not limited by the hardware and can be configured. You can configure VPN ports 
under Ports in the console tree of Routing and Remote Access.</p>

<p>You can also add a parallel port by configuring Ports. Serial communication 
ports will show up only after a modem is installed for the Routing and Remote Access machine. Both types of ports can be configured for inbound and 
outbound connections.</p>


<p>
<A HREF="javascript:fullSize('11ntk03x.htm')"> <img src="images/11ntk03.JPG" width=404 height=248 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 11.3</b> <i>Routing and Remote Access Ports</i><!-- /caption -->
</p>

<A NAME="464"><H2>Creating a Remote Access Policy (RAP)</H2></A>

<p>RAPs are a named set of conditions, as illustrated in Figure 11.4, that are used to define who has remote access to the network and what the characteristics of that connection will be. Conditions for accepting or rejecting connections can be based on many different criteria, such as day and time, group membership, type of service, and so forth. Characteristics of the connection could be configured, for example, as an ISDN connection that can last only 30 minutes and that will not allow Hypertext Transfer Protocol (HTTP) packets.</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>RAPs are shared between Routing and Remote Access and IAS. They can be configured from either tool.</blockquote></div>
</p>


<p>
<A HREF="javascript:fullSize('11ntk04x.htm')"> <img src="images/11ntk04.JPG" width=404 height=261 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 11.4</b> <i>Routing and Remote Access Policies</i><!-- /caption -->
</p>

<p>From the IAS administration tool or the Routing and Remote Access Manager, RAPs can be created, deleted, renamed, and reordered. Note that there is no Save option, so it is not possible to save a copy to floppy disk. The order of policies is significant because the first matching policy will be used to accept or reject the connection.</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>Remote Access Policies are not stored in Active Directory; they are stored locally in the IAS.MDB file. Policies need to be created manually on each server. Remote Access Policies are applied to users in a mixed-mode domain, even though the user's dial-in permission can only be set to Allow Access or Deny 
Access, as illustrated in Figure 11.5 (Control Access Through Remote Access Policy is not available on mixed-mode domain controllers). If the user's permission is Allow Access, the user still must meet the conditions set forth in a policy before being allowed to connect.</blockquote></div>
</p>


<p>
<img src="images/11ntk05.JPG" width=404 height=469 border="0">
</p><p>
<!-- caption --><b>Figure 11.5</b> <i>Configuring Remote Access Policies</i><!-- /caption -->
</p>

<A NAME="465"><H3>Conditions</H3></A>

<p>Conditions can be added to a RAP on what conditions must match in order for the system to grant or deny remote access permission. This works in conjunction with the remote access permission associated with the user to determine whether the user is given access. The flowchart in Figure 11.6 shows the logic used to 
decide whether the connection request is granted or denied.</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>If no Remote Access Policy exists (if the default policy is deleted, 
for example), users will not be able to access the network, regardless of their 
individual Routing and Remote Access permission settings.</blockquote></div>
</p>

<p>By using this flowchart, one can predict the outcome of a connection request 
for any given situation. For example, a user's dial-in property is set to Control Access Through Remote Access Policy and the RAP is the default Allow Access If Dial-In Permission Is Enabled (the policy is to deny access, and the condition is to permit any day, any time). By following the flowchart, the user connection attempt will be rejected.</p>


<p>
<A HREF="javascript:fullSize('11ntk06x.htm')"> <img src="images/11ntk06.JPG" width=404 height=651 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 11.6</b> <i>Flowchart of Remote Access Policy</i><!-- /caption -->
</p>

<p>However, if the user's dial-in property (illustrated in Figure 11.7) is set to Allow Access, then using the same default policy as above, the user connection attempt will be accepted.</p>


<p>
<img src="images/11ntk07.JPG" width=404 height=469 border="0">
</p><p>
<!-- caption --><b>Figure 11.7</b> <i>Setting dial-in properties to grant access</i><!-- /caption -->
</p>

<A NAME="466"><H3>Grant or Deny Access</H3></A>

<p>Policies can be configured to either grant or deny access. This works in conjunction with the user object's dial-in permission to decide whether or not a user is given access, by means of the logic shown in Figure 11.6.</p>

<A NAME="467"><H3>Caller ID</H3></A>

<p>Caller ID verifies that the caller is calling from the phone number specified. If caller ID is configured, support for the passing of caller ID information all the way from the caller to Routing and Remote Access is required, or the connection attempt will be denied.</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>For backwards compatibility with previous versions of Windows NT, RAP, Caller ID, Apply Static Routes, and Assign A Static IP Address are not available in mixed mode.</blockquote></div>
</p>

<p>
<img src="images/practic.JPG" width=90 height=72 border="0">
</p>

<A NAME="468"><H2>Practice: Creating a New Remote Access Policy</H2></A>

<p>In this procedure, a new policy will be created that allows remote access based on the user's group membership.</p>

<p><li><b>To create a new remote access policy</b></li></p>

<ol>
<p><li>Using the Routing and Remote Access administration tool, right-click Remote Access Policies and select New Remote Access Policy.</li></p>

<p><li>Add a friendly name of &quot;Allow Domain Users,&quot; then click Next.</li></p>

<p><li>Click Add to add a condition.</li></p>

<p><li>Select Windows-groups, then click Add.</li></p>

<p><li>Click Add, select Domain Users, then click Add. Click OK.</li></p>

<p><li>Click OK to exit the Groups dialog.</li></p>

<p><li>Click Next, then select Grant Remote Access Permission.</li></p>

<p><li>Click next, then click Finish.</li></p>
</ol>

<A NAME="469"><H2>Configuring a Remote Access Profile</H2></A>

<p>The profile specifies what kind of access the user will be given if the conditions match. There are six different tabs that can be used to configure a profile.</p>

<A NAME="470"><H3>Dial-In Constraints</H3></A>

<p>Constraints on the actual connection are configured in the Edit Dial-In Profile dialog box, on the Constraints tab, as shown in Figure 11.8. Possible settings 
include idle time disconnect, maximum session time, day and time, phone 
number, and media type (ISDN, tunnel, async, and so forth).</p>


<p>
<img src="images/11ntk08.JPG" width=404 height=466 border="0">
</p><p>
<!-- caption --><b>Figure 11.8</b> <i>The Edit Dial-In Profile dialog box</i><!-- /caption -->
</p>

<A NAME="471"><H3>IP</H3></A>

<p>Configuration for client IP address assignment and IP packet filtering is found here. Packet filters can be set for either inbound or outbound and can be configured for protocol and port.</p>

<A NAME="472"><H3>Multilink</H3></A>

<p>Set multilink and BAP options here. A line can be dropped if bandwidth drops below a certain level for a given length of time.</p>

<A NAME="473"><H3>Authentication</H3></A>

<p>Authentication protocols such as Password Authentication Protocol (PAP), 
Challenge Handshake Authentication Protocol (CHAP), and Extensible 
Authentication Protocol (EAP) are set here.</p>

<A NAME="474"><H3>Encryption</H3></A>

<p>Encryption settings for Microsoft Routing and Remote Access servers are 
configured here. Options are to prohibit encryption, allow it, or require it.</p>

<A NAME="475"><H3>Advanced</H3></A>

<p>The Advanced tab allows for the configuration of additional network parameters that do not apply to Microsoft Routing and Remote Access servers. Included are standard RADIUS and Ascend attributes, which may apply to other manufacturers' NAS equipment.</p>

<p>
<img src="images/practic.JPG" width=90 height=72 border="0">
</p>

<A NAME="476"><H2>Practice: Creating a Policy Filter</H2></A>

<p>In this procedure, you will edit the profile of the Allow Access If Dial-In 
Permission Enabled policy so that users who gain access through that policy 
cannot ping the Routing and Remote Access server's network, whereas users who are granted access via the Allow Domain Users policy can ping the Routing and Remote Access server.</p>

<p><li><b>To create an ICMP Echo filter in the Allow Access If Dial-In Permission Is Enabled policy</b></li></p>

<ol>
<p><li>Right-click the Allow Access If Dial-In Permission Enabled policy and select Properties.</li></p>


<p><li>Click the Edit Profile button.</li></p>

<p><li>Select the IP tab.</li></p>

<p><li>Click the From Client IP Packet filter.</li></p>

<p><li>Click Add.</li></p>

<p><li>Click the destination network box.</li></p>

<p><li>For the IP address, type the network number and netmask of the Routing and Remote Access server.</li></p>

<p><li>For the protocol, select ICMP.</li></p>

<p><li>Enter <b>8</b> for ICMP type, and enter <b>0</b> for ICMP code. (ICMP type 8 designates an Echo request.)</li></p>

<p><li>Click OK to exit the Add/Edit IP filter, and OK to exit the IP Packet Filters Configuration dialog box. Click OK again to exit the dialog box.</li></p>
</ol>

<A NAME="477"><H2>Configuring Bandwidth Allocation Protocol (BAP)</H2></A>

<p>BAP and Bandwidth Allocation Control Protocol (BACP) enhance multilink by dynamically adding or dropping links on demand. BAP and BACP are sometimes used interchangeably to refer to the same bandwidth-on-demand functionality. Both protocols are Point-to-Point (PPP) control protocols and work together to provide bandwidth on demand.</p>

<p>BAP functionality is implemented through a new Link Control Protocol (LCP) option, BACP, and BAP protocols, as described in the following list:</p>

<ul>
<p><li><b>Link Discriminator.</b> A new LCP option used as a unique identifier for each link of a multilink bundle.</li></p>

<p><li><b>BACP.</b> BACP uses LCP negotiations to elect a &quot;favored peer.&quot; The favored peer is used to determine which peer is favored if the peers simultaneously transmit the same BAP request.</li></p>

<p><li><b>BAP.</b> BAP provides a mechanism for link and bandwidth management. Link management allows for the adding and dropping of links. This includes providing phone numbers as well as type of hardware (modem or ISDN) of the additional available links. Bandwidth management decides when to add and drop links based on link utilization.</li></p>
</ul>



<p>BAP and BACP are encapsulated in PPP Data-Link layer frames with the following protocol field (in hex). This information may be useful when reading PPP logs. As illustrated in Figure 11.9, you can enable BAP and BACP bandwidth control using the PPP tab on the Connection Properties dialog box.</p>

<ul>
<p><li>C02D for BAP</li></p>

<p><li>C02B for BACP</li></p>
</ul>



<p>
<img src="images/11ntk09.JPG" width=404 height=379 border="0">
</p><p>
<!-- caption --><b>Figure 11.9</b> <i>Setting PPP options for a remote access policy</i><!-- /caption -->
</p>

<p><li><b>To enable or disable BAP/BACP on a server-wide basis</b></li></p>

<ol>
<p><li>In Routing and Remote Access Manager, right-click the server on which you want to enable BAP/BACP, then click Properties.</li></p>

<p><li>In the PPP tab, select the Dynamic Bandwidth Control Using BAP Or BACP check box.</li></p>
</ol>

<p>BAP policies are enforced through profile settings or Remote Access Policies. Remote Access Policies are accessed from Routing and Remote Access Manager or from IAS Manager.</p>

<A NAME="478"><H3>BAP Additional Phone Numbers</H3></A>

<p>The server can provide the client with additional phone numbers to dial if extra bandwidth is needed. Using this option, the client only needs to know one phone number but can still bring up extra lines as needed, as illustrated in Figure 11.10.</p>

<ol>
<p><li>From the Routing and Remote Access Manager go to Ports, Properties, select a port, then click Configure.</li></p>

<p><li>Enter the phone number of other modems to be used for multilink.</li></p>



<p>
<img src="images/11ntk10.JPG" width=384 height=280 border="0">
</p><p>
<!-- caption --><b>Figure 11.10</b> <i>BAP additional phone numbers</i><!-- /caption -->
</p>

</ol>

<A NAME="479"><H2>Lesson Summary</H2></A>

<p>With Routing and Remote Access already installed, we configured it for inbound connections, locked it down with RAPs, added remote access profiles for security, and controlled access with BAP.</p>

</BODY>
</HTML>





