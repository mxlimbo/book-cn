<HTML>
<HEAD>
<TITLE>Lesson 2: The WINS Resolution Process</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmnet.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch09b.htm">[Previous]</A> <A HREF="ch09d.htm">[Next]</A><P>



<A NAME="359"><H1>Lesson 2: The WINS Resolution Process</H1></A>

<p>WINS uses standard methods of name registration, name renewal, and name 
release. This lesson introduces the different phases used to resolve a NetBIOS name to an IP address using WINS.</p>

<p><div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li>Describe WINS name registration, renewal, release, query, and response.</li></p>
</ul>

<p><b>Estimated lesson time: 25 minutes</b></p>
</blockquote></div></p>

<A NAME="360"><H2>Resolving NetBIOS Names with WINS</H2></A>

<p>When a client needs to contact another host on the network, it first contacts the WINS server to resolve the IP address using mapping information from the database of the server. The relational database engine of the WINS server accesses an indexed sequential access method (ISAM) database. The ISAM database is a 
replicated database that contains NetBIOS computer names and IP address mappings. For a WINS client to log on to the network, it must register its computer name and IP address with the WINS server. This creates an entry in the WINS database for every NetBIOS service running on the client. Because these entries are updated each time a WINS-enabled client logs on to the network, information stored in the WINS server database remains accurate.</p>

<p>The process WINS uses to resolve and maintain NetBIOS names is similar to the B-node implementation. The method used to renew a name is unique to NetBIOS node types that use a NetBIOS name server. WINS is an extension of RFCs 1001 and 1002. Figure 9.4 shows the process of resolving a NetBIOS name.</p>

<A NAME="361"><H3>Name Registration</H3></A>

<p>Each WINS client is configured with the IP address of a primary WINS server and optionally, a secondary WINS server. When a client starts, it registers its NetBIOS name and IP address with the configured WINS server. The WINS server stores the client's NetBIOS name/IP address mapping in its database.</p>

<A NAME="362"><H3>Name Renewal</H3></A>

<p>All NetBIOS names are registered on a temporary basis, which means that the same name can be used later by a different host if the original owner stops using it.</p>

<A NAME="363"><H3>Name Release</H3></A>

<p>Each WINS client is responsible for maintaining the lease on its registered name. When the name will no longer be used, such as when the computer is shut down, the WINS client sends a message to the WINS server to release it.</p>

<A NAME="364"><H3>Name Query and Name Resolution</H3></A>

<p>After a WINS client has registered its NetBIOS name and IP address with a WINS server, it can communicate with other hosts by obtaining the IP address of other NetBIOS-based computers from a WINS server. All WINS communications are done using directed datagrams over UDP port 137 (NBNS).</p>

<p>
<A HREF="javascript:fullSize('09ntk04x.htm')"> <img src="images/09ntk04.JPG" width=404 height=200 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 9.4</b> <i>Name resolution between clients and a WINS server</i><!-- /caption -->
</p>

<A NAME="365"><H2>Name Registration</H2></A>

<p>Unlike the B-node implementation of NetBT, which broadcasts its name registration, WINS clients register their NetBIOS names with WINS servers.</p>

<p>When a WINS client initializes, it registers its NetBIOS name by sending a name registration request directly to the configured WINS server. NetBIOS names are registered when services or applications start, such as the Workstation, Server, and Messenger.</p>

<p>If the WINS server is available and the name is not already registered by another WINS client, a successful registration message is returned to the client. This message contains the amount of time the NetBIOS name is registered to the client, specified as the Time to Live (TTL). Figure 9.5 shows the name registration process.</p>

<p>
<A HREF="javascript:fullSize('09ntk05x.htm')"> <img src="images/09ntk05.JPG" width=404 height=230 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 9.5</b> <i>Name registration process</i><!-- /caption -->
</p>

<A NAME="366"><H3>When a Duplicate Name Is Found</H3></A>

<p>If there is a duplicate name registered in the WINS database, the WINS server sends a challenge to the currently registered owner of the name. The challenge is sent as a name query request. The WINS server sends the challenge three times at 500-millisecond intervals.</p>

<p>If the registered computer is a multihomed computer, the WINS server tries each IP address it has for the computer until it receives a response or until all of the IP addresses have been tried.</p>

<p>If the current registered owner responds successfully to the WINS server, the WINS server sends a negative name registration response to the WINS client that is attempting to register the name. If the current registered owner does not respond to the WINS server, the WINS server sends a successful name registration response to the WINS client that is attempting to register the name.</p>

<A NAME="367"><H3>When the WINS Server Is Unavailable</H3></A>

<p>A WINS client will make three attempts to find the primary WINS server. If it fails after the third attempt, the name registration request is sent to the secondary WINS server, if configured. If neither server is available, the WINS client may initiate a broadcast to register its name.</p>

<A NAME="368"><H2>Name Renewal</H2></A>

<p>To continue using the same NetBIOS name, a client must renew its lease before it expires. If a client does not renew the lease, the WINS server makes it available for another WINS client.</p>

<A NAME="369"><H3>Name Refresh Request</H3></A>

<p>WINS clients must renew their name registrations before the renewal interval 
expires. The renewal interval determines how long the server stores the name registration as an active record in the WINS database. When a WINS client 
renews its name registration, it sends a name refresh request to the WINS server. The name refresh request includes the IP address and the NetBIOS name that the client seeks to refresh. The WINS server responds to the name refresh request with a name refresh response that includes a new renewal interval for the name. When a WINS client refreshes its name, it performs the following steps:</p>

<ol>
<p><li>When a client has consumed half of its renewal interval, it sends a name refresh request to the primary WINS server.</li></p>

<p><li>If its name is not refreshed by the primary WINS server, the WINS client tries to refresh again in 10 minutes and continues to try the primary WINS server repeatedly every 10 minutes for a total of 1 hour. The WINS client, after trying to refresh its name registration with the primary WINS server for 1 hour, stops trying and attempts to refresh its name with the secondary WINS server.</li></p>

<p><li>If it is not refreshed by the secondary WINS server, the WINS client tries to refresh its name again using the secondary WINS server in 10 minutes and continues to try every 10 minutes for a total of 1 hour. The WINS client, after trying to refresh on the secondary WINS server for 1 hour, stops trying and tries to refresh using the primary WINS server. This process of trying the primary WINS server and then the secondary WINS server continues until the renewal interval is consumed or the WINS client has its name refreshed.</li></p>

<p><li>If the WINS client succeeds in refreshing its name, the renewal interval is reset on the WINS server.</li></p>

<p><li>If the WINS client fails to register during the renewal interval on either the primary or secondary WINS server, the name is released.</li></p>
</ol>

<p>Figure 9.6 shows how a WINS client renews its lease to use the same 
NetBIOS name.</p>

<p>
<A HREF="javascript:fullSize('09ntk06x.htm')"> <img src="images/09ntk06.JPG" width=404 height=233 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 9.6</b> <i>Renewing a lease using the same NetBIOS name</i><!-- /caption -->
</p>

<p>When a WINS server receives the name refresh request, it sends the client a name refresh response with a new TTL.</p>

<A NAME="370"><H2>Name Release</H2></A>

<p>When a WINS client is properly shut down, it sends a name release request 
directly to the WINS server for each registered name. The name release request includes the client's IP address and the NetBIOS name to be removed from the WINS database. This allows the name to be available for another client, as 
illustrated in Figure 9.7.</p>

<p>When the WINS server receives the name release request, it checks its database for the specified name. If the WINS server encounters a database error or if a 
different IP address maps the registered name, it sends a negative name release to the WINS client. Otherwise, the WINS server sends a positive name release and designates the specified name as inactive in its database. The name release 
response contains the released NetBIOS name and a TTL value of zero.</p>

<p>
<A HREF="javascript:fullSize('09ntk07x.htm')"> <img src="images/09ntk07.JPG" width=404 height=230 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 9.7</b> <i>Name release request</i><!-- /caption -->
</p>

<A NAME="371"><H2>Name Query and Name Response</H2></A>

<p>A common method of resolving NetBIOS names to IP addresses is with an NBNS, such as WINS. When a WINS client is configured, by default, the H-node type of NetBT is used. The NBNS is always checked for a NetBIOS name/IP address mapping before initiating a broadcast. The following steps and illustration in 
Figure 9.8 demonstrate the process:</p>

<ol>
<p><li>When a user initiates a Windows NT command, such as net use, the NetBIOS name cache is checked for the NetBIOS name/IP address mapping of the destination host.</li></p>

<p><li>If the name is not resolved from cache, a name query request is sent directly to the client's primary WINS server.</li></p>

<p>If the primary WINS server is unavailable, the client resends the request two more times before switching to the secondary WINS server. </p>

<p>When either WINS server resolves the name, a success message with the IP address for the requested NetBIOS name is sent to the source host.</p>

<p><li>If no WINS server can resolve the name, a name query response is sent back to the WINS client with the message &quot;Requested name does not exist,&quot; and broadcast is implemented.</li></p>

<p>If the name is not resolved from cache by a WINS server or broadcast, the name may still be resolved by parsing the LMHOSTS or Hosts file, or by using DNS.</p>
</ol>
<p>
<A HREF="javascript:fullSize('09ntk08x.htm')"> <img src="images/09ntk08.JPG" width=404 height=211 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 9.8</b> <i>NetBIOS name server checked for NetBIOS name/IP address mapping</i><!-- /caption -->
</p>

<A NAME="372"><H2>Lesson Summary</H2></A>

<p>WINS uses standard name registration, name renewal, and name release methods. To continue using the same NetBIOS name, a client must renew its lease before it expires. When a WINS client is shut down, it notifies the WINS server that it no longer needs its NetBIOS name.</p>

</BODY>
</HTML>





