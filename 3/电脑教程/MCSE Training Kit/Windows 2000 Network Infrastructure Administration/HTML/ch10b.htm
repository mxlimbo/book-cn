<HTML>
<HEAD>
<TITLE>Lesson 1: Introducing and Installing DHCP</TITLE>
<link rel="STYLESHEET" type="text/css" href="mmnet.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch10a.htm">[Previous]</A> <A HREF="ch10c.htm">[Next]</A><P>



<A NAME="396"><H1>Lesson 1: Introducing and Installing DHCP</H1></A>

<p>DHCP automatically assigns IP addresses to computers. DHCP overcomes the limitations of configuring TCP/IP manually. This lesson gives you an overview of DHCP and how it works.</p>

<p><div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li>Describe the difference between manual and automatic configuration of TCP/IP</li></p>

<p><li>Identify TCP/IP configuration parameters that can be assigned by a DHCP server</li></p>

<p><li>Describe IP Lease Requests and Offers</li></p>

<p><li>Install DHCP in Windows 2000</li></p>
</ul>



<p><b>Estimated lesson time: 20 minutes</b></p>
</blockquote></div></p>

<A NAME="397"><H2>DHCP Overview</H2></A>

<p>DHCP is an extension of the Boot Protocol (BOOTP). BOOTP enables diskless clients to start up and automatically configure TCP/IP. DHCP centralizes and manages the allocation of TCP/IP configuration information by automatically assigning IP addresses to computers configured to use DHCP. Implementing DHCP eliminates some of the configuration problems associated with manually configuring TCP/IP.</p>

<p>As illustrated in Figure 10.1, each time a DHCP client starts, it requests IP 
addressing information from a DHCP server, including the IP address, the subnet mask, and optional values. The optional values may include a default gateway address, Domain Name System (DNS) address, and Windows Internet Name 
Service (WINS) server address.</p>

<p>
<A HREF="javascript:fullSize('10ntk01x.htm')"> <img src="images/10ntk01.JPG" width=404 height=163 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 10.1</b> <i>How a DHCP client interacts with a DHCP server</i><!-- /caption -->
</p>

<p>When a DHCP server receives a request, it selects IP addressing information from a pool of addresses defined in its database and offers it to the DHCP client. If the client accepts the offer, the IP addressing information is leased to the client for a specified period of time. If there is no available IP addressing information in the pool to lease to a client, the client cannot initialize TCP/IP.</p>

<A NAME="398"><H3>Manual vs. Automatic Configuration</H3></A>

<p>To understand why DHCP is beneficial in configuring TCP/IP on client computers, it is useful to contrast the manual method of configuring TCP/IP with the automatic method using DHCP.</p>

<p><b>Configuring TCP/IP Manually</b></p>

<p>Configuring TCP/IP manually means that users can easily pick a random IP 
address instead of getting a valid IP address from the network administrator. 
Using incorrect addresses can lead to network problems that can be very difficult to trace to the source.</p>

<p>In addition, typing the IP address, subnet mask, or default gateway can lead to problems ranging from trouble communicating if the default gateway or subnet mask is wrong to problems associated with a duplicate IP address.</p>

<p>Another limitation of configuring TCP/IP manually is the administrative overhead on internetworks where computers are frequently moved from one subnet to 
another. For example, when a workstation is moved to a different subnet, the IP address and default gateway address must be changed for the workstation to communicate from its new location.</p>

<p><b>Configuring TCP/IP Using DHCP</b></p>

<p>Using DHCP to automatically configure IP addressing information means that users no longer need to acquire IP addressing information from an administrator to configure TCP/IP. The DHCP server supplies all of the necessary configuration information to all of the DHCP clients. Many difficult-to-trace network problems are eliminated by using DHCP.</p>

<p>TCP/IP configuration parameters that can be assigned by the DHCP server include</p>

<ul>
<p><li>IP addresses for each network adapter in a client computer</li></p>

<p><li>Subnet masks that are used to identify the IP network portion from the host portion of the IP address</li></p>

<p><li>Default gateways (routers) that are used to connect a single network segment to others</li></p>

<p><li>Additional configuration parameters that can optionally be assigned to DHCP clients (such as IP addresses for DNS or WINS servers a client may use)</li></p>
</ul>



<A NAME="399"><H2>How DHCP Works</H2></A>

<p>DHCP uses a four-phase process to configure a DHCP client, as shown in Table 10.1. If a computer has multiple network adapters, the DHCP process occurs separately over each adapter. A unique IP address will be assigned to each adapter in the computer. All DHCP communication is done over User Datagram Protocol (UDP) ports 67 and 68.</p>

<p>Most DHCP messages are sent by broadcast. For DHCP clients to communicate with a DHCP server on a remote network, the IP routers must support forwarding DHCP broadcasts. DHCP configuration phases are shown in Table 10.1.</p>

<p><b>Table 10.1</b> <i>Four Phases of DHCP Client Configuration</i></p>

<p><table cellpadding=5 width="95%"><tr>
<th>Phase</th> <th>Description</th>
</tr><tr>
<td valign="top">IP lease discover</td> <td valign="top">The client initializes a limited version of TCP/IP and broadcasts a request for the location of a DHCP server and IP addressing information.</td>
</tr><tr>
<td valign="top">IP lease offer</td> <td valign="top">All DHCP servers that have valid IP addressing information available send an offer to the client.</td>
</tr><tr>
<td valign="top">IP lease request</td> <td valign="top">The client selects the IP addressing information from the first offer it receives and broadcasts a message requesting to lease the IP addressing information in the offer.</td>
</tr><tr>
<td valign="top">IP lease acknowledgment</td> <td valign="top">The DHCP server that made the offer responds to the 
message, and all other DHCP servers withdraw their offers. The IP addressing information is assigned to the client and an acknowledgment is sent. The client finishes initializing and binding the TCP/IP protocol. Once the automatic 
configuration process is complete, the client can use all TCP/IP services and utilities for normal network communications and connectivity to other IP hosts.</td>
</tr></table></p>

<A NAME="400"><H3>IP Lease Discover and Offer</H3></A>

<p>As illustrated in Figure 10.2, in the first two phases, the client broadcasts for a DHCP server and a DHCP server offers an IP address to the client.</p>


<p>
<A HREF="javascript:fullSize('10ntk02x.htm')"> <img src="images/10ntk02.JPG" width=404 height=200 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 10.2</b> <i>IP lease discover and offer</i><!-- /caption -->
</p>

<p><b>IP Lease Discover</b></p>

<p>During the boot process of a client, it requests to lease an IP address by broadcasting a request to all DHCP servers. Because the client does not have an IP 
address or know the IP address of a DHCP server, it uses 0.0.0.0 as the source address and 255.255.255.255 as the destination address.</p>

<p>The request for a lease is sent in a DHCPDISCOVER message. This message also contains the client's hardware address and computer name so that DHCP servers know which client sent the request.</p>

<p>The IP lease process is used when one of the following occurs:</p>

<ul>
<p><li>TCP/IP is initialized for the first time as a DHCP client</li></p>

<p><li>The client requests a specific IP address and is denied, possibly because the DHCP server dropped the lease</li></p>

<p><li>The client previously leased an IP address but released the lease and now requires a new lease</li></p>
</ul>

 

<p><b>IP Lease Offer</b></p>

<p>All DHCP servers that receive the request and have a valid configuration for the client broadcast an offer with the following information:</p>

<ul>
<p><li>The client's hardware address</li></p>

<p><li>An offered IP address</li></p>

<p><li>Subnet mask</li></p>

<p><li>Length of the lease</li></p>

<p><li>A server identifier (the IP address of the offering DHCP server)</li></p>
</ul>



<p>A broadcast is used because the client does not yet have an IP address. As illustrated in Figure 10.3, the offer is sent as a DHCPOFFER message. The DHCP server reserves the IP address so that it will not be offered to another DHCP 
client. The DHCP client selects the IP address from the first offer it receives.</p>

<p>
<A HREF="javascript:fullSize('10ntk03x.htm')"> <img src="images/10ntk03.JPG" width=404 height=264 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 10.3</b> <i>Sending a DHCPOFFER message</i><!-- /caption -->
</p>

<p><b>When No DHCP Servers Are Online</b></p>

<p>The DHCP client waits 1 second for an offer. If an offer is not received, the 
client will not be able to initialize and it will rebroadcast the request three times (at 9-, 13-, and 16-second intervals, plus a random length of time between 0 and 1000 milliseconds). If an offer is not received after four requests, the client will retry every 5 minutes.</p>

<p>Windows 2000-based clients can automatically configure an IP address and subnet mask if a DHCP server is unavailable at system start time. This is a new feature of Windows 2000 called Automatic Private IP Addressing (APIPA). This is useful for clients on small private networks, such as a small business office, a home office, or a remote access client. The Windows 2000 DHCP client service goes through the following process to autoconfigure the client:</p>

<ol>
<p><li>The DHCP client attempts to locate a DHCP server and obtain an address and configuration.</li></p>

<p><li>If a DHCP server cannot be found or does not respond, the DHCP client autoconfigures its IP address and subnet mask using a selected address from the Microsoft-reserved Class B network, 169.254.0.0, with the subnet mask 255.255.0.0.</li></p>
<p>The DHCP client tests for an address conflict to make sure that the IP address it has chosen is not already in use on the network. If a conflict is found, the client selects another IP address. The client will retry autoconfiguration for up to 10 addresses.</p>

<p><li>Once the DHCP client succeeds in self-selecting an address, it configures its network interface with the IP address. The client then continues, in the background, to check for a DHCP server every 5 minutes. If a DHCP server is found later, the client abandons its autoconfigured information. The DHCP client then uses an address offered by the DHCP server (and any other provided DHCP option information) to update its IP configuration settings.</li></p>
</ol>

<A NAME="401"><H3>IP Lease Request and Acknowledgment</H3></A>

<p>In the last two phases, the client selects an offer and the DHCP server acknowledges the lease.</p>

<p><b>IP Lease Request</b></p>

<p>After the client receives an offer from at least one DHCP server, it broadcasts to all DHCP servers that it has made a selection by accepting an offer.</p>

<p>The broadcast is sent in a DHCPREQUEST message and includes the server identifier (IP address) of the server whose offer was accepted. All other DHCP servers then retract their offers so that their IP addresses are available for the next IP lease request.</p>

<p><b>IP Lease Acknowledgment (Successful)</b></p>

<p>The DHCP server with the accepted offer broadcasts a successful acknowledgment to the client in the form of a DHCPACK message. This message contains a valid lease for an IP address and possibly other configuration information. When the DHCP client receives the acknowledgment, TCP/IP is completely initialized and is considered a bound DHCP client. Once bound, the client can use TCP/IP to communicate on the internetwork.</p>

<p><b>IP Lease Acknowledgment (Unsuccessful)</b></p>

<p>An unsuccessful acknowledgment (DHCPNACK) is broadcast if the client is 
trying to lease its previous IP address and the IP address is no longer available. It is also broadcast if the IP address is invalid because the client has been physically moved to a different subnet. When the client receives an unsuccessful acknowledgment, it returns to the process of requesting an IP lease.</p>

<A NAME="402"><H2>Installing a DHCP Server</H2></A>

<p>Before you install a DHCP server, you should identify the following:</p>

<ul>
<p><li>The hardware and storage requirements for the DHCP server</li></p>

<p><li>Which computers you can immediately configure as DHCP clients for dynamic TCP/IP configuration and which computers you should manually configure with static TCP/IP configuration parameters, including static IP addresses</li></p>

<p><li>The DHCP option types and their values to be predefined for DHCP clients</li></p>
</ul>



<p>Before you install DHCP, answer the following questions:</p>

<ul>
<p><li><b> Will all of the computers become DHCP clients?</b> If not, consider that non-DHCP clients have static IP addresses, and static IP addresses must be excluded from the DHCP server configuration. If a client requires a specific address, the IP address needs to be reserved.</li></p>

<p><li><b> Will a DHCP server supply IP addresses to multiple subnets?</b> If so, consider that any routers connecting subnets act as DHCP relay agents. If your routers are not acting as DHCP relay agents, at least one DHCP server is required on each subnet that has DHCP clients. The DHCP server could be a DHCP relay agent or a router that has BOOTP enabled.</li></p>

<p><li><b> How many DHCP servers are required?</b> Consider that a DHCP server does not share information with other DHCP servers. Therefore, it is necessary to create unique IP addresses for each server to assign to clients.</li></p>

<p><li><b> What IP addressing options will clients obtain from a DHCP server?</b> The IP addressing options determine how to configure the DHCP server, and whether the options should be created for all of the clients in the internetwork, clients on a specific subnet, or individual clients. The IP addressing options might be:</li></p>
<ul>
<p><li>Default gateway</li></p>

<p><li>DNS server</li></p>

<p><li>NetBIOS over TCP/IP name resolution</li></p>

<p><li>WINS server</li></p>

<p><li>NetBIOS scope ID</li></p>
</ul>
</ul>


<p><li><b>To install a DHCP server</b></li></p>

<ol>
<p><li>Open Windows Components Wizard by clicking Start, pointing to Settings, and clicking Control Panel.</li></p>

<p>When Control Panel opens, double-click Add/Remove Programs, then click Add/Remove Windows Components.</p>

<p><li>Under Components, scroll to and click Networking Services.</li></p>

<p><li>Click Details.</li></p>

<p><li>Under Subcomponents Of Networking Services, select Dynamic Host Configuration Protocol (DHCP), click OK, then click Next.</li></p>

<p>If prompted, type the full path to the Windows 2000 distribution files and click Continue. Required files will be copied to your hard disk.</p>

<p><li>Click Finish to close the Windows Components Wizard.</li></p>
</ol>

<p><div class="note"><blockquote><b>NOTE</b><HR>It is strongly recommended that you manually configure the DHCP server computer to use a static IP address. The DHCP server cannot be a DHCP client. It must have a static IP address, subnet mask, and default gateway address.</blockquote></div></p>

<A NAME="403"><H2>Ipconfig</H2></A>

<p>Ipconfig is a command-line tool that displays the current configuration of the 
installed IP stack on a networked computer. It can display a detailed configuration report for all interfaces, including any configured wide area network (WAN) miniports, such as those used for remote access or virtual private network (VPN) connections. A sample report is illustrated in Figure 10.4.</p>

<p>
<A HREF="javascript:fullSize('10ntk04x.htm')"> <img src="images/10ntk04.JPG" width=404 height=205 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 10.4</b> <i>Report displayed for Ipconfig /all</i><!-- /caption -->
</p>

<A NAME="404"><H3>Ipconfig Switches</H3></A>

<p>The Ipconfig command is of particular use on systems running DHCP, allowing users to determine which TCP/IP configuration values have been configured by DHCP. Table 10.2 explains the switches used with the Ipconfig command.</p>

<p><b>Table 10.2</b> <i>Ipconfig Command-Line Switches</i></p>

<p><table cellpadding=5 width="95%"><tr>
<th>Switch</th> <th>Effect</th>
</tr><tr>
<td valign="top">/all</td> <td valign="top">Produces a detailed configuration report for all interfaces</td>
</tr><tr>
<td valign="top">/flushdns</td> <td valign="top">Removes all entries from the DNS name cache</td>
</tr><tr>
<td valign="top">/registerdns</td> <td valign="top">The DNS domain name for client resolutions</td>
</tr><tr>
<td valign="top">/displaydns</td> <td valign="top">Displays the contents of the DNS resolver cache</td>
</tr><tr>
<td valign="top">/release &lt;adapter&gt;</td> <td valign="top"> Releases the IP address for a specified interface</td>
</tr><tr>
<td valign="top">/renew &lt;adapter&gt;</td> <td valign="top"> Renews the IP address for a specified interface</td>
</tr><tr>
<td valign="top">/showclassid &lt;adapter&gt;</td> <td valign="top"> Displays all the DHCP class IDs allowed for the adapter specified</td>
</tr><tr>
<td valign="top">/setclassid &lt;adapter&gt; &lt;classID to set&gt;</td> <td valign="top"> Changes the DHCP class ID for the adapter specified 
</td>
</tr><tr>
<td valign="top">/?</td> <td valign="top">Displays the items in this table</td>
</tr></table></p>

<p><div class="note"><blockquote><b>NOTE</b><HR>Output can be redirected to a file and pasted into other documents.</blockquote></div></p>

<p><li><b>To verify, release, or renew a client address lease</b></li></p>

<ol>
<p><li>At a DHCP-enabled client computer running Windows 2000, open a command prompt.</li></p>

<p><li>Use the Ipconfig command-line utility to verify, release, or renew the lease of the client with a DHCP server, as follows:</li></p>
</ol>
<ul>
<p>To verify the current DHCP and TCP/IP configuration, type <b>ipconfig /all</b>.</p> 

<p>To release a DHCP client lease, type <b>ipconfig /release</b>.</p>

<p>To renew a DHCP client lease, type <b>ipconfig /renew</b>.</p>
</ul>

<p>The Ipconfig utility is also supported for use in Windows NT. For Windows 95 and Windows 98 clients, use Winipcfg, the Windows IP configuration program, to perform these same tasks. To run Winipcfg on supporting clients, type <b>winipcfg</b> at either an MS-DOS command prompt or in the Run command window. When using Winipcfg to release or renew leases, click Release or Renew to perform these respective tasks.</p>

<A NAME="405"><H2>DHCP Relay Agent</H2></A>

<p>A relay agent is a small program that relays DHCP/BOOTP messages between clients and servers on different subnets. The DHCP Relay Agent component provided with the Windows 2000 router is a BOOTP relay agent that relays DHCP messages between DHCP clients and DHCP servers on different IP networks. For each IP network segment that contains DHCP clients, either a DHCP server or a computer acting as a DHCP relay agent is required.</p>

<p><li><b>To add the DHCP Relay Agent</b></li></p>

<ol>
<p><li>Click Start, point to Programs, point to Administrative Tools, then click Routing And Remote Access.</li></p>

<p><li>In the console tree, click Server name\IP Routing\General.</li></p>

<p><li>Right-click General, then click New Routing Protocol.</li></p>

<p><li>In the Select Routing Protocol dialog box, click DHCP Relay Agent, then click OK.</li></p>
</ol>

<A NAME="406"><H2>Lesson Summary</H2></A>

<p>DHCP was developed to solve configuration problems by centralizing IP configuration information for allocation to clients. DHCP uses a four-phase process to configure a DHCP client. The phases are, in order: lease discover, lease offer, lease request, and lease acknowledgment. In addition to verifying a computer's IP configuration, you can use the Ipconfig utility to renew options, lease time, and relinquish a lease.</p>

</BODY>
</HTML>





