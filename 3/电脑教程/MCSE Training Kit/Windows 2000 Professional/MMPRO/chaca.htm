<html>
<head>
<title>Appendix C -- Understanding the DHCP Service</title>
<link rel="STYLESHEET" type="text/css" href="mmpro.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</head>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("chaba.htm", "chada.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>



<A NAME="993"><H1>Appendix C -- Understanding the DHCP Service</H1></A>

<p>The Dynamic Host Configuration Protocol (DHCP) Service in Microsoft Windows 2000 centralizes and manages the allocation of Microsoft Transmission Control Protocol/Internet Protocol (TCP/IP) configuration information by assigning Internet Protocol (IP) addresses automatically to computers that are configured as DHCP clients. Implementing the DHCP Service can eliminate many of the configuration problems associated with configuring TCP/IP manually.</p>

<p>To introduce you to DHCP, the following six topics are covered in this appendix:</p>

<ul>
<p><li>The Bootstrap Protocol (BOOTP)</li></p>

<p><li>Manual versus automatic TCP/IP configuration</li></p>

<p><li>The requirements for a server running the DHCP Service</li></p>

<p><li>The requirements for DHCP clients</li></p>

<p><li>The DHCP lease process</li></p>

<p><li>IP lease renewal and release</li></p>
</ul>



<A NAME="994"><H2>The Bootstrap Protocol</H2></A>

<p>The Bootstrap Protocol, based on the User Datagram Protocol/Internet Protocol (UDP/IP), enables a booting host to configure itself dynamically. DHCP is an extension of BOOTP, which enables diskless clients to start up and automatically configure TCP/IP. Each time that a DHCP client starts, it requests IP addressing information from a DHCP server, including the following:</p>

<ul>
<p><li>An IP address</li></p>

<p><li>A subnet mask</li></p>

<p><li>Optional values, such as the following:</li></p>

<ul>
<p><li>A default gateway address</li></p>

<p><li>A Domain Name System (DNS) server address</li></p>

<p><li>A Windows Internet Name Service (WINS) server address</p>
</ul>
</ul>

<p>When a DHCP server receives a request for an IP address, it selects IP addressing information from a pool of addresses that are defined in its database and 
offers the IP addressing information to the DHCP client, as shown in Figure C.1. If the client accepts the offer, the DHCP server leases the IP addressing information to the client for a specified period of time.</p>

<p>
<A HREF="javascript:fullSize('Factk01x.htm')"> <img src="images/Factk01.JPG" width=404 height=280 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure C.1</b> <i>A DHCP server provides IP addresses to DHCP clients</i><!-- /caption -->
</p>

<A NAME="995"><H2>Manual Versus Automatic TCP/IP Configuration</H2></A>

<p>To understand why the DHCP Service is beneficial for configuring TCP/IP on clients, it is useful to contrast the manual method of configuring TCP/IP with the automatic method using DHCP, as shown in Table C.1.</p>

<p><b>Table C.1</b> <i>Configuring TCP/IP Manually Versus Using the DHCP Service</i></p>

<p><table cellpadding=5 width="95%"><tr><th>Configuring TCP/IP manually</th><th>Configuring TCP/IP using DHCP</th></tr>

<tr><td valign="top">Users can pick an IP address randomly rather than obtaining a valid IP address from the network administrator. Using incorrect addresses can lead to network problems that can be difficult to trace to the source.</td>
<td valign="top">Users no longer need to acquire IP addressing information from an administrator to configure TCP/IP. The DHCP Service supplies all the necessary configuration information to all the DHCP clients.</td></tr>

<tr><td valign="top">Typing the IP address, subnet mask, or default gateway can lead to problems ranging from difficulty communicating, if the default gateway or subnet mask is incorrect, to problems associated with a duplicate IP address.</td>
<td valign="top">Correct configuration information ensures correct configuration, which eliminates most difficult-to-trace network problems.</td></tr>

<tr><td valign="top">There is administrative overhead for networks if you frequently move computers from one subnet to another. For example, you must change the IP address and default gateway address for a client to communicate from a new location.</td>
<td valign="top">Having servers running the DHCP Service on each subnet eliminates the overhead of having to manually reconfigure IP addresses, subnet masks, and default gateways when you move computers from one subnet to another.</td></tr></table></p>

<p>To implement DHCP, you must install and configure the DHCP Service on at least one computer running Windows 2000 Server within the TCP/IP network. The computer can be configured as a domain controller or as a stand-alone server. In addition, for DHCP to function properly, you must configure the server and all of the clients.</p>

<A NAME="996"><H2>Requirements for a Server Running the DHCP Service</H2></A>

<p>A DHCP server requires a computer running Windows 2000 Server that is configured with the following:</p>

<ul>
<p><li>The DHCP Service.</li></p>

<p><li>A static IP address (it can't be a DHCP client itself), subnet mask, default gateway (if necessary), and other TCP/IP parameters.</li></p>

<p><li>A DHCP scope. A <i>scope</i> is a range of IP addresses that are available for lease or assignment to clients.</li></p>
</ul>



<A NAME="997"><H2>Requirements for DHCP Clients</H2></A>

<p>A DHCP client requires a computer that is DHCP-enabled and running any of the following supported operating systems:</p>

<ul>
<p><li>Windows 2000, Windows NT Server version 3.51 or later, or Windows NT Workstation version 3.51 or later.</li></p>

<p><li>Microsoft Windows 95 or later.</li></p>

<p><li>Windows for Workgroups version 3.11 running Microsoft TCP/IP-32, which is included on the Windows 2000 Server CD-ROM.</li></p>

<p><li>Microsoft Network Client version 3 for Microsoft MS-DOS with the real-mode TCP/IP driver, which is included on the Windows 2000 Server CD-ROM.</li></p>

<p><li>LAN Manager version 2.2c, which is included on the Windows 2000 Server CD-ROM. LAN Manager 2.2c for OS/2 is not supported.</li></p>
</ul>



<A NAME="998"><H2>The DHCP Lease Process</H2></A>

<p>To understand the DHCP lease process, you must first understand when the lease process occurs. The DHCP lease process occurs when one of the following events happens:</p>

<ul>
<p><li>TCP/IP is initialized for the first time on a DHCP client.</li></p>

<p><li>A client requests a specific IP address and is denied, possibly because the DHCP server dropped the lease.</li></p>

<p><li>A client previously leased an IP address but released the IP address and requires a new one.</li></p>
</ul>

<p>DHCP uses a four-phase process to lease IP addressing information to a DHCP client for a specific period of time: DHCPDISCOVER, DHCPOFFER, DHCPREQUEST, and DHCPACK. (See Figure C.2.)</p>

<p>
<A HREF="javascript:fullSize('Factk02x.htm')"> <img src="images/Factk02.JPG" width=404 height=182 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure C.2</b> <i>The DHCP lease process</i><!-- /caption -->
</p>

<A NAME="999"><H3>The DHCPDISCOVER Phase</H3></A>

<p>The first phase in the DHCP lease process is DHCPDISCOVER. To begin the DHCP lease process, a client initializes a limited version of TCP/IP and broadcasts a DHCPDISCOVER message requesting the location of a DHCP server and IP addressing information. Because the client doesn't know the IP address of a DHCP server, the client uses 0.0.0.0 as the source address and 255.255.255.255 as the destination address.</p>

<p>The DHCPDISCOVER message contains the client's hardware address and computer name so that the DHCP servers can determine which client sent the request.</p>

<A NAME="1000"><H3>The DHCPOFFER Phase</H3></A>

<p>The second phase in the DHCP lease process is DHCPOFFER. All DHCP servers that receive the IP lease request and have a valid client configuration broadcast a DHCPOFFER message that includes the following information:</p>

<ul>
<p><li>The client's hardware address</li></p>

<p><li>An offered IP address</li></p>

<p><li>A subnet mask</li></p>

<p><li>The length of the lease</li></p>

<p><li>A server identifier (the IP address of the offering DHCP server)</li></p>
</ul>



<p>The DHCP server sends a broadcast because the client doesn't yet have an IP 
address. The DHCP client selects the IP address from the first offer that it 
receives. The DHCP server that is issuing the IP address reserves the address 
so that it can't be offered to another DHCP client.</p>

<A NAME="1001"><H3>The DHCPREQUEST Phase</H3></A>

<p>The third phase in the DHCP lease process occurs after the client receives a DHCPOFFER from at least one DHCP server and selects an IP address. The 
client broadcasts a DHCPREQUEST message to all DHCP servers, indicating that it has accepted an offer. The DHCPREQUEST message includes the server identifier (IP address) of the server whose offer it accepted. All other DHCP servers then retract their offers and retain their IP addresses for the next IP lease request.</p>

<A NAME="1002"><H3>The DHCPACK Phase</H3></A>

<p>The final phase in a successful DHCP lease process occurs when the DHCP server issuing the accepted offer broadcasts a successful acknowledgment to the client in the form of a DHCPACK message. This message contains a valid lease for an IP address and possibly other configuration information.</p>

<p>When the DHCP client receives the acknowledgment, TCP/IP is completely initialized and the client is considered a bound DHCP client. Once bound, the client can use TCP/IP to communicate on the network.</p>

<A NAME="1003"><H3>The DHCPNACK Message</H3></A>

<p>If the DHCPREQUEST is not successful, the DHCP server broadcasts a negative acknowledgement (DHCPNACK). A DHCP server broadcasts a DHCPNACK if</p>

<ul>
<p><li>The client is trying to lease its previous IP address, and the IP address is no longer available.</li></p>

<p><li>The IP address is invalid because the client physically has been moved to a different subnet.</li></p>
</ul>



<p>When the client receives an unsuccessful acknowledgment, it resumes the DHCP lease process.</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>If a computer has multiple network adapters that are bound to TCP/IP, the DHCP process occurs separately over each adapter. The DHCP Service assigns a unique IP address to each adapter in the computer that is bound to TCP/IP.</blockquote></div></p>

<A NAME="1004"><H2>IP Lease Renewal and Release</H2></A>

<p>All DHCP clients attempt to renew their lease when 50 percent of the lease time has expired. To renew its lease, a DHCP client sends a DHCPREQUEST message directly to the DHCP server from which it obtained the lease. If the DHCP server is available, it renews the lease and sends the client a DHCPACK message with the new lease time and any updated configuration parameters, as shown in Figure C.3. The client updates its configuration when it receives the acknowledgment.</p>

<p>
<A HREF="javascript:fullSize('Factk03x.htm')"> <img src="images/Factk03.JPG" width=404 height=307 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure C.3</b> <i>Renewing an IP lease</i><!-- /caption -->
</p>

<p><div class="note"><blockquote><b>NOTE</b><HR>Each time a DHCP client restarts, it attempts to lease the same IP address from the original DHCP server. If the lease request is unsuccessful and lease time is still available, the DHCP client continues to use the same IP address until the next attempt to renew the lease.</blockquote></div></p>

<p>If a DHCP client can't renew its lease with the original DHCP server at the 50 percent interval, the client broadcasts a DHCPREQUEST to contact any available DHCP server when 87.5 percent of the lease time has expired. Any DHCP server can respond with a DHCPACK message (renewing the lease) or a DHCPNACK message (forcing the DHCP client to reinitialize and obtain a lease for a different IP address).</p>

<p>If the lease expires, or if a DHCPNACK message is received, the DHCP client must immediately discontinue using that IP address. The DHCP client then 
begins the DHCP lease process to lease a new IP address.</p>

<A NAME="1005"><H3>Using Ipconfig to Renew a Lease</H3></A>

<p>Use the ipconfig command with the /renew switch to send a DHCPREQUEST message to the DHCP server to receive updated options and lease time. If the DHCP server is unavailable, the client continues using the current DHCP- 
supplied configuration options.</p>

<A NAME="1006"><H3>Using Ipconfig to Release a Lease</H3></A>

<p>Use the ipconfig command with the /release switch to cause a DHCP client to send a DHCPRELEASE message to the DHCP server and to release its lease. This is useful when you are moving a client to a different network and the client will not need its previous lease. TCP/IP communications with the client will stop after you issue this command.</p>

<p>Microsoft DHCP clients don't initiate DHCPRELEASE messages when shutting down. If a client remains shut down for the length of its lease (and the lease is not renewed), the DHCP server might assign that client's IP address to a different client after the lease expires. A client has a better chance of receiving the same IP address during initialization if it doesn't send a DHCPRELEASE message.</p>
</body>
</html>








