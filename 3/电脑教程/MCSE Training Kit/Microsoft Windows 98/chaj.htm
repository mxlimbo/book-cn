<HTML>
<HEAD>
<LINK REL=StyleSheet HREF="basicIE4.css" TYPE="text/css">
<TITLE>Appendix J -- Virtual Private Networking</TITLE>
<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>



<FONT SIZE="+3">Appendix J</FONT>
<P>
<H1>Virtual Private Networking</H1>
<P>Point-to-Point Tunneling Protocol (PPTP) is a network protocol that enables the secure transfer of data from a remote client to a private enterprise server, creating a virtual private network (VPN ) by using TCP/IP-based data networks. PPTP supports multiple network protocols (IP, IPX, and NetBEUI) and can be used for virtual private networking over public and private networks. You can use PPTP to provide secure, on-demand, virtual networks by using dial-up lines, local area networks (LANs), wide area networks (WANs), or the Internet and other public, TCP/IP-based networks.<P>
This appendix provides information on how to install, configure, and use PPTP on computers running the Windows&#160;NT Workstation version 4.0, and Windows&#160;NT Server version 4.0 operating systems. (For information on how to setup PPTP on a Windows&#160;98 machine see Chapter 18.) The main topics of this appendix are:<P>
<UL>
<LI>Planning for PPTP and virtual private networks<P>
<LI>What you must know before installing PPTP<SUP><P>
</SUP><LI>Installing and configuring a PPTP server<SUP><P>
</SUP><LI>Installing and configuring a PPTP client<P>
<LI>Using PPTP to dial up an ISP and connect to a PPTP server<P>
<LI>Using the Point-to-Point Protocol (PPP) to connect to a PPTP server by using a PPTP service provided by an ISP<P>
<LI>Using PPTP over the LAN to connect to a PPTP server<P>
</UL>

<H1>Planning for PPTP and Virtual Private Networks</H1>
A virtual private network (VPN) can be defined as an on-demand connection between two computers. The VPN consists of the two computers (one computer at each end of the connection) and a route, or <I>tunnel</I>, over the public or private network. To ensure privacy and secure communication, data transmitted between the two computers is encrypted by the Point-to Point Protocol (PPP) (a remote access protocol) and then routed over a previously established dial-up or LAN connection by a PPTP device. This device is referred to as a <I>virtual private network</I> or VPN.<P>
PPTP uses the VPN device to establish and maintain private, secure communication between computers. It does this by using Remote Access Service (RAS) and Dial-Up Networking to communicate over dial-up lines and public and private networks. <P>
You can use PPTP in the following three scenarios:<P>
<UL>
<LI>In the most common scenario, you can connect your workstation to a remote network by making a Dial-Up Networking connection to an Internet Service Provider (ISP) and then tunneling through the Internet to a PPTP server that is attached to both the Internet and to the remote network. Once you are connected to the PPTP server, you can transparently access any public or private network that is connected.<P>
<LI>If you have a permanent IP connection to a PPTP tunnel server, you can use Dial-Up Networking to connect directly to that tunnel server. You can then use that PPTP server to tunnel to any public or private network that is connected to it.<P>
<LI>Some ISPs are introducing a service that automatically tunnels your traffic to a PPTP server on a remote network. If your ISP supports this service, you can use Dial-Up Networking to make a dial-up connection to the ISP's PPTP tunnel server. You can then use that tunnel server to tunnel to any public or private network that is connected to it.<P>
</UL>
<H2>Hardware Requirements</H2>
The computer that is configured as a PPTP server must have the minimum configuration required to run Window NT Server version 4.0. In addition, two network adapter cards, also referred to as network interface cards (NICs), are required. One adapter is connected to the Internet; the other is connected to the private enterprise network.<P>
One of the primary advantages of PPTP is that it reduces or eliminates the need for dedicated, telecommunications equipment to support remote and mobile users who need to connect to the enterprise network. PPTP enables secure use of public or outsourced telecommunication networks. This reduces the cost of owning and maintaining dedicated, telecommunications equipment. <P>
A PPTP client is a remote or mobile enterprise user that connects to an enterprise PPTP server by using dial-up lines over the Internet. Additional hardware is required, such as an analog modem or Integrated Service Digital Network (ISDN) device and a device for telephone access (for example, a telephone wall jack.). If the PPTP client is connecting over the LAN to a PPTP server, the additional hardware required is the network adapter that is physically wired to the LAN network.<P>
<H2>Network Protocols on the Private Enterprise Network</H2>
PPTP enables you to use virtual private networking over public TCP/IP networks and retain existing network protocols, network node addresses, and naming schemes on the private enterprise network. Thus, no changes to existing network configurations and to network-based applications are required when using PPTP to tunnel across the Internet or other TCP/IP-based public networks. For example, IPX or NetBEUI clients can continue to run applications on the private network that require these protocols.<P>
Name resolution methods used on the private network&#151;such as Windows Internet Naming Service (WINS) for NetBIOS computers, Domain Name System (DNS) for TCP/IP host names, and Service Advertisement Protocol (SAP) for IPX networking&#151;do not need to be changed. In addition, IP addresses that are not valid on the Internet can be used on the private network.<P>
Note, however, that the address and name resolution schemes on the private enterprise network must be correctly configured. If they are not, PPTP clients are unable to communicate with computers on the private network.<P>
<H1>Before Installing PPTP</H1>
Before you begin installing PPTP, it is important that you understand the following points:<P>
<UL>
<LI>PPTP uses Microsoft's implementation of RAS and the Point-to-Point Protocol (PPP) to establish connections with remote computers by using dial-up lines, Ethernet networks, or token ring networks. PPP provides remote-user authentication and data encryption between the PPTP client and the PPTP server. Thus, to use PPTP you must install and configure RAS with Dial-Up Networking on both PPTP clients and PPTP servers. <P>
<LI>Because PPTP requires RAS and the PPP protocol, you must establish a PPP account with your ISP to use PPTP over an ISP connection to the Internet.<P>
<LI>PPTP uses virtual devices called VPNs. When you configure PPTP, you install and configure VPNs in RAS as if they were physical devices, just like modems.<P>
<LI>PPTP is installed and configured on PPTP clients and PPTP servers only. Computers on the route between the PPTP client and PPTP server do not require PPTP installation. <P>
<LI>A PPTP server can be placed behind a firewall on the private enterprise network to ensure that traffic in and out of the private network over the PPTP server is secured by the firewall computer. <P>
<LI>To ensure enterprise network security, PPTP clients must be authenticated (just like any other remote user using RAS and Dial-Up Networking) in order to connect to the private enterprise network.<P>
<LI>Using the Internet to establish a connection between a PPTP client and a PPTP server means that the PPTP server must have a valid, Internet-sanctioned IP address. However, the encapsulated IPX, NetBEUI, or TCP/IP packets sent between the PPTP client and the PPTP server can be addressed to computers on the private enterprise network using private network addressing or naming schemes. The PPTP server disassembles the PPTP packet from the PPTP client and forwards the packet to the correct computer on the private network.<P>
</UL>

<H1>Installing and Configuring PPTP on a PPTP Server</H1>
PPTP is installed on a Windows&#160;NT-based server as a network protocol by using the Protocols tab in the Network option of Control Panel. You can add, configure, and remove PPTP by using the Protocols tab. This section explains how to install and configure the PPTP protocol on a PPTP server and assumes the following:<P>
<UL>
<LI>Windows&#160;NT Server version 4.0 is installed.<P>
<LI>One or more network adapters are installed. In most cases, two or more network adapters are required: one to connect to the Internet and one or more to connect to enterprise networks.<P>
<LI>TCP/IP is installed and bound to the network adapter connected to the private enterprise network, and the adapter is connected to the Internet.<P>
<LI>The network protocol used on the private enterprise network, (TCP/IP, NetBEUI, or IPX) is installed and bound to the adapter(s) connected to the private enterprise network.<P>
<LI>The PPTP server is configured with a static IP address.<P>
<LI>RAS, with Dial-Up Networking, is installed and configured.<P>
<LI>You know how many simultaneous connections with remote PPTP clients you want the PPTP server to support, so that you can configure the correct number of VPN devices.<P>
</UL>

Configuring a computer running Windows&#160;NT Server version 4.0 as a PPTP server involves three major procedures:<P>
<UL>
<LI>Installing PPTP and then selecting the number of VPN devices <P>
<LI>Adding the VPN devices as RAS ports and devices<P>
<LI>Configuring encryption and authentication options<P>
</UL>

<H2>Installing PPTP on a PPTP Server</H2>
If you want to install the PPTP protocol on a computer running Windows&#160;NT Server version 4.0, perform the following procedure:<P>
<OL>
<LI>	Click <B>Start</B>, point to <B>Settings</B>, and click <B>Control Panel</B>.<P>
<LI>	Double-click <B>Network</B> in <B>Control Panel</B>.<P>
<LI>	Click the <B>Protocols</B> tab, and then click <B>Add</B> to display the <B>Select Network Protocol</B> dialog box (see Figure J.1). <P>
<P>
<A HREF="javascript:fullSize('FJXX01x.htm')"> <IMG SRC="fjxx01.jpg" WIDTH=360 HEIGHT=275 BORDER="0" ALT = "Click to view at full size."> </A>
<P>

<caption>
<B>Figure J.1</B>  <I>Selecting the PPTP network protocol</I>
</caption>
<P>
<LI>	Select Point To Point Tunneling Protocol and click OK.<P>
<LI>	Type the drive and directory location of your Windows&#160;NT Server version 4.0 installation files in the <B>Windows&#160;NT Setup</B> dialog box, and then click <B>Continue</B>. <P>
The PPTP files are copied from the installation directory, and the <B>PPTP Configuration</B> dialog box appears (see Figure J.2).
<P>
<A HREF="javascript:fullSize('FJXX02x.htm')"> <IMG SRC="fjxx02.jpg" WIDTH=360 HEIGHT=104 BORDER="0" ALT = "Click to view at full size."> </A>
<P>

<caption>
<B>Figure J.2</B> <I>Configuring the number of VPN devices for the PPTP server</I>
</caption>
<P>
<LI>	Click the <B>Number of Virtual Private Networks</B> drop-down arrow to select the number of simultaneous VPNs you want the server to support. <P>
You can select a number between 1 and 256. Typically, multiple VPNs are installed on a PPTP server to enable multiple clients to connect simultaneously to the PPTP server. The server can be configured to support a maximum number of 256 simultaneous VPN connections.<P>
<LI>Click <B>OK,</B> and then click <B>OK </B>again<B> </B>in the <B>Setup Message</B> dialog box.<P>
<LI>	In the <B>Remote Access Setup</B> dialog box you can do either of the following:<P>
<UL>
<LI>Temporarily stop installation of PPTP by clicking <B>Cancel</B>, closing <B>Network</B>, and shutting down and restarting the computer. Note that you must perform the procedure described in the following section &quot;Adding VPN Devices as RAS Ports on a PPTP Server&quot; to complete installation of PPTP.<P>
<LI>Continue installation of PPTP by clicking <B>Add</B> to add the VPN devices installed with PPTP to RAS. (See step 5 of the following procedure.)<P>
</UL>
</OL>

<H3>Adding VPN Devices as RAS Ports on a PPTP Server</H3>
After installing PPTP, you must add the VPN devices to RAS. Follow these steps to add VPN devices on a computer running Windows&#160;NT Server version 4.0.<P>
If you want to configure VPN devices on the PPTP server:<P>
<OL>
<LI>	Click <B>Start</B>, point to <B>Settings</B>, and then click <B>Control Panel</B>.<P>
<LI>	Double-click <B>Network</B> in <B>Control Panel</B>.<P>
<LI>	Click the <B>Services </B>tab and select <B>Remote Access Service</B>.<P>
<LI>	Click <B>Properties</B> to display the <B>Remote Access Setup</B> dialog box. <P>
<LI>	Click <B>Add</B>. <P>
The <B>Add RAS Device</B> dialog box appears (Figure J.3).
<P>
<A HREF="javascript:fullSize('FJXX03x.htm')"> <IMG SRC="fjxx03.jpg" WIDTH=360 HEIGHT=189 BORDER="0" ALT = "Click to view at full size."> </A>
<P>
<caption>
<B>Figure J.3</B> <I>Adding the VPN devices to RAS on the PPTP server</I>
</caption>
<P>
<LI>	Click the <B>RAS Capable Devices</B> list arrow to display VPN devices that must be added and configured as a port and device in RAS. <P>
<LI>	Select a VPN device and click <B>OK</B>. <P>
Repeat steps 5, 6, and 7 until all the VPNs are added to the <B>Remote Access Setup</B> dialog box.<P>
<LI>	Select a VPN port and click <B>Configure</B>. Verify that the <B>Receive calls</B> <B>only </B>option in the <B>Port Usage</B> dialog box is selected and then click <B>OK</B> to return to the <B>Remote Access Setup</B> dialog box. <P>
(If you also use this server as a PPTP client and want to use this VPN device to dial out as a PPTP device, select <B>Dial-out</B>.) <P>
<LI>	Repeat the last step for each VPN device that is displayed in the <B>Remote Access Setup</B> dialog box. <P>
(By default, VPN devices on a computer running Windows&#160;NT Server version 4.0 are automatically configured with the <B>Receive calls only</B> option, but you should verify this configuration.) <P>
<LI>	Click <B>Network</B> to display the <B>Network Configuration</B> dialog box and verify that only TCP/IP is checked in the <B>Server Settings</B> box in the <B>Network Configuration</B> dialog box. <P>
<LI>	Click <B>OK</B> to return to the <B>Remote Access Setup</B> dialog box.<P>
<LI>	Click <B>Continue</B>. <P>
<LI>	Close <B>Network</B>, shut down, and then restart the computer.<P>
</OL>

<H2>Configuring PPTP Server Encryption and Authentication Options</H2>
Configuring a PPTP server involves three steps:<P>
<UL>
<LI>Encrypting data sent over the Internet<P>
<LI>Accepting only PPTP packets from the Internet<P>
<LI>Accessing a private network<P>
</UL>

<H3>Configuring Server Encryption for PPTP</H3>
The encryption of data is performed by the remote access protocol, PPP. You enable encryption by configuring each VPN device that was added and configured in RAS. This configuration is identical to configuring encryption for other RAS devices, such as a modem.<P>
If you want to enable encryption on a VPN device on the PPTP server, perform the following procedure:<P>
<OL>
<LI>	Click <B>Start</B>, point to <B>Settings</B>, and then click <B>Control Panel.</B><P>
<LI>	Double-click <B>Network</B> in <B>Control Panel</B>.<P>
<LI>	Click the <B>Services </B>tab and select <B>Remote Access Service</B>.<P>
<LI>	Click <B>Properties</B> to display the <B>Remote Access Setup</B> dialog box (see Figure J.4).
<P>
<A HREF="javascript:fullSize('FJXX04x.htm')"> <IMG SRC="fjxx04.jpg" WIDTH=360 HEIGHT=180 BORDER="0" ALT = "Click to view at full size."> </A>
<P>

<caption>
<B>Figure J.4</B> <I>Selecting a VPN device for encryption on the PPTP server</I>
</caption>
<P>
<LI>	Select a VPN device for which you want to enable encryption, and then click <B>Network</B>. <P>
The <B>Network Configuration</B> dialog box appears (see Figure J.5).<P>
<IMG SRC="fjxx05.gif" WIDTH=319 HEIGHT=416 BORDER="0">
<P>
<caption>
<B>Figure J.5</B> <I>Configuring the VPN device with encryption on the PPTP server</I>
</caption>
<P>
<LI>	Select <B>Require Microsoft encrypted authentication</B> and <B>Require data encryption</B>. <P>
This configures RAS and PPP to enforce Windows&#160;NT-based authentication of all remote clients connecting to the PPTP server.<P>
<LI>	Click <B>OK</B> to return to the <B>Remote Access Setup</B> dialog box.<P>
<LI>	Click <B>Continue</B>.<P>
<LI>	Close <B>Network,</B> shut down, and then restart the computer.<P>
</OL>
<H3>Configuring PPTP Filtering on the PPTP Server</H3>
Enabling PPTP filtering provides a form of security for your private network by configuring an adapter on the computer to block all packets except PPTP packets. In a multi-homed computer, such as a PPTP server with one adapter connected to the enterprise network and another adapter connected to the Internet, PPTP filtering should be enabled on the adapter over which the PPTP connection is being made. <P>
In other words, if remote or mobile users connect to the enterprise network by using the PPTP server and the Internet, PPTP filtering should be enabled on the server adapter that is connected to the Internet. PPTP filtering in this case is enabled by configuring TCP/IP settings for the adapter that is connected to the Internet.<P>

<HR><BLOCKQUOTE>
<B>Note</B><P>
When PPTP filtering is enabled, all other network packets are ignored. Thus, packets from TCP/IP utilities such as<B> ping</B> and <B>tracert</B> are not accepted by the adapter on which PPTP filtering is enabled. This provides security, but it also means it can be difficult to troubleshoot possible problems on the PPTP server by using the TCP/IP troubleshooting utilities.<P>
</BLOCKQUOTE><HR>
<P>
If you want to enable PPTP filtering on an adapter in the PPTP server, perform the following procedure:<P>
<OL>
<LI>	Click <B>Start</B>, point to <B>Settings</B>, and then click <B>Control Panel</B>.<P>
<LI>	Double-click <B>Network </B>in Control Panel.<P>
<LI>	Click the <B>Protocols</B> tab, select <B>TCP/IP Protocol</B>, and then click <B>Properties</B>.<P>
<LI>	Click the <B>IP Address</B> tab, and then click <B>Advanced.</B><P>
The<B> Advanced IP Addressing </B>dialog box appears<B> </B>(see Figure J.6).<P>
<LI>	Click the <B>Adapter</B> drop-down arrow and select the adapter connected to the Internet. Click <B>Enable PPTP Filtering</B>, as shown in the following dialog box. <P>
Note that filtering is enabled only on network adapters. Filtering cannot be enabled on modems or ISDN devices.<P>
<IMG SRC="fjxx06.gif" WIDTH=344 HEIGHT=422 BORDER="0">
<P>
<caption>
<B>Figure J.6</B> <I>Enabling PPTP Filtering on the PPTP server</I>
</caption>
<P>
<LI>	Click <B>OK</B>, click <B>OK </B>again, and then close <B>Network</B>.<P>
<LI>	Shut down and then restart the computer.<P>
</OL>

<H1>Configuring LAN Routing on the PPTP Server</H1>
RAS must be configured to access your private network using the appropriate network protocols in order to enable the PPTP server to forward a packet from a PPTP client to the correct destination computer. For more information about general RAS server configuration (for example, using TCP/IP, IPX, or NetBEUI), see Rassetup.hlp in the \<I>Systemroot</I>\System32 directory of the RAS server.<P>
Once RAS is configured to access the private network, a PPTP server requires the following configuration:<P>
<UL>
<LI>The TCP/IP protocol must be configured to enable IP forwarding.<P>
<LI>The default route on the private network (intranet) must be suppressed by adding a Registry entry.<P>
<LI>You must prevent RAS from changing source IP addresses of incoming packets.<P>
<LI>Static routes to the private network must be established.<P>
</UL>
<H3>Enable IP Forwarding</H3>
You must enable IP forwarding on the PPTP server. If you want to enable IP forwarding, perform the following procedure: <P>
<OL>
<LI>	Click <B>Start</B>, point to <B>Settings</B>, and then click <B>Control Panel</B>.<P>
<LI>	Double-click <B>Network</B> in <B>Control Panel</B>. <P>
<LI>	Click the <B>Protocols </B>tab, select <B>TCP/IP</B>, and then click <B>Properties</B>.<P>
<LI>	Click the <B>Routing</B> tab, and then click <B>Enable IP Forwarding</B>.<P>
<LI>	Click <B>OK, </B>click<B> OK</B> again, and then close <B>Network.</B><P>
</OL>

<H3>Adding the DontAddDefaultGateway Registry Entry</H3>
By default, Windows&#160;NT Server and Windows&#160;NT Workstation both place a default route (0.0.0.0) on each network adapter in a computer. This causes the server to send packets of unknown IP addresses to the network adapter configured with the default route. This is the normal and desired action of a router.<P>
However, you must change this default setting if a server is connected to a private network (intranet) and the Internet. You must disable the automatic addition of a default route on the network adapter for the private network. You do this on the PPTP server by adding the <B>DontAddDefaultGateway </B>Registry entry with a value of REG_DWORD 0x1 in the following Registry location:<P>
<BLOCKQUOTE>
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services<BR>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\<I>network adapter</I>\Parameters\Tcpip\DontAddDefaultGateway<P>
</BLOCKQUOTE>
<P>
This entry prevents the default route from being added to PPTP server's network adapter. Use a Registry editor to add this entry, and then shut down and restart the computer.<P>
After the <B>DontAddDefaultGateway </B>entry is created you must add static routes for the network adapter. These static routes must configure the PPTP server to route incoming data from the Internet to the correct server on the private network. This procedure is explained below.<P>
<H2>Preventing RAS from Changing Source IP Addresses</H2>
By default, RAS changes the source IP address of packets it routes, from the IP address of the client sending the packets to its own source IP address.<P>
You must disable this functionality in order for LAN-to-LAN routing to function. You do this on the PPTP server by adding the <B>DisableOtherSrcPackets </B>Registry entry<B> </B>with a value of REG_DWORD 0<P>
<BLOCKQUOTE>
HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\RasArp\Parameters<P>
</BLOCKQUOTE>
This entry prevents the RAS server from changing the source address of packets it forwards.<P>
<H3>Adding Static Routes for the Private Network</H3>
You add static routes to your private network on the PPTP server by using the <B>route</B> command at the command prompt. The static entries can be added by using a .bat file that contains the routes or by using the <B>route</B> command with the <B>-p</B> (<I>persistent</I>) option.<P>
The <B>route </B>command causes all subnets and computers on the private network to be known to the PPTP server. Without the necessary <B>route </B>commands, the PPTP server would broadcast for every address required by PPTP clients. <P>
To add the static routes to the PPTP server, run <B>route</B> with the <B>-p </B>option at the command prompt, as shown in the following example:<P>
<BLOCKQUOTE>C:\&gt;route add -p 172.16.48.10<P>
</BLOCKQUOTE>
<P>
The <B>route</B> command must identify all the computers or networks you want PPTP clients to reach. <P>
<H2>Installing and Configuring PPTP on a Windows NT-based Client</H2>
<P>The procedures in this section assume the following:<P>
<UL>
<LI>Windows&#160;NT Workstation version 4.0 or Windows&#160;NT Server version 4.0 is installed.<P>
<LI>TCP/IP is installed on the computer.<P>
<LI>RAS with Dial-up Networking is installed on the computer.<P>
<LI>An analog modem, ISDN device, or other modem device is installed and configured in RAS to enable you to make a dial-out connection from the computer. <P>
<LI>If you are using the Internet to connect to the PPTP server, you have a PPP account with your ISP.<P>
</UL>

<H2>Installing PPTP on a Windows NT-based Client</H2>
If you want to install the PPTP protocol on a client running Windows&#160;NT Workstation version 4.0 or Windows&#160;NT Server version 4.0, peform the following procedure: <P>
<OL>
<LI>	Click <B>Start</B>, point to <B>Settings</B>, and then click <B>Control Panel</B>.<P>
<LI>	In <B>Control Panel</B>, double-click <B>Network</B>.<P>
<LI>	Click the <B>Protocols </B>tab, and then click <B>Add</B> to display the <B>Select Network Protocol</B> dialog box (see Figure J.7).
<P>
<A HREF="javascript:fullSize('FJXX07x.htm')"> <IMG SRC="fjxx07.jpg" WIDTH=360 HEIGHT=275 BORDER="0" ALT = "Click to view at full size."> </A>
<P>
<caption>
<B>Figure J.7</B> <I>Selecting the PPTP network protocol on the PPTP client</I>
</caption>
<P>
<LI>	Select Point To Point Tunneling Protocol and click OK.<P>
<LI>	Type the drive and directory location of your installation files in the Windows&#160;NT Setup dialog box, and then click Continue.<P>
The PPTP files are copied from the installation directory and the <B>PPTP Configuration</B> dialog box appears (see Figure J.8).
<P>
<A HREF="javascript:fullSize('FJXX08x.htm')"> <IMG SRC="fjxx08.jpg" WIDTH=360 HEIGHT=103 BORDER="0" ALT = "Click to view at full size."> </A>
<P>
<caption>
<B>Figure J.8</B> <I>Adding a VPN device on the PPTP client</I>
</caption>
<P>
<LI>	Click the <B>Number of Virtual Private Networks</B> drop-down arrow and select the number of VPN devices you want the client to support. <P>
You can select a number between 1 and 256 for computers running Windows&#160;NT Workstation version 4.0 or Windows&#160;NT Server version 4.0. Typically, only one VPN is installed on a PPTP client.<P>
</OL>

<HR><BLOCKQUOTE>
<B>Note</B><P>
If the PPTP client is an ISP server running Windows&#160;NT Server version 4.0, you can select multiple VPN devices as needed to simultaneously support the PPP clients using the ISP server to connect to a PPTP server. Windows&#160;NT Server version 4.0 supports a maximum number of 256 VPN devices.
</BLOCKQUOTE><HR>
<OL START="7">
<LI>	Click <B>OK,</B> and then click <B>OK </B>in the <B>Setup Message</B> dialog box.<P>
<LI>	In the <B>Remote Access Setup</B> dialog box, you can do either of the following:<P>
a) Temporarily stop installation of PPTP by clicking <B>Cancel</B>, closing <B>Network</B>, and then shutting down and restarting the computer. Note that you must perform the procedure described in the following section &quot;Adding a VPN Device as a RAS Port on the PPTP Client&quot; to complete installation of PPTP.<P>
b) Continue installation by clicking <B>Add</B> to add to RAS the VPN device installed with PPTP. (See step 5 of the procedure described in the following section.)<P>
</OL>

<H3>Adding a VPN Device as a RAS Port on the PPTP Client</H3>
You must add the VPN device to RAS after installing PPTP. Follow these steps to add a VPN device on a computer running Windows&#160;NT Workstation version 4.0.<P>
If you want to configure a VPN device on the PPTP client, perform the following procedure:<P>
<OL>
<LI>Click <B>Start</B>, point to <B>Settings</B>, and then click <B>Control Panel</B>.<P>
<LI>	In <B>Control Panel</B>, double-click <B>Network</B>.<P>
<LI>	Click the <B>Services </B>tab and select <B>Remote Access Service</B>.<P>
<LI>	Click <B>Properties</B> to display the <B>Remote Access Setup</B> dialog box. <P>
<LI>	Click <B>Add</B>. The <B>Add RAS Device</B> dialog box (see Figure J.9).<P>
<P>
<A HREF="javascript:fullSize('FJXX09x.htm')"> <IMG SRC="FJXX09.JPG" WIDTH=360 HEIGHT=190 BORDER=0 ALT = "Click to view at full size."> </A>
<P>
<caption>
<B>Figure J.9</B> <I>Adding the VPN to RAS on a PPTP client</I>
</caption>
<P>
<LI>	Click the <B>RAS Capable Devices</B> list to display the VPN devices that must be added and configured as a port and device in RAS.<P>
<LI>	Select the VPN1 - RASPPTPM device, and then click <B>OK</B>. <P>
(If you installed PPTP with more than one VPN device, repeat steps 5, 6, and 7 until all the VPNs are added to the <B>Remote Access Setup</B> dialog box.)<P>
<LI>	By default, the VPN device on a computer running Windows&#160;NT Workstation version 4.0 is configured to dial out only. Select the VPN port and click <B>Configure</B>. Verify that the <B>Dial out only</B> option in the <B>Port Usage</B> dialog box is the only option selected, and then click <B>OK</B>.<B> </B><P>
This<B> </B>returns you to the <B>Remote Access Setup</B> dialog box.<P>
<LI>	Click <B>Network</B> to display the <B>Network Configuration</B> dialog box.<P>
<LI>	Verify that the <B>TCP/IP</B> option in <B>Dial out Protocols</B> is the only option checked, and then click <B>OK</B>.<P>
<LI>	Click <B>Continue</B>.<P>
<LI>	Close <B>Network,</B> shut down, and then restart the computer.<P>
</OL>

<H2>Configuring Dial-Up Networking on the Windows&#160;NT-based PPTP Client</H2>
<P>PPTP is most commonly used for enabling secure and encrypted communications to private enterprise networks via the Internet. In this scenario, the PPTP client must have two phonebook entries: one to connect to the Internet via an ISP and one to connect to a PPTP server on the target network.<P>
However, if you are using PPTP to connect to a PPTP tunnel server on your LAN, you only need to have one phonebook entry: the PPTP server phonebook entry.<P>
The following procedures describe how to use Dial-Up Networking to create phonebook entries for the ISP and the PPTP server.<P>
<H2>Creating the Phonebook Entry to Dial an ISP</H2>
If you are using PPTP and Dial-Up Networking to connect to a PPTP server over the Internet, you need to create a phonebook entry for your ISP. <P>

<HR><BLOCKQUOTE>
<B>Note</B><P>
You do not need to create a phonebook entry for your ISP if you are using a LAN connection to dial up a PPTP server on the LAN.
</BLOCKQUOTE><HR>
<P>
Before starting the following procedures, make sure you have:<P>
<UL>
<LI>Installed all network protocols used on the private network to which you want to connect.<P>
<LI>Configured RAS to dial out using those network protocols.<P>
</UL>
<P>
If you want to create a new ISP entry by using the Phonebook wizard, perform the following procedure:<P>
<OL>
<LI>	Click <B>Start</B>, point to <B>Programs</B>, point to <B>Accessories</B>, and then click <B>Dial-Up Networking</B>. <P>
(If this is the first phonebook entry you are creating, the <B>Dial-Up Networking</B> dialog box appears. Click <B>OK</B>.)<P>
<LI>	Type a name for your phonebook entry, such as the name of your ISP, in the <B>Name the new phonebook entry</B> box, and then click <B>Next</B>.<P>
<LI>	Click <B>I am calling the Internet</B> and click <B>Next</B>. <P>
This configures the phonebook entry to use TCP/IP and PPP as the Dial-Up Networking protocols.<P>
<LI>	Select your modem device in the <B>Select the modem or adapter this entry will use</B> box, and then click <B>Next</B>.<P>
<LI>	Type the ISP's phone number in the <B>Phone number</B> box. Click <B>Use Telephony dialing properties</B> if you need to add an area code or other prefix. Click <B>Alternatives</B> if you have an alternative phone number for your ISP.<P>
<LI>	Click <B>Next</B>, and then click <B>Finish</B>.<P>
<LI>	Verify the phonebook entry by using the following procedure.<P>
</OL>

If you want to verify or edit your ISP phonebook entry, perform the following procedure:<P>
<OL>
<LI>	Click <B>More</B> in <B>Dial-Up Networking</B>, and then click <B>Edit entry and modem properties</B> to verify that your ISP phonebook entry is correctly configured. <P>
The <B>Edit Phonebook Entry</B> dialog box is illustrated in Figure J.10.
<P>
<A HREF="javascript:fullSize('FJXX10x.htm')"> <IMG SRC="FJXX10.JPG" WIDTH=360 HEIGHT=300 BORDER=0 ALT = "Click to view at full size."> </A>
<P>
<caption>
<B>Figure J.10</B> <I>Example phonebook entry used to dial up an ISP</I>
</caption><P>
<LI>	Review the information on the <B>Basic</B> tab to ensure that the phone number is correct and that the correct modem or ISDN device is selected. Make any necessary changes.<P>
<LI>	Click the <B>Server</B> tab (see Figure J.11). 
<P>
<A HREF="javascript:fullSize('FJXX11x.htm')"> <IMG SRC="FJXX11.JPG" WIDTH=360 HEIGHT=300 BORDER=0 ALT = "Click to view at full size."> </A>
<P>

<caption>
<B>Figure J.11</B> <I>Verifying the dial-up server properties</I>
</caption><P>
<LI>	Review the information on the <B>Server</B> tab to ensure that the <B>Dial-up server type</B> displays &quot;PPP: Windows&#160;NT, Windows&#160;95 Plus, Internet.&quot;<P>
<LI>	In the <B>Network protocols</B> box, ensure that <B>TCP/IP</B> is selected. <P>
<LI>	Click <B>TCP/IP Settings</B> to display the <B>PPP TCP/IP Settings</B> dialog box.<P>
Ensure that the TCP/IP settings conform to the IP address and name server information specified by your ISP. <P>
<LI>	By default, the options <B>Enable software compression</B> and<B> Enable PPP LCP extensions</B> are selected. These settings are compatible with most ISP services. Check with your ISP before changing these default settings.<P>
<LI>	Click the <B>Script</B> tab, and then select <B>None</B>. <P>
The PPP protocol provided in RAS is designed to automate remote logon. If your ISP requires a manual logon, consult your ISP for the correct configuration. <P>
<LI>	Click the <B>Security</B> tab. Click <B>Accept only Microsoft encrypted authentication</B>. <P>
The configures PPP to encrypt the user name and password for remote logon to a server that enforces Windows&#160;NT authentication. <P>
<LI>	Click <B>OK</B>, and then click <B>Close</B> to complete the ISP phonebook entry. <P>
</OL>

<H3>Creating the Phonebook Entry to Dial a PPTP Server</H3>
You must create a phonebook entry to connect to your PPTP server by using a VPN device.<P>
<HR><BLOCKQUOTE>
<B>Note</B><P>
You do not need to create a phonebook entry for your PPTP server if your computer is not PPTP-enabled and you are using a PPTP service provided by your ISP.
</BLOCKQUOTE><HR>
<P>
Before starting the following procedures you must have:<P>
<UL>
<LI>Installed all network protocols (IP, IPX, NetBEUI) used on the private network to which you want to connect.<P>
<LI>Configured RAS to dial out using the network protocols (IP, IPX, NetBEUI) used on the private network.<P>
</UL>

If you want to create an phonebook entry to dial-up a PPTP server by using a VPN device, perform the following procedure:<P>
<OL>
<LI>	Click <B>Start</B>, point to <B>Programs</B>, point to <B>Accessories</B>, and then click <B>Dial-Up Networking</B>. <P>
(If this is the first phonebook entry, a <B>Dial-Up Networking</B> dialog box appears. Click <B>OK</B>.)<P>
<LI>	Type the name of your PPTP server in <B>Name the new phonebook entry</B>, and click <B>Next</B>.<P>
<LI>	Click <B>I am calling the Internet</B> and click <B>Next</B>. This configures the phonebook entry to use TCP/IP and PPP as the Dial-Up Networking protocols.<P>
<LI>	Select <B>RASPPTPM(VPN1)</B> in the <B>Select the modem or adapter this entry will use</B> box, and then click <B>Next</B>.<P>
<LI>	Type the IP address of the adapter on the PPTP server that is connected to the Internet in the <B>Phone Number</B> box.<P>
</OL>
<HR><BLOCKQUOTE>
<B>Note</B><P>
If your PPTP server has an Internet registered DNS name, you could alternatively enter its DNS name in this field.
</BLOCKQUOTE><HR>
<P>
<OL START="6">
<LI>	Click <B>Next</B>, and then click <B>Finish</B>.<P>
<LI>	Verify the phonebook entry by using the following procedure.<P>
</OL>

<P>
<HR><BLOCKQUOTE>
<B>Note</B><P>If you are configuring the VPN device on an ISP server running Windows&#160;NT Server version 4.0 that is configured with multiple VPN devices, repeat this procedure for each VPN device.
</BLOCKQUOTE><HR>

<P>If you want to verify or edit your phonebook entry for the PPTP server, perform the following procedure:<P>
<OL>
<LI>	Click <B>More</B> in <B>Dial-Up Networking,</B> and then click <B>Edit entry and modem properties</B> to verify that your PPTP server phonebook entry is correctly configured. <P>
The <B>Edit Phonebook Entry</B> dialog box appears (see Figure J.12).<P>
<A HREF="javascript:fullSize('FJXX12x.htm')"> <IMG SRC="FJXX12.JPG" WIDTH=360 HEIGHT=300 BORDER=0 ALT = "Click to view at full size."> </A>
<P>

<caption>
<B>Figure J.12</B> <I>Example phonebook entry for PPTP server and a VPN device</I>
</caption><P>
<LI>	Review the information on the <B>Basic</B> tab to ensure that the phone number is correct and that the <B>RASPPTPM(VPN1) </B>device is selected. Make any necessary changes.<P>
<LI>	Click the <B>Server</B> tab.<P>
<LI>	Review the information on the <B>Server</B> tab to ensure that the <B>Dial-up server type</B> displays &quot;PPP: Windows&#160;NT, Windows&#160;95 Plus, Internet.&quot;<P>
<LI>	In the <B>Network protocols</B> box, ensure that the network protocols used on your private network are selected. Any selected protocol (TCP/IP, IPX/SPX, NetBEUI) must already be installed on the PPTP client you are configuring. In addition, RAS must be configured to use that protocol to dial out. Note that TCP/IP does not need to be selected unless it is the protocol used on your private network. <P>
<LI>	If you use TCP/IP on your private network, click <B>TCP/IP Settings</B> to display the <B>PPP TCP/IP Settings</B> dialog box. Ensure that the TCP/IP settings conform to the settings required by the RAS configuration on the PPTP server. This includes the <B>Enable software compression</B> and<B> Enable PPP LCP extensions</B> settings.<P>
<LI>	Click the <B>Script</B> tab, and then select <B>None</B>. <P>
The PPP protocol used in RAS is designed to automate remote logon. If your ISP requires a manual logon, consult your ISP for the correct configuration. <P>
<LI>	Click the <B>Security</B> tab. Click <B>Accept only Microsoft encrypted authentication</B>. <P>
The PPP protocol encrypts the user name and password for remote logon. The user name and password used to log on to the current session can be used by selecting <B>Use current username and password</B>. You are prompted by the PPTP server if this box is not selected. Both methods are encrypted and are therefore secure.<P>
</OL>
<P>
<HR><BLOCKQUOTE>
<B>Note</B><P>
If you are configuring the VPN device on an ISP server running Windows&#160;NT Server version 4.0 that is configured with multiple VPN devices, repeat this procedure for each VPN device.
</BLOCKQUOTE><HR>
<P>
<H2>Using PPTP to Connect to a PPTP Server by Dialing an ISP</H2>

<P>With PPTP, you can connect your workstation to a remote network by tunneling through the Internet to a PPTP server on that network. To do so, you must make two connections. First, you must connect to the Internet through an ISP. Next, you must create a tunnel to the target network. This section explains how to make these connections using Windows&#160;NT-based clients.<P>
<H2>Connecting to a PPTP Server Using a Windows NT-based PPTP Client</H2>
<P>If you want to connect to a PPTP server using a Windows&#160;NT-based PPTP client, perform the following procedure:<P>
<OL>
<LI>	In <B>My Computer</B>, double-click <B>Dial-Up Networking</B>.<P>
<LI>	Click <B>More</B> and select <B>User Preferences</B>. On the <B>Appearance</B> tab, clear the <B>Close on dial</B> checkbox. Click <B>OK</B>.<P>
<LI>	In the <B>Dial-Up Networking</B> dialog box, click the drop-down arrow in the <B>Phonebook entry to dial</B> list to select the entry for your ISP phonebook entry, and then click <B>Dial</B>. <P>
<LI>	After connecting to your ISP, click the drop-down arrow in <B>the Phonebook entry to dial</B> list once more to select the entry for your PPTP server. Click <B>Dial</B>.<P>
</OL>

<H2>After Connecting to a PPTP Server</H2>
<P>After you connect successfully to the PPTP server on the remote network, the ISP routes all traffic sent from your workstation over the Internet to the PPTP server. The PPTP server then routes the traffic to the correct computer on the remote network. Consequently, you will only see computers and servers on the remote network. You will no longer see the Internet unless the remote network itself provides access to the Internet.<P>
<H2>Dialing an ISP PPTP Service to Connect to a PPTP Server</H2>
<P>Some ISPs are introducing a service that automatically tunnels your traffic to a PPTP server on a remote network. (Your ISP will be able to tell you whether this service is available.)<P>
You can use Dial-Up Networking to make a connection to a PPTP server across the Internet if your ISP provides a PPTP service. You do this by using Dial-Up Networking and your modem or ISDN device to connect to your ISP server. You do not need to define a VPN connection because the ISP server makes the connection to the PPTP server for the PPP client. <P>
Contact your ISP to find out whether they have a PPTP server that provides a PPTP service and, if so, how to connect to that server. <P>
<H2>Using PPTP Over the LAN to Connect to a PPTP Server</H2>
<P>PPTP clients with a permanent IP connection to a PPTP tunnel server can use PPTP tunneling over that IP connection. For example, suppose that you are in a networked office environment and your network has a PPTP tunnel server. You can then use that PPTP server to tunnel to any private network that is connected to that PPTP server, such as the personnel department's private network. Thus, you can create a virtual private network by using your direct LAN connection. Data sent from your PPTP client to another computer on the LAN is encrypted and secure because you are using a PPTP server to connect to the remote computer.<P>
In the following scenario, the PPTP client uses Dial-Up Networking over a LAN connection instead of a telephone line. Only one connection to the PPTP server is required. <P>
<H3>Connecting to a PPTP Server using a Windows NT PPTP Client</H3>
If you want to connect to a PPTP server over a LAN connection, perform the following procedure:<P>
<OL>
<LI>	In <B>My Computer</B>, double-click <B>Dial-Up Networking</B>.<P>
<LI>	Click <B>More</B> and select <B>User Preferences</B>. On the <B>Appearance</B> tab, clear the <B>Close on dial</B> checkbox, and then click <B>OK</B>.<P>
<LI>	In the <B>Dial-Up Networking</B> dialog box, click the drop-down arrow in the <B>Phonebook entry to dial</B> list to select the entry for your PPTP server.<P>
<LI>	Click <B>Dial</B>.<P>
</OL>



</BODY>
</HTML>