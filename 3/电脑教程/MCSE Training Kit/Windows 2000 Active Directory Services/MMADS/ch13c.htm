<html>
<head>
<title>Lesson 2: Auditing</title>
<link rel="STYLESHEET" type="text/css" href="mmads.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</head>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch13b.htm", "ch13d.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="702"><h1>Lesson 2: Auditing</h1></A>
<p>In this lesson you will learn about Windows 2000 auditing, which is a tool for maintaining network security. Auditing allows you to track user activities and system-wide events. You will learn about audit policies and what you need to consider before you set one up. You also will learn how to set up auditing 
on resources.</p>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to</b>

<ul>
<p><li> Describe the purpose of auditing</li></p>

<p><li> Plan an audit strategy and determine which events to audit</li></p>

<p><li> Set up an audit policy</li></p>

<p><li> Set up auditing on files and folders</li></p>

<p><li> Set up auditing on Active Directory objects</li></p>

<p><li> Set up auditing on printers</li></p>
</ul>

<p><b>Estimated lesson time: 60 minutes</b></p>
</blockquote></div>
</p>

<A NAME="703"><h2>Understanding Auditing</h2></A>
<p><i>Auditing</i> in Microsoft Windows 2000 is the process of tracking both user 
activities and Windows 2000 activities, which are called <i>events,</i> on a computer. Through auditing, you can specify which events are written to the security log. For example, the security log can maintain a record of valid and invalid logon attempts and events relating to creating, opening, or deleting files or other 
objects. An audit entry in the security log contains the following information:</p>

<ul>
<p><li> The action that was performed</li></p>

<p><li> The user who performed the action</li></p>

<p><li> The success or failure of the event and when the event occurred</li></p>
</ul>

<A NAME="704"><h2>Using an Audit Policy</h2></A>
<p>An <i>audit policy</i> defines the categories of events that Windows 2000 records in the security log on each computer. The security log allows you to track the events that you specify.</p>

<p>Windows 2000 writes events to the security log on the computer where the event occurs. For example, any time someone tries to log on to the domain using a 
domain user account and the logon attempt fails, Windows 2000 writes an event to the security log on the domain controller. The event is recorded on the domain controller rather than on the computer at which the logon attempt was made 
because it is the domain controller that attempted to and could not authenticate the logon attempt.</p>

<p>You can set up an audit policy for a computer to do the following:</p>

<ul>
<p><li> Track the success and failure of events, such as logon attempts by users, an attempt by a particular user to read a specific file, changes to a user account or to group memberships, and changes to your security settings</li></p>

<p><li> Eliminate or minimize the risk of unauthorized use of resources</li></p>
</ul>

<p>You use Event Viewer to view events that Windows 2000 has recorded in the 
security log. You can also archive log files to track trends over time&#8212;for 
example, to determine the use of printers or files or to verify attempts at 
unauthorized use of resources.</p>

<A NAME="705"><h2>Audit Policy Guidelines</h2></A>
<p>When you plan an audit policy you must determine the computers on which to set up auditing. Auditing is turned off by default. As you are determining which computers to audit, you must also plan the events to audit on each computer. Windows 2000 records audited events on each computer separately.</p>

<p>After you have determined the events to audit, you must determine whether to audit the success of events, failure of events, or both. Tracking successful events can tell you how often Windows 2000 or users gain access to specific files, printers, or other objects. You can use this information for resource planning. Tracking failed events can alert you to possible security breaches. For example, if you notice several failed logon attempts by a certain user account, especially if these attempts are occurring outside normal business hours, you can assume that an unauthorized person is attempting to break into your system.</p>

<p>Other guidelines in determining your audit policy include the following:</p>

<ul>
<p><li> <b>Determine if you need to track trends of system usage.</b> If so, plan to archive event logs. Archiving these logs will allow you to view how usage changes over time and to plan to increase system resources before they become a problem.</li></p>

<p><li> <b>Review security logs frequently.</b> You should set a schedule and regularly review security logs because configuring auditing alone does not alert you to security breaches.</li></p>

<p><li> <b>Define an audit policy that is useful and manageable.</b> Always audit sensitive and confidential data. Audit only those events that will provide you with meaningful information about your network environment. This will minimize usage of server resources and make essential information easier to locate. Auditing too many types of events can create excess overhead for Windows 2000.</li></p>

<p><li> <b>Audit resource access by the Everyone group instead of the Users group.</b> This will ensure that you audit anyone who can connect to the network, not just the users for whom you create user accounts in the domain. Also audit resource access failures by the Everyone group.</li></p>

<p><li> <b>Audit all administrative tasks by the administrative groups.</b> This will ensure that you audit any additions or changes made by administrators.</li></p>
</ul>

<A NAME="706"><h2>Configuring Auditing</h2></A>
<p>You implement an audit policy based on the role of the computer in the Windows 2000 network. Auditing is configured differently for the following types of 
computers running Windows 2000:</p>

<ul>
<p><li> For member or stand-alone servers, or computers running Windows 2000 Professional, an audit policy is set for each individual computer. To audit events that occur on a local computer, you configure a local group policy for that computer, which applies to that computer only.</li></p>

<p><li> For domain controllers, an audit policy is set for all domain controllers in the domain. To audit events that occur on domain controllers, you configure the audit policy in a nonlocal GPO for the domain, which applies to all domain controllers and is accessible through the Domain Controllers OU.</li></p>
</ul>

<p>The event categories on a domain controller are identical to those on a computer that is not a domain controller.</p>

<A NAME="707"><h3>Auditing Requirements</h3></A>
<p>The requirements to set up and administer auditing are as follows:</p>

<ul>
<p><li> You must have the Manage Auditing And Security Log user right for the computer where you want to configure an audit policy or review an audit log. By default, Windows 2000 grants these rights to the Administrators group. For information about user rights, see <a href="ch13e.htm">Lesson 4</a>.</li></p>

<p><li> The files and folders to be audited must be on Microsoft Windows NT file system (NTFS) volumes.</li></p>
</ul>

<A NAME="708"><h3>Setting Up Auditing</h3></A>
<p>Setting up auditing is a two-part process:</p>

<ol>
<p><li> <b>Set the audit policy.</b> The audit policy enables auditing of objects but does not activate auditing of specific objects.</li></p>

<p><li> <b>Enable auditing of specific resources.</b> You specify the specific events to audit for files, folders, printers, and Active Directory objects. Windows 2000 then tracks and logs the specified events.</li></p>
</ol>

<A NAME="709"><h2>Setting Up an Audit Policy</h2></A>
<p>The first step in implementing an audit GPO is selecting the categories of events that Windows 2000 audits. For each event category that you can audit, the 
configuration settings indicate whether to track successful or failed attempts. You set audit policies in the Group Policy snap-in. The security log is limited in size. 
Select the events to be audited carefully and consider the amount of disk space you are willing to devote to the security log. Table 13.1 describes the event 
categories that Windows 2000 can audit.</p>

<p><b>Table 13.1</b> <i>Types of Events Audited by Windows 2000</i></p>
<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th>Event Category</th>
<th>Description</th>
</tr>
<tr>
<td valign="top">Account logon</td>
<td valign="top">A domain controller received a request to validate a 
user account.</td>
</tr>
<tr>
<td valign="top">Account management</td>
<td valign="top">An administrator created, changed, or deleted a user account or group. A user account was renamed, disabled, or enabled, or a password was set or changed.</td>
</tr>
<tr>
<td valign="top">Directory service access</td>
<td valign="top">A user gained access to an Active Directory object. You must configure specific Active Directory objects for auditing to log this type of event.</td>
</tr>
<tr>
<td valign="top">Logon events</td>
<td valign="top">A user logged on or logged off, or a user made or canceled a network connection to the computer.</td>
</tr>
<tr>
<td valign="top">Object access</td>
<td valign="top">A user gained access to a file, folder, or printer. You must configure specific files, folders, or printers for auditing. 
Directory service access is auditing a user's access to 
specific Active Directory objects. Object access is auditing 
a user's access to files, folders, and printers.</td>
</tr>
<tr>
<td valign="top">Policy change</td>
<td valign="top">A change was made to the user security options, user rights, or audit policies.</td>
</tr>
<tr>
<td valign="top">Privilege use</td>
<td valign="top">A user exercised a right, such as changing the system time (this does not include rights that are related to logging on and logging off).</td>
</tr>
<tr>
<td valign="top">Process tracking</td>
<td valign="top">A program performed an action. This information is generally useful only for programmers who want to track details of program execution.</td>
</tr>
<tr>
<td valign="top">System events</td>
<td valign="top">A user restarted or shut down the computer, or an event 
occurred that affects Windows 2000 security or the security log (for example, the audit log is full and Windows 2000 discards entries).</td>
</tr>
</table>
</p>

<p><li> <b><a name="894">To set an audit policy for a domain controller</a></b></li></p>

<ol>
<p><li> Open Active Directory Users and Computers.</li></p>

<p><li> In the console tree, right-click Domain Controllers, then click Properties.</li></p>

<p><li> In the Group Policy tab, click the policy in which you want set the audit policy, then click Edit.</li></p>

<p><li> In the Group Policy snap-in, in the console tree, click Computer Configuration, double-click Windows Settings, double-click Security Settings, double-click Local Policies, then double-click Audit Policy.</li></p>

<p>The console displays the current audit policy settings in the details pane, as shown in Figure 13.2.</p>

<p>
<A HREF="javascript:fullSize('new13-02x.htm')"> <img src="images/new13-02.JPG" width=404 height=285 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 13.2</b> <i>Custom console showing events that Windows 2000 can audit</i><!-- /caption -->
</p>


<p><li> In the details pane, right-click the event category you want to audit, then click Security.</li></p>

<p><li> In the Template Security Policy Setting dialog box (see Figure 13.3), click Define These Policy Settings In The Template, then click one or both:</li></p>

	<ul>
	<p><li> Success, to audit successful attempts for the event category</li></p>
	
	<p><li> Failure, to audit failed attempts for the event category</li></p>
	</ul>

<p><li> Click OK.</li></p>

<p><li> Because the changes that you make to your computer's audit policy take effect only when the policy is propagated (applied) to your computer, do one of the following to initiate policy propagation:</li></p>

	<ul>
	<p><li> Type <b>secedit /refreshpolicy machine_policy</b> at the command prompt, then press Enter.</li></p>
	
	<p><li> Restart your computer.</li></p>
	
	<p><li> Wait for automatic policy propagation, which occurs at regular, configurable intervals. By default, policy propagation occurs every eight hours.</li></p>
	</ul>

<p>
<img src="images/13wtk03.JPG" width=385 height=237 border="0">
</p><p>
<!-- caption --><b>Figure 13.3</b> <i>The Template Security Policy Setting dialog box</i><!-- /caption -->
</p>

</ol>

<p><li> <b>To set an audit policy on a computer that does not participate in a domain</b></li></p>

<ol>
<p><li> Click Start, point to Programs, point to Administrative Tools, then click Local Security Policy.</li></p>

<p><li> In Local Security Settings, in the console tree, double-click Local Policies, then double-click Audit Policy.</li></p>

<p><li> In the details pane, right-click the event category you want to audit, then click Security.</li></p>

<p><li> In the Local Security Policy Setting dialog box (see Figure 13.4), click one or both:</li></p>

	<ul>
	<p><li> Success, to audit successful attempts for the event category</li></p>
	
	<p><li> Failure, to audit failed attempts for the event category</li></p>
	</ul>

<p>The Effective Policy Setting box shows the security setting value currently enforced on the system. If an audit policy has already been set at the domain level or the OU level, it overrides the local audit policy.</p>

<p><li> Click OK.</li></p>

<p><li> Because the changes that you make to your computer's audit policy take effect only when the policy is propagated (applied) to your computer, do one of the following to initiate policy propagation:</li></p>

	<ul>
	<p><li> Type <b>secedit /refreshpolicy machine_policy</b>at the command prompt, then press Enter.</li></p>
	
	<p><li> Restart your computer.</li></p>
	
	<p><li> Wait for automatic policy propagation, which occurs at regular, configurable intervals. By default, policy propagation occurs every eight hours.</li></p>
	</ul>

<p>
<img src="images/new13-04.JPG" width=384 height=352 border="0">
</p><p>
<!-- caption --><b>Figure 13.4</b> <i>The Local Security Policy Setting dialog box</i><!-- /caption -->
</p>

</ol>

<p><li> <b>To set an audit policy on a member server or workstation</b></li></p>

<ol>
<p><li> Create an OU for the remote computer(s) and add the desired machine account(s) to the OU.</li></p>

<p><li> Using Active Directory Users and Computers, as in the &quot;<a href="ch13c.htm#894">To set an audit policy for a domain controller</a>&quot; procedure described earlier, create an audit policy to enable security auditing.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
Security auditing for workstations, member servers, and domain controllers can be enabled remotely only by domain and enterprise administrators.</blockquote></div>
</p>

<A NAME="710"><h2>Auditing Access to Files and Folders</h2></A>
<p>If security breaches are an issue for your organization, you can set up auditing for files and folders on NTFS partitions. To audit user access to files and folders, you must first set the Audit Object Access event category, which includes files and folders, in the audit policy.</p>

<p>Once you have set Audit Object Access in your audit policy, you enable auditing for specific files and folders and specify which types of access, by which users or groups, to audit.</p>

<p><li> <b>To set up auditing for specific files and folders</b></li></p>

<ol>
<p><li> In Windows Explorer, right-click the file or folder you want to audit, then click Properties.</li></p>

<p><li> In the Security tab in the Properties dialog box for a file or folder, click Advanced.</li></p>

<p><li> In the Access Control Settings For dialog box for the file or folder, in the Auditing tab, click Add, select the users and groups for whom you want to audit file and folder access, then click OK.</li></p>

<p><li> In the Auditing Entry For dialog box for the file or folder (see Figure 13.5), select the Successful check box, the Failed check box, or both check boxes for the events that you want to audit.</li></p>

<p>
<img src="images/13wtk04.JPG" width=367 height=468>
</p><p>
<!-- caption --><b>Figure 13.5</b> <i>The Auditing Entry For dialog box for the Command Prompt file</i><!-- /caption -->
</p>


<p>Table 13.2 describes the events that can be audited for files and folders and explains what action triggers the event to occur.</p>

<p><b>Table 13.2</b> <i>User Events and What Triggers Them</i></p>

<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th>Event</th>
<th>User Activity that Triggers the Event</th>
</tr>
<tr>
<td valign="top">Traverse Folder/Execute File</td>
<td valign="top">Moving through folders to reach other files or folders, 
 even if the user has no permissions to for traversed folders (folders only) or running program files (files only)</td>
</tr>
<tr>
<td valign="top">List Folder/Read Data</td>
<td valign="top">Viewing filenames and subfolder names within a 
 folder (folders only) or viewing data in files (files only)</td>
</tr>
<tr>
<td valign="top">Read Attributes and Read Extended Attributes</td>
<td valign="top">Displaying the attributes of a file or folder </td>
</tr>
<tr>
<td valign="top">Create Files/Write Data</td>
<td valign="top">Creating files within a folder (folders only) or 
 changing the contents of a file (files only)</td>
</tr>
<tr>
<td valign="top">Create Folders/Append Data</td>
<td valign="top">Creating folders within a folder (folders only) or 
 making changes to the end of the file but not changing, 
 deleting, or overwriting existing data (files only)</td>
</tr>
<tr>
<td valign="top">Write Attributes and Write Extended Attributes</td>
<td valign="top">Changing attributes of a file or folder </td>
</tr>
<tr>
<td valign="top">Delete Subfolders And Files</td>
<td valign="top">Deleting a file or subfolder in a folder</td>
</tr>
<tr>
<td valign="top">Delete</td>
<td valign="top">Deleting a file or folder</td>
</tr>
<tr>
<td valign="top">Read Permissions</td>
<td valign="top">Viewing permissions or the file owner for a file or folder</td>
</tr>
<tr>
<td valign="top">Change Permissions</td>
<td valign="top">Changing permissions for a file or folder</td>
</tr>
<tr>
<td valign="top">Take Ownership</td>
<td valign="top">Taking ownership of a file or folder</td>
</tr>
</table>
</p>

<p><li> In the Apply Onto list (available only for folders), specify where objects are audited. By default, this box is set to This Folder, Subfolders and Files, so any auditing changes that you make to a parent folder also apply to all child folders and all files in the parent and child folders. Where objects are audited depends on the selection in the Apply Onto list and whether the Apply These Auditing Entries To Objects And/Or Containers Within This Container Only check box is selected as shown in Table 13.3.</li></p>

<p><b>Table 13.3</b> <i>Results When the Apply These Auditing Entries To Objects And/Or Containers Within This Container Only Check Box Is Cleared</i></p>

<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th>Apply Onto</th>
<th>Audits Current Folder</th>
<th>Audits Sub-folders in the Current Folder</th>
<th>Audits Files in the Current Folder</th>
<th>Audits All Subsequent Folders</th>
<th>Audits Files in all Subsequent Subfolders</th>
</tr>
<tr>
<td valign="top">This folder only</td>
<td valign="top">X</td>
<td valign="top"></td>
<td valign="top"></td>
<td valign="top"></td>
<td valign="top"></td>
</tr>
<tr>
<td valign="top">This folder, subfolders, and files</td>
<td valign="top">X</td>
<td valign="top">X</td>
<td valign="top">X</td>
<td valign="top">X</td>
<td valign="top">X</td>
</tr>
<tr>
<td valign="top">This folder and subfolders</td>
<td valign="top">X</td>
<td valign="top">X</td>
<td valign="top"></td>
<td valign="top">X</td>
<td valign="top"></td>
</tr>
<tr>
<td valign="top">This folder and files </td>
<td valign="top">X</td>
<td valign="top"></td>
<td valign="top">X</td>
<td valign="top"></td>
<td valign="top">X</td>
</tr>
<tr>
<td valign="top">Subfolders and files only </td>
<td valign="top"></td>
<td valign="top">X</td>
<td valign="top">X</td>
<td valign="top">X</td>
<td valign="top">X</td>
</tr>
<tr>
<td valign="top">Subfolders only</td>
<td valign="top"></td>
<td valign="top">X</td>
<td valign="top"></td>
<td valign="top">X</td>
<td valign="top"></td>
</tr>
<tr>
<td valign="top">Files only</td>
<td valign="top"></td>
<td valign="top"></td>
<td valign="top">X</td>
<td valign="top"></td>
<td valign="top">X</td>
</tr>
</table>
</p>

<p>When the Apply These Auditing Entries To Objects And/Or Containers Within This Container Only check box is selected, auditing is applied to the selection in the Apply Onto box and all applicable child objects within the tree.</p>

<p><li> Click OK to return to the Access Control Settings For dialog box for the file or folder.</li></p>

<p><li> To prevent changes that are made to a parent folder from applying to the currently selected file or folder, clear the Allow Inheritable Auditing Entries From Parent To Propagate To This Object check box.</li></p>

<p>If the check boxes under Access are shaded in the Auditing Entry For dialog box for the file or folder, or if the Remove button is unavailable in the Access Control Settings For dialog box for the file or folder, then auditing has been inherited from the parent folder.</p>

<p><li> Click OK.</li></p>
</ol>

<A NAME="711"><h2>Auditing Access to Active Directory Objects</h2></A>
<p>Similar to auditing file and folder access, to audit Active Directory object access, you have to configure an audit policy and then set auditing for specific objects, such as users, computers, OUs, or groups, by specifying which types of access and access by which users to audit. You audit Active Directory objects to track access to Active Directory objects, such as changing the properties on a user 
account. To enable auditing of user access to Active Directory objects, set the 
Audit Directory Service Access event category in the audit policy.</p>

<p><li> <b>To set up auditing for specific Active Directory objects</b></li></p>

<ol>
<p><li> In Active Directory Users and Computers, click View, then click Advanced Features.</li></p>

<p><li> Select the object that you want to audit, click Properties on the Action menu, click the Security tab, then click the Advanced button.</li></p>

<p><li> In the Access Control Settings For dialog box for the object, in the Auditing tab, click Add, select the users or groups for whom you want to audit file and folder access, then click OK.</li></p>

<p><li> In the Auditing Entry For dialog box for the object (see Figure 13.6), select the Successful check box, the Failed check box, or both check boxes for the events that you want to audit.</li></p>

<p>Table 13.4 describes some of the audit events for Active Directory objects and explains what action triggers the event to occur.</p>

<p><b>Table 13.4</b> <i>Some Active Directory Object Events and What Triggers Them</i></p>

<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th>Event</th>
<th>User Activity that Triggers the Event</th>
</tr>
<tr>
<td valign="top">Full Control</td>
<td valign="top">Performing any type of access to the audited object</td>
</tr>
<tr>
<td valign="top">List Contents</td>
<td valign="top">Viewing the objects within the audited object</td>
</tr>
<tr>
<td valign="top">Read All Properties</td>
<td valign="top">Viewing any attribute of the audited object</td>
</tr>
<tr>
<td valign="top">Write All Properties</td>
<td valign="top">Changing any attribute of the audited object</td>
</tr>
<tr>
<td valign="top">Create All Child Objects</td>
<td valign="top">Creating any object within the audited object</td>
</tr>
<tr>
<td valign="top">Delete All Child Objects</td>
<td valign="top">Deleting any object within the audited object</td>
</tr>
<tr>
<td valign="top">Read Permissions</td>
<td valign="top">Viewing the permissions for the audited object</td>
</tr>
<tr>
<td valign="top">Modify Permissions</td>
<td valign="top">Changing the permissions for the audited object</td>
</tr>
<tr>
<td valign="top">Modify Owner</td>
<td valign="top">Taking ownership of the audited object</td>
</tr>
</table>
</p>

<p>
<img src="images/13wtk05.JPG" width=367 height=468>
</p><p>
<!-- caption --><b>Figure 13.6</b> <i>The Auditing Entry For dialog box for the Computers folder</i><!-- /caption -->
</p>


<p><li> In the Apply Onto list, specify where objects are audited. By default, this box is set to This Object And All Child Objects, so any auditing changes that you make to a parent object also apply to all child objects. Where objects are audited depends on the selection in the Apply Onto list and whether the Apply These Auditing Entries To Objects And/Or Containers Within This Container Only check box is selected. These two features are only enabled for objects that act as containers.</li></p>

<p><li> Click OK to return to the Access Control Settings For dialog box for the object.</li></p>

<p><li> To prevent changes that are made to a parent folder from applying to the currently selected file or folder, clear the Allow Inheritable Auditing Entries From Parent To Propagate To This Object check box.</li></p>

<p>If the check boxes under Access are shaded in the Auditing Entry For dialog box for the object, or if the Remove button is unavailable in the Access 
Control Settings For dialog box for the object, then auditing has been 
inherited from the parent folder.</p>

<p><li> Click OK.</li></p>
</ol>

<A NAME="712"><h2>Auditing Access to Printers</h2></A>
<p>Audit access to printers to track access to sensitive printers. To audit access to printers, set the Audit Object Access event category in your audit policy, which includes printers. Then, enable auditing for specific printers and specify which types of access and access by which users to audit. After you select the printer, you use the same steps that you use to set up auditing on files and folders.</p>

<p><li> <b>To set up auditing on a printer</b></li></p>

<ol>
<p><li> Click Start, point to Settings, then click Printers.</li></p>

<p><li> In the Printers system folder, right-click the printer you want to audit, then click Properties.</li></p>

<p><li> In the Properties dialog box for the printer, click the Security tab, then click Advanced.</li></p>

<p><li> In the Access Control Settings For dialog box for the printer, in the Auditing tab, click Add, select the appropriate users or groups for whom you want to audit printer access, click Add, then click OK.</li></p>

<p><li> In the Auditing Entry For dialog box for the printer (see Figure 13.7), select the Successful check box, the Failed check box, or both check boxes for the events that you want to audit.</li></p>

<p>
<img src="images/13wtk06.JPG" width=367 height=468 border="0">
</p><p>
<!-- caption --><b>Figure 13.7</b> <i>The Auditing Entry For dialog box for a printer</i><!-- /caption -->
</p>


<p>Table 13.5 describes audit events for printers and explains what action 
triggers the event to occur.</p>

<p><b>Table 13.5</b> <i>Printer Events and What Triggers Them</i></p>
<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th>Event</th>
<th>User Activity that Triggers the Event</th>
</tr>
<tr>
<td valign="top">Print</td>
<td valign="top">Printing a file</td>
</tr>
<tr>
<td valign="top">Manage Printers</td>
<td valign="top">Changing printer settings, pausing a printer, sharing a 
 printer, or removing a printer</td>
</tr>
<tr>
<td valign="top">Manage Documents</td>
<td valign="top">Changing job settings; pausing, restarting, moving, or 
 deleting documents; sharing a printer; or changing 
 printer properties</td>
</tr>
<tr>
<td valign="top">Read Permissions</td>
<td valign="top">Viewing printer permissions</td>
</tr>
<tr>
<td valign="top">Change Permissions</td>
<td valign="top">Changing printer permissions</td>
</tr>
<tr>
<td valign="top">Take Ownership</td>
<td valign="top">Taking printer ownership</td>
</tr>
</table>
</p>

<p><li> In the Apply Onto list, select where the auditing setting applies.</li></p>

<p><li> Click OK in the appropriate dialog boxes to exit.</li></p>
</ol>

<A NAME="713"><h2>Auditing Practices</h2></A>
<p>Table 13.6 lists various events that you should audit, as well as the specific 
security threat that the audit event monitors.</p>

<p><b>Table 13.6</b> <i>Recommended Audit Events</i></p>
<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th>Audit Event</th>
<th>Potential Threat</th>
</tr>
<tr>
<td valign="top">Failure audit for logon/logoff.</td>
<td valign="top">Random password hack</td>
</tr>
<tr>
<td valign="top">Success audit for logon/logoff.</td>
<td valign="top">Stolen password break-in</td>
</tr>
<tr>
<td valign="top">Success audit for user rights, user and group management,  
security change policies, restart, shutdown, and system events.</td>
<td valign="top">Misuse of privileges</td>
</tr>
<tr>
<td valign="top">Success and failure audit for file-access and object-access  
events. File Manager success and failure audit of 
Read/Write access by suspect users or groups 
for the sensitive files.</td>
<td valign="top">Improper access to sensitive files</td>
</tr>
<tr>
<td valign="top">Success and failure audit for file-access printers and object- 
access events. Print Manager success and failure audit of  
print access by suspect users or groups for the printers.</td>
<td valign="top">Improper access to printers</td>
</tr>
<tr>
<td valign="top">Success and failure write access auditing for program files  
(.exe and .dll extensions). Success and failure auditing for 
process tracking. Run suspect programs; examine security 
log for unexpected attempts to modify program files or 
create unexpected processes. Run only when actively 
monitoring the system log.</td>
<td valign="top">Virus outbreak</td>
</tr>
</table>
</p>

<p><img src="images/practic.JPG" width=92 height=74 border="0"></p>

<A NAME="714"><h2>Practice: Auditing Resources and Events</h2></A>
<p>In this practice you plan a domain audit policy. Then you set up an audit policy for a domain controller by enabling auditing of certain events. You set up auditing of a file, a printer, and an Active Directory object.</p>

<A NAME="715"><h3>Exercise 1: Planning a Domain Audit Policy</h3></A>
<p>In this exercise you plan an audit policy for your server. You need to determine the following:</p>

<ul>
<p><li> Which types of events to audit</li></p>

<p><li> Whether to audit the success or failure of an event, or both</li></p>
</ul>

<p>Use the following criteria to make your decisions:</p>

<ul>
<p><li> Record unsuccessful attempts to gain access to the network.</li></p>

<p><li> Record unauthorized access to the files that make up the Customer database.</li></p>

<p><li> For billing purposes, track color printer usage.</li></p>

<p><li> Track whenever someone tries to tamper with the server hardware.</li></p>

<p><li> Keep a record of actions that an administrator performs to track unauthorized changes.</li></p>

<p><li> Track backup procedures to prevent data theft.</li></p>

<p><li> Track unauthorized access to sensitive Active Directory objects.</li></p>
</ul>

<p>Record your decisions to audit successful events, failed events, or both for the actions listed in Table 13.7.</p>

<p><b>Table 13.7</b> <i>Audit Policy Plan for Exercise 1</i></p>
<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th>Action to Audit</th>
<th>Successful</th>
<th>Failed</th>
</tr>
<tr>
<td valign="top">Account logon events</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Account management</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Directory service access</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Logon events</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Object access</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Policy change</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Privilege use</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Process tracking</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">System events</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
</table>
</p>

<p><a href="chaaa.htm#1040">Answers</a></p>

<A NAME="716"><h3>Exercise 2: Setting Up an Audit Policy</h3></A>
<p>In this exercise you enable auditing for selected event categories.</p>

<p><li> <b>To set up an audit policy</b></li></p>

<ol>
<p><li> Open Active Directory Users and Computers.</li></p>

<p><li> In the console tree, right-click Domain Controllers, then click Properties.</li></p>

<p><li> In the Properties dialog box, in the Group Policy tab, select the Default Domain Controllers Policy group policy, then click Edit.</li></p>

<p><li> In the Group Policy snap-in, in the console tree, click Computer Configuration, double-click Windows Settings, double-click Security Settings, double-click Local Policies, then double-click Audit Policy.</li></p>

<p><li> To set the audit policy, in the details pane, double-click each event category, then select either Success or Failure as listed in Table 13.8.</li></p>

<p><b>Table 13.8</b> <i>Audit Policy Settings for Exercise 2</i></p>
<p>
<table valign="top" cellpadding="5" width="95%">
<tr>
<th>Event Category</th>
<th>Success</th>
<th>Failure</th>
</tr>
<tr>
<td valign="top">Account logon events</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Account management</td>
<td valign="top">X</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Directory service access</td>
<td valign="top">&nbsp;</td>
<td valign="top">X</td>
</tr>
<tr>
<td valign="top">Logon events</td>
<td valign="top">&nbsp;</td>
<td valign="top">X</td>
</tr>
<tr>
<td valign="top">Object access</td>
<td valign="top">X</td>
<td valign="top">X</td>
</tr>
<tr>
<td valign="top">Policy change</td>
<td valign="top">X</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Privilege use</td>
<td valign="top">X</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">Process tracking</td>
<td valign="top">&nbsp;</td>
<td valign="top">&nbsp;</td>
</tr>
<tr>
<td valign="top">System events</td>
<td valign="top">X</td>
<td valign="top">X</td>
</tr>
</table>
</p>

<p><li> Close the Group Policy snap-in.</li></p>

<p><li> Close the Domain Controllers Properties dialog box.</li></p>

<p><li> Start a command prompt.</li></p>

<p><li> At the command prompt, type <b>secedit /refreshpolicy machine_policy</b>, then press Enter.</li></p>

<p>The policy changes take effect in a few moments.</p>

<p><li> Close the command prompt.</li></p>
</ol>

<A NAME="717"><h3>Exercise 3: Setting Up Auditing of Files</h3></A>
<p>In this exercise you set up auditing for a file.</p>

<p><li> <b>To set up auditing of files</b></li></p>

<ol>
<p><li> In Windows Explorer, locate a file such as a simple text file.</li></p>

<p><li> Right-click the filename, then click Properties.</li></p>

<p><li> In the Properties dialog box, click the Security tab, then click Advanced.</li></p>

<p><li> In the Access Control Settings For dialog box for the text file, click the Auditing tab.</li></p>

<p><li> Click Add.</li></p>

<p><li> In the Select User, Computer, Or Group dialog box, double-click Everyone in the list of user accounts and groups.</li></p>

<p><li> In the Auditing Entry For dialog box for the text file, select the Successful check box and the Failed check box for each of the following events:</li></p>

	<ul>
	<p><li> Create Files/Write Data</li></p>
	
	<p><li> Delete</li></p>
	
	<p><li> Change Permissions</li></p>
	
	<p><li> Take Ownership</li></p>
	</ul>

<p><li> Click OK.</li></p>

<p>Windows 2000 displays the Everyone group in the Access Control Settings For dialog box for the text file.</p>

<p><li> Click OK to apply your changes.</li></p>
</ol>

<p><li> <b>To change file permissions</b></li></p>

<ol>
<p><li> In the Properties dialog box, on the Security tab, add the Everyone group.</li></p>

<p><li> Change the NTFS permissions for the Everyone group to only the Read permission for the file, and clear the Allow Inheritable Permissions From Parent To Propagate To This Object check box.</li></p>

<p>The Security message box appears asking you to confirm that you want to clear the Allow Inheritable Permissions From Parent To Propagate To This Object check box.</p>

<p><li> On the Security message box, click Remove, then click OK.</li></p>

<p>Any other permissions are removed.</p>

<p><li> Click OK to close the Properties dialog box, then close Windows Explorer.</li></p>
</ol>

<A NAME="718"><h3>Exercise 4: Setting Up Auditing of a Printer</h3></A>
<p>In this exercise you set up auditing of a printer.</p>

<p>
<div class="warning"><blockquote><b>IMPORTANT</b><hr>
As in <A HREF="ch11a.htm">Chapter 11</A>, you need to have a local printer installed on your computer. However, you do <i>not</i> need a printing device connected to the computer. If you do not have a local printer installed, create one now. Remember that <i>printing device</i> refers to the physical machine that prints and that <i>local printer</i> refers to the software that Windows 2000 needs to send data to the printing device.</blockquote></div>
</p>

<p><li> <b>To set up auditing of a printer</b></li></p>

<ol>
<p><li> Click Start, point to Settings, then click Printers.</li></p>

<p><li> In the Printers system folder, right-click a printer associated with your computer, then click Properties.</li></p>

<p><li> Click the Security tab, then click Advanced.</li></p>

<p><li> In the Access Control Settings For dialog box for the printer, click the Auditing tab, then click Add.</li></p>

<p><li> In the Select User, Computer, Or Group dialog box, double-click Everyone in the list box.</li></p>

<p><li> In the Auditing Entry For dialog box for the printer, select the Successful check box for all types of access.</li></p>

<p><li> Click OK.</li></p>

<p>Windows 2000 displays the Everyone group in the Access Control Settings For dialog box for the printer.</p>

<p><li> In the Access Control Settings For dialog box for the printer, click OK to apply your changes.</li></p>

<p><li> Click OK to close the printer Properties dialog box.</li></p>

<p><li> Close the Printers system folder.</li></p>
</ol>

<A NAME="719"><h3>Exercise 5: Setting Up Auditing of an Active Directory Object</h3></A>
<p>In this exercise you set up auditing of an Active Directory object.</p>

<p><li> <b>To review auditing of an Active Directory object</b></li></p>

<ol>
<p><li> Start Active Directory Users and Computers.</li></p>

<p><li> On the View menu, click Advanced Features.</li></p>

<p><li> In the console tree, click your domain.</li></p>

<p><li> In the details pane, click Users, and then on the Action menu, click Properties.</li></p>

<p><li> In the Users Properties dialog box, click the Security tab, then click Advanced.</li></p>

<p><li> In the Access Control Settings For Users dialog box, click the Auditing tab, then double-click Everyone.</li></p>

<p>The Auditing Entry For Users dialog box appears.</p>

<p>Review the default audit settings for object access by members of the Everyone group. How do the audited types of access differ from the types of access that are not audited?</p>

<p><li> Click OK three times to close the Auditing Entry For Users, the Access Control Settings For Users, and the Users Properties dialog boxes.</li></p>

<p>At which computer or computers does Windows 2000 record log entries for Active Directory access? Will you be able to review them?</p>

<p><li> Close Active Directory Users and Computers.</li></p>
</ol>

<p><a href="chaaa.htm#1113">Answers</a></p>

<A NAME="720"><h2>Lesson Summary</h2></A>
<p>In this lesson you learned how to set up an audit policy. The first step in implementing an audit policy is selecting the event categories that Windows 2000 
audits. For each event that you can audit, the configuration settings indicate whether to track successful or failed attempts.</p>

<p>For member or stand-alone servers, or computers running Windows 2000 Professional, an audit policy is set for each individual computer. To audit events that occur on a local computer, you configure a local group policy for that computer, which applies to that computer only.</p>

<p>For domain controllers, an audit policy is set for all domain controllers in the 
domain. To audit events that occur on domain controllers, you configure a nonlocal group policy for the domain, which applies to all domain controllers.</p>

<p>In the practice portion of this lesson you planned a domain audit policy, set up an audit policy for a domain controller, and set up auditing of a file, a printer, and an Active Directory object.</p>

</BODY>
</HTML>







