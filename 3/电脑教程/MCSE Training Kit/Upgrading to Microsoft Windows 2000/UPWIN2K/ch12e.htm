<HTML>
<HEAD>
<TITLE>Lesson 4: Using the Backup Utility</TITLE>
<link rel="STYLESHEET" type="text/css" href="upwin2k.css">

<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</head>
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch12d.htm", "ch12f.htm", "images/unit_p_a1.gif", "images/unit_p_a2.gif", "images/unit_p_b1.gif", "images/unit_p_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#aa22aa", "2");
//--></SCRIPT><P>

<A NAME="579"><H1>Lesson 4: Using the Backup Utility</H1></A>

<p>Windows 2000 includes an enhanced, graphical backup utility that is
designed to help you protect data from accidental loss as a result of hardware
or storage media failure. You can use the Backup utility to do the
following:</p>

<ul>
<p><li>Back up files and folders</li></p>

<p><li>Back up system state data</li></p>

<p><li>Schedule a backup</li></p>

<p><li>Restore files and folders</li></p>

<p><li>Restore Active Directory directory services</li></p>
</ul>


<p>
<div class="note"><blockquote><b>NOTE</b><hr>
You can also use the Backup utility to create an
Emergency Repair Disk.
</blockquote></div>
</p>

<p>The Backup utility supports a variety of storage devices and media,
including tape drives, logical drives, removable disks, and recordable
CDROM drives. In addition, the Backup utility includes wizards that are designed to
make using the utility easier and more efficient. Effective use of the
Backup utility can help ensure a quick system recovery in the event of
a failure.</p>

<p>
<div class="sidebar"><blockquote>
<p><b>After this lesson, you will be able to</b></p>

<ul>
<p><li>Back up files and folders.</li></p>

<p><li>Back up the system state data.</li></p>

<p><li>Restore files and folders.</li></p>

<p><li>Restore Active Directory directory services.</li></p>
</ul>


<p><b>Estimated lesson time: 40 minutes</b></p>
</blockquote></div>
</p>

<A NAME="580"><H2>Backing Up Files and Folders</H2></A>

<p>You can use the Backup utility to archive files and folders on
volumes that are formatted with either file allocation table (FAT) or
NTFS. The Backup utility includes a Backup wizard, which steps you through the entire backup
process. However, you can also create a backup job without using the
wizard. To access the Backup utility, click Start, point to Programs,
point to Accessories, point to System Tools, and click Backup. The
Backup window appears, as shown in Figure 12.1. To begin the backup process, click the Backup tab (see
Figure 12.2) and then select the drives, folders, or files you want to
back up. Then click the Start Backup button.</p>

<p>
<A HREF="javascript:fullSize('F12UP01x.htm')"> <img src="images/F12UP01.JPG" width=404 height=302 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 12.1</b> <i>The Backup window's Welcome tab</i><!--/caption-->
</p>


<p>
<A HREF="javascript:fullSize('F12UP02x.htm')"> <img src="images/F12UP02.JPG" width=404 height=302 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 12.2</b> <i>Select the data to be backed up on the Backup tab.</i><!--/caption-->
</p>


<A NAME="581"><H2>Backing Up System State Data</H2></A>

<p>You can use the Backup utility in Windows 2000 to back up the system
state data, which includes the following system components:</p>

<ul>
<p><li><b>Registry:</b> A database repository for information about
a computer's configuration. It contains information such as user
profiles, the programs installed on the computer and the types of
documents each can create, property settings for folders and program
icons, what hardware exists on the system, and which ports are in
use.</li></p>

<p><li><b>Component Services Class Registration database:</b> A
database that stores class registrations.</li></p>

<p><li><b>System startup files:</b> Ntldr and Ntdetect.com for
Intel-based systems and Osloader.exe for Digital-alpha-based
systems.</li></p>

<p><li><b>Certificate Services database:</b> A database that stores
the issued certificates. A certificate is a file used for
authentication and secure exchange of data on nonsecured networks, such
as the Internet.</li></p>

<p><li><b>Active Directory directory services:</b> The directory
that stores information about network resources, as well as all the
services that make the information available and useful. The resources
stored in the directory&#8212;such as user data, printers, servers,
databases, groups, computers, and security policies&#8212;are known as
objects.</li></p>

<p><li><b>Sysvol folder:</b> The shared system volume, which is a
folder structure that exists on all Windows 2000 domain controllers. It stores scripts
and some of the group policy objects for both the current domain as
well as the enterprise. The default location for the shared system
volume is <i>systemroot</i>\Sysvol.</li></p>
</ul>


<p>On computers running Windows 2000 Professional, the system state
includes the registry, the Component Services Class Registration database, and
system startup files.</p>

<p>On computers running Windows 2000 Server operating systems, the
system state includes the registry, the Component Services Class
Registration database, and system startup files, and if the computer is
also a certificate server, the system state also includes the
Certificate Services database.</p>

<p>On computers running Windows 2000 Server operating systems that are
installed as domain controllers, the system state includes the
registry, the Component Services Class Registration database, system
startup files, the Certificate Services database, Active Directory
directory services, and the Sysvol folder.</p>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
You cannot back up individual components of the
system state data.
</blockquote></div>
</p>

<p>You can back up the system state data on a local computer in one of
the following three ways:</p>

<ul>
<p><li>In the Backup wizard, on the What To Back Up page, click
Only Back Up The System State Data.</li></p>

<p><li>In the Backup wizard, on the Items To Back Up page, expand
My Computer, and then select the check box to the left of System
State.</li></p>

<p><li>In the Backup utility, on the Backup tab, expand My
Computer, and then select the System State check box.</li></p>
</ul>


<A NAME="582"><H2>Scheduling a Backup</H2></A>

<p>Windows 2000 integrates the Backup utility with the Task Scheduler
service. As a result, you can use the Backup utility to schedule a
backup. You can schedule a backup to occur at regular intervals or
during periods of relative inactivity on a network (see Figure
12.3).</p>

<p>
<A HREF="javascript:fullSize('F12UP03x.htm')"> <img src="images/F12UP03.JPG" width=404 height=301 border=0 ALT = "Click to view at full size."> </A>
</p><p>
<!--caption--><b>Figure 12.3</b> <i>A backup scheduled for a weekly interval</i><!--/caption-->
</p>


<p>To schedule a backup, you can use the Backup wizard and click
Advanced, or you can follow the procedure identified to back up files
and folders. When the Backup Job Information dialog box appears, you
would click Schedule and then do the following:</p>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
If the Backup dialog box appears, indicating
that you must save the backup selections before you can schedule a
backup, click Yes, specify the appropriate information in the Save
Selections dialog box, and then click Save.
</blockquote></div>
</p>

<ol>
<p><li>In the Set Account Information dialog box, specify the user name
and password of the account under whose security context you want the
scheduled backup to run. You must specify an account that has been
granted the Back Up Files And Directories privilege.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
The Set Account Information dialog box will not
appear if Task Scheduler is already running.
</blockquote></div>
</p>

<ol>
<p><li value="2">In the Scheduled Job Options dialog box, specify a job name, and
then click Properties.</li></p>

<p><li>In the Schedule Job dialog box, specify the date, time, and
frequency parameters for the scheduled backup. Then close the Scheduled
Job Options dialog box.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
You can view scheduled jobs on the Schedule Jobs
tab in the Backup utility.
</blockquote></div>
</p>

<A NAME="583"><H2>Restoring Files and Folders</H2></A>

<p>You can use the Backup utility in Windows 2000 to restore files and
folders. The Backup utility includes a Restore wizard that steps you through the
entire restore process. However, you can also restore files and folders
without using the wizard.</p>

<p>To restore files and folders without using the wizard, open the
Backup utility, and then specify the following:</p>

<ul>
<p><li>The folders or files to restore.</li></p>

<p><li>A restore location. You can restore files to the original
location, an alternate location, or to a single folder.</li></p>

<p><li>Restore options, such as whether to replace existing files
with backup files.</li></p>
</ul>

<p><div class="caution"><blockquote><b>CAUTION</b><HR>
To avoid data loss and to preserve all file and folder
features, you should restore data that is archived from a Windows 2000
NTFS volume to another Windows 2000 NTFS volume. Restoring the data to
a FAT volume or to a Windows NT 4.0 NTFS volume might result in the loss of access
permissions, Encrypting File System (EFS) settings, disk quota
information, mounted drive information, or Remote Storage
information.</BLOCKQUOTE></DIV></P>

<A NAME="584">		<H2>Restoring Active Directory Directory Services</H2></A>

<p>You can use the Backup utility to restore Active Directory directory
services during the process of replacing a failed domain controller, to repair a
damaged Active Directory database, or to recover one or more objects
that are accidentally deleted from Active Directory directory
services.</p>

<A NAME="585"><H3>Failed Domain Controllers</H3></A>

<p>If a domain controller fails completely, you must first restart the
computer and make sure Windows 2000 is running. Then you can use the
Backup utility to restore the latest version of the system state data, which includes
Active Directory directory services.</p>

<p>After you have restored Active Directory directory services, Windows
2000 automatically does the following:</p>

<ul>
<p><li>Performs a consistency check on and reindexes the Active
Directory database.</li></p>

<p><li>Updates Active Directory directory services and the File
Replication Service with data from their replication partners.</li></p>
</ul>


<A NAME="586"><H3>Damaged Active Directory Databases</H3></A>

<p>If the operating system on a domain controller is functioning
normally, but the Active Directory database is damaged, you must
restart the computer, select the Directory Services Restore Mode
advanced startup option, and then use the Backup utility to restore the
latest system state data.</p>

<p>After you have restored the Active Directory database, restart the
computer, and Windows 2000 will reindex the Active Directory database
and update Active Directory directory services and the File Replication Service.</p>

<A NAME="587"><H3>Authoritative Restores</H3></A>

<p>Restoring deleted objects in a distributed environment presents a
challenge. If you restore the most recent copy of the Active Directory
database that contains the deleted objects, those objects will be
deleted when replication occurs because the objects are marked for
deletion in the replicas of the database.</p>

<p>To prevent this from occurring, you can perform an authoritative
restore. When you restore an object authoritatively, it persists after
replication even though it is marked for deletion in the replicas of
the database.</p>

<p>To perform an authoritative restore, you would do the following:</p>

<ol>
<p><li>Restart the computer, press F8, and select the Directory
Services Restore Mode from the Windows 2000 Advanced Options menu.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
If your system is set up for dual booting and
you are prompted to select an operating system, select it and press
Enter.
</blockquote></div>
</p>

<ol>
<p><li value="2">Restore the system state data from the most recent backup that
contains the objects that you want to recover.</li></p>

<p><li>When the restore is complete, run Ntdsutil.exe.</li></p>

<p><li>Type <b>authoritative restore</b> at the command prompt.</li></p>

<p><li>Type <b>restore subtree distinguished_name_of_object</b> at the
authoritative restore prompt.</li></p>

<p>For example, if you are the administrator of a domain called
domain.com and you want to restore an organizational unit (OU) called
Sales, which existed directly below the domain, you would type</p>

<p><b>restore subtree OU=Sales,DC=domain,DC=com</b></p>


<p><li>Exit Ntdsutil by typing <b>quit</b> at the prompt, and then
restart the computer.</li></p>
</ol>

<p>The restored object is marked as authoritative and will be
replicated to all domain controllers in the domain.</p>

<p><img src="images/practic.JPG" width=68 height=54 border="0"></p>

<A NAME="588"><H2>Practice: Using the Backup Utility to Restore Active Directory Directory Services</H2></A>

<p>In this practice, you will back up the system state using Windows
2000 Backup. You will delete an OU and then perform an authoritative
restore.</p>

<A NAME="589"><H3>Exercise 1: Backing Up the System State Data</H3></A>

<p>In this exercise, you will backup the system state using Windows
2000 Backup. You will then delete an OU.</p>


<p><li><b>To back up the system data</b></li></p>
<ol>
<p><li>On the Start menu, point to Programs, point to Accessories,
point to System Tools, and then click Backup.</li></p>

<p><li>Click the Backup Wizard button on the Welcome tab.</li></p>

<p>The Backup wizard starts.</p>

<p><li>Click Next.</li></p>

<p><li>On the What To Back Up page, click Only Backup The System State
Data, and then click Next.</li></p>

<p><li>On the Where To Store The Backup page, type <b>C:\SysState</b>
in the Backup Media Or File Name box, and then click Next.</li></p>

<p><li>On the Completing The Backup Wizard page, click the Advanced
button.</li></p>

<p><li>On the Type Of Backup page, click Next.</li></p>

<p><li>On the How To Back Up page, click Next.</li></p>

<p><li>On the Media Options page, click Next.</li></p>

<p><li>On the Backup Label page, type <b>Practice</b> in both the
Backup Label and Media Label boxes, and then click Next.</li></p>

<p><li>On the When To Back Up page, click Next.</li></p>

<p><li>On the Completing The Backup Wizard page, click Finish.</li></p>

<p>Backup begins backing up the system state data.</p>

<p><li>When the backup is complete, click Close in the Backup Program
dialog box, and then close Backup.</li></p>
</ol>

<A NAME="590"><H3>Exercise 2: Deleting an OU</H3></A>

<p>In this exercise, you will delete the Production OU.</p>


<p><li><b>To delete an OU</b></li></p>
<ol>
<p><li>Open Active Directory Users and Computers.</li></p>

<p><li>Expand domain.com.</li></p>

<p><li>Delete the Production OU. Click the Yes button to confirm the
deletion.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
If a message box appears to warn you about the
presence of objects within the Production container, click Yes to
confirm the deletion.
</blockquote></div>
</p>

<ol>
<p><li value="4">Close Active Directory Users and Computers.</li></p>
</ol>

<A NAME="591"><H3>Exercise 3: Performing an Authoritative Restore of Active Directory Directory Services</H3></A>

<p>In this exercise, you will perform an authoritative restore of the
Active Directory directory services and recover the Production OU.</p>

<p><li><b>To restore Active Directory directory services</b></li></p>
<ol>
<p><li>Restart the computer, and when the boot loader menu appears,
press F8.</li></p>

<p><li>Select Directory Services Restore Mode and press Enter.</li></p>

<p><li>Press Enter to select the Microsoft Windows 2000 Server
operating system.</li></p>

<p>The Welcome To Windows dialog box appears. This will take a few
minutes.</p>

<p><li>Log on as Administrator.</li></p>

<p>A Desktop dialog box appears informing you that you are in safe
mode.</p>
</ol>
<p>
<div class="note"><blockquote><b>NOTE</b><hr>
 As of the writing of this training kit, the
administrator's password may not be accepted. This is a limitation
in pre-release versions of the Windows 2000 Server software. If this
occurs when you attempt to log on in Safe mode, leave the password box
empty and press Enter.
</blockquote></div>
</p>

<ol>
<p><li value="5">Click OK.</li></p>

<p><li>Open Backup, and then click Restore Wizard on the Welcome
tab.</li></p>

<p><li>Click Next.</li></p>

<p><li>On the What To Restore page, expand File, expand Practice, and
then click the System State check box to select it.</li></p>

<p>There should be a check mark in the box indicating that System State
is selected.</p>

<p><li>Click Next.</li></p>

<p><li>On the Completing The Restore Wizard page, click Finish.</li></p>

<p><li>In the Enter Backup File Name dialog box, verify that
C:\SysState appears in the Restore From Backup File box, and then click
OK.</li></p>

<p>The Restore Progress dialog box appears. The restore process will
take a few minutes.</p>

<p><li>When the restore is complete, click Close.</li></p>

<p>The Backup dialog box appears, prompting you to restart the
computer.</p>

<p><li>Click No, and then close Backup.</li></p>
</ol>

<p>
<div class="note"><blockquote><b>NOTE</b><hr>
If you were to click Yes in step 13, you would
have done a non-authoritative restore. You clicked No, so that you can perform the
next procedure and make it an authoritative restore.
</blockquote></div>
</p>


<p><li><b>To make the restore authoritative</b></li></p>
<ol>
<p><li>Open a command prompt.</li></p>

<p><li>Type <b>ntdsutil</b> and then press Enter.</li></p>

<p><li>At the ntdsutil: prompt, type <b>authoritative restore</b> and
then press Enter.</li></p>

<p><li>Type <b>restore subtree OU=Production,DC=domain,DC=com</b> at
the authoritative restore: prompt, and then press Enter.</li></p>

<p>The Authoritative Restore Confirmation Dialog message box appears
asking if you are sure you want to perform this authoritative
restore.</p>

<p><li>Click Yes.</li></p>

<p>The ntdsutil utility begins to restore the OU. When the restore
process is complete, the authoritative restore prompt returns.</p>

<p><li>At the authoritative restore: prompt, type <b>quit</b> and then
press Enter.</li></p>

<p><li>At the ntdsutil: prompt, type <b>quit</b> and then press
Enter.</li></p>

<p><li>Type <b>exit</b> and press Enter to close the command prompt,
and then restart the computer.</li></p>
</ol>

<A NAME="592"><H3>Exercise 4: Verifying the Authoritative Restore</H3></A>

<p>In this exercise, you will verify the authoritative restore by
verifying that the Production OU was restored.</p>


<p><li><b>To verify the Production OU was restored</b></li></p>
<ol>
<p><li>Log on as Administrator.</li></p>

<p><li>Open Active Directory Users and Computers.</li></p>

<p><li>Expand domain.com.</li></p>

<p><li>Verify that the Production OU is listed.</li></p>

<p><li>Close Active Directory Users and Computers.</li></p>
</ol>

<A NAME="593"><H2>Lesson Summary</H2></A>

<p>Windows 2000 includes an enhanced, graphical backup utility that is
designed to help you protect data from accidental loss as a result of hardware
or storage media failure. You can use the Backup utility to back up
files and folders, back up system state data, schedule a backup,
restore files and folders, and restore Active Directory directory services.</p>

<p>The system state data that you back up depends on the operating
system running on the computer. On computers running Windows 2000
Professional, the system state data includes the registry, the
Component Services Class Registration database, and system startup
files. On computers running Windows 2000 Server operating systems, the
system state data includes the same files as does Windows 2000
Professional. If the computer is also a certificate server, the system
state data also includes the Certificate Services database. On
computers running Windows 2000 Server operating systems that are installed as domain
controllers, the system state includes the registry, the Component
Services Class Registration database, system startup files, the
Certificate Services database, Active Directory directory services, and
the Sysvol folder.</p>

<p>Windows 2000 integrates the Backup utility with the Task Scheduler
service. As a result, you can use the Backup utility to schedule a backup. You
can schedule a backup to occur at regular intervals or during periods
of relative inactivity on a network.</p>

<p>You use the Backup utility in Windows 2000 to restore files and
folders. The Backup utility includes a Restore wizard that steps you
through the entire restore process. You can also use the Backup utility
to restore Active Directory directory services. You can restore Active
Directory directory services during the process of replacing a failed
domain controller to repair a damaged Active Directory database, or to recover one or more objects that are accidentally
deleted from Active Directory directory services.</p>

</BODY>
</HTML>



