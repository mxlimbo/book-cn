<!DOCTYPE html SYSTEM "msxhtml1-strict.dtd">
<html lang="en" xml:lang="en">
<head>
<link rel="stylesheet" type="text/css" href="styles.css" />
<script type="text/javascript" language="JavaScript" src="expando.js"></script>
<title>Lesson 2: Configuring a Routing and Remote Access Server</title>


</head>
<body>
<div class="prevnext"><p><a href="ch12a.htm">3</a> <a href="ch12c.htm">4</a></p></div>

<h1><a name="911">Lesson 2: Configuring a Routing and Remote Access Server</a></h1>


<p>Once Routing and Remote Access is installed, you can configure it for inbound connections, lock it down with Remote Access Policies (RAPs), add remote access profiles for security, and control access with Bandwidth Allocation Protocol (BAP). In this lesson, you explore these configurable options.</p>

<hr />
<p><b>After this lesson, you will be able to</b></p>
<ul>
<li>Explain how to allow inbound connections</li>
<li>Create a RAP</li>
<li>Describe how to configure a remote access profile</li>
<li>Describe how to configure BAP</li>
</ul>
<p><b>Estimated lesson time: 45 minutes</b></p>
<hr />

<h2><a name="912">Allowing Inbound Connections</a></h2>


<p>When Routing and Remote Access is started for the first time, Windows 2000 automatically creates five PPTP and five L2TP ports, as illustrated in Figure 12.3. The number of VPN ports that are available to any remote access server is not limited by the hardware and can be configured. You can configure VPN ports under Ports in the console tree of Routing and Remote Access.</p>

<div class="figure">
<a href="javascript:fullSize('F12cc03x.htm')"><img src="images/F12cc03.JPG" /></a>
<div class="caption"><b>Figure 12.3</b> <i>Routing and Remote Access ports</i>
</div>
</div>


<h2><a name="913">Creating a Remote Access Policy (RAP)</a></h2>


<p>You can also add a parallel port by configuring Ports. Serial communication ports shows up only after a modem is installed for the Routing and Remote Access computer. Both types of ports can be configured for inbound and outbound connections.</p>

<p>RAPs are a named set of conditions, as illustrated in Figure 12.4, that are used to define who has remote access to the network and what the characteristics of that connection will be. Conditions for accepting or rejecting connections can be based on many different criteria, such as day and time, group membership, type of service, and so forth. Characteristics of the connection could be configured, for example, as an ISDN connection that can last only 30 minutes and that will not allow Hypertext Transfer Protocol (HTTP) packets.</p>

<blockquote><div class="note"><b>NOTE</b><hr />
RAPs are shared between routing and remote access and IAS. They can be configured from either tool.</div></blockquote>

<div class="figure">
<a href="javascript:fullSize('F12cc04x.htm')"><img src="images/F12cc04.JPG" /></a>
<div class="caption"><b>Figure 12.4</b> <i>Routing and Remote Access policies</i>
</div>
</div>


<p>RAPs can be created, deleted, renamed, and reordered from the IAS administration tool or the Routing and Remote Access Manager. Note that there is no Save option, so it is not possible to save a copy to floppy disk. The order of policies is significant because the first matching policy will be used to accept or reject the connection.</p>

<blockquote><div class="note"><b>NOTE</b><hr />
Remote Access Policies are not stored in Active Directory; they are stored locally in the IAS.MDB file. Policies need to be created manually on each server. Remote Access Policies are applied to users in a Mixed-mode domain, even though the user's dial-in permission can only be set to Allow Access or Deny Access, as illustrated in Figure 12.5 (Control Access Through Remote Access Policy is not available on Mixed-mode domain controllers). If the user's permission is Allow Access, the user still must meet the conditions set forth in a policy before being allowed to connect.</div></blockquote>

<div class="figure">
<img src="images/F12cc05.JPG" />
<div class="caption"><b>Figure 12.5</b> <i>Configuring Remote Access policies</i></div></div>


<h3><a name="914">Conditions</a></h3>


<p>Conditions can be added to a RAP in order for the system to grant or deny remote access permission. This works in conjunction with the dial-in permission associated with the user to determine whether the user is given access. The flowchart in Figure 12.6 shows the logic used to decide whether the connection request is granted or denied.</p>

<blockquote><div class="note"><b>NOTE</b><hr />
If no Remote Access Policy exists (if the default policy is deleted, for example), users will not be able to access the network, regardless of their individual Routing and Remote Access permission settings.</div></blockquote>

<p>By using this flowchart, one can predict the outcome of a connection request for any situation. For example, a user's dial-in property is set to Control Access Through Remote Access Policy and the RAP is the default Allow Access If Dial-In Permission Is Enabled (the policy is to deny access, and the condition is to permit any day, any time). By following the flowchart, it can be seen that the user connection attempt will be rejected.</p>

<div class="figure">
<a href="javascript:fullSize('F12cc06x.htm')"><img src="images/F12cc06.JPG" /></a>
<div class="caption"><b>Figure 12.6</b> <i>Flowchart of Remote Access Policy</i>
</div>
</div>


<p>However, if the user's dial-in property (illustrated in Figure 12.7) is set to Allow Access and the default policy mentioned earlier is used, the user connection attempt will be accepted.</p>

<div class="figure">
<img src="images/F12cc07.JPG" />
<div class="caption"><b>Figure 12.7</b> <i>Setting dial-in properties to grant access</i></div></div>


<h3><a name="915">Grant or Deny Access</a></h3>


<p>Policies can be configured to either grant or deny access. This works in conjunction with the user object's dial-in permission to decide whether or not a user is given access, by means of the logic shown in Figure 12.11.</p>

<h3><a name="916">Caller ID</a></h3>


<p>Caller ID verifies that the caller is calling from the telephone number specified. If caller ID is configured, support for the passing of caller ID information all the way from the caller to Routing and Remote Access is required, or the connection attempt will be denied.</p>

<blockquote><div class="note"><b>NOTE</b><hr />
For backwards compatibility with previous versions of Windows NT, RAP, Caller ID, Apply Static Routes, and Assign A Static IP Address are not available in Mixed mode.</div></blockquote>

<p><img src="images/practice.jpg" /></p>
<h2><a name="917">Practice: Creating a New Remote Access Policy</a></h2>


<p>In this practice, you create a new policy that allows remote access based on the user's group membership.</p>

<h3><a name="918">Exercise 1: Creating a New Remote Access Policy</a></h3>

<ol>
<li>Using the Routing And Remote Access Administration tool, right-click Remote Access Policies and select New Remote Access Policy.</li>

<li>Add a friendly name of &quot;Allow Domain Users,&quot; and then click Next.</li>

<li>Click Add to add a condition.</li>

<li>Select Windows-Groups, and then click Add.</li>

<li>Click Add, select Domain Users, and then click Add. Click OK.</li>

<li>Click OK to exit the Groups dialog.</li>

<li>Click Next, and then select Grant Remote Access Permission.</li>

<li>Click Next, and then click Finish.</li>
</ol>

<h2><a name="919">Configuring a Remote Access Profile</a></h2>


<p>The profile specifies what kind of access the user will be given if the conditions match. There are six different tabs that can be used to configure a profile.</p>

<h3><a name="920">Dial-In Constraints</a></h3>


<p>Constraints on the actual connection are configured in the Edit Dial-In Profile dialog box, on the Constraints tab, as shown in Figure 12.8. Possible settings include idle time disconnect, maximum session time, day and time, telephone number, and media type (ISDN, tunnel, async, and so forth).</p>

<div class="figure">
<img src="images/F12cc08.JPG" />
<div class="caption"><b>Figure 12.8</b> <i>The Edit Dial-In Profile dialog box</i></div></div>


<h3><a name="921">IP</a></h3>


<p>Configuration for client IP address assignment and IP packet filtering is set on this tab. Packet filters can be set for either inbound or outbound and can be configured for protocol and port.</p>

<h3><a name="922">Multilink</a></h3>


<p>Set Multilink and BAP options here. A line can be dropped if bandwidth drops below a certain level for a given length of time.</p>

<h3><a name="923">Authentication</a></h3>


<p>Authentication protocols such as Password Authentication Protocol (PAP), Challenge Handshake Authentication Protocol (CHAP), and Extensible Authentication Protocol (EAP) are set here.</p>

<h3><a name="924">Encryption</a></h3>


<p>Encryption settings for Microsoft Routing and Remote Access servers are configured here. Options are to prohibit encryption, allow it, or require it.</p>

<h3><a name="925">Advanced</a></h3>


<p>The Advanced tab allows for the configuration of additional network parameters that do not apply to Microsoft Routing and Remote Access servers. Included are standard RADIUS and Ascend attributes, which may apply to other manufacturers' NAS equipment.</p>

<p><img src="images/practice.jpg" /></p>
<h2><a name="926">Practice: Creating a Policy Filter</a></h2>


<p>In this exercise, you edit the profile of the Allow Access If Dial-In Permission Enabled policy so that users who gain access through that policy cannot ping the Routing and Remote Access server's network, whereas users who are granted access via the Allow Domain Users policy can ping the Routing and Remote Access server.</p>

<h3><a name="927">Exercise 1: Create an ICMP Echo Filter in the Allow Access If Dial-In Permission Is Enabled Policy</a></h3>


<ol>
<li>Right-click the Allow Access If Dial-In Permission Enabled policy and select Properties.</li>

<li>Click the Edit Profile button.</li>

<li>Select the IP tab.</li>

<li>Click the From Client IP Packet filter.</li>

<li>Click Add.</li>

<li>Click the Destination Network box.</li>

<li>For the IP address, type the network number and netmask of the Routing and Remote Access server.</li>

<li>For the protocol, select ICMP.</li>

<li>Enter <b>8</b> for ICMP type, and enter <b>0</b> for ICMP code. (ICMP type 8 designates an Echo request.)</li>

<li>Click OK to exit the Add/Edit IP filter, and OK to exit the IP Packet Filters Configuration dialog box. Click OK again to exit the dialog box.</li>
</ol>

<h2><a name="928">Configuring Bandwidth Allocation Protocol (BAP)</a></h2>


<p>BAP and Bandwidth Allocation Control Protocol (BACP) enhance Multilink by dynamically adding or dropping links on demand. BAP and BACP are sometimes used interchangeably to refer to the same bandwidth-on-demand functionality. Both protocols are Point-to-Point (PPP) control protocols and work together to provide bandwidth on demand.</p>

<p>BAP functionality is implemented through a new Link Control Protocol (LCP) option, BACP, and BAP, as described in the following list:</p>

<ul>
<li><b>Link Discriminator.</b> A new LCP option used as a unique identifier for each link of a Multilink bundle.</li>

<li><b>BACP.</b> BACP uses LCP negotiations to elect a &quot;favored peer.&quot; The favored peer is used to determine which peer is favored if the peers simultaneously transmit the same BAP request.</li>

<li><b>BAP.</b> BAP provides a mechanism for link and bandwidth management. Link management allows you to add and drop links. This includes providing telephone numbers as well as type of hardware (modem or ISDN) of the additional available links. Bandwidth management decides when to add and drop links based on link utilization.</li>
</ul>

<p>BAP and BACP are encapsulated in PPP Data-link layer frames with the following protocol field (in hex). This information may be useful when reading PPP logs. As illustrated in Figure 12.9, you can enable BAP and BACP bandwidth control using the PPP tab on the Connection Properties dialog box.</p>

<ul>
<li>C02D for BAP</li>
<li>C02B for BACP</li>
</ul>

<div class="figure">
<img src="images/F12cc09.JPG" />
<div class="caption"><b>Figure 12.9</b> <i>Setting PPP options for a remote access policy</i></div></div>


<p><b>Follow these steps to enable or disable BAP/BACP on a server-wide basis:</b></p>

<ol>
<li>In Routing and Remote Access Manager, right-click the server on which you want to enable BAP/BACP, and then click Properties.</li>

<li>In the PPP tab, select the Dynamic Bandwidth Control Using BAP Or BACP check box.</li>
</ol>

<p>BAP policies are enforced through profile settings or Remote Access Policies. Remote Access Policies are accessed from Routing and Remote Access Manager or from IAS Manager.</p>

<h3><a name="929">BAP Additional Phone Numbers</a></h3>


<p>The server can provide the client with additional telephone numbers to dial if extra bandwidth is needed. Using this option, the client only needs to know one telephone number but can still bring up extra lines as needed, as illustrated in Figure 12.10.</p>

<div class="figure">
<img src="images/F12cc10.JPG" />
<div class="caption"><b>Figure 12.10</b> <i>BAP additional telephone numbers</i></div></div>


<ol>
<li>From the Routing and Remote Access Manager, go to Ports, go to Properties, select a port, and then click Configure.</li>

<li>Enter the telephone number of other modems to be used for Multilink.</li>
</ol>

<h2><a name="930">Lesson Summary</a></h2>


<p>In this lesson, you configured Routing and Remote Access for inbound connections, locked it down with RAPs, added remote access profiles for security, and controlled access with BAP.</p>

</body>
</html>



