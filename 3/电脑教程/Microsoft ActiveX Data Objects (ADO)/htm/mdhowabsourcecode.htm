<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>地址簿应用程序源代码</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h3><a name="mdhowabsourcecode"></a>地址簿应用程序源代码</h3>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:请参阅">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="mdhowABSourceCode_C">
</object></p>
<p>
下列代码是地址簿范例应用程序的完整源代码。</p>
<pre>&lt;HTML&gt;
&lt;HEAD&gt;
&lt;TITLE&gt;Corporate Address Book&lt;/TITLE&gt;
&lt;/HEAD&gt;

&lt;!--
   目的：   为 Web 用户提供公司目录搜索服务。
   编写者：   Microsoft Remote Data Service 工作组，Microsoft Corp.。
   日期：   1997 年 4 月
--&gt;

&lt;BODY BACKGROUND="Arcadia.gif" LANGUAGE="VBScript" onload="Load"&gt;
&lt;tr&gt;
   &lt;td align="center" width="40%"&gt;
      &lt;table border="2" cellpadding="7" cellspacing="7"&gt;
         &lt;tr&gt;
            &lt;td width="100%"&gt;&lt;font color="#160B5A"&gt;&lt;font
            size="4"&gt;&lt;strong&gt;Arcadia Bay Corporate Phone
            Directory&lt;/strong&gt;&lt;/font&gt;&lt;/font&gt;&lt;/td&gt;
         &lt;/tr&gt;
      &lt;/table&gt;
      &lt;/td&gt;
&lt;/tr&gt;

&lt;hr&gt;
&lt;h2&gt;&lt;font color = "#160B5A"&gt;Search Parameters&lt;/h2&gt;
&lt;h5&gt;&lt;font color = "#160B5A"&gt;Please enter one or more search patterns and press FIND to search.&lt;/h5&gt;

&lt;FONT COLOR = "#160B5A"&gt;&lt;B&gt;

&lt;PRE&gt; First Name&nbsp;&nbsp; &lt;INPUT NAME=SFirst SIZE=30&gt; &lt;/PRE&gt;

&lt;PRE&gt; Last Name&nbsp; &lt;INPUT NAME=SLast&nbsp; SIZE=30&gt; &lt;/PRE&gt;

&lt;PRE&gt; Title&nbsp;&nbsp;&nbsp; &lt;INPUT NAME=STitle SIZE=30&gt; &lt;/PRE&gt;

&lt;PRE&gt; E-mail Alias &lt;INPUT NAME=SEmail SIZE=30&gt; &lt;/PRE&gt;

&lt;!-- 
   “命令”按钮选项:
   -----------------------
   查找      将搜索请求提交给数据库。
   清除      清除 QBE 字段（仅为任务保存功能）。
   更新配置文件   发送已更新的“地址配置文件”回数据库。
   取消更改   取消自从上次“更新配置文件”以来的所有更改。
--&gt;

&lt;INPUT TYPE=BUTTON NAME="Find"    VALUE="Find"&gt;
&lt;INPUT TYPE=BUTTON NAME="Clear"    VALUE="Clear"&gt;
&lt;INPUT TYPE=BUTTON NAME="Update"    VALUE="Update Profile"&gt;
&lt;INPUT TYPE=BUTTON NAME="Cancel"    VALUE="Cancel Changes"&gt;

&lt;hr&gt;
&lt;h2&gt;&lt;font color = "#400040"&gt;Search Results&lt;/h2&gt;
&lt;/B&gt;
&lt;br&gt;

&lt;!-- 
   This Sheridan DataGrid control (SGrid) is initialized to
   allow changes to the data - these changes will be saved
   to the database when the Update Profile button is pressed. 
--&gt;

&lt;Object CLASSID="clsid:AC05DC80-7DF1-11d0-839E-00A024A94B3A"
   CODEBASE="http://&lt;%=Request.ServerVariables("SERVER_NAME")%&gt;/MSADC/Samples/ssdatb32.cab"
   ID=GRID1 
 &nbsp;&nbsp; datasrc=#SControl 
 &nbsp;&nbsp; HEIGHT=125 
 &nbsp;&nbsp; WIDTH=495&gt;
   &lt;PARAM NAME="AllowAddNew" VALUE="TRUE"&gt;
   &lt;PARAM NAME="AllowDelete" VALUE="TRUE"&gt;
   &lt;PARAM NAME="AllowUpdate" VALUE="TRUE"&gt;
   &lt;PARAM NAME="BackColor"&nbsp;&nbsp; VALUE="-2147483643"&gt;
   &lt;PARAM NAME="BackColorOdd"&nbsp; VALUE="-2147483643"&gt;
   &lt;PARAM NAME="ForeColorEven" VALUE="0"&gt;
&lt;/OBJECT&gt;

&lt;br&gt;
&lt;br&gt;
&lt;INPUT TYPE=BUTTON NAME="First"    VALUE="First"&gt;
&lt;INPUT TYPE=BUTTON NAME="Prev"    VALUE="Previous"&gt;
&lt;INPUT TYPE=BUTTON NAME="Next"   VALUE="Next"&gt;
&lt;INPUT TYPE=BUTTON NAME="Last"   VALUE="Last"&gt;
&lt;hr&gt;


&lt;!-- Non-visual controls - RDS.DataControl --&gt;

&lt;OBJECT classid="clsid:BD96C556-65A3-11D0-983A-00C04FC29E33"
   ID=SControl
   WIDTH=1 HEIGHT=1&gt;
   &lt;PARAM NAME="SERVER" VALUE="http://&lt;%=Request.ServerVariables("SERVER_NAME")%&gt;"&gt;
   &lt;PARAM NAME="CONNECT" VALUE="dsn=ADCDemo;UID=ADCDemo;PWD=ADCDemo;"&gt;
&lt;/OBJECT&gt;


&lt;!-- VBS 脚本：撰写查询，更新配置文件，并检索搜索结果。 --&gt;

&lt;SCRIPT LANGUAGE="VBScript"&gt;

Dim myQuery

Sub Load
   Grid1.CAPTION = "Arcadia Bay Corporate Phone Directory"

   ' 仅使用列名称初始化数据网格。
   SControl.SQL = "Select FirstName, LastName, Title, Email, Building, Room, Phone from Employee where 2 &lt; 1"
   SControl.Refresh

End Sub

' 执行“清除”按钮 C 清除所有 QBE 字段以准备新的 “查找”。

Sub Clear_OnClick
   SFirst.Value=""
   SLast.Value=""
   STitle.Value=""
   SEmail.Value=""
End Sub


' 执行“查找”按钮 C 撰写由数据库处理的动态 SQL 查询，并返回将要绑定到 Sgrid 对象的匹配记录。

Sub Find_OnClick

   myQuery = "Select FirstName, LastName, Title, Type, Email, ManagerEmail, Building, Room, Phone from Employee"

   ' 检查 QBE 字段并撰写动态的 SQL 查询。

   IF (SFirst.Value &lt;&gt; "") THEN
      myQuery = myQuery + " where FirstName like '" + SFirst.Value + "%'"
   End IF

   IF (SLast.Value &lt;&gt; "") THEN
      myQuery = myQuery + " where LastName like '" + SLast.Value + "%'"
   End IF

   IF (STitle.Value &lt;&gt; "") THEN
      myQuery = myQuery + " where Title like '" + STitle.Value + "%'"
   End IF

   IF (SEmail.Value &lt;&gt; "") THEN
      myQuery = myQuery + " where Email like '" + SEmail.Value + "%'"
   End IF

   ' 设置新查询然后刷新 SControl 以便显示新结果。

   SControl.SQL = myQuery
   SControl.Refresh
   
End Sub

' 定位子程序 C 基于 RDS.DataControl (SControl) 的货币变更。
' 在绑定的记录集中移动到第一个记录。

Sub First_OnClick
     SControl.Recordset.MoveFirst
End Sub

' 在绑定的记录集中从当前位置移动到下一个记录。Sub Next_OnClick
   If SControl.Recordset.EOF Then   ' 移动无法超出末端记录
      SControl.Recordset.MoveFirst 
      SControl.Recordset.MoveNext
      Exit Sub
   End If   

   SControl.Recordset.MoveNext

End Sub

' 在绑定的记录集中从当前位置移动到上一个记录.

Sub Prev_OnClick
If SControl.Recordset.BOF Then   ' 移动无法超出顶端记录
      SControl.Recordset.MoveLast   ' 移出 BOF 缓冲区
      SControl.Recordset.MovePrevious
      Exit Sub
   End If
   SControl.Recordset.MovePrevious
End Sub

' 在绑定的记录集中移动到最后一个记录。

Sub Last_OnClick
     SControl.Recordset.MoveLast
End Sub

' 提交所做编辑并获取新数据的干净拷贝。

Sub Update_OnClick
     SControl.SubmitChanges
   SControl.Refresh&nbsp;&nbsp;&nbsp; ' SubmitChanges 之后的 ADC 1.5 不要求刷新，但它保证刷新的数据。
End Sub

' 取消编辑并恢复初始值。

Sub Cancel_OnClick
     SControl.CancelUpdate
End Sub

&lt;/SCRIPT&gt;

&lt;BR&gt;
&lt;font color = "#400040"&gt;This site powered by Microsoft Remote Data Service. &lt;/font&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;
</pre>
</BODY>
</HTML>
