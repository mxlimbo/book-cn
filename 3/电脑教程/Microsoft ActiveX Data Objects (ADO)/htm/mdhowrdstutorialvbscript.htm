<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>RDS 教程 (VBScript)</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h3><a name="mdhowrdstutorialvbscript"></a>RDS 教程 (VBScript)</h3>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:请参阅">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="mdhowRDSTutorialVBScript_C">
</object></p>
<p>
该部分是使用 Microsoft Visual Basic，Scripting Edition 编写对“RDS 教程”的重新说明。</p>
<p>
本教程中，<b>RDS.DataControl</b> 和 <b>RDS.DataSpace</b> 是在设计时创建的，就是说它们通过对象标记进行定义，如 &lt;OBJECT&gt;...&lt;/OBJECT&gt;。此外，它们也可在运行时通过 <b>Server.CreateObject</b> 方法创建。例如，<b>RDS.DataControl</b> 对象的创建可以是：</p>
<p>
Set DC = <span class=cfe><b>Server.CreateObject</b></span>("RDS.DataControl")</p>
<pre>&lt;!-- RDS.DataControl --&gt;
&lt;OBJECT 
ID="DC1" CLASSID="CLSID:BD96C556-65A3-11D0-983A-00C04FC29E33"&gt;
&lt;/OBJECT&gt;

&lt;!-- RDS.DataSpace --&gt;
&lt;OBJECT 
ID="DS1" WIDTH=1 HEIGHT=1
CLASSID="CLSID:BD96C556-65A3-11D0-983A-00C04FC29E36"&gt;
&lt;/OBJECT&gt;

&lt;SCRIPT LANGUAGE="VBScript"&gt;

Sub RDSTutorial()
Dim DF1 as Object
</pre>
<p>
<b>步骤 1 ― 指定服务器程序</b></p>
<p class=label>
</p>
<p>
VBScript 可以发现它运行其上的 IIS Web 服务器的名称，方法是访问可用于 Active Server Pages 的 <b>VBScript Request.ServerVariables</b> 方法:</p>
<pre>"http://&lt;%=Request.ServerVariables("SERVER_NAME")%&gt;"
</pre>
<p>
不过对于本教程，将使用假设的服务器“yourServer”。</p>
<p class=indent>
<b>注意</b>&nbsp;&nbsp;&nbsp;请留意 <b>ByRef</b> 参数的数据类型。<b>VBScript</b> 不允许指定变量类型，因此必须始终传递变体型。使用 HTTP 时，RDS 允许将变体型传递给希望使用非变体型的方法，以便使用 <b>RDS.DataSpace</b> 对象的 <b>CreateObjec</b>t 方法进行调用。当使用 DCOM 或过程中服务器时，必须使客户端与服务器端的数据类型相匹配，否则将会产生“类型不匹配”错误。</p>
<pre>Set DF1 = DS1.CreateObject("RDSServer.DataFactory", "http://yourServer")
</pre>
<p>
<b>步骤 2a ― 通过 RDS.DataControl 调用服务器程序</b></p>
<p class=label>
<b>&nbsp;</b></p>
<pre>该范例只是注释，说明 <b>RDS.DataControl</b> 的默认行为是执行指定的查询。
&lt;OBJECT CLASSID="clsid:BD96C556-65A3-11D0-983A-00C04FC29E33" ID="DC1"&gt;
&lt;PARAM NAME="SQL" VALUE="SELECT * FROM authors"&gt;
&lt;PARAM NAME="Connect" VALUE="DSN=Pubs;"&gt;
&lt;PARAM NAME="Server" VALUE="http://YourServer/"&gt;
&lt;/OBJECT&gt;
...
&lt;SCRIPT LANGUAGE="VBScript"&gt;

Sub RDSTutorial2A()
Dim RS as New ADODB.Recordset
DC1.Refresh
Set RS = DC1.Recordset
...</pre>
<p class=label>
<b>步骤 2b ― 通过 RDSServer.DataFactory 调用服务器程序</b></p>
<p class=label>
<b>步骤 3 ― 服务器获得 Recordset </b></p>
<p class=label>
<b>步骤 4 ― 服务器返回 Recordset</b></p>
<pre>Set RS = DF1.Query("DSN=pubs", "SELECT * FROM authors")</pre>
<p>
<b>步骤 5 ― 使 DataControl 能被可视控件使用</b></p>
<pre>' 将返回的记录集指定到 DataControl。
DC1.SourceRecordset = RS</pre>
<p>
<b>步骤 6a ― 使用 RDS.DataControl 将更改返回服务器</b></p>
<p>
该范例只是注释，说明 <b></b> 是如何执行更新的。</p>
<pre>&lt;OBJECT CLASSID="clsid:BD96C556-65A3-11D0-983A-00C04FC29E33" ID="DC1"&gt;
&lt;PARAM NAME="SQL" VALUE="SELECT * FROM authors"&gt;
&lt;PARAM NAME="Connect" VALUE="DSN=Pubs;"&gt;
&lt;PARAM NAME="Server" VALUE="http://YourServer/"&gt;
&lt;/OBJECT&gt;
...
&lt;SCRIPT LANGUAGE="VBScript"&gt;

Sub RDSTutorial6A()
Dim RS as New ADODB.Recordset
DC1.Refresh
...
Set RS = DC1.Recordset
' 编辑记录集对象.
' SERVER 和 CONNECT 属性已经在步骤 2A 中设置。
Set DC1.SourceRecordset = RS
...
DC1.SubmitChanges
</pre>
<p>
<b>步骤 6b ― 通过 RDSServer.DataFactory 将更改返回服务器</b></p>
<pre>DF.SubmitChanges<span class=cfe><b> </b></span>"DSN=pubs", RS

End Sub
&lt;/SCRIPT&gt;
&lt;/BODY&gt;
&lt;/HTML&gt;
</pre>
<p>
<b>本教程到此结束。</b></p>
</BODY>
</HTML>
