<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>AddNew 方法范例</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h3><a name="mdmthaddnewx"></a>AddNew 方法范例</h3>
<p>
该范例使用 AddNew 方法创建具有指定名称的新记录。</p>
<pre>Public Sub AddNewX()

   Dim cnn1 As ADODB.Connection
   Dim rstEmployees As ADODB.Recordset
   Dim strCnn As String
   Dim strID As String
   Dim strFirstName As String
   Dim strLastName As String
   Dim booRecordAdded As Boolean

   ' 打开连接。
   Set cnn1 = New ADODB.Connection
   strCnn = "Provider=sqloledb;" &amp; _
      "Data Source=srv;Initial Catalog=pubs;User Id=sa;Password=;"
   cnn1.Open strCnn
      
   ' 打开雇员表。
   Set rstEmployees = New ADODB.Recordset
   rstEmployees.CursorType = adOpenKeyset
   rstEmployees.LockType = adLockOptimistic
   rstEmployees.Open "employee", cnn1, , , adCmdTable

   ' 从用户获取数据，雇员 ID 的格式必须为： 
   ' 名、中间名和姓的三个首字母， 
   ' 五位数字，以及性别标识 M 或 F。
   ' 例如，Bill Sornsin 的雇员 ID 为：B-S55555M。
   strID = Trim(InputBox("Enter employee ID:"))
   strFirstName = Trim(InputBox("Enter first name:"))
   strLastName = Trim(InputBox("Enter last name:"))

   ' P只在用户输入姓和名之后进行。
   If (strID &lt;&gt; "") And (strFirstName &lt;&gt; "") _
      And (strLastName &lt;&gt; "") Then

      rstEmployees.AddNew
      rstEmployees!emp_id = strID
      rstEmployees!fname = strFirstName
      rstEmployees!lname = strLastName
      rstEmployees.Update
      booRecordAdded = True

      ' 显示新添加的数据。
      MsgBox "New record: " &amp; rstEmployees!emp_id &amp; " " &amp; _
         rstEmployees!fname &amp; " " &amp; rstEmployees!lname

   Else
      MsgBox "Please enter an employee ID, " &amp; _
         "first name, and last name."
   End If
      
   ' 删除新记录，因为这只是演示。
   cnn1.Execute "DELETE FROM employee WHERE emp_id = '" &amp; strID &amp; "'"
      
   rstEmployees.Close
   cnn1.Close

End Sub
</pre>
<p class=label>
<b>VBScript 版本</b></p>
<p>
下面是使用 VBScript 编写、并用于 Active Server Page (ASP) 的相同范例。如需查看该完整功能范例，请使用与 IIS 一同安装并位于 C:\InetPub\ASPSamp\AdvWorks 的数据源 AdvWorks.mdb，来创建名为 AdvWorks 的系统“数据源名称”(DSN)。这是 Microsoft Access 数据库文件。请使用“查找”命令定位文件 Adovbs.inc，并将其放入计划使用的目录中。请将以下代码剪切并粘贴到“记事本”或其他文本编辑器中，另存为 <b>AddNew.asp</b>。这样，便可在任何客户端浏览器中查看结果。</p>
<p>
如要执行此范例，请按 HTML 格式添加虚构的新记录，单击“添加新记录”。查看 <b>Delete</b> 方法范例可删除不需要的记录。</p>
<pre>&lt;!-- #Include file="ADOVBS.INC" --&gt;
&lt;% Language = VBScript %&gt;
&lt;HTML&gt;&lt;HEAD&gt;&lt;TITLE&gt;ADO Open Method&lt;/TITLE&gt;
&lt;/HEAD&gt;&lt;BODY&gt; 
&lt;FONT FACE="MS SANS SERIF" SIZE=2&gt;
&lt;Center&gt;&lt;H3&gt;ADO AddNew Method&lt;/H3&gt;
&lt;!-- ADO Connection Object used to create recordset--&gt;
&lt;% 
'创建并打开 Connection 对象。
Set OBJdbConnection = Server.CreateObject("ADODB.Connection") 
OBJdbConnection.Open "AdvWorks" 
'创建并打开 Recordset 对象。
Set RsCustomerList = Server.CreateObject("ADODB.Recordset")
RsCustomerList.ActiveConnection = OBJdbConnection
RsCustomerList.CursorType = adOpenKeyset
RsCustomerList.LockType = adLockOptimistic
RsCustomerList.Source = "Customers"
RsCustomerList.Open

%&gt;
&lt;!-- 如果这是第一次打开页面，则输入数据时 Form 集合将为空。 

请运行 AddNew 方法--&gt;
&lt;% If Not IsEmpty(Request.Form) Then
   If Not Request.Form("CompanyName") = "" Then
      RsCustomerList.AddNew
      RsCustomerList("CompanyName") = Request.Form("CompanyName")
      RsCustomerList("ContactLastName") = Request.Form("LastName")
      RsCustomerList("ContactFirstName") = Request.Form("FirstName")
      RsCustomerList("PhoneNumber") = Request.Form("PhoneNumber")
      RsCustomerList("City") = Request.Form("City")
      RsCustomerList("StateOrProvince") = Request.Form("State")
      RsCustomerList.Update
      RsCustomerList.MoveFirst
      
   End If
End If
%&gt;

&lt;TABLE COLSPAN=8 CELLPADDING=5 BORDER=0&gt;

&lt;!-- Customer 表的 BEGIN 列标头行--&gt;

&lt;TR&gt;&lt;TD ALIGN=CENTER BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;Company Name&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;Contact Name&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER WIDTH=150 BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;Phone Number&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;City&lt;/FONT&gt;&lt;/TD&gt;
&lt;TD ALIGN=CENTER BGCOLOR="#008080"&gt;
&lt;FONT STYLE="ARIAL NARROW" COLOR="#ffffff" SIZE=1&gt;State/Province&lt;/FONT&gt;&lt;/TD&gt;&lt;/TR&gt;
&lt;!--每通过一遍记录集，显示一行 Customer 表的 ADO 数据--&gt;
&lt;% Do While Not RsCustomerList.EOF %&gt;
  &lt;TR&gt;&lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt; 
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RSCustomerList("CompanyName")%&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RScustomerList("ContactLastName") &amp; ", " %&gt; 
  &lt;%= RScustomerList("ContactFirstName") %&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt;
 &nbsp; &lt;%= RScustomerList("PhoneNumber")%&gt; 
 &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RScustomerList("City")%&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;
  &lt;TD BGCOLOR="f7efde" ALIGN=CENTER&gt;
  &lt;FONT STYLE="ARIAL NARROW" SIZE=1&gt; 
  &lt;%= RScustomerList("StateOrProvince")%&gt; 
  &lt;/FONT&gt;&lt;/TD&gt;&lt;/TR&gt; 
&lt;!-- Next Row = Record Loop 并添加到行 html 表--&gt;
&lt;% 
RScustomerList.MoveNext 
Loop 
%&gt;

&lt;/TABLE&gt;&lt;HR&gt;
&lt;!-- 输入新记录的窗体将变量返回该页 --&gt;
&lt;Table&gt;
&lt;Form Method = Post Action="AddNew.asp" Name=Form&gt;
&lt;TR&gt;&lt;TD&gt;&lt;P&gt;Company Name:&lt;/TD&gt;
&lt;TD&gt;&lt;Input Type="Text" Size="50" Name="CompanyName" Value = ""&gt;&lt;/P&gt;&lt;/TD&gt;
&lt;TR&gt;&lt;TD&gt;&lt;P&gt;Contact First Name:&lt;/TD&gt;
&lt;TD&gt;&lt;Input Type="Text" Size="50" Name="FirstName" Value = ""&gt;&lt;/P&gt;&lt;/TD&gt;
&lt;TR&gt;&lt;TD&gt;&lt;P&gt;Contact Last Name:&lt;/TD&gt;
&lt;TD&gt;&lt;Input Type="Text" Size="50" Name="LastName" Value = ""&gt;&lt;/P&gt;&lt;/TD&gt;
&lt;TR&gt;&lt;TD&gt;&lt;P&gt;Contact Phone:&lt;/TD&gt;
&lt;TD&gt;&lt;Input Type="Text" Size="50" Name="PhoneNumber" Value = ""&gt;&lt;/P&gt;&lt;/TD&gt;
&lt;TR&gt;&lt;TD&gt;&lt;P&gt;City:&lt;/TD&gt;
&lt;TD&gt;&lt;Input Type="Text" Size="50" Name="City" Value = ""&gt;&lt;/P&gt;&lt;/TD&gt;
&lt;TR&gt;&lt;TD&gt;&lt;P&gt;State / Province:&lt;/TD&gt;
&lt;TD&gt;&lt;Input Type="Text" Size="5" Name="State" Value = ""&gt;&lt;/P&gt;&lt;/TD&gt;
&lt;TR&gt;&lt;TD&gt;&lt;Input Type="Submit" Value="Add New "&gt;&lt;Input Type="Reset" Value="Reset Form"&gt;
&lt;/Form&gt;&lt;/Table&gt;&lt;/Center&gt;&lt;/FONT&gt;
&lt;%'Show location of DSN data source
Response.Write(OBJdbConnection)
%&gt;
&lt;Script Language = "VBScript"&gt;
Sub Form_OnSubmit
   MsgBox "Sending New Record to Server",,"ADO-ASP _Example"
End Sub
&lt;/Script&gt;
&lt;/BODY&gt;&lt;/HTML&gt;
</pre>
</BODY>
</HTML>
