<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>步骤 6：结束更新（ADO 教程）</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h3><a name="mdhowconcludeupdate"></a>步骤 6：结束更新（ADO 教程）</h3>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:请参阅">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="mdhowConcludeUpdate_C">
</object></p>
<p class=label>
<b>您所在的步骤...</b>
<ul type=disc>
<li>
连接数据源。<br><br></li>
<li>
可选择创建表示 SQL 查询命令的对象。<br><br></li>
<li>
可选择在 SQL 命令中将值指定为变量参数。<br><br></li>
<li>
执行命令。如果命令以行返回，将行存储在存储对象中。<br><br></li>
<li>
可选择对数据进行定位、检查、操作和编辑。<br><br></li>
<li>
适当情况下，可以使用存储对象中的变更对数据源进行更新。可选择在事务处理中嵌入更新数据。<br><br></li>
<li>
<b>在使用事务之后，可以接受或拒绝在事务中所做的更改。结束事务。 </b></li>
</ul>
<p class=label>
<b>讨论</b></p>
<p>
假设批更新结束时发生错误，如何解决将取决于错误的性质和严重性以及应用程序的逻辑关系。如果数据库是与其他用户共享的，典型的错误则是他人在您之前更改了数据字段，这种类型的错误称为“冲突”。ADO 将检测到这种请况并报告错误。 </p>
<p>
本教程中的该步骤分为两部分：如果不存在更新错误则“提交”事务，结束更新。</p>
<p>
如果错误存在，它们会被错误处理例程捕获。可使用 <b>adFilterConflictingRecords</b> 常数对 <b>Recordset</b> 进行筛选，将冲突行显示出来。要纠正错误只需打印作者的姓和名（<b>au_fname</b> 和 <b>au_lname</b>），然后回卷事务，放弃成功的更新。由此结束更新。</p>
<pre>...
conn.CommitTrans
...
On Error
rs.Filter = adFilterConflictingRecords
rs.MoveFirst
Do While Not rs.EOF
   Debug.Print "Conflict: Name: " &amp; rs("au_fname") " " &amp; rs("au_lname")
   rs.MoveNext
Loop
conn.Rollback
Resume Next
...
</pre>
<p>
<b>本教程到此结束。</b></p>
</BODY>
</HTML>
