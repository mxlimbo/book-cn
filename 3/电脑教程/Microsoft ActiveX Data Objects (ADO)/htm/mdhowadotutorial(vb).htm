<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML dir=ltr>
<HEAD>
<META HTTP-EQUIV="Content-Type" Content="text/html; charset=GB_2312-80">
<title>ADO 教程 (VB)</title>
<style>@import url(/stylesheets/msdn_ie4.css);</style>
<link disabled rel="stylesheet" href="/stylesheets/msdn_ie3.css"></HEAD>
<BODY>

<h3><a name="mdhowadotutorial(vb)"></a>ADO 教程 (VB) </h3>
<p>
<object id=alink_1 type="application/x-oleobject"
	classid="clsid:adb880a6-d8ff-11cf-9377-00aa003b7a11">
<PARAM name="Command" value="ALink,MENU">
<PARAM name="Text" value="Text:请参阅">
<PARAM name="Flags" value=",,1">
<PARAM name="Item1" value="">
<PARAM name="Item2" value="mdhowADOTutorial(VB)_C">
</object></p>
<pre>Public Sub main()

Dim conn As New ADODB.Connection
Dim cmd As New ADODB.Command
Dim rs As New ADODB.Recordset
‘步骤 1
conn.Open "DSN=pubs;uid=sa;pwd=;database=pubs"
‘步骤 2
Set cmd.ActiveConnection = conn
cmd.CommandText = "SELECT * from authors"
‘步骤 3
rs.CursorLocation = adUseClient
rs.Open cmd, , adOpenStatic, adLockBatchOptimistic
‘步骤 4
rs("au_lname").Properties("Optimize") = True
rs.Sort = "au_lname"
rs.Filter = "phone LIKE '415 5*'"
rs.MoveFirst
Do While Not rs.EOF
 &nbsp;&nbsp; Debug.Print "Name: " &amp; rs("au_fname") &amp; " "; rs("au_lname") &amp; _
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; "Phone: "; rs("phone") &amp; vbCr
 &nbsp;&nbsp; rs("phone") = "777" &amp; Mid(rs("phone"), 5, 11)
 &nbsp;&nbsp; rs.MoveNext
Loop

‘步骤 5
conn.BeginTrans

‘步骤 6 - A
On Error GoTo ConflictHandler
rs.UpdateBatch
On Error GoTo 0

conn.CommitTrans

Exit Sub

‘ 步骤 6 - B
ConflictHandler:

rs.Filter = adFilterConflictingRecords
rs.MoveFirst
Do While Not rs.EOF
 &nbsp;&nbsp; Debug.Print "Conflict: Name: " &amp; rs("au_fname"); " " &amp; rs("au_lname")
 &nbsp;&nbsp; rs.MoveNext
Loop
conn.Rollback
Resume Next

End Sub
</pre>
<p>
<b>Visual Basic 教程到此结束。 </b></p>
</BODY>
</HTML>
