<HTML>
<HEAD>
<TITLE>Lab 12: Creating STUpload as an ActiveX Document Server</TITLE>
<link rel="STYLESHEET" type="text/css" href="Library.css">

</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch12d.htm", "ch12f.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>

<A NAME="466"><H1>Lab 12: Creating STUpload as an ActiveX Document Server</H1></A>

<p>In this lab, you will see how a fully featured MFC application can easily be created
as an ActiveX document server. You will see how the functionality of the STUpload
application can be made available to allow Internet Explorer users to view STUpload
document files deployed on a Web site.</p>

<p>To make the examples clearer, the STUpload projects that you have been working with
throughout this book have not been created with ActiveX document server support. The
Chapter 12\Partial folder contains a copy of the STUpload project that has been created
with ActiveX document server support. The ActiveX document server support, as you
recall, is added by selecting the <b>Full-server</b> and the <b>Active document 
server</b> options in Step 3 of the
MFC AppWizard. You should use a copy of this project as a starting point for the
exercises in this lab.</p>

<p><li><b>To view the ActiveX document server classes</b></li></p>

<ol>
<p><li>Open your copy of the Chapter 12\Partial\STUpload project. If you look at the
classes displayed in ClassView, you will see that the ActiveX document server version
of the project has some extra classes. The <b>CInPlaceFrame</b> class represents the
frame window that encloses the document when it is edited &quot;in
place&quot;&#8212;that is, when it is edited in a container. The 
<b>CSTUploadServerItem</b> class provides the server interface to the container.</li></p>

<p><li>Double click the <b>CSTUploadDoc</b> item. Look at the class definition and 
notice that it is derived from the <b>COleServerDoc</b> class.</li></p>
</ol>

<p>You will now modify the <b>IDR_SRVR_INPLACE</b> menu and toolbar to make STUpload
menu commands available from the menu of the ActiveX document container.</p>

<p><li><b>To edit the IDR_SRVR_INPLACE menu</b></li></p>

<ol>
<p><li>In ResourceView, double-click the <b>IDR_SRVR_INPLACE</b> menu item.
Select the <b>Edit</b> submenu and press <b>DEL</b> to delete the menu. Confirm
the deletion by clicking <b>OK</b>.</li></p>

<p><li>Double-click the <b>IDR_MAINFRAME</b> menu item. On the <b>Window</b> menu,
click <b>Tile Horizontally</b> to view both menus together.</li></p>

<p><li>Copy the <b>Data</b> submenu from the <b>IDR_MAINFRAME</b> menu to the former
location of the <b>Edit</b> submenu on the <b>IDR_SRVR_INPLACE</b> menu. Copy by
dragging the menu while holding down the CTRL key.</li></p>

<p><li>From the <b>Data</b> submenu on the <b>IDR_SRVR_INPLACE</b> menu, delete the 
<b>Import</b> menu comand. Close both menu editor windows.</li></p>
</ol>

<p>You delete the <b>Import</b> menu command because the ActiveX document elements of
the STUpload application will be used only to view and upload existing documents
deployed on a Web server. You will not offer the capability to create new documents
over the Web.</p>

<p><li><b>To edit the IDR_SRVR_INPLACE toolbar</b></li></p>

<ol>
<p><li>In ResourceView, double-click the <b>IDR_SRVR_INPLACE</b> toolbar item.
Remove the <b>Cut</b>, <b>Copy</b> and <b>Paste</b> toolbar buttons by dragging
them off the toolbar.</li></p>

<p><li>Double-click the <b>IDR_MAINFRAME</b> toolbar item. From the <b>Window</b> menu,
select <b>Tile Horizontally</b> to view both toolbars together.</li></p>

<p><li>Copy the <b>ID_DATA_UPLOAD</b> and the <b>ID_DATA_QUERYDATABASE</b> toolbar
buttons from the <b>IDR_MAINFRAME</b> menu to the <b>IDR_SRVR_INPLACE</b> menu. Copy
by holding down the CTRL key while dragging the buttons across. Close both toolbar
editor windows.</li></p>
</ol>

<p>Build the STUpload project. Once the build has completed successfully, complete the
following steps to test the ActiveX document server functionality of the STUpload
application.</p>

<p><li><b>To create and deploy an STUpload ActiveX document</b></li></p>

<ol>
<p><li>Press CTRL+F5 to run the STUpload application. Using the <b>Import</b> command
on the <b>Data</b> menu, load the Ch12Test.dat file from the Chapter 12\Data folder. 
Use the <b>Select Fund</b> window to choose a fund to view.</li></p>

<p><li>Close the STUpload application, saving the current document as 
<b>ADTest.stu</b>.</li></p>

<p><li>Deploy the <b>ADTest.stu</b> document to the <b>Docs</b> virtual directory that
you created for the exercises in this chapter.</li></p>
</ol>

<p><li><b>To test the STUpload ActiveX document server</b></li></p>

<ol>
<p><li>Open Internet Explorer and enter the following URL into the <b>Address</b>
box:</li></p>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre> http://[<i>your computer name</i>]/docs/ADTest.stu</pre>
</td></tr>
</table>
</p>

<p>The ADTest.stu file should display in the browser. If you do not have a Web site set
up on your machine, you can simulate this step by dragging the ADTest.stu file icon
from Windows Explorer and dropping it onto the browser.</p>

<p><li>On the <b>Data</b> menu, click the <b>Upload</b> command. Click <b>OK</b> to
upload the file to the database.</li></p>

<p><li>Once the upload has completed, use the <b>Query Database</b> command on the 
<b>Data</b> menu to check that the items you uploaded are now on the database.</li></p>

<p><li>Close Internet Explorer.</li></p>
</ol>

</BODY>
</HTML>







