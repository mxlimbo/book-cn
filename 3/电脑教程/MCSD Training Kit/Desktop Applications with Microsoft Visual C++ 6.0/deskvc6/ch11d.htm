<HTML>
<HEAD>
<TITLE>Lab 11: Using an ActiveX Control in an Application</TITLE>
<link rel="STYLESHEET" type="text/css" href="Library.css">

</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch11c.htm", "ch11e.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>

<A NAME="427"><H1>Lab 11: Using an ActiveX Control in an Application</H1></A>

<p>In <a href="ch07e.htm#304">Lab 7</a>, you saw how the STUpload application uses two ActiveX controls&#8212;the
Microsoft ADO Data Control and the Microsoft DataGrid Control&#8212;as part of its user
interface. You are not going to implement any additional ActiveX controls for the
STUpload application. Instead, you will learn how to use the OneArmedBandit control
that you created in this chapter as part of a Windows application. This application,
named VirtualSlot, is shown in Figure 11.8.</p>

<p>
<A HREF="javascript:fullSize('f11DA08x.htm')"> <img src="images/f11DA08.jpg" width=404 height=179 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- caption --><b>Figure 11.8</b> <i>The VirtualSlot application</i><!-- /caption -->
</p>

<p>This application calls the <b>Play()</b> method exposed by the OneArmedBandit control,
and handles the <b>Jackpot</b> event. While designing the application, you will use the
property page to set the number of symbols displayed and the control colors.</p>

<p>If you have not completed the exercises in this chapter, you can use the OneArmedBandit
control located in the Chapter 11\Lab folder. Take the fol-
lowing steps to register this control on your computer:</p>

<ol>
<p><li> Copy the OneArmedBandit.ocx file to a suitable location on your hard drive.</li></p>

<p><li> From the <b>Start</b> menu, open a command prompt and change to the directory
that contains the OneArmedBandit.ocx file.</li></p>

<p><li> Enter the following command to register the control on your computer:</li></p>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>regsvr32 onearmedbandit.ocx</pre>
</td></tr>
</table>
</p>
</ol>

<p>You are now ready to create the VirtualSlot application.</p>

<p><li> <b>To create the VirtualSlot project</b></li></p>

<ol>
<p><li> In Visual C++, choose <b>New</b> from the <b>File</b> menu.</li></p>

<p><li> Select the <b>MFC AppWizard (exe)</b> to create a new project named <b>
VirtualSlot</b>. Click <b>OK</b>.</li></p>

<p><li> In Step 1 of the AppWizard, click <b>Dialog Based</b> and then click <b>
Finish</b>.</li></p>

<p><li> Click <b>OK</b> to confirm the selection.</li></p>
</ol>

<p>The IDD_VIRTUALSLOT_DIALOG dialog template appears in the dialog
editor. You will modify this to create the VirtualSlot application interface, which
will consist of an instance of the OneArmedBandit control, a <b>Play</b> button, and a
<b>Close</b> button.</p>

<p><li> <b>To modify the IDD_VIRTUALSLOT_DIALOG dialog template</b></li></p>

<ol>
<p><li> Delete the //TODO static text.</li></p>

<p><li> Change the <b>OK</b> button caption to <b>Close</b>. Assign a new ID, <b>
ID_PLAY</b>, to the <b>Cancel</b> button and change the caption to <b>Play</b>.</li></p>

<p><li> Rearrange the buttons as shown in Figure 11.8.</li></p>
</ol>

<p><li> <b>To insert the OneArmedBandit control into the project</b></li></p>

<ol>
<p><li> On the <b>Project</b> menu, click <b>Add to Project</b>, and then click <b>
Components and Controls</b>.</li></p>

<p><li> In the Components and Controls Gallery, double-click the <b>Registered ActiveX
Controls</b> folder to display all ActiveX controls registered on your system.</li></p>

<p><li> Click the OneArmedBandit Control, and then click <b>Insert</b>.</li></p>

<p><li> Click <b>OK</b> to insert the component. Click <b>OK</b> to confirm that you
want to generate the <b>COneArmedBandit</b> class for the control.</li></p>

<p><li> Click <b>Close</b> to close the Components and Controls Gallery.</li></p>
</ol>

<p>Note that the generic <b>OCX</b> icon for the OneArmedBandit control is placed on
the <b>Controls</b> toolbar. The MFC OneArmedBandit project you created in this chapter
contained a bitmap resource <b>IDB_ONEARMEDBANDIT</b> that you could have modified to
create a distinctive toolbar button.</p>

<p>In ClassView, you see the <b>COneArmedBandit</b> class that has been created by the
Components and Controls Gallery. This class contains wrapper functions that provide
access to your control properties and methods. The <b>Create()</b> function allows you
to dynamically create an instance of the control (within a <b>CView</b>
object for example).</p>

<p><li> <b>To place an instance of the COneArmedBandit control</b></li></p>

<ol>
<p><li> Click the <b>OneArmedBandit</b> button on the <b>Controls</b> toolbar and place
the control on the dialog box. Resize the control and the dialog box so that they
appear as shown in Figure 11.8.</li></p>

<p><li> With the OneArmedBandit control selected, press ENTER to edit the control
properties. Your familiar property pages will appear, along with the <b>General</b> and
<b>All</b> pages that are implemented by the container.</li></p>

<p><li> On the <b>Control</b> page, change the <b>Number of Symbols</b> to <b>
7</b>.</li></p>

<p><li> On the <b>Colors</b> page, select colors for your <b>ForeColor</b> and <b>
BackColor</b> properties.</li></p>
</ol>

<p>You will now modify the <b>CVirtualSlotDlg</b> dialog class to implement the <b>
Play</b> button and handle the <b>Jackpot</b> event.</p>

<p><li> <b>To implement the Play button</b></li></p>

<ol>
<p><li> Press CTRL+W to open ClassWizard. On the <b>Member Variables</b> tab, click the
<b>IDC_ONEARMEDBANDIT1</b> control ID. Click <b>Add Variable</b> to create a <b>
Control</b> member variable of type <b>COneArmedBandit</b>, named <b>m_bandit</b>.</li></p>

<p><li> On the <b>Message Maps</b> page, click the <b>ID_PLAY</b> object ID. Add a
handler for the BN_CLICKED message named <b>OnPlay()</b>.</li></p>

<p><li> Click <b>Edit Code</b>. In the <b>OnPlay()</b> function implementation, replace
the //TODO comment with the following line of code:</li></p>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>m_bandit.Play();</pre>
</td></tr>
</table>
</p>
</ol>

<p><li> <b>To handle the Jackpot event</b></li></p>

<ol>
<p><li> On the <b>Message Maps</b> tab of ClassWizard, simply click the <b>IDC_
ONEARMEDBANDIT1</b> control ID.</li></p>

<p><li> Click the <b>Jackpot</b> message, and then click <b>Add Function</b> to create
the <b>OnJackpotOnearmedbanditctrl1()</b> function.</li></p>

<p><li> Click <b>Edit Code</b>. In the function implementation, replace the //TODO
comment with the following line of code:</li></p>


<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>AfxMessageBox(&quot;Jackpot!&quot;);</pre>
</td></tr>
</table>
</p>

<p><li> You can now build and run the VirtualSlot application. Click the <b>Play</b>
button to spin the one-armed bandit. Keep playing until you hit the jackpot!</li></p>
</ol>

</BODY>
</HTML>







