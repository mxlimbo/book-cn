<HTML>
<HEAD>
<TITLE>Lab: Using Activex Data Objects</TITLE>
<link rel="STYLESHEET" type="text/css" href="Library.css">


</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch08h.htm", "ch08j.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>

<A NAME="445"><H1>Lab: Using ActiveX Data Objects</H1></A>

<P>In this lab, you will write ADO code to create a Connection and Recordset object. The Recordset object will be created based on a SQL statement built from a Search form that you will create. You can continue to work with the files you created in Lab 7, or you can use the files provided for you in the \Labs\Lab08\Partial folder. The solution code is in the \Labs\Lab08\Solution folder.</P>

<p>
<img src="images/video.gif" width=78 height=54 border=0>
</p>

<P>To see a demonstration of the solution, run the Lab08.exe animation located in the Animations folder on the Supplemental Course Materials CD-ROM that accompanies this book.</P>


<b>Estimated lesson time: 20 minutes</b>


<A NAME="446"><H2>Exercise 1: Creating ADO Objects</H2></A>

<P>In this exercise, you will declare Recordset and Connection object variables. These variables will be used in Exercise 2. You will also create a custom search form to allow users to locate guest records.</P>

<P><LI><B>To declare a Connection and Recordset object variable</B></LI></P>

<OL>
<P><LI>Open your application or the Visual Basic project located in the \Labs\Lab08\Partial folder.</LI></P>

<P><LI>Set a reference to the <B>Microsoft ActiveX Data Objects 2.0</B> object library.</LI></P>

<P><LI>In the General Declarations section of <B>frmReservation</B>, type the following code:</LI></P>

 <P><table cellpadding=5 width="95%"><TR><TD>
<PRE>Private cnReservation As ADODB.Connection
Private rsReservation As ADODB.Recordset</PRE>
</TD></TR></TABLE>
</P>
</OL>

<P><LI><B>To implement a custom Search form</B></LI></P>

<OL>
<P><LI>Create a new form and set the <B>Name</B> property to <B>frmSearch</B>.</LI></P>

<P><LI>Place three Label and TextBox controls, and one CommandButton on <B>frmSearch</B>, and set the following properties.</LI></P>
<P>
<TABLE CELLPADDING=5 WIDTH="95%">
<TR>
<TH>Control</TH>
<TH>Property</TH>
<TH>Value</TH></TR>
<TR>
<TD VALIGN="TOP">Label1</TD>
<TD VALIGN="TOP">Name</TD>
<TD VALIGN="TOP">lblLastName</TD></TR>
<TR>
<TD VALIGN="TOP"> </TD>
<TD VALIGN="TOP">Caption</TD>
<TD VALIGN="TOP">Last Name</TD></TR>
<TR>
<TD VALIGN="TOP">Text1</TD>
<TD VALIGN="TOP">Name</TD>
<TD VALIGN="TOP">txtLastName</TD></TR>
<TR>
<TD VALIGN="TOP"> </TD>
<TD VALIGN="TOP">Text</TD>
<TD VALIGN="TOP">&lt;blank&gt;</TD></TR>
<TR>
<TD VALIGN="TOP">Label2</TD>
<TD VALIGN="TOP">Name</TD>
<TD VALIGN="TOP">lblFirstName</TD></TR>
<TR>
<TD VALIGN="TOP"> </TD>
<TD VALIGN="TOP">Caption</TD>
<TD VALIGN="TOP">First Name</TD></TR>
<TR>
<TD VALIGN="TOP">Text2</TD>
<TD VALIGN="TOP">Name</TD>
<TD VALIGN="TOP">txtFirstName</TD></TR>
<TR>
<TD VALIGN="TOP"> </TD>
<TD VALIGN="TOP">Text</TD>
<TD VALIGN="TOP">&lt;blank&gt;</TD></TR>
<TR>
<TD VALIGN="TOP">Label3</TD>
<TD VALIGN="TOP">Name</TD>
<TD VALIGN="TOP">lblPhone</TD></TR>
<TR>
<TD VALIGN="TOP"> </TD>
<TD VALIGN="TOP">Caption</TD>
<TD VALIGN="TOP">Phone</TD></TR>
<TR>
<TD VALIGN="TOP">Text3</TD>
<TD VALIGN="TOP">Name</TD>
<TD VALIGN="TOP">txtPhone</TD></TR>
<TR>
<TD VALIGN="TOP"> </TD>
<TD VALIGN="TOP">Text</TD>
<TD VALIGN="TOP">&lt;blank&gt;</TD></TR>
<TR>
<TD VALIGN="TOP">Command1</TD>
<TD VALIGN="TOP">Name</TD>
<TD VALIGN="TOP">cmdSearch</TD></TR>
<TR>
<TD VALIGN="TOP"> </TD>
<TD VALIGN="TOP">Caption</TD>
<TD VALIGN="TOP">&amp;Search</TD></TR></TABLE></P>

 <P>Your form should look similar to Figure 8.4</P>

<P>
<img src="images/F08xx04.GIF" width=391 height=185 border="0">
</P><P>
<!--caption--><B>Figure 8.4</B> <i>Position of controls on frmSearch</i>  <!--/caption-->
</P>


<P><LI>In the Click event of <B>cmdSearch</B>, type the following code:</LI></P>

 <P><table cellpadding=5 width="95%"><TR><TD>
<PRE>'Hide the current form
Me.Hide</PRE>
</TD></TR></TABLE>
</P>

<P><LI>Save your work as <B>frmSearch.frm</B>.</LI></P>
</OL>

<A NAME="447"><H2>Exercise 2: Writing ADO Code</H2></A>

<P>In this exercise, you will write ADO code to query the Reservations table in the Rsvn.mdb database. The rsReservation Recordset object that you created in Exercise 1 will be based on information that the user enters into the fields on frmSearch.</P>

<P><LI><B>To open the rsReservation recordset</B></LI></P>

<OL>
<P><LI>In the <B>mnuGuestSearch_Click</B> event, type the following code:</LI></P>

 <P><table cellpadding=5 width="95%"><TR><TD>
<PRE>Dim SQL As String
Dim msgRetVal As Integer

frmSearch.Show vbModal
'Create a SQL statement to search for a guest
SQL = &quot;SELECT * FROM Reservation WHERE LastName LIKE '&quot; &amp; _
   frmSearch!txtLastName.Text &amp; &quot;%'&quot; &amp; _
   &quot; AND FirstName LIKE '&quot; &amp; frmSearch!txtFirstName.Text &amp; &quot;%'&quot; &amp; _
   &quot; AND Phone = '&quot; &amp; frmSearch.txtPhone.Text &amp; &quot;';&quot;
Unload frmSearch
Set frmSearch = Nothing
'Create and open the connection
Set cnReservation = New ADODB.Connection
cnReservation.ConnectionString = _
   &quot;Provider=Microsoft.Jet.OLEDB.3.51;&quot; &amp; _
   &quot;Data Source=C:\Labs\Rsvn.mdb&quot;
cnReservation.Open

Set rsReservation = New ADODB.Recordset
'Create and open the recordset
rsReservation.Open SQL, cnReservation, adOpenDynamic</PRE>
</TD></TR></TABLE>
</P>

<P><LI>Next, write the code necessary to place fields from the record into the text fields on frmReservation. Add the following code to the <B>mnuGuestSearch_Click</B> event:</LI></P>

 <P><table cellpadding=5 width="95%"><TR><TD>
<PRE>'If no records found, then display a message and exit the sub
If rsReservation.BOF And rsReservation.EOF Then
   MsgBox &quot;Unable to locate guest.&quot;
   Exit Sub
End If

'Place each field from the record into the fields on frmReservation
txtFirstName.Text = rsReservation![FirstName]
txtLastName.Text = rsReservation![LastName]
txtAddress.Text = rsReservation![Address]
txtNumDays.Text = rsReservation![NumberOfDays]
txtNumPeople.Text = rsReservation![NumberOfPeople]
txtPhone.Text = rsReservation![Phone]
txtRate.Text = rsReservation![Rate]
txtRoomNumber.Text = rsReservation![RoomNumber]
mskCheckIn.Text = Format(rsReservation![CheckInDate], &quot;mm-dd-yyyy&quot;)
txtCheckOut.Text = Format(DateAdd(&quot;d&quot;, _
   Val(txtNumDays.Text), mskCheckIn.Text), &quot;mm-dd-yyyy&quot;)
Select Case rsReservation![PaymentType]
   Case &quot;CREDIT CARD&quot;
     grpPmtType(0).Value = True
   Case &quot;CHECK&quot;
     grpPmtType(1).Value = True
   Case &quot;CASH&quot;
     grpPmtType(2).Value = True
End Select</PRE>
</TD></TR></TABLE>
</P>
</OL>
<P><LI><B>To test your application</B></LI></P>

<OL>
<P><LI>Start the application.</LI></P>

<P>The Reservation form appears.</P>

<P><LI>On the <B>Guest</B> menu, click <B>Search</B>.</LI></P>

<P>The Search form appears.</P>

<P><LI>Type <B>Fleming</B> for last name, <B>Brian</B> for first name, and <B>(206) 555-3412</B> (place a space after the close parenthesis) for phone number, as illustrated in Figure 8.5, and then click <B>Search</B>.</LI></P>

<P>
<img src="images/F08xx05.GIF" width=389 height=183 border="0">
</P><P>
<!--caption--><B>Figure 8.5</B> <i>Entering search values</i>  <!--/caption-->
</P>


<P>Visual Basic finds the record in the Reservation table. The recordset's field values appear in the controls on frmReservation, as illustrated in Figure 8.6.</P>

<P>
<A HREF="javascript:fullSize('F08xx06x.htm')"> <img src="images/F08xx06.JPG" width=404 height=319 border=0 ALT = "Click to view at full size."> </A>
</P><P>
<!--caption--><B>Figure 8.6</B>  <I>The frmReservation form containing the found record</I><!--/caption-->
</P>


<P><LI>On the <B>Run</B> menu, click <B>End</B>.</LI></P>

<P><LI>On the Visual Basic <B>File</B> menu, click <B>Save</B> <B>Project</B>.</LI></P></OL>

</BODY>
</HTML>





