<HTML>
<HEAD>
<TITLE>Lab: Using the ADO Data Control</TITLE>
<link rel="STYLESHEET" type="text/css" href="Library.css">


</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch07g.htm", "ch07i.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>

<A NAME="390"><H1>Lab: Using the ADO Data Control</H1></A>

<P>In this lab, you will add navigation capabilities to frmReservation. You will add the ADO Data control to frmReservation and connect to Microsoft Access' Reservation database. The database's Reservation table will be used as the data source for the ADO Data control. You will bind controls on the frmReservation to the ADO Data control at design time, and programmatically at run time. You can continue to work with the files you created in Lab 6, or use the files provided in the \Labs\Lab07\Partial folder. The solution code is in the \Labs\Lab07\Solution folder.</P>


<p>
<img src="images/video.gif" width=78 height=54 border="0">
</p>

<P>To see a demonstration of the solution, run the Lab07.exe animation located in the Animations folder on the Supplemental Course Materials CD-ROM that accompanies this book.</P>


<b>Estimated lesson time: 45 minutes</b>


<A NAME="391"><H2>Exercise 1: Connecting to a data source</H2></A>

<P>In this exercise, you will connect to a database using the ADO Data control's property pages.</P>

<P><LI><B>To open the hotel reservation application project</B></LI></P>
<ul>
<p><li>Open either the reservation application project that you have been working on or the Hotelres.vbp project located in the \Labs\Lab07\Partial folder.</li></p>
</ul>
<P><LI><B>To add an ADO Data control to frmReservation</B></LI></P>

<OL>
<P><LI>Use the <B>Components</B> dialog box to add the <B>Microsoft ADO Data Control 6.0 (OLE DB) </B>component to the toolbox.</LI></P>

<P><LI>Place an ADO Data control on <B>frmReservation</B> as illustrated in Figure 7.17.</LI></P>


<P>
<A HREF="javascript:fullSize('F07xx17x.htm')"> <img src="images/F07xx17.JPG" width=404 height=320 border=0 ALT = "Click to view at full size."> </A>
</P><P>
<!--caption--><B>Figure 7.17</B> <i>ADO Data control placed on frmReservation</i>  <!--/caption-->
</P>
</ol>

<P><LI><B>To connect the ADO Data control to a data source</B></LI></P>

<OL>
<P><LI>Set the ADO Data control's Name property to <B>adcReservation</B>, and the Caption property to <B>Reservations</B>.</LI></P>

<P><LI>Use the ADO Data control's property pages to create a connection string using the <B>Microsoft Jet OLE DB</B> provider to connect to the Rsvn.mdb database located in the \Labs\Lab07 folder.</LI></P>

<P><LI>Set the RecordSource property of the ADO Data control to use a <B>Command Type</B> of <B>2- adCmdTable</B>, and use <B>Reservations</B> as the <B>Table or Stored Procedure Name</B>, as illustrated in Figure 7.18.</LI></P>

<P>
<img src="images/F07xx18x.gif" width=419 height=315 border=0>
</P><P>
<!--caption--><B>Figure 7.18</B> <i>Setting RecordSource property of adcReservation</i>  <!--/caption-->
</P>


<P><LI>Set the <B>adcReservation</B> control's CursorType property to <B>3- adOpenStatic</B>.</LI></P>

<P>This will provide record browsing capability to users without allowing them to add, change, or delete records.</P>
</ol>


<A NAME="392"><H2>Exercise 2: Binding controls to the ADO Data control</H2></A>

<P>In this exercise, you will bind controls on the frmReservation form to the adcReservation control. Some controls will be bound at design time, while others will be bound programmatically at run time.</P>

<P><LI><B>To bind controls to adcReservation</B></LI></P>

<OL>
<P><LI>Using the <B>adcReservation</B> ADO Data control as the DataSource, set the DataField properties for all of the bound controls on <B>frmReservation</B>.</LI></P>

<P>Do not bind the <B>Payment Type</B> option buttons. They will be bound programmatically at run time.</P>
<P><LI>Set the DataFormat property of <B>mskCheckIn</B> to <B>Date</B> as illustrated in Figure 7.19.</LI></P>

<P>
<img src="images/F07xx19.GIF" width=398 height=361 border=0>
</P><P>
<!--caption--><B>Figure 7.19</B> <i>Formatting the mskCheckIn control</i>  <!--/caption-->
</P>


<P><LI>Type the following code statement before the End Sub statement in the <B>DisableControls</B> Sub procedure:</LI></P>

<P><TABLE CELLPADDING=5 WIDTH="95%"><TR><TD><PRE>
adcReservation.Enabled = True
</pre></td></tr></table></p>
 
  <P>The user will now be able to use the ADO Data control to navigate between records in the <B>Reservation</B> table.</P>

<P><LI>To have the <B>Payment Type </B>option buttons programmatically display the correct type of payment (Credit Card, Check or Cash) from <B>adcReservation</B> recordset, add the following code to the <B>adcReservation_MoveComplete</B> event.</LI></P>

<P><TABLE CELLPADDING=5 WIDTH="95%"><TR><TD><PRE>
Dim strStatus As String
Dim dtCheckIn As Date
Dim intNumDays As Integer
'If no value has been entered into the recordset 
'continue without stopping applicaiton
On Error Resume Next
'Check the payment type in the database and
'set the option buttons to correspond with the
'payment type value from the recordset
strStatus = adcReservation.Recordset![PaymentType]
Select Case strStatus
     Case &quot;CREDIT CARD&quot;
          grpPmtType(0).Value = True
     Case &quot;CHECK&quot;
          grpPmtType(1).Value = True
     Case &quot;CASH&quot;
          grpPmtType(2).Value = True
End Select

'Set the dtCheckIn and intNumDays variables
'to the values from the ADO Data control's recordset
dtCheckIn = adcReservation.Recordset![CheckInDate]
intNumDays = adcReservation.Recordset![NumberOfDays]
'Calculate the check out date and place it into
'the txtCheckOut control
txtCheckOut.Text = Format(DateAdd(&quot;d&quot;, intNumDays, dtCheckIn), _
     &quot;mm-dd-yyyy&quot;)
</pre></td></tr></table></p>
	 
<P><LI>Save and test your application.</LI></P>
</ol>

</BODY>
</HTML>





