<HTML>
<HEAD>
<TITLE>Lab: Connecting to COM Components</TITLE>
<link rel="STYLESHEET" type="text/css" href="Library.css">


</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch09e.htm", "ch09g.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>

<A NAME="483"><H1>Lab: Connecting to COM Components</H1></A>

<P>In this lab, you will connect to Microsoft Word and Microsoft Excel and automate the process of creating a reminder letter and invoice for the guests. You will use the Reservations database, which is in the \Labs folder. You will also use the Chateau.dot file, which is in the \Labs folder. You can continue to work with the files you created in Lab 8, or you can use the files provided for you in the \Labs\Lab09\Partial folder. The solution code can be found in the \Labs\Lab09\Solution folder.</P>

<p>
<img src="images/video.gif" width=78 height=54 border=0>
</p>

<P>To see a demonstration of the solution, run the Lab09.exe animation located in the Animations folder on the Supplemental Course Materials CD-ROM that accompanies this book.</P>

<A NAME="484"><H3>Estimated lesson time: 45 minutes</H3></A>

<A NAME="485"><H2>Exercise 1: Connecting to Microsoft Word</H2></A>

<P>In this exercise you will add reporting features to the reservation application's existing menu. In the new Reports menu you will add Reminder and Invoice menu items. In the Reminder menu item you will create an instance of Microsoft Word, send frmReservation values to the Word template, and then show it in Print Preview. </P>

<A NAME="486"><H3>Open the hotel reservation application project</H3></A>

<ul>
<p><li>Open the Chateau St. Mark hotel reservation system project.</li></p>
</ul>

<P><LI><B>To set a reference to the Microsoft Word type library</B></LI></P>

<OL>
<P><LI>On the <B>Project</B> menu, click <B>References</B>.</LI></P>

<P>The <B>References</B> dialog box appears.</P>
<P><LI>Click the <B>Microsoft Word 8.0 Object Library</B>, then click <B>OK</B>.</LI></P>
</ol>

<P><LI><B>To create the new Reports menu</B></LI></P>

<OL>
<P><LI>Add the following menu items using the Menu Editor. Position the new menu between the <B>Guest</B> and <B>Help</B> menus. The menu appearance is illustrated in Figure 9.12.</LI></P>
<P>
<table valign="top" cellpadding=5 width="95%">
<TR>
<th>Menu Item
</th>
<th>Property
</th>
<th>Value
</th></TR>
<TR>
<td valign="top" rowspan="2">&amp;Reports
</TD>
<td valign="top">Caption
</TD>
<td valign="top">&amp;Reports
</TD></TR>
<TR>

<td valign="top">Name
</TD>
<td valign="top">mnuReports
</TD></TR>
<TR>
<td valign="top" rowspan="2">&amp;Reminder
</TD>
<td valign="top">Caption
</TD>
<td valign="top">&amp;Reminder
</TD></TR>
<TR>

<td valign="top">Name
</TD>
<td valign="top">mnuReportsReminder
</TD></TR>
<TR>
<td valign="top" rowspan="2">&amp;Invoice
</TD>
<td valign="top">Caption
</TD>
<td valign="top">&amp;Invoice
</TD></TR>
<TR>

<td valign="top">Name
</TD>
<td valign="top">MnuReportsInvoice
</TD></TR></TABLE>
</p>

<P>
<img src="images/F09xx12.GIF" width=170 height=63 border="0">
</P><P>
<!--caption--><B>Figure 9.12</B> <i>The Reports menu</i>  <!--/caption-->
</P>

</ol>

<P><LI><B>To add code to automate Microsoft Word</B></LI></P>

<OL>
<P><LI>Add the following code to the <B>mnuReportsReminder_Click</B> event to create an instance of Microsoft Word:</LI></P>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>
Static wd As Word.Application
Static wdDoc As Word.Document
Dim strPmtType As String
'Create a new instance of word
Set wd = New Word.Application
</pre>
</td></tr>
</table>
</p>

<P><LI>Add the following code to the<B> mnuReportsReminder_Click</B> event to open the Chateau.dot template:</LI></P>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>
'Show the new instance of Word
wd.Visible = True
'Open the Chateau.dot Word template
Set wdDoc = wd.Documents.Add(&quot;C:\Labs\Chateau.dot&quot;)
</pre>
</td></tr>
</table>
</p>

<P><LI>Add the following code to the<B> mnuReportsReminder_Click</B> event to insert values into the template:</LI></P>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>
'Determine the payment type
If grpPmtType(0).Value = True Then
    strPmtType = &quot;Credit Card&quot;
ElseIf grpPmtType(1).Value Then
    strPmtType = &quot;Check&quot;
Else
    strPmtType = &quot;Cash&quot;
End If

'Fill the fields on the template with values from the form
With wdDoc
    .FormFields(&quot;wdFirstName&quot;).Range = txtFirstName.Text
    .FormFields(&quot;wdCheckIn&quot;).Range = mskCheckIn.Text
    .FormFields(&quot;wdNumOfDays&quot;).Range = txtNumDays.Text
    .FormFields(&quot;wdPmtType&quot;).Range = strPmtType
    .FormFields(&quot;wdCalcTotal&quot;).Range = _
        Format(CSng(txtNumDays.Text) * _
        CSng(txtRate.Text), &quot;Currency&quot;)
    .FormFields(&quot;wdCheckOut&quot;).Range = txtCheckOut.Text
End With
</pre>
</td></tr>
</table>
</p>

<P><LI>Add the following code to the<B> mnuReportsReminder_Click</B> event to show the document in Print Preview:</LI></P>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>
'Send the new document to printprieview
wdDoc.PrintPreview
</pre>
</td></tr>
</table>
</p>

 <P>A new Word document based on the Chateau.dot template opens and the form fields are filled in with values from frmReservation. The document then displays in Print Preview.</P>
</ol>

<P><LI><B>To test the application</B></LI></P>

<OL>
<P><LI>Save and run the application.</LI></P>

<P><LI>On <B>frmReservation,</B> select <B>Search</B> on the <B>Guest</B> menu.</LI></P>

<P><LI>Enter the following values into the <B>Search</B> form:</LI></P>
<P>
<table valign="top" cellpadding=5 width="95%">
<TR>
<th>Text box
</TH>
<th>Value
</TH></TR>
<TR>
<td valign="top">Last Name
</TD>
<td valign="top">Oberg
</TD></TR>
<TR>
<td valign="top">First Name
</TD>
<td valign="top">Bruce
</TD></TR>
<TR>
<td valign="top">Phone Number
</TD>
<td valign="top">(206) 555-9482
</TD></TR></TABLE>
</p>


<P><LI>Click <B>Search</B>.</LI></P>

<P><LI>Select <B>Reminder</B> on the <B>Reports</B> menu.</LI></P>

<P>Word opens and the Reminder letter displays in Print Preview.</P>

<P><LI>Close Word without saving the document.</LI></P>
</ol>

<A NAME="487"><H2>Exercise 2: Connecting to Microsoft Excel</H2></A>

<P>In this exercise you will create a Microsoft Excel invoice based on the current record in frmReservation.</P>

<p><div class="note"><blockquote><b>NOTE</b><HR>
You must have Microsoft Excel installed on your computer before you can use the automation code presented in this exercise.
</blockquote></div></p>

<P><LI><B>To set a reference to the Microsoft Excel type library</B></LI></P>

<OL>
<P><LI>On the <B>Project</B> menu, click <B>References</B>.</LI></P>

<P><LI>Click the <B>Microsoft Excel 8.0 Object Library</B>, then click <B>OK</B>.</LI></P>
</ol>

<P><LI><B>To add code to automate Microsoft Excel</B></LI></P>

<OL>
<P><LI>Add the following code to the <B>mnuReportsInvoice_Click</B> event to create an instance of Microsoft Excel:</LI></P>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>
Static xl As Excel.Application
Set xl = New Excel.Application
</pre>
</td></tr>
</table>
</p>

<P><LI>Add the following code to the <B>mnuReportsInvoice_Click</B> event to create a new Excel workbook, set font values, and insert values into the invoice spreadsheet:</LI></P>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>
With xl
    .Visible = True
    .Workbooks.Add
    'Define the properties the cell A1
    With .Range(&quot;A1&quot;)
        .Value = &quot;Chateau St. Mark Invoice&quot;
        .Font.Bold = True
        .Font.Name = &quot;Times New Roman&quot;
        .Font.Size = 26
    End With
    .Range(&quot;A4&quot;).Value = &quot;Name:&quot;
    .Range(&quot;B4&quot;).Value = txtFirstName.Text &amp; &quot; &quot; &amp; txtLastName.Text
    With .Range(&quot;A5&quot;)
        .Value = &quot;Address&quot;
        .VerticalAlignment = xlTop
    End With 
    With .Range(&quot;B5&quot;)
        .Value = txtAddress.Text
        .ColumnWidth = 20
        .WrapText = True
    End With
    .Range(&quot;A6&quot;).Value = &quot;Number of Days:&quot;
    .Range(&quot;B6&quot;).Value = txtNumDays.Text
    .Range(&quot;A7&quot;).Value = &quot;Rate:&quot;
    .Range(&quot;B7&quot;).Value = txtRate.Text
    .Range(&quot;A8&quot;).Value = &quot;Total Due:&quot;
    'Calculate the total amount due
    .Range(&quot;B8&quot;).Value = _
        Format(CSng(txtNumDays.Text) * _
        CSng(txtRate.Text), &quot;Currency&quot;)
End With
Columns(&quot;A:A&quot;).ColumnWidth = 25
</pre>
</td></tr>
</table>
</p>

<P><LI>Add the following code to the <B>mnuReportsInvoice_Click</B> event to show the invoice spreadsheet in Print Preview:</LI></P>

<p>
<table cellpadding=5 width="95%"><tr><td>
<pre>xl.ActiveWorkbook.PrintPreview</pre>
</td></tr>
</table>
</p>

<P><LI>Save your work. In the next exercise, steps are provided to help you test creating an invoice using Microsoft Excel.</LI></P>
</ol>

<P><LI><B>To test the application</B></LI></P>

<OL>
<P><LI>Save and run the application.</LI></P>

<P><LI>On <B>frmReservation</B>, select <B>Search</B> on the <B>Guest</B> menu.</LI></P>

<P><LI>Enter the following values into the <B>Search</B> form:</LI></P>
<P>
<table valign="top" cellpadding="5" width="95%">
<TR>
<th>Text box
</th>
<th>Value
</th></TR>
<TR>
<td valign="top">Last Name
</TD>
<td valign="top">Oberg
</TD></TR>
<TR>
<td valign="top">First Name
</TD>
<td valign="top">Bruce
</TD></TR>
<TR>
<td valign="top">Phone Number
</TD>
<td valign="top">(206) 555-9482
</TD></TR></TABLE>
</p>

<P><LI>Click <B>Search</B>.</LI></P>

<P><LI>Select <B>Invoice</B> on the <B>Reports</B> menu.</LI></P>

<P>Excel opens and the Invoice displays in Print Preview.</P>

<P><LI>Close Excel without saving the document.</LI></P>
</ol>

</BODY>
</HTML>





