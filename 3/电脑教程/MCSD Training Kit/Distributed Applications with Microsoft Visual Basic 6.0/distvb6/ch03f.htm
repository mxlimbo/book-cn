<HTML>
<HEAD>
<TITLE>Lab: Creating a COM DLL </TITLE>
<link rel="STYLESHEET" type="text/css" href="Library.css">

</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch03e.htm", "ch03g.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>


<A NAME="161"><H1>Lab: Creating a COM DLL </H1></A>

<P>In this lab, you will create a COM DLL that contains two classes. These classes will be based on a billing system for the Chateau St. Mark Hotel. The first class will be an Account class; the second will be a collection class that contains accounts. You will compile your COM DLL and create a client standard EXE project to use your COM DLL.</P>

<p>
<img src="images/video.gif" width=78 height=54 border="0">
</p>

<P>To see a demonstration of this lab, run the Lab03.exe animation located in the Animations folder on the Supplemental Course Material CD-ROM that accompanies this book.</P>


<p><b>Estimated lesson time: 40 minutes</b></p>

<P><LI><B> To create a COM DLL</B></LI></P>

<ol>

<p><li> Create a new ActiveX DLL project in Visual Basic</li></p>

<p><li> Name the project <B>Account</B>.</li></p>

<p><li> Create a class called <B>CAccount</B> and set its Instancing property to <B>PublicNotCreatable</B>.</li></p>

<p><li> Add the following properties to the class:</li></p>

<P>
	<TABLE VALIGN="top" CELLPADDING=5 WIDTH="95%">

		<TR>
			<TH>Property Name</TH>
			<TH>Data Type</TH>
			<TH>Procedure</TH>
		</TR>
		
		<TR>
			<TD VALIGN="TOP">AccountNumber</TD>
			<TD VALIGN="TOP">Integer</TD>
			<TD VALIGN="TOP">Get/Let</TD>
		</TR>

		<TR>
			<TD VALIGN="TOP">FullName</TD>
			<TD VALIGN="TOP">String</TD>
			<TD VALIGN="TOP">Get/Let</TD>
		</TR>

		<TR>
			<TD VALIGN="TOP">Balance</TD>
			<TD VALIGN="TOP">Currency</TD>
			<TD VALIGN="TOP">Get/Let</TD>
		</TR>
		
	</TABLE>
</P>	

<p>You will have to create property procedures and Private variables to hold the property values.</p>

<p><li> Use the ClassBuilder utility to create a collection based on the <B>CAccount</B> class.</li></p>

<p><li> Name the collection class <B>colAcc</B>, and set its Instancing property to <B>MultiUse</B>.</li></p>

<p><li> Save your work, and compile your project.</li></p>

<p>Click <B>Make Account.dll</B> from the File menu.</p>

</ol>

<P><LI><B> To create a client application</B></LI></P>

<ol>

<p><li> Add a new Standard EXE project named <B>AcctEXE</B>.</li></p>

<p><li> Add a reference to the Account project.</li></p>

<p><li> Set Project1 as the startup project.</li></p>

<p><li> Change the name of Form1 to <B>frmAccts</B>.</li></p>

<p><li> Add three CommandButton controls and three Label controls to frmAccts with the following properties:</li></p>

<P>
	<TABLE VALIGN="top" CELLPADDING=5 WIDTH="95%">

		<TR>
			<TH>Control</TH>
			<TH>Property</TH>
			<TH>Value</TH>
		</TR>

		<TR>
			<TD VALIGN="TOP">cmdAddAccounts</TD>
			<TD VALIGN="TOP">Caption</TD>
			<TD VALIGN="TOP">&amp;Add Accounts</TD>
		</TR>
		
		<TR>
			<TD VALIGN="TOP">cmdGetAccount</TD>
			<TD VALIGN="TOP">Caption</TD>
			<TD VALIGN="TOP">&amp;Get Account</TD>
		</TR>

		<TR>
			<TD VALIGN="TOP">cmdExit</TD>
			<TD VALIGN="TOP">Caption</TD>
			<TD VALIGN="TOP">E&amp;xit</TD>
		</TR>

		<TR>
			<TD VALIGN="TOP">lblAccountNumber</TD>
			<TD VALIGN="TOP">Caption</TD>
			<TD VALIGN="TOP">&lt;blank&gt;</TD>
		</TR>

		<TR>
			<TD VALIGN="TOP">lblFullName</TD>
			<TD VALIGN="TOP">Caption</TD>
			<TD VALIGN="TOP">&lt;blank&gt;</TD>
		</TR>

		<TR>
			<TD VALIGN="TOP">lblBalance</TD>
			<TD VALIGN="TOP">Caption</TD>
			<TD VALIGN="TOP">&lt;blank&gt;</TD>
		</TR>
	
	</TABLE>
</P>

<p>Your form should look similar to the illustration in Figure 3.15.</p>

<P>
<A HREF="javascript:fullSize('F03xx15x.htm')"> <img src="images/F03xx15.JPG" width=404 height=184 border=0 ALT = "Click to view at full size."> </A>
</P><P>
<!--caption--><b>Figure 3.15</b> <i>The client application form</i><!--/caption-->
</P>


<p><li> Add the following code to your client application:</li></p>

<P>
<TABLE CELLPADDING=5 WIDTH ="95%">
<TR><TD>
<PRE>
' General Declarations
Private Accts As New colAcc

Private Sub cmdAddAccounts_Click()
    ' Add account objects to the Accts collection
    Accts.Add 1, &quot;John Smith&quot;, 5000
    Accts.Add 2, &quot;Jane Doe&quot;, 1000
    Accts.Add 3, &quot;Jim Thomas&quot;, 3000
End Sub

Private Sub cmdExit_Click()
    Set Accts = Nothing
    Unload Me
End Sub

Private Sub cmdGetAccount_Click()
    Dim intAcctNum As Integer
    Dim Acct As CAccount

    ' Ask the user for an account number to get from the collection
    intAcctNum = Int(Val(InputBox(&quot;Enter an account number&quot;, _
        &quot;Get Account&quot;)))
    ' Run the Item property procedure in the colAcc collection class
    Set Acct = Accts.Item(intAcctNum)
    ' Display values on the form
    lblAccountNumber.Caption = Acct.AccountNumber
    lblFullName.Caption = Acct.FullName
    lblBalance.Caption = Format(Acct.Balance, &quot;currency&quot;)
    Set Acct = Nothing
End Sub
</PRE>
</TD></TR></TABLE>
</P>

<p><li> Save and run your project in Visual Basic.</li></p>

<p><li> When prompted for an account number, type <B>3</B> and click <B>OK</B>.</li></p>

<p>The information appears for the account with the AccountNumber property of 3, as illustrated in Figure 3.16.</p>



<P>
<A HREF="javascript:fullSize('F03xx16x.htm')"> <img src="images/F03xx16.JPG" width=404 height=216 border=0 ALT = "Click to view at full size."> </A>
</P><P>
<!--caption--><b>Figure 3.16</b> <i>Information for account number 3 displayed on the client form</i><!--/caption-->
</P>

</ol>

</BODY>
</HTML>



