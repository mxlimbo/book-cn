<HTML>
<HEAD>
<TITLE>Lesson 3: Navigating Records</TITLE>
<link rel="STYLESHEET" type="text/css" href="Library.css">

</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch06c.htm", "ch06e.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>


<A NAME="245"><H1>Lesson 3: Navigating Records</H1></A>

<P>ADO provides several methods and properties to navigate and monitor recordsets. A recordset's navigation options may vary, depending on the cursor type and location. You need to consider what navigation requirements are needed before opening a recordset.</P>

<P>Of all the ADO objects, only the Recordset object allows users to navigate through a set of records. Only one record within a recordset is current at a given time, therefore, the Recordset object supports a number of properties and methods that allow users to navigate through the recordset.</P>

<p>
<div class="sidebar"><blockquote>
<b>After this lesson, you will be able to:</b>
<ul>

<p><li>Use the ADO recordset navigation methods.</li></p>

<p><li>Explain various ADO recordset navigation properties.</li></p>

</ul>
<b>Estimated lesson time: 15 minutes</b>
</blockquote></div>
</p>

<A NAME="246"><H2>ADO Navigation Properties</H2></A>

<P>The following table lists the properties of the Recordset object that are used to navigate a recordset:</P>
<P>
<TABLE CELLPADDING=5 WIDTH="95%">
<TR>
<Th>Property
</Th>
<Th>Description
</Th></TR>
<TR>
<TD VALIGN="TOP">AbsolutePage
</TD>
<TD VALIGN="TOP">Sets or returns the absolute page in which the current record exists.
</TD></TR>
<TR>
<TD VALIGN="TOP">AbsolutePosition
</TD>
<TD VALIGN="TOP">Sets or returns the absolute position of the current record (this can be affected by record additions or deletions).
</TD></TR>
<TR>
<TD VALIGN="TOP">BOF
</TD>
<TD VALIGN="TOP">Indicates if the record pointer has moved before the first record.
</TD></TR>
<TR>
<TD VALIGN="TOP">Bookmark
</TD>
<TD VALIGN="TOP">Returns a unique identifier for the current record. Setting this property to a specific record's bookmark moves the record pointer to that record.
</TD></TR>
<TR>
<TD VALIGN="TOP">EOF
</TD>
<TD VALIGN="TOP">Indicates if the record pointer has moved past the last record.
</TD></TR></TABLE></p>

<P>The following example evaluates the EOF property:</P>

<P><TABLE CELLPADDING=5 WIDTH="95%"><TR><TD><PRE>
If rsAuthor.EOF Then _
    MsgBox &quot;The end of the recordset has been reached.&quot;
End If
</pre></td></tr></table></p>

<A NAME="247"><H2>ADO Navigation Methods</H2></A>

<P>The following table lists the methods of the Recordset object that are used to navigate through a recordset.</P>
<P>
<TABLE CELLPADDING=5 WIDTH="95%">
<TR>
<Th>Method
</Th>
<Th>Description
</Th></TR>
<TR>
<TD VALIGN="TOP">Move
</TD>
<TD VALIGN="TOP">Moves a specified number of records forward or back.
</TD></TR>
<TR>
<TD VALIGN="TOP">MoveFirst
</TD>
<TD VALIGN="TOP">Moves to the first record.
</TD></TR>
<TR>
<TD VALIGN="TOP">MoveLast
</TD>
<TD VALIGN="TOP">Moves to the last record.
</TD></TR>
<TR>
<TD VALIGN="TOP">MoveNext
</TD>
<TD VALIGN="TOP">Moves to the next record.
</TD></TR>
<TR>
<TD VALIGN="TOP">MovePrevious
</TD>
<TD VALIGN="TOP">Moves to the previous record.
</TD></TR></TABLE></p>


<p>
<img src="images/practice.gif" width=67 height=55 alt="" border="0">
</p>
 

<A NAME="248"><H2>Practice: Navigating an ADO Recordset</H2></A>

<P>In this practice you will build an application that creates a recordset object based on the Authors table in the SQL Server Pubs database. This application will have navigation buttons that allow movement through the recordset object. Figure 6.1 illustrates the layout of the application form.</P>

<P>
<img src="images/F06xx01.GIF" width=319 height=239 border=0>
</P><P>
<!--caption--><b>Figure 6.1</b> <i>Database navigation controls on the form</i><!--/caption-->
</P>


<p><li><b>To connect to the SQL Server</B></li></P>

<ol>
<p><li>Open a new Visual Basic Standard EXE.</li></p>

<p><li>On the <B>Project</B> Menu, click <B>References</B>.</li></p>

<p><li>Check <B>Microsoft ActiveX Data Objects 2.0 Library</B> and click <B>OK</B>.</li></p>

<p><li>Set the project <B>Name</B> property to <B>PracL4</B>.</li></p>

<p><li>Set the name property of Form1 to <B>frmAuthors</B></li></p>

<p><li>Add two Textbox controls to the form. Set their name properties to <B>txtFirst</B> and <B>txtLast</B>.</li></p>

<p><li>Add four CommandButton controls and a Label control to the form. Arrange the controls as shown in Figure 6.1. Set the following control properties:</li></p>

<P>
	<TABLE width="95%" cellpadding=5>

		<TR>
			<Th>Control</th>
			<Th>Property</th>
			<Th>Value</th>
		</TR>
		
		<TR>
			<TD VALIGN="TOP"><P>Command1</P></TD>
			<TD VALIGN="TOP">Name<br>Caption</td>
			<TD VALIGN="TOP">CmdFirst<br>|&lt;</TD>
		</TR>
		
		<TR>
			<TD VALIGN="TOP"><P>Command2</P></TD>
			<TD VALIGN="TOP">Name<br>Caption</TD>
			<TD VALIGN="TOP">CmdPrevious<br>&lt;&lt;</TD>
		</TR>

		<TR>
			<TD VALIGN="TOP"><P>Command3</P></TD>
			<TD VALIGN="TOP">Name<br>Caption</TD>
			<TD VALIGN="TOP">CmdNext<br>&gt;&gt;</TD>
		</TR>

		<TR>
			<TD VALIGN="TOP"><P>Command4</P></TD>
			<TD VALIGN="TOP">Name<br>Caption</TD>
			<TD VALIGN="TOP">CmdLast<br>&gt;|</TD>
		</TR>

		<TR>
			<TD VALIGN="TOP"><P>Label1</P></TD>
			<TD VALIGN="TOP">Name<br>Caption</TD>
			<TD VALIGN="TOP">LblRecordCount<br>&lt;blank&gt;</TD>
		</TR>
	
	</TABLE>
</p>

<p><li>Save the project files to the \Practice\Ch06 folder.</li></p>
</ol>

<p><li><b>To create a connection and a recordset</B></li></P>

<ol>
<p><li>Add the following variable declarations to the frmAuthor's General Declarations section.</li></p>

<P><TABLE CELLPADDING=5 WIDTH="95%"><TR><TD><PRE>
' Use the events of the Recordset object
Private WithEvents rsAuthors As ADODB.Recordset
Private strConnect As String
Private cn As ADODB.Connection
</pre></td></tr></table></p>

<p><li>Add the following code to the Form_Load event procedure.</li></p>

<P><TABLE CELLPADDING=5 WIDTH="95%"><TR><TD><PRE>
Private Sub Form_Load()
    ' Use your local SQL Server name for the Data Source
    strConnect = &quot;Provider=SQLOLEDB;User ID=sa;&quot; &amp; _
        &quot;Data Source=VB6ENTSVR;&quot; amp; _
        &quot;Initial Catalog=Pubs&quot;

    ' Instantiate a Connection object
    Set cn = New ADODB.Connection
' Open a new connection
    cn.Open strConnect, &quot;sa&quot;, &quot;&quot;
    ' Instantiate the Recordset object
    Set rsAuthors = New ADODB.Recordset
    ' Set the CursorType, LockType and CursorLocation
    rsAuthors.CursorType = adOpenDynamic
    rsAuthors.LockType = adLockOptimistic
    rsAuthors.CursorLocation = adUseClient

    ' Open a new recordset using the
    ' cn connection and return the appropriate records
    rsAuthors.Open &quot;Select * from Authors&quot;, cn
    ' Bind the Textbox controls
    Set txtFirst.DataSource = rsAuthors
    txtFirst.DataField = &quot;au_fname&quot;
    Set txtLast.DataSource = rsAuthors
    txtLast.DataField = &quot;au_lname&quot;
End Sub


</pre></td></tr></table></p>

<p>This code creates a connection to the Pubs database on your SQL Server. It then creates a client-side, dynamic Recordset object from the Authors table. The txtFirst and txtLast controls are bound to the au_fname and au_lname fields.</p>
</ol>

<p><li><b>To add navigation features to the form</B></li></P>

<ol>
<p><li>Use the <B>MoveFirst</B>, <B>MovePrevious</B>, <B>MoveNext</B> and <B>MoveLast</B> methods in the command button <B>Click</B> events to give the user the ability to navigate the records. The following example shows the Click event procedures:</li></p>

<P><TABLE CELLPADDING=5 WIDTH="95%"><TR><TD><PRE>
Private Sub cmdFirst_Click()
    rsAuthors.MoveFirst
End Sub

Private Sub cmdLast_Click()
    rsAuthors.MoveLast
End Sub

Private Sub cmdNext_Click()
    rsAuthors.MoveNext
End Sub

Private Sub cmdPrevious_Click()
    rsAuthors.MovePrevious
End Sub
</pre></td></tr></table></p>

<p><li>Save the application.</li></p>

<p><li>Run the application and try navigating through the Authors records.</li></p>
</ol>

<p><li><b>To use ADO object events</B></li></P>

<ol>
<p><li>From the frmAuthors module window, select <B>rsAuthors</B> from the <B>Object</B> drop-down list (see Figure 6.2).</li></p>

<P>
<img src="images/F06xx02.GIF" width=403 height=283 border=0>
</P><P>
<!--caption--><b>Figure 6.2</b> <i>The Object list</i><!--/caption-->
</P>


<p><li>From the <B>Procedure</B> drop-down list, select the <B>MoveComplete</B> procedure. Add the following code to the MoveComplete event:</li></p>

<P><TABLE CELLPADDING=5 WIDTH="95%"><TR><TD><PRE>
Private Sub rsAuthors_MoveComplete(ByVal adReason As _ 
    ADODB.EventReasonEnum, ByVal pError As ADODB.Error,  _
        adStatus As ADODB.EventStatusEnum, _
        ByVal pRecordset As ADODB.Recordset)
    ' Avoid reading beyond the end of file (EOF) or the
    ' beginning of file (BOF)
    If rsAuthors.EOF Then
        rsAuthors.MoveLast
    ElseIf rsAuthors.BOF Then
        rsAuthors.MoveFirst
    End If
    ' Set the label's caption to show current record
    ' and total record count
    lblRecordCount.Caption = &quot;Record &quot; &amp; _ 
        rsAuthors.AbsolutePosition _ 
        &amp; &quot; of &quot; &amp; rsAuthors.RecordCount
End Sub
</pre></td></tr></table></p>

<p><li>Save and test the application. Figure 6.3 illustrates the completed form.</li></p>

<P>
<img src="images/F06xx03.GIF" width=320 height=240 border=0>
</P><P>
<!--caption--><b>Figure 6.3</b> <i>The completed form</i><!--/caption-->
</P>


</ol>

<A NAME="249"><H2>Lesson Summary </H2></A>

<P>In this lesson you learned how to navigate through the results of a data source query using the Recordset object. The various properties and methods supported by a recordset were described. In addition, you completed a practice that illustrated the use of various navigation properties, such as BOF, EOF, and the Move methods.</P>



</BODY>
</HTML>



