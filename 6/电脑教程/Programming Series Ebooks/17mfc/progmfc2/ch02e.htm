<HTML>
<HEAD>
	<link rel="STYLESHEET" type="text/css" href="Library.css">
<TITLE>Loose Ends</TITLE>


</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000">
<SCRIPT LANGUAGE="JavaScript">
<!--

function fullSize(sURL){
	window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}

function LibraryHeaderNav(sBackward, sForward, sImgLeftOff, sImgLeftOn, sImgRightOff, sImgRightOn, iH, iW, sImgLeftStyle, sImgRightStyle, sImgRuleStyle, sRuleColor, sRuleSize){
	var tableStr;
	//validate questionable args for defs
	tableStr = "<TABLE BORDER=0 CELLPADDING=0 CELLSPACING=0 border=0 width=100%>";
	tableStr += "<TR VALIGN=top ALIGN=right>";

	tableStr += "<TD align=right class=" + sImgRuleStyle + ">&nbsp;</TD>";	
	
	tableStr += "<TD width=34 align=right class=" + sImgLeftStyle + ">";
	tableStr += "<A href='" + sBackward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgLeftOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgLeftOff + '\'\"';
	tableStr += " SRC='" + sImgLeftOff + "' vspace=0 hspace=0></a></TD>";
	
	tableStr += "<TD width=34 align=left class=" + sImgRightStyle + ">";
	tableStr += "<A href='" + sForward + "'>";
	tableStr += "<IMG HEIGHT=" + iH + " WIDTH=" + iW + " BORDER=0";
	tableStr += ' OnMouseOver=\"this.src=\'' + sImgRightOn + '\'\"';
	tableStr += ' OnMouseOut=\"this.src=\'' + sImgRightOff + '\'\"';
	tableStr += " SRC='" + sImgRightOff + "' vspace=0 hspace=0></a></TD></TR>";

	tableStr += "<TR VALIGN=top>";
	tableStr += "<TD height=3 align=center colspan=3 class=" + sImgRuleStyle + ">";
	tableStr += "<HR color=" + sRuleColor + " size=" + sRuleSize + "></TD></TR></TABLE>";
	//alert(tableStr);
	document.write(tableStr);
}

 																						     //purple is: #aa22aa   orange is: #ff9900
LibraryHeaderNav("ch02d.htm", "ch03a.htm", "images/unit_o_a1.gif", "images/unit_o_a2.gif", "images/unit_o_b1.gif", "images/unit_o_b2.gif", 18, 34, "unit01", "unit02", "headerrule", "#ff9900", "2");
//--></SCRIPT>

<A NAME="66"><H1>Loose Ends</H1></A>

<p>
Before we close out the chapter, we need to tie up one loose end. All the programs presented thus far have created a window with the statement
</P>

<p><table cellpadding=5 width="95%"><tr><td>	<pre>m_pMainWnd = new CMainWindow;
</pre>
</td></tr></table></p>

<p>
in <I>InitInstance</I>. Since the object is instantiated with <I>new</I>, it remains in memory after <I>InitInstance</I> ends and, in fact, will not go away until it is deleted with a <I>delete</I> statement. Yet nowhere in the programs' source code will you find such a statement. On the surface, this would seem to be a problem. After all, every C++ programmer knows that every <I>new</I> must be countered with a <I>delete</I> or objects will be left behind in memory. So what gives? 
</p>

<p>
As you probably suspected, the class library deletes the object for you. To be more precise, the object deletes itself. The key to this little trick is that the very last message a window receives before it goes away for good is WM_NCDESTROY. If you look at the source code for <I>CWnd::OnNcDestroy</I>, you'll see that it calls a virtual function named <I>PostNcDestroy</I>. <I>CFrameWnd</I> overrides <I>PostNcDestroy</I> and executes a
</P>

<p><table cellpadding=5 width="95%"><tr><td>	
<PRE>delete this;
</pre>
</td></tr></table></p>

<p>
statement. Therefore, when a frame window is destroyed, the object associated 
with that window is automatically deleted, too. A frame window is destroyed when 
the user closes the application.
</P>

<p>
It's worth noting that <I>CWnd</I>'s own implementation of 
<I>PostNcDestroy</I> does not delete the associated window object. Therefore, if you derive your own window 
class directly from <I>CWnd</I>, you also need to override 
<I>PostNcDestroy</I> in the derived class and execute a 
<I>delete this</I> statement. Otherwise, the 
<I>CWnd</I> object will not be properly deleted. You'll see what I mean in the next chapter.
</P>
</BODY>
</HTML>




