<HTML>
<HEAD>
<TITLE>A Thread's Message Queue</TITLE>
<link rel="STYLESHEET" type="text/css" href="advwin4.css">
<SCRIPT LANGUAGE="JavaScript"><!-- 
function fullSize(sURL){window.open(sURL,'scrshot','width=500,height=375,top=20,left=20,directories=no , Toolbar = no, resizable = yes, menubar = no, ScrollBars = yes ');
}
--></SCRIPT>
</HEAD>
<BODY BGCOLOR="#ffffff" TEXT="#000000">
<A HREF="ch26a.htm">[Previous]</A> <A HREF="ch26c.htm">[Next]</A><P>

<A NAME="349"><H1>A Thread's Message Queue</H1></A>

<p>As I have already said, one of the main goals of Windows is to offer
a robust environment for all the applications running. To meet this
goal, each thread must run in an environment in which it believes that
it is the only thread running. More specifically, each thread must have
message queues that are totally unaffected by other threads. In
addition, each thread must have a simulated environment that allows the
thread to maintain its own notion of keyboard focus, window activation,
mouse capture, and so on.</p>

<p>When a thread is first created, the system assumes that the thread
will not be used for any user interface_related tasks. This reduces the
system resources required by the thread. However, as soon as the thread
calls a graphical UI-related function (such as checking its message
queue or creating a window) the system automatically allocates some
additional resources for the thread so that it can perform its
UI-related tasks. Specifically, the system allocates a THREADINFO
structure and associates this data structure with the thread.</p>

<p>This THREADINFO structure contains a set of member variables that
are used to make the thread think that it is running in its very own
environment. The THREADINFO structure is an internal, undocumented data
structure that identifies the thread's posted-message queue,
send-message queue, reply- 
message queue, virtualized-input queue, and wake flags, as well as a
number of variables that are used for the thread's local input
state. Figure 26-1 illustrates how THREADINFO structures are associated
with three threads.</p>

<p>This THREADINFO structure is the cornerstone of the windows
messaging system and you should refer to this figure as you read the
following sections.</p>

<p>
<A HREF="javascript:fullSize('F26si01x.htm')"> <img src="images/F26si01.JPG" width=404 height=593 border=0 ALT="Click to view at full size."> </A>
</p><p>
<!-- CAPTION --><b>Figure 26-1.</b> <i>Three threads with their respective THREADINFO structures</i><!-- /CAPTION -->
</p>

</BODY>
</HTML>






