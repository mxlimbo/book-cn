<html>
<head>
<title>网络编程基础篇之CGI</title>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<link rel="stylesheet" href="ebook.css" type="text/css">
</head>
<body leftmargin="0" topmargin="0" background="bg.jpg">
<table width="100%" cellspacing="0">
  <tr>
    <td valign="top" bgcolor="#FFD26A">
      <table width="180" height="100%">
        <tr align="center" valign="top">
          <td>
            <p><img src="image.jpg"></p>
            <p><a href="list.htm"><img src="bd.gif" border="0"></a><br>
              <a href="06.htm"><img src="ap.gif" border="0"></a></p>
          </td>
        </tr>
        <tr align="center" valign="bottom">
          <td><a href="08.htm"><img src="np.gif" border="0"></a></td>
        </tr>
      </table>
    </td>
    <td valign="top">
      <blockquote>
        <div align="center"><img src="title.gif"></div>
        <!--正文开始-->
        <font color="#0000FF">7.上传文件</font> 
        <p>上传文件是建立交互式网站的一个重要手段。一般来说，考虑到CGI程序的安全和一些敏感问题，服务器是不会轻易开放文件上传权利的。<br>
          我们用一个由VB编写而成的upload.exe程序。讲一讲VB写WIN-CGI时候的一些问题。</p>
        <font color="#0000FF">7.1 VB写Win-CGI:</font><br>
        在Windows环境下，WEB服务器和一个Windows CGI之间是通过临时文件来传送数据的。这个过程如下：<br>
        1.Web服务器接受一个客户机对Windows CGI程序的请求，这个请求也称为Windows CGI请求。<br>
        2.Web服务器把要传送给Windows CGI程序的数据放在一个叫CGI profile的主输入文件。在某些情况下，还会增加一个文件。<br>
        3.Web服务器执行CGI程序，把CGI profile作为它的第一个参数。<br>
        4.Windows CGI开始执行，服务器等待Windows CGI进程结束。在等待过程中，服务器还可以处理其他请求，比如另一个新的CGI进程或HTTP请求。<br>
        5.Windows CGI程序读取作为命令行参数的profile文件并完成必要的处理，CGI程序也许要使用porfile文件中的数据和其他相关的辅助文件中的数据。<br>
        6.在Windows CGI程序结束前，把它的应答写在profile文件指定的输出文件中。<br>
        7.得到CGI程序处理结果后，WEB服务器读取输出文件，看看输出数据是否要打包，并把最后数据发给客户机。<br>
        8.WEB服务器随后就删除处理这个请求时产生的临时文件。如果在服务器管理器注册时，不删除临时文件，则保留这些临时文件。<br>
        <br>
        总的说，基于文件的传输过程是比较古老的。但它是最常用的通讯方式。<br>
        <br>
        <font color="#0000FF">7.2 CGI32.BAS</font><br>
        CGI32.BAS是给windows系列的使用者在VB4.0或更高的环境下开发Windows-cgi而写的一个程序接口。本文假设你已经对VB编程非常熟悉，所以对于使用VB的过程我就省略不说了。在写Win-CGI程序的时候，请将VB环境中的有效对象全部关掉（Custom 
        controls），并将CGI32.bas加入project中。随后创建一个子程序
        <ul>CGI_Main()<br>
    Sub CGI-Main()<br>
    'Win-CGI程序内容<br>
    end sub></ul>
         对于CGI32.bas，如果你还没有，请在这里<a href="Cgi32.bas.zip">下载</a>。<br>
    <br><ul>
    Sub Main()<br>
    On Error GoTo ErrorHandler<br>
    <br>
    If Trim$(Command$) = "" Then ' Interactive start<br>
    Inter_Main ' Call interactive main<br>
    Exit Sub ' Exit the program<br>
    End If<br>
    <br>
    InitializeCGI ' Create the CGI environment<br>
    <br>
    '===========<br>
    CGI_Main ' Execute the actual "script"<br>
    '===========<br>
    <br>
    Cleanup:<br>
    Close #CGI_OutputFN<br>
    Exit Sub ' End the program<br>
    '------------<br>
    ErrorHandler:<br>
    Select Case Err ' Decode our "user defined" errors<br>
    Case ERR_NO_FIELD:<br>
    ErrorString = "Unknown form field"<br>
    Case Else:<br>
    ErrorString = Error$ ' Must be VB error<br>
    End Select<br>
    <br>
    ErrorString = ErrorString &amp; " (error #" &amp; Err &amp; ")"<br>
    On Error GoTo 0 ' Prevent recursion<br>
    ErrorHandler (Err) ' Generate HTTP error result<br>
    Resume Cleanup<br>
    '------------<br>
    End Sub</ul>
    上面是一个Win-cgi的例子。<br>
        <br>
        <font color="#0000FF">7.3 upload.exe</font><br>
        限于篇幅，这个程序不打算写出所有代码，只是把已经编译好的upload.exe放在这里。有兴趣的朋友可以在<a
    href="uploader.exe.zip">这里下载</a>。现在后，请将upload.exe放在你的Cgi-win目录下，如果你是使用其他的Server（不是ohttpd的话），可能在执行时候会有些麻烦，那就没有办法了。<br>
        <br>
        <!--正文结束-->
      <center>
      <hr>
      <p>本书由<a href="http://www.huiniao.com/">【灰鸟资讯】</a>免费制作<br>
          想要更多的免费电子图书，请光临<br>
          <a href="http://www.huiniao.com">http://www.huiniao.com</a></p>
      </center>
      </blockquote>
    </td>
  </tr>
</table>
</body>
</html>
